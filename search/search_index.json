{"config":{"lang":["en"],"separator":"[\\s\\-,:!=\\[\\]()\"`/]+|\\.(?!\\d)|&[lg]t;|(?!\\b)(?=[A-Z][a-z])","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Home","text":""},{"location":"design/00-index_zh/","title":"\u4e3a\u4ec0\u4e48\u8981\u5f00\u53d1sysMaster","text":"<p>sysMaster\u662fopenEuler\u5bf9\u5f53\u524dLinux\u7cfb\u7edf\u521d\u59cb\u5316\u548c\u670d\u52a1\u7ba1\u7406\u5728\u5d4c\u5165\u5f0f\uff0c\u670d\u52a1\u5668\uff0c\u4e91\u5316\u7b49\u4e0d\u540c\u573a\u666f\u4e0b\u9762\u4e34\u7684\u95ee\u9898\u548c\u7279\u70b9\u8fdb\u884c\u603b\u7ed3\u548c\u601d\u8003\u540e\uff0c\u5f00\u5c55\u7684\u4e00\u79cd\u6539\u8fdb\u548c\u63a2\u7d22\uff0c\u63d0\u4f9b\u7edf\u4e00\u7684\uff0c\u80fd\u591f\u652f\u6301\u5d4c\u5165\u5f0f\uff0c\u670d\u52a1\u5668\uff0c\u4e91\u573a\u666f\u4e0b\u7684\u7cfb\u7edf\u521d\u59cb\u5316\u548c\u670d\u52a1\uff08\u8fdb\u7a0b\uff0c\u5bb9\u5668\uff0c\u865a\u62df\u673a\uff09\u7ba1\u7406\u7cfb\u7edf\u3002</p> <p></p>"},{"location":"design/00-index_zh/#linux","title":"Linux\u7684\u521d\u59cb\u5316\u7cfb\u7edf\u548c\u670d\u52a1\u7ba1\u7406","text":"<p>\u6211\u4eec\u90fd\u77e5\u90531\u53f7\u8fdb\u7a0b\u662f\u6240\u6709Unix\u7cfb\u7edf\u4e2d\u7531\u5185\u6838\u542f\u52a8\u7684\u7b2c\u4e00\u4e2a\u7528\u6237\u6001\u8fdb \u7a0b\uff0c\u5b83\u662f\u64cd\u4f5c\u7cfb\u7edf\u6b63\u5e38\u5de5\u4f5c\u7684\u524d\u63d0\uff0c\u5b83\u662f\u64cd\u4f5c\u7cfb\u7edf\u521d\u59cb\u5316\u7a0b\u5e8f\u7684\u4ee3\u8868\uff08\u521d\u59cb\u5316\u5b9e\u9645\u5305\u542b\u4e00\u4e9b\u7684\u5de5\u5177\u96c6\u5408\uff09\uff0c\u5e76\u4e14\u9700\u8981\u4e00\u76f4\u8fd0\u884c\u5728\u540e\u53f0\uff0c\u56de\u6536\u5b64\u513f\u8fdb\u7a0b\uff0c\u786e\u4fdd\u7cfb\u7edf\u6b63\u5e38\u5de5\u4f5c\u3002 \u5927\u5bb6\u719f\u6089\u7684\u521d\u59cb\u5316\u7cfb\u7edf\uff0c\u6709\u5386\u53f2\u60a0\u4e45\u7684sysvinit\uff0c\u6709Debian\u548cUbuntu\u7b49\u7cfb\u7edf\u7684Upstart\uff0c\u4ee5\u53ca\u5f53\u524d\u4f7f\u7528\u5e7f\u6cdb\u7684systemd\uff0c\u8fd9\u4e9b\u8f6f\u4ef6\u5404\u6709\u7279\u70b9\uff0c\u5177\u4f53\u53ef\u4ee5\u53c2\u8003\u4e0b\u8868:</p> Init\u8f6f\u4ef6 \u8bf4\u660e \u542f\u52a8\u7ba1\u7406 \u8fdb\u7a0b\u56de\u6536 \u670d\u52a1\u7ba1\u7406 \u5e76\u884c\u542f\u52a8 \u8bbe\u5907\u7ba1\u7406 \u8d44\u6e90\u63a7\u5236 \u65e5\u5fd7\u7ba1\u7406 sysvinit \u65e9\u671f\u7248\u672c\u4f7f\u7528\u7684\u521d\u59cb\u5316\u8fdb\u7a0b\u5de5\u5177,  \u9010\u6e10\u6de1\u51fa\u821e\u53f0\u3002 \u2713 \u2713 upstart debian,  Ubuntu\u7b49\u7cfb\u7edf\u4f7f\u7528\u7684initdaemon \u2713 \u2713 \u2713 \u2713 systemd \u63d0\u9ad8\u7cfb\u7edf\u7684\u542f\u52a8\u901f\u5ea6\uff0c\u76f8\u6bd4\u4f20\u7edf\u7684System  V\u662f\u4e00\u5927\u9769\u65b0\uff0c\u5df2\u88ab\u5927\u591a\u6570Linux\u53d1\u884c\u7248\u6240\u4f7f\u7528\u3002 \u2713 \u2713 \u2713 \u2713 \u2713 \u2713 \u2713 <p>Systemd\u5bf9Sysvinit\u505a\u51fa\u4e86\u5f88\u5927\u7684\u6539\u8fdb\uff0c\u5c24\u5176\u662f\u542f\u52a8\u901f\u5ea6\u4e0a\uff0c\u529f\u80fd\u4e5f\u8d8a\u6765\u8d8a\u4e30\u5bcc\uff0c\u4f46\u8fd9\u4e5f\u5bfc\u81f4\u5176\u7cfb\u7edf\u67b6\u6784\u548c\u5b9e\u73b0\u8d8a\u6765\u8d8a\u590d\u6742\uff0c\u5728\u8fdd\u80ccKeep It Simple\u7684\u9053\u8def\u4e0a\u8d8a\u8d70\u8d8a\u8fdc\u3002\u5927\u800c\u5168\u7684\u529f\u80fd\u4e5f\u4e0d\u662f\u6240\u6709\u573a\u666f\u90fd\u9700\u8981\u7684\uff0c\u4e5f\u4e0d\u652f\u6301\u7075\u6d3b\u7ec4\u5408\uff0c\u5bf9\u4e8e\u5d4c\u5165\u5f0f\u4ee5\u53ca\u4e00\u4e9bIOT\u8bbe\u5907\u4e0d\u80fd\u505a\u5f88\u597d\u7684\u652f\u6301\u3002\u540c\u65f6\u4e0eopenEuler\u9762\u5411\u8fb9\u7f18\uff0c\u5d4c\u5165\u5f0f\uff0c\u670d\u52a1\u5668\uff0c\u4e91\u573a\u666fOS\u7684\u613f\u666f\u4e0d\u5951\u5408\u3002</p> <p>\u6839\u636e\u7ef4\u62a4\u95ee\u9898\u7684\u7edf\u8ba1\u8ffd\u8e2a\uff0cSystemd\u6bcf\u4e2a\u7248\u672c\u5f15\u5165\u7684\u95ee\u9898\u90fd\u4e0d\u662f\u4e00\u4e2a\u6536\u655b\u72b6\u6001\uff0c\u5e76\u4e14\u8fd1\u4e9b\u5e74\u95ee\u9898\u8d8a\u6765\u8d8a\u591a\u3002\u800c\u4e14\u7531\u4e8e1\u53f7\u8fdb\u7a0b\u7279\u6b8a\u6027\uff0c\u8fd9\u4e9b\u95ee\u9898\u4f1a\u5e26\u6765\u7cfb\u7edf\u7ea7\u522b\u7684\u5b95\u673a\u3002</p> <p></p>"},{"location":"design/00-index_zh/#_1","title":"\u4e91\u7684\u670d\u52a1\u7ba1\u7406","text":"<p>\u4e91\u5316\u573a\u666f\u4e0b\uff0c\u670d\u52a1\u7684\u7ba1\u7406\u5bf9\u8c61\u7531\u8fdb\u7a0b\u6f14\u53d8\u4e3a\u865a\u62df\u673a\u3001\u5bb9\u5668\uff0c\u5982\u901a\u8fc7OpenStack\uff0ck8s\u7ed3\u5408\u8282\u70b9\u4e0a\u7684agent\uff08kubelet\uff0cnova\uff09\u8fdb\u884c\u7ba1\u7406\u3002agent\u5728node\u4e2d\u901a\u8fc7Systemd\u8fdb\u884c\u7ba1\u7406\uff0c\u5e76\u4e14\u4e5f\u4f7f\u7528\u4e86Systemd\u63d0\u4f9b\u4e86\u4e00\u4e9b\u57fa\u7840\u80fd\u529b\uff0c\u5982\u65e5\u5fd7\u8f93\u51fa\u3002</p> <p>\u5bf9\u4e8eNode\uff08VM\uff0cHost\uff09\u5185\u90e8\u7684\u4e00\u4e9b\u5173\u952e\u670d\u52a1\uff0c\u5982Ngnix\uff0c\u901a\u8fc7Systemd\u8fdb\u884c\u751f\u547d\u5468\u671f\u7684\u7ba1\u7406\uff0c\u5e76\u4e14\u8fd9\u4e9b\u670d\u52a1\u4e5f\u662f\u5206\u5e03\u5f0f\u7684\uff0c\u5f53\u524d\u51fa\u73b0\u95ee\u9898\uff0c\u7531\u670d\u52a1\u81ea\u884c\u8fdb\u884c\u5904\u7406\uff0c\u65e0\u6cd5\u50cf\u5bb9\u5668\u5b9e\u4f8b\u548c\u865a\u62df\u673a\u5b9e\u4f8b\u4e00\u6837\u901a\u8fc7\u7c7b\u4f3cK8S\u3001OpenStack\u5e73\u53f0\u7edf\u4e00\u7f16\u6392\u3002</p> <p></p>"},{"location":"design/00-index_zh/#sysmaster_1","title":"sysMaster\u5e94\u8be5\u805a\u7126\u4ec0\u4e48\uff1f","text":"<p>\u64cd\u4f5c\u7cfb\u7edf\u7684\u521d\u59cb\u5316\u4ee5\u53ca\u7cfb\u7edf\u4e2d\u7684\u670d\u52a1\u7ba1\u7406\uff0c\u4f5c\u4e3a\u7cfb\u7edf\u4e2d\u975e\u5e38\u91cd\u8981\u7684\u4e00\u4e2a\u529f\u80fd\uff0c\u968f\u7740\u573a\u666f\u548c\u5916\u90e8\u5f62\u5f0f\u7684\u53d8\u5316\uff0c\u6211\u4eec\u671f\u671b\u63d0\u4f9b\u4e00\u5957\u7edf\u4e00\u7684\u7cfb\u7edf\u521d\u59cb\u5316\u548c\u670d\u52a1\u7ba1\u7406\u6846\u67b6\uff0c\u5e76\u4e14\u671f\u671b\u80fd\u591f\u6d88\u9664\u73b0\u6709\u95ee\u9898\u4ee5\u53ca\u9002\u5e94\u548c\u7b26\u5408\u4f20\u7edf\u573a\u666f\u548c\u4e91\u573a\u666f\u7684\u8bc9\u6c42\u3002 \u5bf9\u4e8eLinux\u7cfb\u7edf\u7684\u521d\u59cb\u5316\u548c\u670d\u52a1\u7ba1\u7406\uff0c\u6211\u4eec\u7684\u76ee\u6807\u662f\uff1a</p> <ol> <li>\u6d88\u9664\u73b0\u6709\u521d\u59cb\u5316\u7cfb\u7edf\u5185\u5b58\u5b89\u5168\u7c7b\u95ee\u9898\uff0c\u51cf\u5c11\u6545\u969c\u53d1\u751f\u7684\u53ef\u80fd\u6027\u3002</li> <li>\u652f\u6301\u5feb\u901f\u90e8\u7f72\u3001\u5347\u7ea7\u548c\u6062\u590d\uff0c\u8fbe\u6210\u6545\u969c\u79d2\u7ea7\u6062\u590d\uff0c\u505a\u5230\u4e1a\u52a1\u65e0\u611f\u77e5\u3002</li> <li>\u6781\u81f4\u8f7b\u91cf\uff0c\u7075\u6d3b\uff0c\u80fd\u591f\u6ee1\u8db3\u5d4c\u5165\uff0c\u670d\u52a1\u5668\uff0c\u4e91\u7b49\u573a\u666f\u5bf9\u4e8e\u8d44\u6e90\u5f00\u9500\u7684\u4e0d\u540c\u8bc9\u6c42\u3002</li> </ol> <p>\u5bf9\u4e8e\u4e91\u573a\u666f\u8282\u70b9\u5185\u90e8\u7684\u8fd0\u884c\u5b9e\u4f8b\uff08\u5982\u5bb9\u5668\uff0c\u865a\u62df\u673a\uff0c\u8fdb\u7a0b\uff09\uff0c\u6211\u4eec\u7684\u76ee\u6807\u662f\uff1a</p> <ol> <li>\u63d0\u4f9b\u7edf\u4e00\u7684\u5b9e\u4f8b\u751f\u547d\u5468\u671f\u7684\u7ba1\u7406\u63a5\u53e3\uff0c\u5bf9\u63a5\u5206\u5e03\u5f0f\u7ba1\u7406\u6846\u67b6(\u5982K8S\u548cOpenStack),\u5c4f\u853d\u5bb9\u5668\u5f15\u64ce\u548c\u865a\u62df\u5316\u7ba1\u7406\u5e73\u53f0\u7684\u5dee\u5f02\u3002</li> <li>\u5bf9\u4e8eVM\u4e2d\u7684\u5173\u952e\u4e91\u5316\u670d\u52a1\uff0c\u80fd\u591f\u590d\u7528\u5f53\u524d\u4e91\u5b9e\u4f8b\u8c03\u5ea6\u5e73\u53f0\u7684\u80fd\u529b\uff0c\u5b9e\u73b0\u5206\u5e03\u5f0f\u7ba1\u7406\u3002</li> </ol>"},{"location":"design/00-index_zh/#_2","title":"\u6781\u81f4\u53ef\u9760\u3001\u8f7b\u91cf\uff0c\u6ee1\u8db3\u5d4c\u5165\u5f0f\uff0c\u670d\u52a1\u5668\u3001\u4e91\u591a\u79cd\u573a\u666f","text":"<p>sysMaster\u901a\u8fc7\u591a\u7ea7\u62c6\u5206\u76841+1+N\u67b6\u6784\uff0c\u786e\u4fdd\u6bcf\u4e2a\u7ec4\u4ef6\u4e13\u6ce8\u81ea\u5df1\u7684\u804c\u8d23\uff0c\u964d\u4f4e\u5355\u7ec4\u4ef6\u7684\u590d\u6742\u6027\uff0c\u786e\u4fdd\u7ec4\u4ef6\u67b6\u6784\u7684\u53ca\u7b80\uff0c\u4ece\u800c\u63d0\u5347\u7cfb\u7edf\u6574\u4f53\u67b6\u6784\u6269\u5c55\u6027\uff0c\u548c\u9002\u5e94\u6027\uff0c\u5e76\u964d\u4f4e\u5f00\u53d1\u548c\u7ef4\u62a4\u7684\u6210\u672c\uff0c\u5e76\u62e5\u6709\u4ee5\u4e0b\u4e3b\u8981\u7279\u7279\u70b9\uff1a</p> <ol> <li>\u8f7b\u91cf\u5316\u8c03\u5ea6\uff0c\u652f\u6301\u66f4\u5feb\u7684\u542f\u52a8\u901f\u5ea6 sysMaster-core\u4e3a\u4e2d\u7684job\u8c03\u5ea6\u5668\uff0c\u4e8b\u4ef6\u9a71\u52a8\u5668\u6765\u8d1f\u8d23\u76f8\u5173\u542f\u52a8\u4efb\u52a1\u7684\u5904\u7406\uff0c\u5176\u4e2d job\u8c03\u5ea6\u5668\uff1a\u5bf9\u542f\u52a8\u670d\u52a1\u4efb\u52a1\u8fdb\u884c\u8c03\u5ea6\uff0c\u63d0\u4f9b\u8f7b\u91cf\u5316\uff0c\u5e76\u884c\u5316\u7684\u8c03\u5ea6\u80fd\u529b\uff0c\u5e76\u4e14\u652f\u6301\u4e8b\u52a1\u80fd\u529b\uff0c\u4fdd\u969c\u670d\u52a1\u542f\u52a8\u7684\u539f\u5b50\u6027\u3002 \u4e8b\u4ef6\u9a71\u52a8\u5668\uff1a\u63a5\u53d7\u5916\u90e8\u4e8b\u4ef6\uff0c\u5e76\u4e14\u9a71\u52a8job\u8c03\u5ea6\u5668\u5b8c\u6210\u4e8b\u4ef6\u76f8\u5173\u4efb\u52a1\uff0c\u5982\u7ba1\u7406\u63a7\u5236\u547d\u4ee4\uff0c\u8bbe\u5907\u53d1\u73b0\u7b49\u7b49\u3002</li> <li>\u63d2\u4ef6\u67b6\u6784\uff0c\u652f\u6301\u670d\u52a1\u7c7b\u578b\u7075\u6d3b\u62d3\u5c55 Unit\u7ba1\u7406\u5668\u63d0\u4f9b\u63d2\u4ef6\u5316\u673a\u5236\uff0c\u652f\u6301\u52a8\u6001\u52a0\u8f7d\u5404\u79cd\u670d\u52a1\u7c7b\u578b\uff0c\u652f\u6301\u670d\u52a1\u7684\u7075\u6d3b\u6269\u5c55\uff0c\u5b9e\u73b0\u6309\u9700\u52a0\u8f7d\u3002</li> <li>\u72b6\u6001\u5916\u7f6e\uff0c\u591a\u7ea7\u8fd8\u539f\u70b9\uff1b\u8bed\u8a00\u7ea7\u539f\u751f\u5b89\u5168\uff0c\u652f\u6491\u6781\u81f4\u53ef\u9760 \u53ef\u9760\u6027\u6846\u67b6\uff1a\u652f\u6301\u72b6\u6001\u5916\u7f6e\uff0c\u591a\u7ea7checkpoint\u652f\u6301\u81ea\u5b9a\u4e49\uff0c\u5e76\u5b9e\u73b0\u8d44\u6e90\u5bf9\u8d26\uff0c\u6570\u636e\u81ea\u6062\u590d\uff0c\u5b9e\u73b0\u6545\u969c\u7684\u5feb\u901f\u81ea\u6062\u590d\uff0c\u540c\u65f6\u76f4\u81f3\u70ed\u5347\u7ea7\u80fd\u529b\uff0c\u5b9e\u73b0\u4e0d\u4e2d\u65ad\u4e1a\u52a1\u7684\u7248\u672c\u5feb\u901f\u5347\u7ea7\u80fd\u529b\u3002 \u9009\u62e9\u5185\u5b58\u5b89\u5168\u7684Rust\u8bed\u8a00\u6765\u8fdb\u884c\u5f00\u53d1\uff0c\u539f\u751f\u6d88\u9664\u5185\u5b58\u5b89\u5168\u7c7b\u95ee\u9898\uff0c\u63d0\u9ad81\u53f7\u8fdb\u7a0b\u81ea\u8eab\u7684\u9c81\u68d2\u6027\uff0c\u63d0\u5347\u7cfb\u7edf\u6574\u4f53\u7684\u53ef\u9760\u6027\u3002</li> <li>\u8fc1\u79fb\u5de5\u5177\u652f\u6301Systemd\u5230sysMaster\u65e0\u7f1d\u8fc1\u79fb\u3002 \u63d0\u4f9b\u751f\u6001\u8fc1\u79fb\u5de5\u5177\uff0c\u652f\u6301\u5ba2\u6237\u548c\u5f00\u53d1\u8005\u4eceSystemd\u5feb\u901f\u5207\u6362\u5230sysMaster\uff0c\u5b9e\u73b0\u65e0\u7f1d\u5207\u6362\u548c\u8fc1\u79fb\u3002</li> <li>\u539f\u751f\u652f\u6301\u9e3f\u8499\u548clinux\u5185\u6838 sysMaster\u5b9a\u4f4d\u4e3a\u652f\u6301\u5d4c\u5165\u5f0f\u548c\u670d\u52a1\u5668\uff0c\u4e91\u7b49\u5168\u573a\u666f\u7684\u652f\u6301\uff0c\u5f53\u524d\u539f\u751f\u652f\u6301\u9e3f\u8499\u5fae\u5185\u6838\u548cLinux\u5185\u6838\u3002\u4e3a\u5fae\u5185\u6838\u548c\u5b8f\u5185\u6838\u63d0\u4f9b\u7edf\u4e00\u7684\u670d\u52a1\u7ba1\u7406\u6846\u67b6\u3002</li> </ol>"},{"location":"design/00-index_zh/#_3","title":"\u5355\u8282\u70b9\u8fd0\u884c\u5bf9\u8c61\u751f\u547d\u5468\u671f\u7ba1\u7406\u7684\u7edf\u4e00\u63a5\u53e3\uff0c\u5bf9\u63a5\u5206\u5e03\u5f0f\u8c03\u5ea6\u6846\u67b6\u3002","text":"<p>sysMaster\u5438\u6536\u73b0\u6709\u8fd0\u5316\u573a\u666f\u7684\u4e00\u4e9b\u7279\u70b9\uff0c\u7ed3\u5408\u5bb9\u5668\u5f15\u64ce(iSulad)\u548cQemu\uff0c\u63d0\u4f9b\u7edf\u4e00\u7684\u5bb9\u5668\u5b9e\u4f8b\u548c\u865a\u62df\u5316\u5b9e\u4f8b\u7684\u7ba1\u7406\u63a5\u53e3\uff0c\u4ee5\u53ca\u7531sysMaster\u7ba1\u7406\u7684\u4e00\u4e9b\u5173\u952e\u5e94\u7528\u5b9e\u4f8b\u7684\u7ba1\u7406\u7edf\u4e00\u5bf9\u63a5\u5230Kubernetes\u548cOpenStack\u3002</p> <p></p>"},{"location":"design/00-index_zh/#sysmaster_2","title":"sysmaster\u9879\u76ee\u91cc\u7a0b\u7891\u53ca\u613f\u666f","text":""},{"location":"design/00-index_zh/#_4","title":"\u4ee3\u7801\u76ee\u5f55\u7ed3\u6784\u8bf4\u660e","text":"<p>\u6e90\u7801\u4ed3\u5e93\u4ee5workspaces\u65b9\u5f0f\u7ba1\u7406\uff0c\u6bcf\u4e00\u4e2a\u76ee\u5f55\u662f\u4e00\u4e2apackage\uff0c\u6bcf\u4e2apackage\u5305\u542b\u4e00\u4e2acrate\uff08lib\u6216bin\u5f62\u5f0f\uff09\uff0c \u516c\u5171lib crate\u7684\u76ee\u5f55\u5e26lib\u524d\u7f00\uff0c\u4f7f\u7528cargo new --lib libtests\u521b\u5efa, daemon\u7c7b\u578b\u7684bin crate\u7684\u76ee\u5f55\u4ee5d\u7ed3\u5c3e\u3002</p> <pre><code>/ (\u6839\u76ee\u5f55)\n|...coms (\u63d2\u4ef6)\n|     |...service (unit type crate)\n|     |...socket  (unit type crate)\n|     |...target  (unit type crate)\n|...libs (\u5bf9\u5916\u63a5\u53e3)\n|     |...libtests (test lib crate)\n|     |...cgroup (cgroup lib crate)\n|     |...cmdproto(cmd proto lib crate)\n|...exts (sysmaster-extends\u7ec4\u4ef6)\n|     |...devmaster (daemon)\n|     |...random-seed (bin)\n|...core (sysmaster-core\u6838\u5fc3\u7ec4\u4ef6)\n|     |...sysmaster (bin)\n|     |...sysmaster (internal lib)\n|...tools\n|     |...musl_build\n|     |...run_with_sd\n|...docs\n|...requirements.sh (\u5b89\u88c5\u4f9d\u8d56)\n</code></pre> <p>\u5982\uff1a</p> <pre><code>  - lib crate: libs/event, libs/basic\n  - bin crate: extends/init, sysmaster\n  - daemon crate: extends/udevd, extends/logind\n</code></pre>"},{"location":"design/00-sysmaster_architecture/","title":"sysmaster\u67b6\u6784\u8bbe\u8ba1","text":""},{"location":"design/00-sysmaster_architecture/#_1","title":"\u540d\u8bcd\u89e3\u91ca","text":"\u672f\u8bed\u540d\u79f0 \u8bf4\u660e Unit SysMaster\u7ba1\u7406\u7684\u670d\u52a1\u5b9e\u4f8b SubUnit \u5177\u4f53\u88ab\u7ba1\u7406\u7684\u5bf9\u8c61\u7c7b\u578b\uff0c\u5982Service\uff0cSocket\u7b49\u7b49 Job \u6bcf\u4e2aUnit\u6267\u884c\u65f6\u4ea7\u751f\u7684\u5bf9\u8c61\uff0c\u5177\u5907\u4e8b\u52a1\u6027\uff0c\u662fUnit\u72b6\u6001\u8fc1\u79fb\u7684\u6700\u5c0f\u5b9e\u4f8b"},{"location":"design/00-sysmaster_architecture/#_2","title":"\u8bbe\u8ba1\u76ee\u6807","text":"<p>sysmaster\u662f\u5bf9\u6807systemd, \u63d0\u4f9b\u4e00\u53f7\u8fdb\u7a0b\u5bf9\u7cfb\u7edf\u8fdb\u884c\u7ba1\u7406\u7684\u529f\u80fd\uff0c\u5f53\u524d\u4e3b\u8981\u8bbe\u8ba1\u76ee\u6807\u4e3a:</p> <ol> <li>\u517c\u5bb9\u6027:\u517c\u5bb9systemd\u5e76\u4e3a\u5bb9\u5668\uff0c\u865a\u62df\u5316\uff0c\u670d\u52a1\u5668\u573a\u666f\u63d0\u4f9b1\u53f7\u8fdb\u7a0b\u4ee5\u53ca\u7cfb\u7edf\u670d\u52a1\u7ba1\u7406\u80fd\u529b</li> <li>\u6309\u9700\u52a0\u8f7d\uff0c\u6781\u901f\u542f\u52a8:\u73b0\u6709systemd\u5305\u542b50+\u670d\u52a1\uff0c\u5728\u5b9e\u9645\u4f7f\u7528\u8fc7\u7a0b\u4e2d\uff0c\u6709\u4e9b\u670d\u52a1\u5b9e\u9645\u5e76\u6ca1\u6709\u7528\u5904\uff0c\u4f46\u662f\u5e26\u6765\u4e86\u67b6\u6784\u7684\u590d\u6742\u6027\uff0c\u4ee3\u7801\u7ed3\u6784\u81c3\u80bf\uff0c\u65e0\u6cd5\u4fee\u6539\uff0c\u542f\u52a8\u8fc7\u7a0b\u5197\u4f59\uff0c\u542f\u52a8\u901f\u5ea6\u6709\u8fdb\u4e00\u6b65\u63d0\u5347\u7684\u7a7a\u95f4</li> <li>\u6781\u81f4\u53ef\u9760\u6027:\u901a\u8fc7rust\u8bed\u8a00\u51cf\u5c11\u5185\u5b58\u7c7bbug\uff0c\u5e76\u652f\u6301\u5feb\u901f\u6062\u590d\u80fd\u529b\uff0c1\u53f7\u8fdb\u7a0b\u6545\u969c\uff0c\u7cfb\u7edf\u4e0d\u91cd\u542f</li> <li>\u5355\u673a\u8d1f\u8f7d\u5747\u8861: \u5c06\u5355\u673a\u7684\u6240\u6709unity(process/container/vm\u7b49)\u7edf\u4e00\u7ba1\u7406, \u6700\u5927\u5316\u5355\u673a\u8d44\u6e90\u5229\u7528\u7387</li> </ol>"},{"location":"design/00-sysmaster_architecture/#_3","title":"\u6574\u4f53\u67b6\u6784","text":"<p>Sysmaster\u6838\u5fc3\u67b6\u6784\u5305\u542bUnitManager\uff0cDataStore\uff0cJobEngine\uff0cEventEngine\uff0cProtoServer\uff0cCli\u547d\u4ee4\u884c\u3002\u4ee5\u53ca\u57fa\u4e8e\u6838\u5fc3\u67b6\u6784\u6269\u5c55\u51fa\u6765\u7684SubUnit\uff0c\u4ee5\u53ca\u76f8\u5173\u7684\u670d\u52a1\uff0c\u6574\u4f53\u67b6\u6784\u5982\u4e0b\u56fe:</p> <p></p> <p>sysmaster\u67b6\u6784\u5982\u4e0a\u56fe\uff0c\u5305\u542b\u4ee5\u4e0b\u6a21\u5757:</p> <ol> <li> <p><code>sysmaster-init</code>: 1\u53f7\u8fdb\u7a0b\uff0c\u4fdd\u6301\u7b80\u5355\uff0c\u53ea\u76f2\u7b49\u5f85\uff0c\u5e76\u5b9a\u671f\u76d1\u542csysmaster-core\u7684\u5fc3\u8df3\uff0c\u5de1\u68c0core\u7684\u72b6\u6001\u3002</p> </li> <li> <p><code>sysmaster-core</code>:</p> <ul> <li> <p><code>bin</code>: \u4e3b\u4f53\u7a0b\u5e8f\u7684\u4ee3\u7801, \u5305\u542b\u4ee5\u4e0b\u5b50\u6a21\u5757:</p> <ul> <li> <p><code>unit</code>: \u7cfb\u7edf\u670d\u52a1\u7684\u57fa\u672c\u914d\u7f6e\u5355\u5143\uff0c\u7cfb\u7edf\u652f\u6301\u7684\u6bcf\u79cd\u670d\u52a1\u5c31\u662f\u4e00\u79cdUnit\uff0c\u662fsymaster\u7684\u6838\u5fc3\u5355\u5143</p> </li> <li> <p><code>dataStore</code>: \u4fdd\u5b58\u7cfb\u7edf\u4e2d\u6240\u6709\u52a0\u8f7d\u7684unit\u5bf9\u8c61\uff0c\u5b9e\u65f6\u66f4\u65b0\u72b6\u6001</p> </li> <li> <p><code>eventEngine</code>: \u4e8b\u4ef6\u9a71\u52a8\u5f15\u64ce\uff0c\u63a5\u6536\u5916\u90e8\u4e8b\u4ef6\uff0c\u9a71\u52a8unit\u72b6\u6001\u673a</p> </li> <li> <p><code>jobEngine</code>: \u5de5\u4f5c\u4efb\u52a1\u5f15\u64ce\uff0cunit\u72b6\u6001\u7684\u53d8\u5316\uff0c\u901a\u8fc7job\u9a71\u52a8\uff0cjob\u652f\u6301\u4e8b\u52a1\u7684\u6982\u5ff5\uff0c\u652f\u6301\u4f1a\u6eda\u673a\u5236\uff0c\u4fdd\u969cunit\u72b6\u6001\u8fc1\u79fb\u7684\u539f\u5b50\u6027\u3002</p> </li> <li> <p><code>reliabilityFrame</code>: \u53ef\u9760\u6027\u6846\u67b6\uff0c\u652f\u6301sysmaster\u7684\u6545\u969c\u6062\u590d\uff0c\u652f\u6301\u6545\u969c\u68c0\u67e5\u70b9\u7684\u52a8\u6001\u6ce8\u5165\uff0c\u6545\u969c\u72b6\u6001\u7684\u68c0\u67e5\uff0c\u6062\u590d\u3002\u5404\u4e2a\u5b50\u7c7b\u9700\u8981\u68b3\u7406\u6545\u969c\u6a21\u5f0f\u5e93\uff0c\u5e76\u4e14\u6ce8\u5165\u6545\u969c\u68c0\u67e5\u70b9\uff0c\u4e00\u65e6\u53d1\u751f\u6545\u969c\uff0c\u6545\u969c\u6846\u67b6\u4f1a\u5c06\u4e1a\u52a1\u6062\u590d\u5230\u6545\u969c\u68c0\u67e5\u70b9\uff0c\u5e76\u91cd\u65b0\u6267\u884c\u540e\u7eed\u52a8\u4f5c\u3002</p> </li> <li> <p><code>commandS</code>: \u76d1\u542c\u63a5\u6536\u5916\u90e8\u7684\u547d\u4ee4\uff0c\u6267\u884c\u5bf9\u5e94\u7684unit\u52a8\u4f5c\u3002</p> </li> </ul> </li> <li> <p><code>lib</code>: sysmaster\u63a5\u53e3\u5c42\uff0c\u4e3acore\u4ee5\u53cacoms\u63d0\u4f9b\u63a5\u53e3</p> </li> </ul> </li> <li> <p><code>sysmaster-extends</code>: bin,daemon\u7b49\u6269\u5c55\u529f\u80fd\u7ec4\u4ef6</p> </li> <li> <p><code>libs</code>: \u5bf9\u64cd\u4f5c\u7cfb\u7edf\u901a\u7528\u529f\u80fd\u7684\u63a5\u53e3\u5c01\u88c5\uff0c\u548csysmaster\u5bf9\u5916\u63d0\u4f9b\u7684\u529f\u80fd\u65e0\u5173\uff0c\u88absysmaster-extends\u3001sysmaster sysmsater-init\u4f9d\u8d56\u3002 sysmaster-extends\uff0csysmaster\u7684\u6269\u5c55\u529f\u80fd</p> </li> </ol>"},{"location":"design/01-errors_of_sysmaster/","title":"\u5bf9\u9519\u8bef\u5904\u7406\u7684\u601d\u8003","text":""},{"location":"design/01-errors_of_sysmaster/#_2","title":"\u7f16\u7a0b\u8bed\u8a00\u7684\u9519\u8bef\u5904\u7406","text":"<p>\u9519\u8bef\u5904\u7406\u662f\u6307\u5728\u7f16\u7a0b\u8bed\u8a00\u4e2d, \u5bf9\u7a0b\u5e8f\u8fd0\u884c\u4e2d\u53ef\u80fd\u53d1\u751f\u7684\u9519\u8bef\uff08\u5982\u8bed\u6cd5\u9519\u8bef\u3001\u8fd0\u884c\u65f6\u9519\u8bef\u3001\u7cfb\u7edf\u9519\u8bef\u7b49\uff09\u8fdb\u884c\u5904\u7406\u7684\u8fc7\u7a0b\u3002\u4e0d\u540c\u7684\u7f16\u7a0b\u8bed\u8a00\u63d0\u4f9b\u4e86\u4e0d\u540c\u7684\u9519\u8bef\u5904\u7406\u673a\u5236, \u5982\u5f02\u5e38\u5904\u7406\u3001\u9519\u8bef\u7801\u3001\u8c03\u8bd5\u4fe1\u606f\u7b49\u3002\u6b63\u786e\u7684\u9519\u8bef\u5904\u7406\u673a\u5236\u53ef\u4ee5\u6709\u6548\u5730\u5e2e\u52a9\u5f00\u53d1\u8005\u5b9a\u4f4d\u548c\u4fee\u590d\u9519\u8bef, \u5e76\u4fdd\u8bc1\u7a0b\u5e8f\u7684\u7a33\u5b9a\u6027\u548c\u53ef\u9760\u6027, \u5b9e\u9645\u751f\u4ea7\u8fc7\u7a0b\u4e2d, \u4efb\u4f55\u9519\u8bef\u90fd\u8981\u5f97\u5230\u59a5\u5584\u5904\u7406, \u5426\u5219\u4f1a\u57cb\u4e0b\u9690\u60a3, \u8f7b\u5219\u5f71\u54cd\u4f53\u9a8c, \u91cd\u5219\u5e26\u6765\u5b89\u5168\u95ee\u9898\u3002</p> <p></p> <p>\u5bf9\u5f00\u53d1\u8005\u6765\u8bf4, \u9519\u8bef\u5904\u7406\u5305\u542b\u8fd9\u4e48\u51e0\u90e8\u5206\uff1a</p> <ol> <li>\u5f53\u9519\u8bef\u53d1\u751f\u65f6, \u7528\u5408\u9002\u7684\u9519\u8bef\u7c7b\u578b\u6355\u83b7\u8fd9\u4e2a\u9519\u8bef\u3002</li> <li>\u9519\u8bef\u6355\u83b7\u540e, \u53ef\u4ee5\u7acb\u523b\u5904\u7406, \u4e5f\u53ef\u4ee5\u4f20\u9012\u9519\u8bef\u5ef6\u8fdf\u5904\u7406\u3002</li> <li>\u6700\u540e, \u6839\u636e\u4e0d\u540c\u7684\u9519\u8bef\u7c7b\u578b, \u7ed9\u7528\u6237\u8fd4\u56de\u5408\u9002\u7684\u3001\u5e2e\u52a9\u4ed6\u4eec\u7406\u89e3\u95ee\u9898\u6240\u5728\u7684\u9519\u8bef\u6d88\u606f\u3002</li> </ol> <p>\u6bcf\u5f53\u5f00\u59cb\u4e00\u4e2a\u65b0\u9879\u76ee\u65f6, \u7b2c\u4e00\u4ef6\u8981\u8003\u8651\u7684\u4e8b\u5e94\u8be5\u662f\u201c\u6211\u8be5\u5982\u4f55\u7ba1\u7406\u9519\u8bef\u201d\u3002</p> <p>\u5e38\u89c1\u7684\u4e09\u79cd\u9519\u8bef\u5904\u7406\u65b9\u5f0f\u5982\u4e0b\uff1a</p> <ol> <li>\u8fd4\u56de\u503c/\u9519\u8bef\u7801: \u5728\u7a0b\u5e8f\u4e2d\u901a\u8fc7\u8fd4\u56de\u4e00\u4e2a\u6574\u6570\u72b6\u6001\u7801\u6765\u8868\u793a\u64cd\u4f5c\u662f\u5426\u6210\u529f, \u72b6\u6001\u7801\u4e3a0\u8868\u793a\u64cd\u4f5c\u6210\u529f, \u5176\u4ed6\u503c\u8868\u793a\u5931\u8d25, \u6bd4\u8f83\u6709\u4ee3\u8868\u6027\u7684\u65f6C\u8bed\u8a00\u7684\u8fd4\u56de\u503c\u53caerrno\u3002</li> <li>\u5f02\u5e38\u548c\u65ad\u8a00: \u8fd4\u56de\u503c\u4e0d\u5229\u4e8e\u9519\u8bef\u7684\u4f20\u64ad, \u4f7f\u7528\u5f02\u5e38\u5904\u7406\u673a\u5236, \u5f53\u7a0b\u5e8f\u53d1\u751f\u9519\u8bef\u65f6, \u629b\u51fa\u4e00\u4e2a\u5f02\u5e38, \u7a0b\u5e8f\u7684\u6267\u884c\u4f1a\u88ab\u4e2d\u65ad, \u5e76\u4ece\u8c03\u7528\u6808\u4e2d\u5411\u4e0a\u56de\u6eaf, \u76f4\u5230\u627e\u5230\u5904\u7406\u8be5\u5f02\u5e38\u7684\u4ee3\u7801\u3002</li> <li>\u7c7b\u578b\u7cfb\u7edf: \u6bd4\u8f83\u5178\u578b\u7684\u662fRust , \u5728 Rust \u4e2d, \u53ef\u4ee5\u4f7f\u7528 Result \u7c7b\u578b\u6765\u8868\u793a\u51fd\u6570\u7684\u8fd4\u56de\u7ed3\u679c, \u5176\u4e2d T \u8868\u793a\u6210\u529f\u7684\u7ed3\u679c\u7c7b\u578b, E \u8868\u793a\u9519\u8bef\u7684\u7ed3\u679c\u7c7b\u578b\u3002\u5982\u679c\u51fd\u6570\u6267\u884c\u6210\u529f, \u5219\u8fd4\u56de\u4e00\u4e2a\u5305\u542b\u6210\u529f\u7ed3\u679c\u7684 Ok \u503c, \u5982\u679c\u6267\u884c\u5931\u8d25, \u5219\u8fd4\u56de\u4e00\u4e2a\u5305\u542b\u9519\u8bef\u7ed3\u679c\u7684 Err \u503c\u3002 <p>\u9519\u8bef\u5904\u7406, \u4e00\u76f4\u662f\u7f16\u7a0b\u8bed\u8a00\u7684\u4e00\u4e2a\u8bbe\u8ba1\u96be\u70b9, \u5404\u79cd\u7f16\u7a0b\u8bed\u8a00\u7684\u9519\u8bef\u5904\u7406\u673a\u5236\u90fd\u4e0d\u5c3d\u76f8\u540c, \u5e76\u4e14\u5404\u6709\u4f18\u52a3.</p> \u65b9\u5f0f \u4f18\u70b9 \u7f3a\u70b9 \u8fd4\u56de\u503c/\u9519\u8bef\u7801 \u7b80\u5355\u6613\u7528, \u6613\u4e8e\u7406\u89e3\u548c\u5b9e\u73b0 \u4e0d\u6613\u4e8e\u63cf\u8ff0\u590d\u6742\u7684\u9519\u8bef\u72b6\u6001, \u53ef\u8bfb\u6027\u5dee, \u5bb9\u6613\u51fa\u9519\uff08\u672a\u68c0\u67e5\u7684\u72b6\u6001\u7801\uff09\u5982\u679c\u9519\u8bef\u4e0d\u53ca\u65f6\u5904\u7406, \u53c8\u4f1a\u4e22\u6389\u8fd9\u4e2a\u9519\u8bef\u4fe1\u606f, \u9020\u6210\u9690\u60a3\u3002 \u5f02\u5e38\u548c\u65ad\u8a00 \u80fd\u591f\u63cf\u8ff0\u590d\u6742\u7684\u9519\u8bef\u72b6\u6001, \u6613\u4e8e\u4f7f\u7528, \u63d0\u9ad8\u53ef\u8bfb\u6027 \u7a0b\u5e8f\u6027\u80fd\u53ef\u80fd\u964d\u4f4e\uff08\u629b\u51fa\u548c\u6355\u83b7\u5f02\u5e38\u7684\u4ee3\u4ef7\uff09, \u4e0d\u9002\u7528\u4e8e\u6240\u6709\u7f16\u7a0b\u8bed\u8a00, \u9700\u8981\u7edf\u4e00\u7684\u5f02\u5e38\u5904\u7406\u673a\u5236,**\u5f00\u53d1\u8005\u4f1a\u6ee5\u7528\u5f02\u5e38**\u4e0d\u9002\u7528\u4e8e\u68c0\u6d4b\u6240\u6709\u7684\u9519\u8bef, \u4e0d\u80fd\u63cf\u8ff0\u590d\u6742\u7684\u9519\u8bef\u72b6\u6001, \u4ec5\u5728\u8c03\u8bd5\u9636\u6bb5\u6709\u6548(assertions) \u7c7b\u578b\u7cfb\u7edf \u901a\u8fc7\u8fd4\u56de\u503c\u8fd4\u56de\u9519\u8bef, \u4f46\u662f\u9519\u8bef\u88ab\u5305\u88f9\u5728\u4e00\u4e2a\u5b8c\u6574\u7684\u3001\u5fc5\u987b\u5904\u7406\u7684\u7c7b\u578b\u4e2d, \u4ee3\u7801\u53ef\u8bfb\u6027\u597d,\u4ee3\u7801\u7b80\u6d01\u9ad8\u6548 \u9700\u8981\u638c\u63e1\u540e,\u624d\u4f1a\u5e26\u6765\u751f\u4ea7\u6548\u7387\u7684\u63d0\u5347. <p>\u8bf7\u6ce8\u610f, \u4e0d\u540c\u7684\u7f16\u7a0b\u8bed\u8a00\u548c\u5e94\u7528\u573a\u666f\u53ef\u80fd\u4f1a\u6709\u6240\u4e0d\u540c, \u56e0\u6b64\u4e0a\u8ff0\u6bd4\u8f83\u4ec5\u662f\u4e00\u822c\u8d8b\u52bf\u3002</p>"},{"location":"design/01-errors_of_sysmaster/#rust","title":"Rust\u8bed\u8a00\u7684\u9519\u8bef\u5904\u7406","text":"<p>Rust \u5077\u5e08 Haskell, \u6784\u5efa\u4e86\u5bf9\u6807 Maybe \u7684 Option \u7c7b\u578b\u548c \u5bf9\u6807 Either \u7684 Result \u7c7b\u578b\u3002\u53ef\u4ee5\u8bf4\u662f\u5341\u5206\u7684\u4f18\u96c5, \u7279\u522b\u4f53\u73b0\u5728\u5bf9Option\u548cIterator\u7684\u4ea4\u4e92\u4e0a, \u4f46\u662f\u5bf9\u4e8e\u65b0\u4eba\u5165\u95e8\u6765\u8bf4\u9700\u8981\u4e00\u5b9a\u7684\u5b66\u4e60\u6210\u672c\u3002</p> <p></p> <p>Option \u662f\u4e00\u4e2a enum, \u5176\u5b9a\u4e49\u5982\u4e0b\uff1a</p> <pre><code>pub enum Option&lt;T&gt; {\nNone,\nSome(T),\n}\n</code></pre> <p>\u5b83\u53ef\u4ee5\u627f\u8f7d\u6709\u503c/\u65e0\u503c\u8fd9\u79cd\u6700\u7b80\u5355\u7684\u9519\u8bef\u7c7b\u578b\u3002</p> <p>Result \u662f\u4e00\u4e2a\u66f4\u52a0\u590d\u6742\u7684 enum, \u5176\u5b9a\u4e49\u5982\u4e0b\uff1a</p> <pre><code>#[must_use = \"this `Result` may be an `Err` variant, which should be handled\"]\npub enum Result&lt;T, E&gt; {\nOk(T),\nErr(E),\n}\n</code></pre> <p>\u5f53\u51fd\u6570\u51fa\u9519\u65f6, \u53ef\u4ee5\u8fd4\u56de Err(E), \u5426\u5219 Ok(T)\u3002</p> <p>\u6b64\u5916, Rust\u8fd8\u63d0\u4f9b?\u8fd0\u7b97\u7b26\u6765\u65b9\u4fbf\u7684\u4f20\u9012\u9519\u8bef, \u9700\u8981\u5b9e\u73b0 From trait \u5728\u4e8c\u8005\u4e4b\u95f4\u5efa\u7acb\u8d77\u8f6c\u6362\u7684\u6865\u6881, \u8fd9\u4f1a\u5e26\u6765\u989d\u5916\u7684\u9ebb\u70e6\u3002Rust \u8fd8\u4e3a Option \u548c Result \u63d0\u4f9b\u4e86\u5927\u91cf\u7684\u8f85\u52a9\u51fd\u6570, \u5982 map / map_err / and_then, \u4f60\u53ef\u4ee5\u5f88\u65b9\u4fbf\u5730\u5904\u7406\u6570\u636e\u7ed3\u6784\u4e2d\u90e8\u5206\u60c5\u51b5\u3002</p> <p></p> <p>\u65e0\u8bba\u662f\u901a\u8fc7 ? \u64cd\u4f5c\u7b26, \u8fd8\u662f\u51fd\u6570\u5f0f\u7f16\u7a0b\u8fdb\u884c\u9519\u8bef\u5904\u7406, Rust \u90fd\u529b\u6c42\u8ba9\u9519\u8bef\u5904\u7406\u7075\u6d3b\u9ad8\u6548, \u8ba9\u5f00\u53d1\u8005\u4f7f\u7528\u8d77\u6765\u7b80\u5355\u76f4\u89c2\u3002</p> <p>\u5bf9\u4e8e\u4e0d\u53ef\u6062\u590d\u7c7b\u7684\u9519\u8bef, \u4f7f\u7528 panic! / catch_unwind \u6765\u5e94\u5bf9,\u63d0\u4f9b\u4e86\u7279\u6b8a\u7684\u5f02\u5e38\u5904\u7406\u80fd\u529b\u3002</p> <p>\u6211\u4eec\u8bb2\u5230 Result \u91cc E \u662f\u4e00\u4e2a\u4ee3\u8868\u9519\u8bef\u7684\u6570\u636e\u7c7b\u578b\u3002\u4e3a\u4e86\u89c4\u8303\u8fd9\u4e2a\u4ee3\u8868\u9519\u8bef\u7684\u6570\u636e\u7c7b\u578b\u7684\u884c\u4e3a, Rust \u5b9a\u4e49\u4e86 Error trait\uff1a <pre><code>pub trait Error: Debug + Display {\nfn source(&amp;self) -&gt; Option&lt;&amp;(dyn Error + 'static)&gt; { ... }\nfn backtrace(&amp;self) -&gt; Option&lt;&amp;Backtrace&gt; { ... }\nfn description(&amp;self) -&gt; &amp;str { ... }\nfn cause(&amp;self) -&gt; Option&lt;&amp;dyn Error&gt; { ... }\n}\n</code></pre> <p>\u6211\u4eec\u53ef\u4ee5\u5b9a\u4e49\u6211\u4eec\u81ea\u5df1\u7684\u6570\u636e\u7c7b\u578b, \u7136\u540e\u4e3a\u5176\u5b9e\u73b0 Error trait\u3002\u5982\u679c\u4e0d\u501f\u52a9\u7b2c\u4e09\u65b9rust\u5e93, \u8981\u6784\u7b51\u597d\u81ea\u5df1\u7684Error\u9519\u8bef\u5904\u7406\u662f\u4e00\u4e2a\u7e41\u7410\u5207\u7cbe\u7ec6\u7684\u5de5\u4f5c.</p>"},{"location":"design/01-errors_of_sysmaster/#_3","title":"\u9519\u8bef\u5904\u7406\u4e2d\u5e38\u89c1\u95ee\u9898","text":"<p>\u5728\u9519\u8bef\u5904\u7406\u4e2d, \u5e38\u89c1\u7684\u95ee\u9898\u5305\u62ec\uff1a</p> <ol> <li>\u672a\u8003\u8651\u6240\u6709\u53ef\u80fd\u7684\u5f02\u5e38\u60c5\u51b5</li> <li>\u5ffd\u7565\u9519\u8bef\u4fe1\u606f, \u5bfc\u81f4\u96be\u4ee5\u8bca\u65ad\u95ee\u9898</li> <li>\u8fc7\u4e8e\u7b80\u5355\u7684\u9519\u8bef\u5904\u7406\u903b\u8f91, \u5bfc\u81f4\u7cfb\u7edf\u4e0d\u7a33\u5b9a</li> <li>\u8fc7\u4e8e\u590d\u6742\u7684\u9519\u8bef\u5904\u7406\u903b\u8f91, \u5bfc\u81f4\u4ee3\u7801\u96be\u4ee5\u7ef4\u62a4</li> <li>\u5bf9\u5df2\u77e5\u9519\u8bef\u7684\u4e0d\u5f53\u5904\u7406, \u5bfc\u81f4\u7cfb\u7edf\u66f4\u52a0\u4e0d\u7a33\u5b9a</li> <li>\u7f3a\u4e4f\u5bf9\u9519\u8bef\u8ddf\u8e2a\u548c\u5206\u6790\u7684\u673a\u5236, \u5bfc\u81f4\u96be\u4ee5\u5feb\u901f\u5b9a\u4f4d\u9519\u8bef\u539f\u56e0</li> <li>\u4e0d\u5408\u7406\u7684\u9519\u8bef\u5904\u7406\u7b56\u7565, \u5bfc\u81f4\u7cfb\u7edf\u884c\u4e3a\u4e0d\u53ef\u9884\u671f\u3002</li> </ol> <p>\u89e3\u51b3\u9519\u8bef\u5904\u7406\u4e2d\u7684\u95ee\u9898\u901a\u5e38\u9700\u8981\u4ee5\u4e0b\u6b65\u9aa4\uff1a</p> <ol> <li>\u5b9a\u4e49\u9519\u8bef\uff1a\u786e\u5b9a\u9519\u8bef\u7684\u7c7b\u578b\u548c\u539f\u56e0\u3002</li> <li>\u6536\u96c6\u6570\u636e\uff1a\u6536\u96c6\u6709\u5173\u9519\u8bef\u7684\u4fe1\u606f, \u5982\u65e5\u5fd7, \u8c03\u7528\u5806\u6808\u548c\u73af\u5883\u53d8\u91cf\u3002</li> <li>\u5206\u6790\u6570\u636e\uff1a\u5206\u6790\u9519\u8bef\u7684\u539f\u56e0, \u4ee5\u53ca\u9700\u8981\u6267\u884c\u54ea\u4e9b\u6b65\u9aa4\u6765\u89e3\u51b3\u95ee\u9898\u3002</li> <li>\u89e3\u51b3\u95ee\u9898\uff1a\u4f7f\u7528\u89e3\u51b3\u65b9\u6848, \u5982\u4ee3\u7801\u4fee\u590d, \u914d\u7f6e\u66f4\u6539\u6216\u66f4\u65b0\u8f6f\u4ef6\u3002</li> <li>\u6d4b\u8bd5\u89e3\u51b3\u65b9\u6848\uff1a\u9a8c\u8bc1\u89e3\u51b3\u65b9\u6848\u662f\u5426\u6709\u6548, \u5e76\u786e\u4fdd\u9519\u8bef\u4e0d\u518d\u53d1\u751f\u3002</li> <li>\u66f4\u65b0\u6587\u6863\uff1a\u66f4\u65b0\u9519\u8bef\u5904\u7406\u6d41\u7a0b\u7684\u6587\u6863, \u4ee5\u4fbf\u5728\u672a\u6765\u7684\u95ee\u9898\u51fa\u73b0\u65f6\u4f7f\u7528\u3002</li> </ol> <p>\u8fd9\u4e9b\u6b65\u9aa4\u53ef\u4ee5\u901a\u8fc7\u4f7f\u7528\u5de5\u5177, \u5982\u8c03\u8bd5\u5668, \u9519\u8bef\u65e5\u5fd7\u5206\u6790\u5668\u548c\u95ee\u9898\u8ddf\u8e2a\u7cfb\u7edf\u7b49, \u6765\u52a0\u901f\u548c\u7b80\u5316\u3002</p> <p>\u9664\u4e86\u4e0a\u9762\u5e38\u89c1\u7684\u4f7f\u7528\u95ee\u9898\u5916,\u5728\u65e5\u5e38\u4f7f\u7528\u8fc7\u7a0b\u4e2d,\u6211\u4eec\u5728\u8bbe\u8ba1\u9519\u8bef\u5904\u7406\u65f6, \u8981\u9762\u4e34\u51e0\u4e2a\u6bd4\u8f83\u5173\u952e\u7684\u95ee\u9898.</p> <ol> <li>\u591a\u79cd\u7c7b\u578b\u7684Error\u5728\u540c\u4e00\u4e2a\u51fd\u6570\u4e2d\u9700\u8981\u5904\u7406\u65f6, \u5fc5\u987b\u8981\u6709\u4e00\u4e2a\u5171\u540c\u7684\u53ef\u4ee5Into\u7684Error\u7c7b\u578b\u4f5c\u4e3a\u51fd\u6570\u8fd4\u56de\u503c, \u6bd4\u5982\u4e0b\u9762\u7684\u4ee3\u7801\uff1a</li> </ol> <pre><code>fn foo() -&gt; Result&lt;(), FooError&gt; {\nlet one: Result&lt;(), OneError&gt; = fn_one();\none?;\nlet two: Result&lt;(), TwoError&gt; = fn_two();\ntwo?;\nOk(())\n}\n</code></pre> <p>\u90a3\u4e48FooError\u5fc5\u987b\u6709\u5b9e\u73b0From\u548cFrom, \u60ef\u5e38\u7684\u505a\u6cd5\u662f\u5199\u4e00\u4e2aenum\u5c06\u6240\u6709\u7684\u9519\u8bef\u90fd\u5c01\u88c5\u8d77\u6765, \u5e76\u4e14\u5b9e\u73b0Display\u3001Debug\u3001Error\u8fd8\u6709From\u8fd9\u51e0\u4e2atrait, \u624b\u5199\u7684\u8bdd\u6bd4\u8f83\u67af\u71e5\u4e4f\u5473\u3002 <ol> <li>Error trait\u7684backtrace\u8fd8\u672a\u7a33\u5b9a, \u867d\u7136\u8bf4backtrace\u5bf9\u6027\u80fd\u4f1a\u6709\u635f\u8017, \u4f46\u662f\u6ca1\u6709backtrace\u5728\u9047\u5230\u9519\u8bef\u629b\u51fa\u7684\u65f6\u5019, \u5982\u679c\u9519\u8bef\u6ca1\u6709\u4e00\u4e9b\u660e\u786e\u7684\u4fe1\u606f, \u5c31\u5f88\u96be\u5b9a\u4f4d\u5230\u662f\u54ea\u91cc\u7684\u4ee3\u7801\u629b\u7684\u8fd9\u4e2a\u9519\u8bef, \u7279\u522b\u662f\u5bf9\u4e8e\u7b2c\u4e09\u65b9\u5e93\u629b\u7684\u9519\u8bef, \u5bf9\u4e8e\u5f00\u53d1\u8c03\u8bd5\u548c\u751f\u4ea7\u6392\u67e5\u95ee\u9898\u90fd\u9020\u6210\u4e86\u4e0d\u4fbf, \u5728Fix the Error trait\u8fd9\u4e2aRFC\u91cc\u9762\u6709\u63d0\u51fa\u3002</li> <li>\u6a21\u5757\u7ea7 Error \u7c7b\u578b\u4e0e\u5168\u5c40 Error \u7c7b\u578b.\u6a21\u5757\u7ea7 Error \u7c7b\u578b\uff1a \u6307\u7684\u662f\u5728\u5355\u4e2a\u6a21\u5757\u5185\u90e8\u4f7f\u7528\u7684\u9519\u8bef\u7c7b\u578b, \u53ea\u5bf9\u8be5\u6a21\u5757\u5185\u7684\u4ee3\u7801\u6709\u6548, \u4e0d\u4f1a\u5f71\u54cd\u5230\u5176\u4ed6\u6a21\u5757\u3002\u6a21\u5757\u7ea7 Error \u7c7b\u578b\u53ef\u4ee5\u4f7f\u4ee3\u7801\u66f4\u5bb9\u6613\u7ef4\u62a4\u548c\u9605\u8bfb, \u5e76\u4e14\u66f4\u5bb9\u6613\u8bca\u65ad\u9519\u8bef\u3002\u5168\u5c40 Error \u7c7b\u578b\uff1a \u6307\u7684\u662f\u5728\u5168\u5c40\u8303\u56f4\u5185\u4f7f\u7528\u7684\u9519\u8bef\u7c7b\u578b, \u5bf9\u6574\u4e2a\u7a0b\u5e8f\u6709\u6548\u3002\u5168\u5c40 Error \u7c7b\u578b\u53ef\u4ee5\u4f7f\u4ee3\u7801\u5177\u6709\u66f4\u9ad8\u7684\u53ef\u79fb\u690d\u6027, \u56e0\u4e3a\u5b83\u53ef\u4ee5\u5728\u4efb\u4f55\u6a21\u5757\u4e2d\u4f7f\u7528, \u4f46\u5b83\u53ef\u80fd\u4f1a\u4f7f\u4ee3\u7801\u96be\u4ee5\u7ef4\u62a4, \u56e0\u4e3a\u6240\u6709\u9519\u8bef\u7c7b\u578b\u90fd\u5b58\u5728\u4e8e\u5168\u5c40\u8303\u56f4\u5185\u3002\u8fd9\u662f\u5728\u5927\u578b\u5de5\u7a0b\u4e2d\u7ecf\u5e38\u8981\u9762\u4e34\u7684\u95ee\u9898, \u8981\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u505a\u51fa\u4e9b\u53d6\u820d.</li> </ol> <p>\u5bf9\u4e8e\u4e0a\u9762\u7684\u95ee\u9898, Rust\u754c\u5f88\u591a\u5f88\u4f18\u79c0\u7684crates\u6765\u89e3\u51b3,\u901a\u8fc7\u5b8f\u6765\u7b80\u5316Error\u7684\u5b9a\u4e49\u548c\u4f7f\u7528.</p> <p>\u8fd9\u91cc\u91cd\u70b9\u4ecb\u7ecd\u4e0b\u4e24\u5957\u65b9\u6848, \u4e24\u8005\u90fd\u5bf9\u4e0a\u9762\u95ee\u9898\u6709\u81ea\u5df1\u72ec\u5230\u7684\u89c1\u89e3.</p> <ul> <li>thiserror + anyhow</li> </ul> <p>\u6ce8\u610f\u4e8b\u9879\uff1athiserror\u662f\u7ed9lib\u4f7f\u7528\u7684, \u800canyhow\u662f\u7ed9bin\u7a0b\u5e8f\u4f7f\u7528, \u5f53\u7136bin\u7a0b\u5e8f\u53ef\u4ee5\u4f7f\u7528thiser+anyhow, \u4f46\u662f\u5207\u8bb0anyhow\u4e0d\u8981\u5728lib\u91cc\u9762\u4f7f\u7528\u3002</p> <pre><code>use thiserror::Error;\n#[derive(Error, Debug)]\npub enum DataStoreError {\n#[error(\"data store disconnected\")]\nDisconnect(#[from] io::Error),\n#[error(\"the data for key `{0}` is not available\")]\nRedaction(String),\n#[error(\"invalid header (expected {expected:?}, found {found:?})\")]\nInvalidHeader {\nexpected: String,\nfound: String,\n},\n#[error(\"unknown data store error\")]\nUnknown,\n}\n</code></pre> <p>\u8fd9\u4e2a\u672c\u8d28\u4e0a\u7528enum\u5c01\u88c5\u7684\u601d\u8def, \u7528derive macro\u6765\u81ea\u52a8\u751f\u6210\u7684, \u8282\u7701\u4e86\u5f88\u591a\u7684\u65f6\u95f4\u3002</p> <pre><code>use anyhow::Result;\nfn get_cluster_info() -&gt; Result&lt;ClusterMap&gt; {\nlet config = std::fs::read_to_string(\"cluster.json\")?;\nlet map: ClusterMap = serde_json::from_str(&amp;config)?;\nOk(map)\n}\n</code></pre> <p>\u8fd9\u91cc\u76f4\u63a5\u5c06anyhow::Result\u4f5c\u4e3a\u8fd4\u56de\u503c, \u56e0\u4e3a\u5b83\u76f4\u63a5\u5b9e\u73b0\u4e86From where E: Error, \u6240\u4ee5\u65e0\u8981\u7ef4\u62a4\u4e00\u4e2aenum\u7c7b\u578b, \u4f46\u662f\u6ce8\u610f\u53ea\u6709\u5728bin\u7a0b\u5e8f\u91cc\u9762\u624d\u5efa\u8bae\u4f7f\u7528. <ul> <li>snafu</li> </ul> <p>snafu\u65b9\u6848, \u65f6\u5c06context\u548c\u5177\u4f53\u7684Error\u6bd4\u8f83\u4f18\u96c5\u7684\u7ed3\u5408\u8d77\u6765. \u8fd8\u53ef\u4ee5\u9644\u5e26\u66f4\u591a\u7684\u9519\u8bef\u76f8\u5173\u4fe1\u606f, \u5982io::Error\u4e2d\u53ef\u4ee5\u9644\u5e26PathBuf\u4fe1\u606f,\u6bd4thiserror\u4e2d\u76f4\u63a5\u7ee7\u627f\u66f4\u6709\u610f\u4e49.</p> <pre><code>#![allow(unused)]\nfn main() {\nuse snafu::{ResultExt, Snafu};\nuse std::{fs, io, path::PathBuf};\n#[derive(Debug, Snafu)]\nenum Error {\n#[snafu(display(\"Unable to read configuration from {}: {}\", path.display(), source))]\nReadConfiguration { source: io::Error, path: PathBuf },\n#[snafu(display(\"Unable to write result to {}: {}\", path.display(), source))]\nWriteResult { source: io::Error, path: PathBuf },\n}\ntype Result&lt;T, E = Error&gt; = std::result::Result&lt;T, E&gt;;\nfn process_data() -&gt; Result&lt;()&gt; {\nlet path = \"config.toml\";\nlet configuration = fs::read_to_string(path).context(ReadConfiguration { path })?;\nlet path = unpack_config(&amp;configuration);\nfs::write(&amp;path, b\"My complex calculation\").context(WriteResult { path })?;\nOk(())\n}\nfn unpack_config(data: &amp;str) -&gt; &amp;str {\n\"/some/path/that/does/not/exist\"\n}\n}\n</code></pre> <p>\u4e0d\u59a8\u901a\u8fc7\u5b98\u7f51\u6765\u4e86\u89e3snafu\u7684\u8bbe\u8ba1\u54f2\u5b66.</p> <ul> <li>\u540c\u6837\u7684\u5e95\u5c42\u9519\u8bef\u53ef\u4ee5\u6839\u636e\u4e0a\u4e0b\u6587\u4e0d\u540c\u800c\u8f6c\u6362\u4e3a\u4e0d\u540c\u7684\u9886\u57df\u7279\u5b9a\u9519\u8bef, \u4f8b\u5982\u540c\u6837\u662f io \u9519\u8bef, \u6839\u636e\u4e0a\u5c42\u4e1a\u52a1\u8bed\u4e49\u7684\u4e0d\u540c\u80fd\u591f\u8f6c\u6362\u4e3a\u4e0d\u540c\u7684\u4e1a\u52a1\u9519\u8bef</li> <li>\u5728\u5e93\u548c\u5e94\u7528\u7684\u573a\u666f\u4e0b\u90fd\u540c\u6837\u597d\u7528</li> <li>\u6a21\u5757\u7ea7\u522b\u7684 Error \u7c7b\u578b, \u6bcf\u4e2a\u6a21\u5757\u90fd\u5e94\u8be5\u5b9a\u4e49\u4e00\u4e2a, \u751a\u81f3\u591a\u4e2a\u81ea\u5df1\u4e13\u7528\u7684\u9519\u8bef\u7c7b\u578b</li> </ul>"},{"location":"design/01-errors_of_sysmaster/#sysmaster","title":"sysMaster\u9519\u8bef\u5904\u7406","text":"<p>\u6211\u4eec\u8fc7\u53bb\u719f\u6089\u7684\u521d\u59cb\u5316\u7cfb\u7edf\uff08\u6bd4\u5982 sysVinit\u3001systemd\u3001upstart\uff09, \u5927\u591a\u662f\u4f7f\u7528 C \u5199\u7684, \u4e14\u5f80\u5f80\u56e0\u4e3a\u8bbe\u8ba1\u590d\u6742, \u529f\u80fd\u5927\u4e00\u7edf\u7b49\u6709\u8fdd UNIX \u4f20\u7edf\u601d\u7ef4\u7684\u505a\u6cd5\u800c\u5e7f\u53d7\u8bdf\u75c5\u3002openEuler \u793e\u533a\u4e3a\u793e\u533a\u63d0\u4f9b\u4e86\u4e00\u4e2a\u5168\u65b0\u7684\u3001\u91c7\u7528 Rust \u7f16\u5199\u7684\u521d\u59cb\u5316\u7cfb\u7edf \u2014\u2014 sysMaster\u3002</p> <p>\u548c systemd \u76f8\u6bd4, \u7531\u4e8e sysMaster \u91c7\u7528 Rust \u8bed\u8a00\u7f16\u5199, \u539f\u751f\u5730\u89c4\u907f\u4e86\u5185\u5b58\u6cc4\u6f0f\u95ee\u9898, \u5f00\u53d1\u8005\u65e0\u9700\u62c5\u5fc3\u5185\u5b58\u6cc4\u6f0f\u5bfc\u81f4\u7684 1 \u53f7\u8fdb\u7a0b\u6302\u6389\u3002\u800c\u4ece\u96f6\u6784\u5efa\u7684 sysMaster, \u4e5f\u6452\u5f03\u4e86\u4e4b\u524d\u7684\u521d\u59cb\u5316\u7cfb\u7edf\u4e2d\u5b58\u5728\u95ee\u9898, \u4e3a\u5f00\u53d1\u8005\u63d0\u4f9b\u4e86**\u65b0\u4e00\u4ee3\u7684\u521d\u59cb\u5316\u7cfb\u7edf** \u3002</p> <p>\u76f8\u6bd4\u4e8e\u8fc7\u53bb\u7684\u521d\u59cb\u5316\u7cfb\u7edf, sysMaster \u63d0\u4f9b\u4e86\u5168\u65b0\u7684\u67b6\u6784\u8bbe\u8ba1, \u5206\u4e3a sysMaster Core \u548c sysMaster Extend \u4e24\u7c7b\u3002sysMaster Core \u63d0\u4f9b\u4e86\u6781\u5ea6\u8f7b\u91cf\u7684\u8c03\u5ea6\u65b9\u5f0f, \u5360\u7528\u66f4\u5c11\u7684\u8d44\u6e90, \u4ee5\u53ca\u66f4\u5feb\u7684\u542f\u52a8\u901f\u5ea6\u3002\u62c6\u5206\u7684\u67b6\u6784\u5219\u53ef\u4ee5\u652f\u6301\u62d3\u5c55\u591a\u79cd\u670d\u52a1\u7c7b\u578b, \u5b9e\u73b0 1+1+N \u7684\u67b6\u6784, \u6ee1\u8db3\u521d\u59cb\u5316\u7cfb\u7edf\u7684\u591a\u6837\u5316\u8bc9\u6c42\u3002\u800c\u5b83\u7684\u751f\u6001\u517c\u5bb9\u5de5\u5177, \u5219\u53ef\u4ee5\u8ba9\u5f00\u53d1\u8005\u53ef\u4ee5\u81ea\u7531\u9009\u62e9 systemd \u548c sysMaster, \u65e0\u9700\u62c5\u5fc3\u88ab\u751f\u6001\u7ed1\u5b9a\u3002</p> <p>\u5148\u6446\u89c2\u70b9,sysMaster\u4e2d\u7684\u9519\u8bef\u5904\u7406\u8981\u9075\u5faa\u4e0b\u9762\u7684\u539f\u5219.</p> <ol> <li>Error\u7c7b\u578b\u5c3d\u91cf\u505a\u5230\u6a21\u5757\u7ea7\u522b, \u7c7b\u578b\u5b9a\u4e49\u5c3d\u91cf\u5185\u805a\u4e14\u907f\u514d\u8bed\u4e49\u91cd\u590d</li> <li>\u5efa\u8bae\u4f7f\u7528snafu, \u6309crate\u5355\u72ec\u5b9a\u4e49\u5bf9\u5e94\u7684error.rs, \u5c3d\u91cf\u907f\u514d\u51fd\u6570\u7ea7\u6216\u6587\u4ef6\u7ea7\u7c92\u5ea6</li> </ol> <p>\u9274\u4e8esysMaster\u5927\u578b\u8f6f\u4ef6\u7684\u5c5e\u6027\u53ca\u72ec\u6709\u7684\u8bbe\u8ba1, \u8fd9\u662f\u4e0d\u4f7f\u7528\u5168\u5c40\u7684Error\u7684\u539f\u56e0, \u56e0\u4e3a\u4f1a\u5bfc\u81f4\u6574\u4e2a\u9879\u76ee\u8026\u5408\u6bd4\u8f83\u9ad8,\u4e0d\u6613\u7ef4\u62a4.</p> <p>\u4e0b\u9762\u91cd\u70b9\u9610\u8ff0\u5982\u4f55\u5728\u9879\u76ee\u4e2d\u5e94\u7528\u8fd9\u4e9b\u539f\u5219.</p> <ul> <li>\u4e0d\u4f1a\u5b9a\u4e49\u5168\u5c40\u7684error lib, \u6bcf\u4e2acrate\u5b9a\u4e49\u81ea\u5df1\u7684error.rs, crate\u5185\u53ea\u80fd\u4f7f\u7528\u8fd9\u4e2a\u7edf\u4e00\u7684Error, \u6ce8\u610f\u8bed\u4e49\u4e0d\u80fd\u91cd\u590d.sysmaster\u4e2d,unit coms\u7ec4\u4ef6\u548csysmaster-core\u5728\u903b\u8f91\u548c\u529f\u80fd\u4e0a\u5171\u7528\u4e00\u4e2aError,\u907f\u514d\u9891\u7e41\u7684\u8f6c\u6362</li> </ul> <pre><code>//! Error define\nuse snafu::prelude::*;\n/// Event Error\n#[derive(Debug, Snafu)]\n#[snafu(visibility(pub(crate))] //\u5c06\u53ef\u89c1\u6027\u9650\u5236\u5728\u5185\u90e8\n#[non_exhaustive] //\u7533\u660e\u7ed3\u6784\u4f53\u53ef\u53d8,\u672a\u6765\u6dfb\u52a0\u66f4\u591a\u5c5e\u6027\npub enum Error {\n/// An error from IO, can throw with more information\n#[snafu(display(\"Error(A-Io)\"))]\nIo {\nsource: std::io::Error,\nwords: &amp;'static str,   // \u989d\u5916\u7684\u9519\u8bef\u4fe1\u606f\nbacktrace: Backtrace,\n},\n/// It cannot be processed at this level and needs to be thrown. Be careful not to repeat semantics\n#[snafu(display(\"Error(event): '{}'.\", word))]\nInvalidLoad {\n/// some words\nmsg: &amp;'static str,\n},\n}\n</code></pre> <ul> <li>\u7edf\u4e00\u4f7f\u7528snafu\u6765\u7b80\u5316Error\u7684\u5b9a\u4e49, \u5e76\u63a7\u5236\u597d\u4f5c\u7528\u57df, \u9519\u8bef\u5c3d\u91cf\u5728\u8c03\u7528\u7684\u5730\u65b9\u540c\u6b65\u5904\u7406\u6389, \u5c3d\u91cf\u907f\u514d<code>?</code>\u548c<code>unwrap()</code>.</li> </ul> <pre><code>//! a_crate/error.rs\n#[snafu(visibility(pub)] //\u5c06\u53ef\u89c1\u6027\u9650\u5236\u5728\u5185\u90e8\n#[non_exhaustive] //\u7533\u660e\u7ed3\u6784\u4f53\u53ef\u53d8,\u672a\u6765\u6dfb\u52a0\u66f4\u591a\u5c5e\u6027\npub enum Error {\n#[snafu(display(\"Error(A-Io)\"))]\nIo {\nsource: std::io::Error,\nwords: &amp;'static str,   // \u989d\u5916\u7684\u9519\u8bef\u4fe1\u606f\nbacktrace: Backtrace,\n},\n#[snafu(display(\"Error(event): '{}'.\", word))]\nOther {\nwords: &amp;'static str,\n},\n}\n/// crate\u5185\u90e8\u4f7f\u7528\u8303\u4f8b\npub fn inner_example() -&gt; std::result::Result&lt;(), Error&gt; {\nstd::fs::File::open(\"./io.rs\").context(IoSnafu { word: \"todo!()\" })?;\n// open\u51fd\u6570\u5bf9\u5e94\u7684\u9519\u8bef\u65f6std::io::Error,\u5426\u5219\u65e0\u6cd5\u4f7f\u7528context\u81ea\u52a8\u8f6c\u5316\nmatch condition() {\ncasea =&gt; Ok(()),\n_ =&gt; OtherSnafu { words: \"some words\" },\n// OtherSnafu\u5b9a\u4e49\u5728crate\u5185\u90e8, \u9700\u58f0\u660e#[snafu(visibility(pub(crate)]\n}\nOk(())\n}\n//! b_crate/error.rs \u4f9d\u8d56a-crate\npub enum Error {\n#[snafu(display(\"Error(B-Io)\"))]\nAError {\nsource: a_crate::error::Error,\nmore_words: &amp;'static str,   // \u4f7f\u7528\u754c\u9762\u4ea7\u751f\u66f4\u591a\u989d\u5916\u7684\u9519\u8bef\u4fe1\u606f\nbacktrace: Backtrace,\n},\n}\n/// \u8de8crate\u4f7f\u7528\u8303\u4f8b\nfn example() -&gt; std::result::Result&lt;(), Error&gt; {\na_crate::inner_expamle().context(AErrorSnafu { more_word: \"()\" })?;\n// inner_expamle()\u5bf9\u5e94\u9519\u8bef\u65f6a_crate::error::Error, \u5426\u5219\u65e0\u6cd5\n// \u540c\u65f6\u8981\u6ce8\u610f#[snafu(visibility(pub)]\u5b9a\u4e49\u7684a_crate\u7684\u53ef\u89c1\u6027, \u5982\u679c\u4f7f\u7528a_crate::error::Error::Io\nOk(())\n}\n</code></pre> <ul> <li>snafu\u5176\u4ed6\u7528\u6cd5(\u5982backtrace/\u5b8f)\u53ef\u4ee5\u53c2\u8003\u5b98\u65b9\u6587\u6863.</li> </ul>"},{"location":"design/01-integration_test/","title":"\u6d4b\u8bd5\u6846\u67b6\u53ca\u7528\u4f8b\u7f16\u5199","text":""},{"location":"design/01-integration_test/#_2","title":"\u6982\u8ff0","text":"<p>\u672c\u6587\u4ecb\u7ecd\u4e86<code>tests</code>\u76ee\u5f55\u4e0b\u96c6\u6210\u6d4b\u8bd5\u7528\u4f8b\u7684\u76ee\u5f55\u7ed3\u6784\u4e0e\u6267\u884c\u65b9\u6cd5\uff0c\u5e76\u4ee5<code>docker_example_001</code>\u3001<code>docker_config_test_service_001</code>\u7b49\u7528\u4f8b\u4e3a\u6848\u4f8b\u4ecb\u7ecd\u5982\u4f55\u6267\u884c\u3001\u7f16\u5199\u96c6\u6210\u6d4b\u8bd5\u7528\u4f8b\u3002</p>"},{"location":"design/01-integration_test/#_3","title":"\u7528\u4f8b\u76ee\u5f55\u7ed3\u6784","text":"<p>\u4e0d\u540c\u4e8e\u5355\u5143\u6d4b\u8bd5\u7528\u4f8b\uff0c\u96c6\u6210\u7528\u4f8b\u4ec5\u6d4b\u8bd5\u5bf9\u5916\u5f00\u653e\u7684\u63a5\u53e3\u3002\u6240\u6709\u96c6\u6210\u6d4b\u8bd5\u7528\u4f8b\u90fd\u653e\u7f6e\u5728<code>tests</code>\u76ee\u5f55\u4e0b\u3002</p> <pre><code>[root@openEuler tests]# tree ./\n./\n\u251c\u2500\u2500 test_frame.sh    # \u6d4b\u8bd5\u6846\u67b6\n\u251c\u2500\u2500 common    # \u516c\u5171\u51fd\u6570\u5e93\u76ee\u5f55\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 docker_lib.sh    # \u5bb9\u5668\u573a\u666f\u516c\u5171\u51fd\u6570\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 lib.sh    # test_frame.sh\u6240\u9700\u7684\u53d8\u91cf\u548c\u516c\u5171\u51fd\u6570\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 mod.rs    # run_script\u51fd\u6570\uff0c\u6d4b\u8bd5\u7528\u4f8b\u5165\u53e3\u51fd\u6570\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 util_lib.sh    # \u6d4b\u8bd5\u811a\u672c\uff08\u4f8b\u5982check.sh\uff09\u516c\u5171\u51fd\u6570\n|   ...\n\u251c\u2500\u2500 docker_example.rs    # example\u6d4b\u8bd5\u5957\u5b9a\u4e49\u6587\u4ef6\uff08\u5bb9\u5668\u573a\u666f\uff09\n\u251c\u2500\u2500 docker_example    # example\u6d4b\u8bd5\u76ee\u5f55\uff08\u5bb9\u5668\u573a\u666f\uff09\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 docker_example_001    # example\u7528\u4f8b\uff08\u5bb9\u5668\u573a\u666f\uff09\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 check.sh    # \u6d4b\u8bd5\u4e3b\u4f53\uff0c\u5b9e\u9645\u7684\u68c0\u67e5\u811a\u672c\n\u2502\u00a0\u00a0     \u2514\u2500\u2500 docker_example_001.sh    # \u6d4b\u8bd5\u7528\u4f8b\u5165\u53e3\u811a\u672c\n|   ...\n\u251c\u2500\u2500 docker_config_test.rs    # \u914d\u7f6e\u9879\u6d4b\u8bd5\u5957\u5b9a\u4e49\u6587\u4ef6\uff08\u5bb9\u5668\u573a\u666f\uff09\n\u251c\u2500\u2500 docker_config_test    # \u914d\u7f6e\u9879\u6d4b\u8bd5\u76ee\u5f55\uff08\u5bb9\u5668\u573a\u666f\uff09\uff0c\u5176\u4e0b\u6587\u4ef6\u90fd\u662f\u6307\u5411config_test\u76ee\u5f55\u7684\u8f6f\u94fe\u63a5\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 docker_config_test_service_001    # service_001\u7528\u4f8b\uff08\u5bb9\u5668\u573a\u666f\uff09\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 check.sh -&gt; ../../config_test/unit_config_test/service_001/check.sh\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 docker_config_test_service_001.sh -&gt; ../../config_test/unit_config_test/service_001/service_001.sh\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 ...\n\u251c\u2500\u2500 config_test    # \u914d\u7f6e\u9879\u6d4b\u8bd5\u7684\u811a\u672c\u5f52\u6863\u76ee\u5f55\uff08\u5305\u62ec\u5355\u5143\u6587\u4ef6\u914d\u7f6e\u9879\u3001\u7cfb\u7edf\u914d\u7f6e\u9879\u7b49\uff09\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 unit_config_test    # \u5355\u5143\u6587\u4ef6\u914d\u7f6e\u9879\u6d4b\u8bd5\u7684\u811a\u672c\u5f52\u6863\u76ee\u5f55\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 service_001    # service_001\u7528\u4f8b\u811a\u672c\u5f52\u6863\u76ee\u5f55\n\u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u251c\u2500\u2500 service_001.sh    # \u6d4b\u8bd5\u7528\u4f8b\u5165\u53e3\u811a\u672c\n\u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2514\u2500\u2500 check.sh    # \u6d4b\u8bd5\u4e3b\u4f53\uff0c\u5b9e\u9645\u7684\u68c0\u67e5\u811a\u672c\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 ...\n|   ...\n\u251c\u2500\u2500 docker_reliable.rs    # \u53ef\u9760\u6027\u6d4b\u8bd5\u5957\u5b9a\u4e49\u6587\u4ef6\uff08\u5bb9\u5668\u573a\u666f\uff09\n\u251c\u2500\u2500 docker_reliable    # \u53ef\u9760\u6027\u6d4b\u8bd5\u76ee\u5f55\uff08\u5bb9\u5668\u573a\u666f\uff09\uff0c\u5176\u4e0b\u6587\u4ef6\u90fd\u662f\u6307\u5411reliable_test\u76ee\u5f55\u7684\u8f6f\u94fe\u63a5\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 docker_reliable_random_kill_001    # random_kill_001\u7528\u4f8b\uff08\u5bb9\u5668\u573a\u666f\uff09\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 check.sh -&gt; ../../reliable_test/random_kill_001/check.sh\n\u2502\u00a0\u00a0     \u2514\u2500\u2500 docker_reliable_random_kill_001.sh -&gt; ../../reliable_test/random_kill_001/random_kill_001.sh\n\u251c\u2500\u2500 reliable_test    # \u53ef\u9760\u6027\u6d4b\u8bd5\u7684\u811a\u672c\u5f52\u6863\u76ee\u5f55\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 random_kill_001    # random_kill_001\u7528\u4f8b\u811a\u672c\u5f52\u6863\u76ee\u5f55\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 check.sh    # \u6d4b\u8bd5\u4e3b\u4f53\uff0c\u5b9e\u9645\u7684\u68c0\u67e5\u811a\u672c\n\u2502\u00a0\u00a0     \u2514\u2500\u2500 random_kill_001.sh    # \u6d4b\u8bd5\u7528\u4f8b\u5165\u53e3\u811a\u672c\n|   ...\n\u251c\u2500\u2500 presets\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 ...\n\u2514\u2500\u2500 test_units    # \u6d4b\u8bd5\u6240\u9700\u6587\u4ef6\u7684\u5f52\u6863\u76ee\u5f55\n\u251c\u2500\u2500 basic.target\n    \u251c\u2500\u2500 ...\n    \u251c\u2500\u2500 tests    # \u96c6\u6210\u6d4b\u8bd5\u6240\u9700\u7684\u5355\u5143\u6587\u4ef6\u5f52\u6863\u76ee\u5f55\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 after.service\n    \u2502\u00a0\u00a0 \u251c\u2500\u2500 base.service\n    \u2502\u00a0\u00a0 \u251c\u2500\u2500 base.socket\n    \u2502\u00a0\u00a0 \u251c\u2500\u2500 ...\n    \u251c\u2500\u2500 ...\n</code></pre> <p>\u5728\u672c\u9879\u76ee\u4e2d\uff0c<code>tests</code>\u76ee\u5f55\u4e0b\u7684\u6bcf\u4e2ars\u6587\u4ef6\u4ee3\u8868\u4e00\u4e2a\u7528\u4f8b\u96c6\u5408\uff0c\u6216\u8005\u8bf4\u4e00\u4e2a\u6d4b\u8bd5\u5957\u3002rs\u6587\u4ef6\u547d\u540d\u9700\u8981\u9075\u5faa\u201c\u573a\u666f_\u6a21\u5757\u201d\u7684\u89c4\u5f8b\uff0c\u201c\u6a21\u5757\u201d\u53ef\u6269\u5c55\u6210\u201c\u5b50\u6a21\u5757\u201d\uff0c\u4f8b\u5982\uff1a\u201c\u573a\u666f_\u6a21\u5757_a\u5b50\u6a21\u5757_b\u5b50\u6a21\u5757_...\u201d\u3002\u8fd9\u6837\u7684\u547d\u540d\u98ce\u683c\u4e0d\u4ec5\u65b9\u4fbf\u7ba1\u7406\uff0c\u4e5f\u4fbf\u4e8e\u4f7f\u7528cargo test\u7684\u539f\u751f\u529f\u80fd\u8fdb\u884c\u7528\u4f8b\u7b5b\u9009\uff08\u5177\u4f53\u89c1[\u7528\u4f8b\u6267\u884c]\u7ae0\u8282\uff09\u3002</p> <pre><code>\u251c\u2500\u2500 docker_example.rs    # \u573a\u666f\uff1adocker\uff0c\u6a21\u5757\u540e\u7f00\uff1aexample\n\u251c\u2500\u2500 docker_config_test.rs    # \u573a\u666f\uff1adocker\uff0c\u6a21\u5757\u540e\u7f00\uff1aconfig_test\n\u251c\u2500\u2500 vm_config_test.rs    # \u573a\u666f\uff1avm\uff0c\u6a21\u5757\u540e\u7f00\uff1aconfig_test\n\u251c\u2500\u2500 docker_reliable.rs    # \u573a\u666f\uff1adocker\uff0c\u6a21\u5757\u540e\u7f00\uff1areliable\n</code></pre> <p><code>tests</code>\u76ee\u5f55\u4e0b\u7684\u6bcf\u4e2ars\u6587\u4ef6\u987b\u914d\u5957\u4e00\u4e2a\u540c\u540d\u6d4b\u8bd5\u5957\u76ee\u5f55\uff0c\u8be5\u76ee\u5f55\u4e0b\u662f\u7528\u4f8b\u7684\u540c\u540d\u5b50\u76ee\u5f55\uff0c\u7528\u4e8e\u5b58\u653e\u6d4b\u8bd5\u6240\u9700\u7684shell\u811a\u672c\u7b49\u6587\u4ef6\u3002\u7528\u4f8b\u6267\u884c\u540e\u751f\u6210\u7684\u8be6\u7ec6\u65e5\u5fd7\u4e5f\u4f1a\u5b58\u653e\u4e8e\u6b64\u3002\u7528\u4f8b\u547d\u540d\u987b\u4ee5\u5176\u6240\u5728\u7684rs\u6587\u4ef6\u540d\u4e3a\u524d\u7f00\uff0c\u540e\u7f00\u8865\u5145\u7528\u4f8b\u6897\u6982\u4fe1\u606f\uff0c\u4e5f\u53ef\u4ee5\u5728\u6700\u540e\u52a0\u4e0a\u4e09\u4f4d\u6570\u5b57\u7684\u7f16\u53f7\u7528\u4ee5\u533a\u5206\u3002</p> <pre><code>\u251c\u2500\u2500 docker_config_test.rs\n\u251c\u2500\u2500 docker_config_test    # rs\u6587\u4ef6\u540c\u540d\u6d4b\u8bd5\u5957\u76ee\u5f55\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 docker_config_test_condition_001    # \u524d\u7f00\uff1adocker_config_test\uff0c\u7528\u4f8b\u6897\u6982\uff1acondition\u914d\u7f6e\u6d4b\u8bd5\uff0c\u7f16\u53f7\uff1a001\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 docker_config_test_condition_002    # \u524d\u7f00\uff1adocker_config_test\uff0c\u7528\u4f8b\u6897\u6982\uff1acondition\u914d\u7f6e\u6d4b\u8bd5\uff0c\u7f16\u53f7\uff1a002\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 docker_config_test_dependency_001    # \u524d\u7f00\uff1adocker_config_test\uff0c\u7528\u4f8b\u6897\u6982\uff1a\u4f9d\u8d56\u7c7b\u914d\u7f6e\u6d4b\u8bd5\uff0c\u7f16\u53f7\uff1a001\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 docker_config_test_dependency_002    # \u524d\u7f00\uff1adocker_config_test\uff0c\u7528\u4f8b\u6897\u6982\uff1a\u4f9d\u8d56\u7c7b\u914d\u7f6e\u6d4b\u8bd5\uff0c\u7f16\u53f7\uff1a002\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 docker_config_test_env_001    # \u524d\u7f00\uff1adocker_config_test\uff0c\u7528\u4f8b\u6897\u6982\uff1a\u73af\u5883\u53d8\u91cf\u914d\u7f6e\u6d4b\u8bd5\uff0c\u7f16\u53f7\uff1a001\n</code></pre> <p>rs\u6587\u4ef6\u4e2d\u4ee5<code>#[test]</code>\u5173\u952e\u5b57\u5b9a\u4e49\u6d4b\u8bd5\u7528\u4f8b\u3002\u4ee5<code>docker_config_test.rs</code>\u4e3a\u4f8b\uff1a</p> <pre><code>#[test]\n#[ignore]\nfn docker_config_test_dependency_001() {\ncommon::run_script(\n\"docker_config_test\",\n\"docker_config_test_dependency_001\",\n\"1\",\n);\n}\n#[test]\n#[ignore]\nfn docker_config_test_dependency_002() {\ncommon::run_script(\n\"docker_config_test\",\n\"docker_config_test_dependency_002\",\n\"1\",\n);\n}\n#[test]\n#[ignore]\nfn docker_config_test_env_001() {\ncommon::run_script(\"docker_config_test\", \"docker_config_test_env_001\", \"1\");\n}\n</code></pre> <p>\u4f60\u4f1a\u6ce8\u610f\u5230\u6709\u4e00\u4e2a<code>tests/common</code>\u76ee\u5f55\uff0c\u8be5\u76ee\u5f55\u7528\u4e8e\u5b58\u653e\u4e00\u4e9b\u516c\u5171\u51fd\u6570\u5e93\uff0c\u4e0d\u5c5e\u4e8e\u4efb\u4f55\u4e00\u4e2a\u5177\u4f53\u7684\u7528\u4f8b\u3002\u8fd8\u6709\u4e00\u4e2a<code>test_units</code>\u76ee\u5f55\uff0c\u7528\u4e8e\u5f52\u6863\u6d4b\u8bd5\u6240\u9700\u7684\u5355\u5143\u6587\u4ef6\uff0c\u96c6\u6210\u6d4b\u8bd5\u6240\u9700\u7684\u5355\u5143\u6587\u4ef6\u90fd\u653e\u7f6e\u5728<code>test_units/tests</code>\u76ee\u5f55\u4e0b\u3002</p>"},{"location":"design/01-integration_test/#_4","title":"\u7528\u4f8b\u6267\u884c","text":"<p>\u63a8\u8350\u4f7f\u7528cargo\u5de5\u5177\u8fdb\u884c\u81ea\u52a8\u5316\u6d4b\u8bd5\u3002\u5728\u9879\u76ee\u76ee\u5f55\u4e0b\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\u5c31\u53ef\u4ee5\u6267\u884c\u6d4b\u8bd5\u7528\u4f8b\uff1a</p> <pre><code>cargo clean\ncargo build --all\n\n# \u53ea\u6267\u884c\u5355\u5143\u7528\u4f8b\ncargo test\n# \u53ea\u6267\u884c\u96c6\u6210\u7528\u4f8b\ncargo test -- --ignored --test-threads=1\n# \u6267\u884c\u6240\u6709\u6d4b\u8bd5\u7528\u4f8b\ncargo test -- --include-ignored --test-threads=1\n</code></pre>"},{"location":"design/01-integration_test/#_5","title":"\u7f13\u5b58\u6e05\u7406","text":"<p>\u6267\u884c\u5bb9\u5668\u573a\u666f\u7684\u7528\u4f8b\uff0c\u6bcf\u6b21\u66f4\u65b0\u4ee3\u7801\u540e\u5fc5\u987b\u6e05\u7406\u73af\u5883\u4e2d\u7f13\u5b58\u7684<code>sysmaster_base</code>\u5bb9\u5668\u955c\u50cf\uff0c\u518d\u6267\u884c\u7528\u4f8b\uff0c\u5426\u5219\u88ab\u6d4b\u5bf9\u8c61\u65e0\u6cd5\u66f4\u65b0\u3002</p> <pre><code>[root@openEuler tests]# docker images\nREPOSITORY                               TAG                 IMAGE ID            CREATED             SIZE\nsysmaster_base-openeuler-22.03-lts-sp1   latest              0d044cccf14a        47 hours ago        461MB\nopeneuler-22.03-lts-sp1                  latest              a0213c9a6ecb        3 months ago        191MB\n[root@openEuler tests]# docker rmi 0d044cccf14a\nUntagged: sysmaster_base-openeuler-22.03-lts-sp1:latest\nDeleted: sha256:0d044cccf14a33b03f19fb55cb7e5d8160ded6dde957ef657989b0d7b6069dbf\nDeleted: sha256:334cc7ee8e6ff60f247fac390c441834f82a4dfa9c7ff912af6453d2c8e301cd\nDeleted: sha256:43f31a4a00930231324af564494e6a8df8ea264a841e8cf3434ce5f6939ef3fe\nDeleted: sha256:9c69b5de436cdf364f7804cef6c8e83d993763c1d2fac7d56a0a6057a0923541\nDeleted: sha256:d42bdece43648694efcf0ce12d18696971188f3aab64910d8cb35b1696c84e4b\nDeleted: sha256:15a448c8a65ea6827ab7348bde18f27b8e05afc3e634f9e670828cedb8f1a966\nDeleted: sha256:937dfaf6419511399eec93ebac6b4d1a68fb68abf86214381d345be9fc1c11ae\nDeleted: sha256:d7402eb5cba4f216aacd24fb189768a1b5658a47c6b9e9320787e497629c3622\n[root@openEuler tests]# docker images\nREPOSITORY                TAG                 IMAGE ID            CREATED             SIZE\nopeneuler-22.03-lts-sp1   latest              a0213c9a6ecb        3 months ago        191MB\n</code></pre>"},{"location":"design/01-integration_test/#ignore","title":"ignore\u6807\u8bb0\u96c6\u6210\u7528\u4f8b","text":"<p>\u793e\u533aci\u95e8\u7981\u5728\u5bb9\u5668\u4e2d\u8fd0\u884c\uff0c\u6240\u4ee5\u65e0\u6cd5\u76f4\u63a5\u5728ci\u95e8\u7981\u4e2d\u6267\u884c\u5bb9\u5668\u3001\u865a\u62df\u673a\u573a\u666f\u7684\u7528\u4f8b\u3002\u800cci\u95e8\u7981\u4e2d\u4f1a\u6267\u884c<code>cargo test --all</code>\uff0c\u5982\u679c\u4e0d\u7528<code>#[ignored]</code>\u5173\u952e\u5b57\u52a0\u4ee5\u533a\u5206\uff0c\u4f1a\u5bfc\u81f4ci\u95e8\u7981\u4e2d\u96c6\u6210\u7528\u4f8b\u6267\u884c\u5931\u8d25\u3002</p> <p><code>#[ignore]</code>\u5173\u952e\u5b57\u5177\u4f53\u4ec0\u4e48\u542b\u4e49\u5462\uff1f\u8ba9\u6211\u4eec\u5148\u6765\u770b\u4e0b\u5b98\u65b9usage\u4fe1\u606f\uff1a</p> <pre><code>Test Attributes:\n\n`#[test]`        - Indicates a function is a test to be run. This function\ntakes no arguments.\n    `#[bench]`       - Indicates a function is a benchmark to be run. This\nfunction takes one argument (test::Bencher).\n    `#[should_panic]` - This function (also labeled with `#[test]`) will only pass if\nthe code causes a panic (an assertion failure or panic!)\nA message may be provided, which the failure string must\n                        contain: #[should_panic(expected = \"foo\")].\n`#[ignore]`       - When applied to a function which is already attributed as a\ntest, then the test runner will ignore these tests during\n                        normal test runs. Running with --ignored or --include-ignored will run\n                        these tests.\n</code></pre> <p>\u7531\u6b64\u53ef\u77e5\uff0c<code>#[ignore]</code>\u6807\u8bb0\u7684\u7528\u4f8b\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4e0d\u4f1a\u6267\u884c\uff0c\u53ea\u6709<code>cargo test</code>\u4f20\u53c2<code>--ignored</code> \u6216 <code>--include-ignored</code>\u624d\u4f1a\u6267\u884c\uff1b\u524d\u8005\u4ee3\u8868\u53ea\u6267\u884c\u5e26<code>#[ignore]</code>\u6807\u8bb0\u7684\u7528\u4f8b\uff0c\u540e\u8005\u4f1a\u6267\u884c\u5e26<code>#[ignore]</code>\u6807\u8bb0\u7684\u7528\u4f8b\u548c\u4e0d\u5e26\u6807\u8bb0\u7684\u7528\u4f8b\u3002\u56e0\u6b64\uff0c\u672c\u9879\u76ee\u4f7f\u7528<code>#[ignore]</code>\u6807\u8bb0\u6765\u8df3\u8fc7ci\u95e8\u7981\u4e2d\u7684\u96c6\u6210\u7528\u4f8b\u3002</p>"},{"location":"design/01-integration_test/#_6","title":"\u6d4b\u8bd5\u5957\u6267\u884c","text":"<p>\u5982\u679c\u4f60\u53ea\u60f3\u6267\u884c\u5355\u4e2a\u7528\u4f8b\uff0c\u6216\u8005\u8bf4\u5355\u4e2a\u6d4b\u8bd5\u5957\uff0c\u53ef\u4ee5\u4f7f\u7528cargo\u81ea\u5e26\u7684\u7528\u4f8b\u540d\u79f0\u7b5b\u9009\u529f\u80fd\uff1a</p> <pre><code>[root@openEuler tests]# cargo test --help\nExecute all unit and integration tests and build examples of a local package\n\nUsage: cargo test [OPTIONS] [TESTNAME] [-- [args]...]\nArguments:\n  [TESTNAME]  If specified, only run tests containing this string in their names\n  [args]...   Arguments for the test binary\n</code></pre> <p>\u4ece\u4e0a\u8ff0\u622a\u53d6\u7684usage\u4fe1\u606f\u4e2d\u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff0c<code>cargo test</code>\u540e\u9762\u7684\u5165\u53c2\u53ef\u4ee5\u76f4\u63a5\u5199\u7528\u4f8b\u540d<code>[TESTNAME]</code>\uff08\u53ea\u652f\u6301\u5355\u4e2a\uff09\uff0c\u6216\u8005\u7528\u4f8b\u540d\u7684\u5b50\u5b57\u7b26\u4e32\u3002</p> <p>\u4ee5<code>docker_example_001</code>\u4e3a\u4f8b\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u5c1d\u8bd5\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u6267\u884c\uff1a</p> <pre><code># \u6267\u884c\u5355\u4e2a\u7528\u4f8b\ncatgo test docker_example_001\n\n# \u6267\u884c\u540d\u79f0\u5305\u542b\u201cdocker_example\u201d\u5b57\u7b26\u4e32\u7684\u7528\u4f8b\uff0c\u5373docker_example\u6d4b\u8bd5\u5957\ncatgo test docker_example\n\n# \u6267\u884c\u540d\u79f0\u5305\u542b\u201cdocker\u201d\u5b57\u7b26\u4e32\u7684\u7528\u4f8b\uff0c\u5373\u6240\u6709\u5bb9\u5668\u573a\u666f\u7684\u7528\u4f8b\ncatgo test docker\n</code></pre> <p>\u4f46\u4e0a\u8ff0\u4f20\u53c2\u65b9\u6cd5\u53ea\u652f\u6301\u5355\u4e2a\u53c2\u6570\uff0c\u5982\u679c\u4f60\u60f3\u6267\u884c\u524d\u7f00\u4e0d\u540c\u7684\u591a\u4e2a\u6d4b\u8bd5\u5957\uff0c\u53ef\u4ee5\u53c2\u8003\u5982\u4e0b\u547d\u4ee4\uff1a</p> <pre><code>cargo test --test docker_config_test --test docker_example\n</code></pre> <p>\u6b63\u5982\u4e0a\u8ff0\u547d\u4ee4\u6240\u793a\uff0c<code>--test</code>\u9009\u9879\u53ef\u4ee5\u6307\u5b9a\u6d4b\u8bd5\u5bf9\u8c61\uff0c\u5e76\u4e14\u652f\u6301\u591a\u6b21\u4f20\u53c2\uff1a</p> <pre><code>     --test [&lt;NAME&gt;]           Test only the specified test target\n</code></pre> <p>\u6267\u884c\u6548\u679c\u5982\u4e0b\uff1a</p> <pre><code># Assume that docker_config_test_service_001 and docker_example_001 is the only testcase in their testsuits\n[root@openEuler tests]# cargo test --test docker_config_test --test docker_example -- --ignored --test-threads=1\nwarning: /opt/sysmaster/Cargo.toml: `panic` setting is ignored for `bench` profile\nwarning: /opt/sysmaster/Cargo.toml: `panic` setting is ignored for `test` profile\n   Compiling cmdproto v0.2.0 (/opt/sysmaster/libs/cmdproto)\nwarning: ExitStatus(unix_wait_status(0))\nCompiling sysmaster v0.2.2 (/opt/sysmaster)\nFinished test [unoptimized + debuginfo] target(s) in 5.51s\n     Running tests/docker_config_test.rs (/opt/sysmaster/target/debug/deps/docker_config_test-96302cf734a3a312)\nrunning 1 test\ntest docker_config_test_service_001 ... ok\n\ntest result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 40.42s\n\nRunning tests/docker_example.rs (/opt/sysmaster/target/debug/deps/docker_example-b995116db87e6729)\nrunning 1 test\ntest docker_example_001 ... ok\n\ntest result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.55s\n</code></pre> <p>\u4f60\u53ef\u80fd\u6ce8\u610f\u5230\u4e0a\u9762\u7684\u547d\u4ee4\u4e2d\uff0c\u4f7f\u7528\u4e86<code>--test-threads</code>\u9009\u9879\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0ccargo\u4f1a\u591a\u7ebf\u7a0b\u5e76\u53d1\u6267\u884c\u7528\u4f8b\uff0c\u8fd9\u4f1a\u6709\u8d44\u6e90\u7ade\u4e89\u7684\u98ce\u9669\u3002\u56e0\u6b64\u5fc5\u987b\u5728\u6267\u884c\u96c6\u6210\u7528\u4f8b\u65f6\u4f7f\u7528<code>--test-threads=1</code>\u9009\u9879\uff0c\u9650\u5236\u540e\u53f0\u7ebf\u7a0b\u6570\u91cf\uff0c\u4ee5\u8fbe\u5230\u4e32\u884c\u6267\u884c\u7684\u6548\u679c\uff1a</p> <pre><code>        --test-threads n_threads\n                        Number of threads used for running tests in parallel\n</code></pre>"},{"location":"design/01-integration_test/#_7","title":"\u65e5\u5fd7\u8f93\u51fa","text":"<p>cargo test\u6267\u884c\u96c6\u6210\u7528\u4f8b\u4f1a\u6253\u5370\u7528\u4f8b\u8def\u5f84\u3001\u6267\u884c\u7ed3\u679c\u3001\u8017\u65f6\u65f6\u957f\u7b49\u4fe1\u606f\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u4e0d\u6253\u5370\u7528\u4f8b\u6210\u529f\u7684\u65e5\u5fd7\uff0c\u53ea\u6253\u5370\u5931\u8d25\u7528\u4f8b\u7684\u8be6\u7ec6\u65e5\u5fd7\uff08\u4f4d\u7f6e\u53ef\u80fd\u4f1a\u6709\u9519\u4e71\uff09\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@openEuler tests]# cargo test --test docker_config_test --test docker_example -- --ignored --test-threads=1\nwarning: /opt/sysmaster/Cargo.toml: `panic` setting is ignored for `bench` profile\nwarning: /opt/sysmaster/Cargo.toml: `panic` setting is ignored for `test` profile\n   Compiling cmdproto v0.2.0 (/opt/sysmaster/libs/cmdproto)\nwarning: ExitStatus(unix_wait_status(0))\nCompiling sysmaster v0.2.2 (/opt/sysmaster)\nFinished test [unoptimized + debuginfo] target(s) in 5.41s\n     Running tests/docker_config_test.rs (/opt/sysmaster/target/debug/deps/docker_config_test-96302cf734a3a312)\nrunning 1 test\ntest docker_config_test_service_001 ... ok\n\ntest result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 36.18s\n\nRunning tests/docker_example.rs (/opt/sysmaster/target/debug/deps/docker_example-b995116db87e6729)\nrunning 1 test\ntest docker_example_001 ... FAILED\n\nfailures:\n\n---- docker_example_001 stdout ----\n[ docker_example_001 ]: BUILD_PATH=/opt/sysmaster DOCKER_TEST=1 sh -x /opt/sysmaster/tests/docker_example/docker_example_001/docker_example_001.sh &amp;&gt; /opt/sysmaster/tests/docker_example/docker_example_001/docker_example_001.log\n[ docker_example_001 ]: exit status: 1   Detail Log:\n++ basename /opt/sysmaster/tests/docker_example/docker_example_001/docker_example_001.sh\n+ TEST_SCRIPT=docker_example_001.sh\n++ dirname /opt/sysmaster/tests/docker_example/docker_example_001/docker_example_001.sh\n+ TEST_SCRIPT_PATH=/opt/sysmaster/tests/docker_example/docker_example_001\n+ source /opt/sysmaster/tests/test_frame.sh\n++ TEST_PATH=/opt/sysmaster/tests\n++ source /opt/sysmaster/tests/common/lib.sh\n+++ test -f /opt/sysmaster/target/release/sysmaster\n+++ test -f /opt/sysmaster/target/debug/sysmaster\n+++ MODE=debug\n++ source /opt/sysmaster/tests/common/docker_lib.sh\n+++ OS_VER=openEuler-22.03-LTS-SP1\n++++ arch\n+++ DOCKER_IMG_URL=https://mirrors.nju.edu.cn/openeuler/openEuler-22.03-LTS-SP1/docker_img/x86_64/\n++++ arch\n+++ DOCKER_TAR=openEuler-docker.x86_64.tar\n+++ BASE_IMG=openeuler-22.03-lts-sp1\n+++ SYSMST_BASE_IMG=sysmaster_base-openeuler-22.03-lts-sp1\n++ source /opt/sysmaster/tests/common/util_lib.sh\n+++ export EXPECT_FAIL=0\n+++ EXPECT_FAIL=0\n+++ export SYSMST_LIB_PATH=/usr/lib/sysmaster/system\n+++ SYSMST_LIB_PATH=/usr/lib/sysmaster/system\n+++ export SYSMST_RUN_PATH=/run/sysmaster/system\n+++ SYSMST_RUN_PATH=/run/sysmaster/system\n+++ export SYSMST_ETC_PATH=/etc/sysmaster/system\n+++ SYSMST_ETC_PATH=/etc/sysmaster/system\n+++ export SYSMST_LOG=/opt/sysmaster.log\n+++ SYSMST_LOG=/opt/sysmaster.log\n+++ export RELIAB_SWITCH_PATH=/run/sysmaster/reliability\n+++ RELIAB_SWITCH_PATH=/run/sysmaster/reliability\n+++ export RELIAB_SWITCH=switch.debug\n+++ RELIAB_SWITCH=switch.debug\n+++ export RELIAB_CLR=clear.debug\n+++ RELIAB_CLR=clear.debug\n+++ export init_pid=\n+++ init_pid=\n+++ export sysmaster_pid=\n+++ sysmaster_pid=\n+++ export 'cond_fail_log=Starting failed .* condition test failed'\n+++ cond_fail_log='Starting failed .* condition test failed'\n+++ export 'asst_fail_log=Starting failed .* assert test failed'\n+++ asst_fail_log='Starting failed .* assert test failed'\n+++ export yum_proxy=proxy=\n+++ yum_proxy=proxy=\n++ set +e\n++ TMP_DIR=\n+ set +e\n+ runtest\n+ local ret=1\n+ log_info '===== cleanup before test ====='\n++ date '+%F %T'\n+ echo '[2023-04-13 20:19:29] [  INFO ] ===== cleanup before test ====='\n[2023-04-13 20:19:29] [  INFO ] ===== cleanup before test =====\n+ test_cleanup\n+ '[' -n '' ']'\n+ rm -rf /usr/bin/sctl /usr/lib/sysmaster\n+ '[' 1 == 1 ']'\n+ cleanup_docker\n+ docker ps -a\n+ grep -v 'CONTAINER ID'\n+ docker images\n+ grep -vEw 'IMAGE ID|openeuler-22.03-lts-sp1|sysmaster_base-openeuler-22.03-lts-sp1'\n+ return 0\n+ test_setup\n+ setenforce 0\n+ install_sysmaster\n+ test -d /opt/sysmaster/target/install\n+ return 0\n+ '[' 1 == 1 ']'\n+ setup_docker\n++ mktemp -d /tmp/docker_example_001_XXXX\n+ TMP_DIR=/tmp/docker_example_001_3Vx5\n+ which docker\n/usr/bin/docker\n+ docker images\n+ grep sysmaster_base-openeuler-22.03-lts-sp1\nsysmaster_base-openeuler-22.03-lts-sp1   latest              399ae0ff19f9        28 hours ago        461MB\n+ return 0\n+ return 0\n+ log_info '===== setup before test OK ====='\n++ date '+%F %T'\n+ echo '[2023-04-13 20:19:29] [  INFO ] ===== setup before test OK ====='\n[2023-04-13 20:19:29] [  INFO ] ===== setup before test OK =====\n++ type -t test_pre\n+ '[' '' = function ']'\n+ log_info '===== test_run begin ====='\n++ date '+%F %T'\n+ echo '[2023-04-13 20:19:29] [  INFO ] ===== test_run begin ====='\n[2023-04-13 20:19:29] [  INFO ] ===== test_run begin =====\n+ test_run\n+ local ret\n+ mkdir -p /tmp/docker_example_001_3Vx5/opt\n++ realpath /opt/sysmaster/tests/docker_example/docker_example_001/check.sh\n+ cp -arf /opt/sysmaster/tests/docker_example/docker_example_001/check.sh /tmp/docker_example_001_3Vx5/opt\n+ chmod -R 777 /tmp/docker_example_001_3Vx5\n+ docker run --privileged --rm -v /tmp/docker_example_001_3Vx5/opt:/opt sysmaster_base-openeuler-22.03-lts-sp1 sh -c 'sh -x /opt/check.sh &amp;&gt; /opt/check.log'\n+ ret=1\n+ cat /tmp/docker_example_001_3Vx5/opt/check.log\n+ exit 1\n+ return 1\n+ log_info '===== test_run FAILED ====='\n++ date '+%F %T'\n+ echo '[2023-04-13 20:19:29] [  INFO ] ===== test_run FAILED ====='\n[2023-04-13 20:19:29] [  INFO ] ===== test_run FAILED =====\n+ log_info '===== cleanup after test ====='\n++ date '+%F %T'\n+ echo '[2023-04-13 20:19:29] [  INFO ] ===== cleanup after test ====='\n[2023-04-13 20:19:29] [  INFO ] ===== cleanup after test =====\n+ test_cleanup\n+ '[' -n /tmp/docker_example_001_3Vx5 ']'\n+ rm -rf /tmp/docker_example_001_3Vx5\n+ rm -rf /usr/bin/sctl /usr/lib/sysmaster\n+ '[' 1 == 1 ']'\n+ cleanup_docker\n+ docker ps -a\n+ grep -v 'CONTAINER ID'\n+ docker images\n+ grep -vEw 'IMAGE ID|openeuler-22.03-lts-sp1|sysmaster_base-openeuler-22.03-lts-sp1'\n+ return 0\n+ exit 1\nthread 'docker_example_001' panicked at 'assertion failed: status.success()', tests/common/mod.rs:40:5\nnote: run with `RUST_BACKTRACE=1` environment variable to display a backtrace\n\nfailures:\n    docker_example_001\n\ntest result: FAILED. 0 passed; 1 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.54s\n\nerror: test failed, to rerun pass `--test docker_example`\n</code></pre> <p><code>---- docker_example_001 stdout ----</code>\u4e0b\u7684\u4fe1\u606f\u5c31\u662f<code>docker_example_001</code>\u7684\u8be6\u7ec6\u6267\u884c\u65e5\u5fd7\uff0c\u5b83\u660e\u786e\u544a\u8bc9\u6211\u4eec\u5177\u4f53\u5931\u8d25\u7684\u4f4d\u7f6e\u3002\u5982\u679c\u4f60\u60f3\u67e5\u770b\u6210\u529f\u7528\u4f8b\u7684\u8be6\u7ec6\u65e5\u5fd7\u4fe1\u606f\uff0c\u53ef\u4ee5\u5c1d\u8bd5<code>--show-output</code>\u9009\u9879\uff1a</p> <pre><code>        --show-output   Show captured stdout of successful tests\n</code></pre> <p>\u5728\u8c03\u8bd5\u5b9a\u4f4d\u7684\u8fc7\u7a0b\u4e2d\uff0ccargo\u76f4\u63a5\u6253\u5370\u5728\u5c4f\u5e55\u4e0a\u7684\u4fe1\u606f\u5f88\u5bb9\u6613\u4e22\u5931\u3002\u6211\u4eec\u53ef\u4ee5\u6839\u636e\u63d0\u793a\u627e\u5230\u8be6\u7ec6\u65e5\u5fd7\u7684\u5f52\u6863\u4f4d\u7f6e\uff0c\u5373\u7528\u4f8b\u5165\u53e3\u811a\u672c\u7684\u540c\u7ea7\u76ee\u5f55\u3002</p> <p>\u6ce8\u610f\uff01\u6bcf\u6b21\u6267\u884c\u7528\u4f8b\u90fd\u4f1a\u8986\u76d6\u4e0a\u4e00\u6b21\u7684\u6267\u884c\u65e5\u5fd7\u3002</p> <pre><code>[ docker_example_001 ]: BUILD_PATH=/opt/sysmaster DOCKER_TEST=1 sh -x /opt/sysmaster/tests/docker_example/docker_example_001/docker_example_001.sh &amp;&gt; /opt/sysmaster/tests/docker_example/docker_example_001/docker_example_001.log\n</code></pre> <p>\u6839\u636e\u793a\u4f8b\u4e2d\u7684\u5931\u8d25\u65e5\u5fd7\uff0c\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\uff0c\u6d4b\u8bd5\u7528\u4f8b\u5b9e\u9645\u4e0a\u662fshell\u811a\u672c\u7684rust\u5c01\u88c5\u3002\u7528\u4f8b\u901a\u8fc7<code>#[test]</code>\u6807\u8bb0\u5728rs\u6587\u4ef6\u4e2d\u6ce8\u518c\u51fd\u6570\u3002cargo\u901a\u8fc7\u8fd9\u4e9b\u51fd\u6570\u6267\u884c\u5bf9\u5e94\u7684\u6d4b\u8bd5\u5165\u53e3\u811a\u672c\u3002\u800c\u5165\u53e3\u811a\u672c\u4e5f\u53ea\u662f\u4e00\u5c42\u5c01\u88c5\uff0c\u5b9e\u9645\u7684\u6d4b\u8bd5\u4e3b\u4f53\u662f\u53e6\u4e00\u4e2a\u68c0\u67e5\u811a\u672c\u3002</p> <pre><code>docker_example.rs  ------&gt;  \u6d4b\u8bd5\u5957\u6587\u4ef6\n      |\n      |\n   fn docker_example_001  ------&gt;  #[test]\u6ce8\u518c\u51fd\u6570\uff0c\u5373\u6ce8\u518c\u7528\u4f8b\n            |\n            |\n      sh -x docker_example_001.sh  ------&gt;  \u6d4b\u8bd5\u5165\u53e3\u811a\u672c\uff0c\u4e0e\u7528\u4f8b\u540c\u540d\uff0c\u5bf9\u5e94\u65e5\u5fd7\uff1adocker_example_001.log\n                  |\n                  |\n            sh -x check.sh  ------&gt;  \u6d4b\u8bd5\u4e3b\u4f53\u68c0\u67e5\u811a\u672c\n</code></pre> <p>\u4f60\u53ef\u80fd\u4f1a\u7591\u95ee\uff0c\u4e3a\u4ec0\u4e48\u4e3b\u4f53\u68c0\u67e5\u811a\u672c\u5916\u8fd8\u8981\u518d\u5c01\u88c5\u4e00\u5c42\u5165\u53e3\u811a\u672c\uff1f\u8fd9\u662f\u56e0\u4e3asysmaster\u8981\u652f\u6301\u5bb9\u5668\u3001\u865a\u62df\u673a\u7b49\u573a\u666f\u3002\u4e0d\u540c\u573a\u666f\u7684\u73af\u5883\u51c6\u5907\u5de5\u4f5c\u4e0d\u540c\uff0c\u62c9\u8d77\u68c0\u67e5\u811a\u672c\u7684\u65b9\u5f0f\u4e5f\u4e0d\u540c\uff0c\u4f46\u5b9e\u9645\u68c0\u67e5\u7684\u5185\u5bb9\u5374\u51e0\u4e4e\u76f8\u540c\u3002\u56e0\u6b64\uff0c\u8bbe\u7f6e\u5165\u53e3\u811a\u672c\u7528\u4e8e\u5dee\u5f02\u5316\u73af\u5883\u51c6\u5907\uff0c\u68c0\u67e5\u811a\u672c\u7528\u4e8e\u6267\u884c\u5171\u6027\u7684\u6d4b\u8bd5\u6b65\u9aa4\u3002</p>"},{"location":"design/01-integration_test/#_8","title":"\u7528\u4f8b\u7f16\u5199","text":"<p>\u4e86\u89e3\u5982\u4f55\u6267\u884c\u7528\u4f8b\u540e \uff0c\u6211\u4eec\u6765\u5c1d\u8bd5\u81ea\u5df1\u7f16\u5199\u4e00\u4e2a\u96c6\u6210\u6d4b\u8bd5\u7528\u4f8b\u3002\u9996\u5148\uff0c\u56de\u987e\u4e00\u4e0b\u4e0a\u6587\u63d0\u5230\u7684\u8981\u70b9\uff1a</p> <ul> <li>rs\u6587\u4ef6\u5373\u6d4b\u8bd5\u5957\u6587\u4ef6\uff0c\u7528\u4e8e\u6ce8\u518c\u6d4b\u8bd5\u51fd\u6570\uff0c\u4e00\u4e2a\u6d4b\u8bd5\u51fd\u6570\u5c31\u662f\u4e00\u4e2a\u6d4b\u8bd5\u7528\u4f8b\u3002</li> <li>\u6d4b\u8bd5\u5957\u547d\u540d\u9075\u5faa\u201c\u573a\u666f_\u6a21\u5757\u201d\u98ce\u683c\uff0c\u6d4b\u8bd5\u7528\u4f8b\u4ee5\u6d4b\u8bd5\u5957\u540d\u79f0\u4e3a\u524d\u7f00\u3002</li> <li>\u6d4b\u8bd5\u5165\u53e3\u811a\u672c\u7528\u4e8e\u73af\u5883\u51c6\u5907\uff0c\u6d4b\u8bd5\u68c0\u67e5\u811a\u672c\u624d\u662f\u771f\u6b63\u7684\u4e3b\u4f53\uff0c\u5404\u811a\u672c\u9700\u4e25\u683c\u5206\u7ea7\u5f52\u6863\u3002</li> </ul> <p>\u7262\u8bb0\u4ee5\u4e0a\u4e09\u70b9\uff0c\u8ba9\u6211\u4eec\u4ecers\u6587\u4ef6\u5f00\u59cb\u5199\u7528\u4f8b\u5427\u3002</p>"},{"location":"design/01-integration_test/#rs","title":"rs\u6587\u4ef6","text":"<p>\u4ee5\u5bb9\u5668\u573a\u666f\u7684<code>docker_example.rs</code>\u4e3a\u4f8b\uff0c\u9996\u5148<code>mod common</code>\u5bfc\u5165<code>common::run_script</code>\u51fd\u6570\u3002<code>fn docker_example_001</code>\u5c31\u662f\u6d4b\u8bd5\u51fd\u6570\uff0c\u4e5f\u5c31\u662fcargo\u8bc6\u522b\u5230\u7684\u771f\u6b63\u7528\u4f8b\u3002</p> <pre><code>mod common;\n#[test]\n#[ignore]\nfn docker_example_001() {\ncommon::run_script(\"docker_example\", \"docker_example_001\", \"1\");\n}\n</code></pre> <p><code>docker_example_001</code>\u51fd\u6570\u4e2d\u53ea\u6709\u4e00\u884c\u8c03\u7528\uff0c\u5373<code>run_script</code>\uff0c\u8be5\u51fd\u6570\u5728<code>common/mod.rs</code>\u4e2d\u5b9a\u4e49\u3002<code>run_script</code>\u4e00\u5171\u67093\u4e2a\u5b57\u7b26\u4e32\u7c7b\u578b\u5165\u53c2\uff0c\u5206\u522b\u662f\uff1a</p> <ul> <li>\u6d4b\u8bd5\u5957\u540d\u79f0suit</li> <li>\u6d4b\u8bd5\u7528\u4f8b\u540d\u79f0name</li> <li>DOCKER_TEST\u7684\u503c</li> </ul> <p>\u524d\u4e24\u4e2a\u5165\u53c2\u7528\u4e8e\u62fc\u63a5\u6d4b\u8bd5\u5165\u53e3\u811a\u672c\u7684\u8def\u5f84\uff0c\u5373<code>{suit}/{name}/{name}.sh</code>\u3002\u7b2c\u4e09\u4e2a\u53c2\u6570\u7b49\u4e8e1\u8868\u793a\u662f\u5bb9\u5668\u573a\u666f\uff0c\u6d4b\u8bd5\u5165\u53e3\u811a\u672c\u4f1a\u6839\u636e\u8fd9\u4e2a\u53d8\u91cf\u7684\u503c\u90e8\u7f72\u73af\u5883\u3002</p>"},{"location":"design/01-integration_test/#_9","title":"\u6d4b\u8bd5\u5165\u53e3\u811a\u672c","text":"<p>\u4ee5<code>docker_example/docker_example_001/docker_example_001.sh</code>\u4e3a\u4f8b\uff0c\u5165\u53e3\u811a\u672c\u9996\u5148\u9700\u8981\u5b9a\u4e492\u4e2a\u5168\u5c40\u53d8\u91cf<code>TEST_SCRIPT</code>\u3001<code>TEST_SCRIPT_PATH</code>\uff0c\u8fd9\u4e24\u8005\u662f\u5fc5\u987b\u7684\uff0c\u6bcf\u4e2a\u811a\u672c\u7684\u5f00\u5934\u90fd\u5fc5\u987b\u5b9a\u4e49\uff0c\u7528\u4e8e\u83b7\u53d6source\u8def\u5f84\uff0c\u53ef\u4ee5\u76f4\u63a5\u62f7\u8d1d\u6837\u4f8b\u4e2d\u7684\u5b9a\u4e49\u3002</p> <pre><code>TEST_SCRIPT=\"$(basename \"$0\")\"\nTEST_SCRIPT_PATH=\"$(dirname \"$0\")\"\n</code></pre> <p>\u63a5\u7740\u9700\u8981<code>source test_frame.sh</code>\uff0c\u8be5\u6587\u4ef6\u5b9a\u4e49\u4e86\u6d4b\u8bd5\u6846\u67b6\u7684\u51e0\u4e2a\u5173\u952e\u51fd\u6570\uff0c[\u6846\u67b6\u51fd\u6570]\u5c0f\u8282\u518d\u5c55\u5f00\u4ecb\u7ecd\u3002\u7136\u540e\uff0c\u5c31\u9700\u8981\u6d4b\u8bd5\u4eba\u5458\u6839\u636e\u6d4b\u8bd5\u573a\u666f\u81ea\u884c\u7f16\u5199<code>test_run</code>\u51fd\u6570\u3002</p> <p><code>docker_example_001</code>\u7528\u4f8b\u662f\u5bb9\u5668\u573a\u666f\u7528\u4f8b\uff0c\u56e0\u6b64<code>test_run</code>\u51fd\u6570\u9700\u8981\u8fdb\u884c\u4e00\u4e9b\u73af\u5883\u51c6\u5907\uff0c\u4f8b\u5982\uff1a\u521b\u5efa\u4e34\u65f6\u76ee\u5f55\uff0c\u5c06\u68c0\u67e5\u811a\u672c<code>check.sh</code>\u62f7\u8d1d\u81f3\u4e34\u65f6\u76ee\u5f55\u3002\u7136\u540e\uff0c\u901a\u8fc7<code>docker run</code>\u547d\u4ee4\u6302\u8f7d\u4e34\u65f6\u76ee\u5f55\u5e76\u6267\u884c<code>check.sh</code>\u3002\u6700\u540e\uff0c\u8bb0\u5f55\u8fd4\u56de\u503c\u3001\u6253\u5370\u68c0\u67e5\u811a\u672c\u7684\u6267\u884c\u65e5\u5fd7\u3002\u8fd9\u4e00\u7cfb\u5217\u64cd\u4f5c\u662f\u5728\u5bb9\u5668\u573a\u666f\u4e0b\u662f\u901a\u7528\u7684\uff0c\u53ef\u4ee5\u76f4\u63a5\u79fb\u690d\u3002</p> <pre><code>#!/bin/bash\n# Description: test for example\nTEST_SCRIPT=\"$(basename \"$0\")\"\nTEST_SCRIPT_PATH=\"$(dirname \"$0\")\"\nsource \"${BUILD_PATH}\"/tests/test_frame.sh\nset +e\n\nfunction test_run() {\nlocal ret\n    mkdir -p \"${TMP_DIR}\"/opt\n    cp -arf \"$(realpath \"${TEST_SCRIPT_PATH}\"/check.sh)\" \"${TMP_DIR}\"/opt\n    chmod -R 777 \"${TMP_DIR}\"\ndocker run --privileged --rm -v \"${TMP_DIR}\"/opt:/opt \"${SYSMST_BASE_IMG}\" sh -c \"sh -x /opt/check.sh &amp;&gt; /opt/check.log\"\nret=$?\ncat \"${TMP_DIR}\"/opt/check.log\n    return \"${ret}\"\n}\nruntest\n</code></pre> <p>\u5982\u679c\u662f\u865a\u62df\u673a\u573a\u666f\u7684\u7528\u4f8b\u5462\uff1f\u53ef\u4ee5\u53c2\u8003<code>docker_config_test_service_001</code>\u7528\u4f8b\u7684\u5165\u53e3\u811a\u672c\uff1a</p> <pre><code>[root@openEuler tests]# cat docker_config_test/docker_config_test_service_001/docker_config_test_service_001.sh\n#!/bin/bash\n# Description: test for Description/Documentation/RemainAfterExit/DefaultDependencies\nTEST_SCRIPT=\"$(basename \"$0\")\"\nTEST_SCRIPT_PATH=\"$(dirname \"$0\")\"\nsource \"${BUILD_PATH}\"/tests/test_frame.sh\nset +e\n\nfunction test_pre() {\npushd \"${TEST_SCRIPT_PATH}\"\nrm -rf tmp_units\n    mkdir tmp_units\n    cp -arf \"${TEST_PATH}\"/test_units/{shutdown.target,sysinit.target} tmp_units\n    cp -arf \"${TEST_PATH}\"/test_units/tests/base.service tmp_units\n    popd\n}\nfunction test_run() {\nlocal ret\n\npushd \"${TEST_SCRIPT_PATH}\"\nif [ \"${DOCKER_TEST}\" == '1' ]; then\nmkdir -p \"${TMP_DIR}\"/opt\n        cp -arf \"$(realpath check.sh)\" \"${TMP_DIR}\"/opt\n        cp -arf \"${TEST_PATH}\"/common/util_lib.sh tmp_units \"${TMP_DIR}\"/opt\n        chmod -R 777 \"${TMP_DIR}\"\ndocker run --privileged --rm -v \"${TMP_DIR}\"/opt:/opt \"${SYSMST_BASE_IMG}\" sh -c \"sh -x /opt/check.sh &amp;&gt; /opt/check.log\"\nret=$?\ncat \"${TMP_DIR}\"/opt/check.log\n        cat \"${TMP_DIR}\"/opt/sysmaster.log\n    else\ncp -arf \"${TEST_PATH}\"/common/util_lib.sh ./\n        sh -x check.sh &amp;&gt; check.log\n        ret=$?\ncat check.log\n        cat sysmaster.log\n    fi\nrm -rf tmp_units check.log\n    popd\nreturn \"${ret}\"\n}\nruntest\n</code></pre> <p>\u4e0a\u8ff0\u5165\u53e3\u811a\u672c\u7684<code>test_run</code>\u542b\u6709\u4e00\u4e2aif\u5206\u652f\uff0c\u5206\u652f\u6839\u636e<code>DOCKER_TEST</code>\u53d8\u91cf\u7684\u503c\u5224\u65ad\u573a\u666f\uff0c\u5e76\u6839\u636e\u4e0d\u540c\u7684\u573a\u666f\u505a\u4e00\u4e9b\u5dee\u5f02\u6027\u7684\u73af\u5883\u51c6\u5907\uff0c\u518d\u4ee5\u4e0d\u540c\u7684\u65b9\u5f0f\u62c9\u8d77<code>check.sh</code>\u3002\u800c\u4e00\u4e9b\u5171\u6027\u7684\u73af\u5883\u51c6\u5907\u5de5\u4f5c\uff0c\u53ef\u4ee5\u5728<code>test_pre</code>\u4e2d\u6267\u884c\uff0c\u4f8b\u5982\u62f7\u8d1d\u6d4b\u8bd5\u6240\u9700\u7684\u5355\u5143\u6587\u4ef6\u7b49\u3002</p> <p>\u53e6\u5916\uff0c\u6709\u5f88\u591a\u7528\u4f8b\u662f\u591a\u573a\u666f\u901a\u7528\u7684\uff0c\u8fd9\u4e9b\u7528\u4f8b\u7684\u5165\u53e3\u811a\u672c\u5b9e\u9645\u4e0a\u662f\u4e00\u4e2a\u8f6f\u94fe\u63a5\uff0c\u4f8b\u5982<code>docker_config_test_service_001.sh</code>\uff1a</p> <pre><code>[root@openEuler tests]# ll docker_config_test/docker_config_test_service_001/docker_config_test_service_001.sh\nlrwxrwxrwx. 1 root root 61 Apr 11 17:28 docker_config_test/docker_config_test_service_001/docker_config_test_service_001.sh -&gt; ../../config_test/unit_config_test/service_001/service_001.sh\n</code></pre> <p>\u4e3b\u4f53\u68c0\u67e5\u811a\u672c\u540c\u6837\u4e5f\u53ef\u4ee5\u8bbe\u7f6e\u8f6f\u94fe\u63a5\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@openEuler tests]# ls -l docker_config_test/docker_config_test_service_001/check.sh\nlrwxrwxrwx. 1 root root 55 Apr 14 14:26 docker_config_test/docker_config_test_service_001/check.sh -&gt; ../../config_test/unit_config_test/service_001/check.sh\n</code></pre> <p>\u5728\u865a\u62df\u673a\u573a\u666f\u6d4b\u8bd5\u76f8\u5e94\u7684\u914d\u7f6e\u65f6\uff0c\u53ea\u9700\u5728<code>vm_config_test_service_001</code>\u76ee\u5f55\u4e0b\u65b0\u5efa<code>vm_config_test_service_001.sh</code>\u3001<code>check.sh</code>\u8f6f\u94fe\u63a5\uff0c\u5206\u522b\u6307\u5411<code>service_001</code>\u76ee\u5f55\u4e0b\u7684<code>service_001.sh</code>\u3001<code>check.sh</code>\u6587\u4ef6\u3002\u5e76\u5728\u6ce8\u518c\u5bf9\u5e94\u7684\u6d4b\u8bd5\u51fd\u6570\u65f6\uff0c\u5c06\u7b2c3\u4e2a\u5165\u53c2\u8bbe\u7f6e\u4e3a0\uff0c\u7531\u6b64\u4fbf\u53ef\u5c3d\u53ef\u80fd\u5730\u51cf\u5c11\u5197\u4f59\u4ee3\u7801\uff1a</p> <pre><code>#[test]\n#[ignore]\nfn vm_config_test_service_001() {\ncommon::run_script(\"vm_config_test\", \"vm_config_test_service_001\", \"0\");\n}\n</code></pre>"},{"location":"design/01-integration_test/#_10","title":"\u6846\u67b6\u51fd\u6570","text":"<p>\u63a5\u4e0b\u6765\uff0c\u5c31\u8ba9\u6211\u4eec\u4e86\u89e3\u4e00\u4e0b<code>test_frame.sh</code>\u662f\u5982\u4f55\u5b9a\u4e49<code>runtest</code>\u51fd\u6570\u7684\u3002<code>test_frame.sh</code>\u4f4d\u4e8e<code>tests</code>\u76ee\u5f55\u4e0b\u3002<code>runtest</code>\u51fd\u6570\u5176\u5b9e\u975e\u5e38\u7b80\u5355\uff0c\u4e00\u5171\u5206\u56db\u4e2a\u9636\u6bb5\uff1a</p> <ul> <li>test_cleanup\uff1a\u6d4b\u8bd5\u524d\u73af\u5883\u6e05\u7406\uff0c\u6e05\u7406\u5931\u8d25\u5219\u7528\u4f8b\u5931\u8d25\u9000\u51fa\u3002</li> <li>test_setup\uff1a\u73af\u5883\u90e8\u7f72\uff0c\u5305\u62ec\u6784\u5efa\u57fa\u7840\u5bb9\u5668\u955c\u50cf\u7b49\uff1b\u90e8\u7f72\u5931\u8d25\u5219\u7528\u4f8b\u5931\u8d25\u9000\u51fa\u3002</li> <li>test_run\uff1a\u9700\u8981\u6d4b\u8bd5\u4eba\u5458\u5728\u5165\u53e3\u811a\u672c\u4e2d\u81ea\u884c\u5b9a\u4e49\uff1b\u6267\u884c\u5931\u8d25\u5219\u7528\u4f8b\u5931\u8d25\uff0c\u4f46\u4e0d\u4f1a\u7acb\u5373\u9000\u51fa\u3002</li> <li>test_cleanup\uff1a\u6d4b\u8bd5\u540e\u7684\u73af\u5883\u6e05\u7406\uff0c\u65e0\u8bbatest_run\u6210\u529f\u4e0e\u5426\u90fd\u4f1a\u6267\u884c\uff0c\u6e05\u7406\u5931\u8d25\u4e5f\u4e0d\u5f71\u54cd\u7528\u4f8b\u7ed3\u679c\u3002</li> </ul> <p>\u82e5\u73af\u5883\u4e2d\u6ca1\u6709\u6267\u884c\u8fc7\u5bb9\u5668\u573a\u666f\u7684\u7528\u4f8b\uff0c<code>test_setup</code>\u4f1a\u4eceopenEuler\u5b98\u7f51\u4e0b\u8f7d\u6807\u51c6\u5bb9\u5668\u955c\u50cf\u5e76\u5bfc\u5165\uff0c\u518d\u5c06sysmaster\u7f16\u8bd1\u51fa\u7684\u4e8c\u8fdb\u5236\u548clib\u5e93\u6587\u4ef6\u62f7\u8d1d\u81f3\u6807\u51c6\u5bb9\u5668\u955c\u50cf\uff0c\u7531\u6b64\u6784\u5efa\u57fa\u7840\u955c\u50cf\uff0c\u7528\u4f5c\u540e\u7eed\u6d4b\u8bd5\u3002\u82e5\u73af\u5883\u4e2d\u5df2\u7ecf\u6267\u884c\u8fc7\u5bb9\u5668\u573a\u666f\u7684\u7528\u4f8b\uff0c<code>test_setup</code>\u68c0\u6d4b\u5230\u53ef\u7528\u7684\u57fa\u7840\u955c\u50cf\uff0c\u5c31\u4e0d\u4f1a\u518d\u91cd\u590d\u6784\u5efa\u3002</p> <p>\u6ce8\u610f\uff01\u66f4\u65b0\u4ee3\u7801\u540e\uff0c\u5fc5\u987b\u624b\u52a8\u5220\u9664\u7f13\u5b58\u7684\u57fa\u7840\u955c\u50cf\uff0c\u786e\u4fdd\u4e8c\u8fdb\u5236\u66f4\u65b0\u3002</p> <p><code>test_setup</code>\u8fd8\u4f1a\u5728<code>/tmp</code>\u76ee\u5f55\u4e0b\u521b\u5efa\u4e00\u4e2a\u4ee5\u7528\u4f8b\u540d\u547d\u540d\u7684\u4e34\u65f6\u76ee\u5f55\uff0c\u7528\u4e8e\u5b58\u653e\u4e00\u4e9b\u4e34\u65f6\u6587\u4ef6\u3002</p> <p><code>test_cleanup</code>\u4f1a\u5728\u6d4b\u8bd5\u524d\u540e\u6e05\u7406\u73af\u5883\u4e2d\u7684\u6b8b\u7559\u5bb9\u5668\u548c\u955c\u50cf\uff0c\u4f46\u4e0d\u4f1a\u5220\u9664\u5f52\u6863\u7684\u57fa\u7840\u955c\u50cf\u548c\u6807\u51c6\u955c\u50cf\u3002\u503c\u5f97\u6ce8\u610f\u7684\u662f\uff0c\u6d4b\u8bd5\u540e\u7684<code>test_cleanup</code>\u4f1a\u5220\u9664<code>test_setup</code>\u521b\u5efa\u7684<code>/tmp</code>\u4e34\u65f6\u76ee\u5f55\uff0c\u6d4b\u8bd5\u524d\u7684<code>test_cleanup</code>\u4e0d\u4f1a\u3002</p>"},{"location":"design/01-integration_test/#_11","title":"\u68c0\u67e5\u811a\u672c","text":"<p>\u68c0\u67e5\u811a\u672c\u662f\u6d4b\u8bd5\u7528\u4f8b\u7684\u4e3b\u4f53\uff0c\u672c\u9879\u76ee\u4e2d\u5927\u90e8\u5206\u68c0\u67e5\u811a\u672c\u90fd\u4ee5<code>check.sh</code>\u547d\u540d\u3002\u5176\u4e2d\u7684\u53ef\u4ee5\u8bbe\u7f6e\u591a\u4e2a\u68c0\u67e5\u51fd\u6570\uff0c\u4ee5<code>docker_config_test_service_001</code>\u4e3a\u4f8b\uff1a</p> <pre><code>[root@openEuler tests]# cat docker_config_test/docker_config_test_service_001/check.sh\n#!/bin/bash\nwork_dir=\"$(dirname \"$0\")\"\nsource \"${work_dir}\"/util_lib.sh\n\nset +e\n\n# usage: test Description/Documentation/RemainAfterExit\nfunction test01() {\nlog_info \"===== test01 =====\"\ncp -arf \"${work_dir}\"/tmp_units/base.service ${SYSMST_LIB_PATH} || return 1\n# RemainAfterExit=false\nsed -i 's/^Description=.*/Description=\"this is a test\"/' ${SYSMST_LIB_PATH}/base.service\n    sed -i '/Description/ a Documentation=\"this is doc\"' ${SYSMST_LIB_PATH}/base.service\n    sed -i '/ExecStart/ a RemainAfterExit=false' ${SYSMST_LIB_PATH}/base.service\n    sed -i 's/sleep 100/sleep 2/' ${SYSMST_LIB_PATH}/base.service\n    run_sysmaster || return 1\nsctl restart base\n    check_status base active || return 1\ncheck_status base inactive || return 1\n# check Description/Documentation\nsctl status base | grep \"base.service - this is a test\" &amp;&amp; sctl status base | grep \"Docs: this is doc\"\nexpect_eq $? 0 || sctl status base\n    # clean\nkill_sysmaster\n\n# RemainAfterExit=true\nsed -i '/RemainAfterExit/ s/false/true/' ${SYSMST_LIB_PATH}/base.service\n    run_sysmaster || return 1\nsctl restart base\n    check_status base active || return 1\nsctl status base | grep active | grep 'running'\nexpect_eq $? 0 || sctl status base\n    main_pid=\"$(get_pids base)\"\nsleep 2\ncheck_status base active || return 1\nsctl status base | grep active | grep 'exited'\nexpect_eq $? 0 || sctl status base\n    ps -elf | grep -v grep | awk '{print $4}' | grep -w \"${main_pid}\"\nexpect_eq $? 1 || ps -elf\n\nsctl stop base\n    check_status base inactive || return 1\n# clean\nkill_sysmaster\n}\n# usage: test RemainAfterExit with oneshot service\nfunction test02() {\nlog_info \"===== test02 =====\"\n...\n}\n# usage: test DefaultDependencies\nfunction test03() {\nlocal key_log='add default dependencies for target.*'\nlog_info \"===== test03 =====\"\n...\n}\ntest01 || exit 1\ntest02 || exit 1\ntest03 || exit 1\nexit \"${EXPECT_FAIL}\"\n</code></pre> <p>\u4e0a\u8ff0\u68c0\u67e5\u811a\u672c\u4e2d\u4e00\u5171\u67093\u4e2a\u68c0\u67e5\u51fd\u6570\uff1a<code>test01</code>\u3001<code>test02</code>\u3001<code>test03</code>\u3002\u6bcf\u4e2a\u68c0\u67e5\u51fd\u6570\u5f02\u5e38\u8fd4\u56de\u90fd\u4f1a\u5bfc\u81f4\u811a\u672c\u76f4\u63a5\u5931\u8d25\u9000\u51fa\uff0c\u4efb\u610f\u4e00\u4e2a\u65ad\u8a00\u5931\u8d25\u4e5f\u4f1a\u5bfc\u81f4\u811a\u672c\u6700\u7ec8\u975e0\u9000\u51fa\uff1a</p> <pre><code>test01 || exit 1\ntest02 || exit 1\ntest03 || exit 1\nexit \"${EXPECT_FAIL}\"\n</code></pre> <p>\u4ee5<code>test01</code>\u4e3a\u4f8b\uff0c\u9996\u5148\u5c06\u4e34\u65f6\u76ee\u5f55\u4e0b\u7684\u5355\u5143\u6587\u4ef6<code>base.service</code>\u62f7\u8d1d\u81f3sysmaster\u5bf9\u5e94\u76ee\u5f55\uff0c\u5e76\u4fee\u6539\u5176\u4e2d\u7684\u914d\u7f6e\u3002\u7136\u540e\u62c9\u8d77sysmaster\uff0c\u901a\u8fc7<code>sctl</code>\u7b49\u547d\u4ee4\u8fdb\u884c\u6d4b\u8bd5\u3002<code>expect_eq</code>\u7b49\u65ad\u8a00\u5931\u8d25\u4e0d\u4f1a\u76f4\u63a5\u5bfc\u81f4\u51fd\u6570\u9000\u51fa\uff0c\u800c\u662f\u4f1a\u5c06<code>EXPECT_FAIL</code>\u53d8\u91cf\u7f6e1\uff0c\u68c0\u67e5\u811a\u672c\u6700\u540e\u4f1a\u6839\u636e\u8be5\u53d8\u91cf\u7684\u503c\u5224\u65ad\u7528\u4f8b\u6210\u529f\u4e0e\u5426\u3002</p> <p><code>check_status</code>\u3001<code>log_info</code>\u7b49\u516c\u5171\u51fd\u6570\uff0c\u4ee5\u53ca<code>expect_xxx</code>\u7cfb\u5217\u65ad\u8a00\u51fd\u6570\uff0c\u90fd\u662f\u5728<code>common/util_lib.sh</code>\u4e2d\u5b9a\u4e49\u7684\u3002\u7f16\u5199\u6d4b\u8bd5\u7528\u4f8b\u524d\u53ef\u4ee5\u5148\u719f\u6089\u4e00\u4e0b\u73b0\u6709\u7684\u516c\u5171\u51fd\u6570\u5e93\u3002</p> <p>\u4ee5\u4e0a\u91cd\u70b9\u4ecb\u7ecd\u4e86\u5bb9\u5668\u573a\u666f\u7684\u6d4b\u8bd5\u6846\u67b6\u548c\u7528\u4f8b\u7f16\u5199\uff0c\u968f\u7740\u6d4b\u8bd5\u573a\u666f\u7684\u4e30\u5bcc\uff0c\u540e\u7eed\u4f1a\u8ddf\u8fdb\u8865\u5145\u3002</p>"},{"location":"design/01-integration_test/#faq","title":"FAQ","text":""},{"location":"design/01-integration_test/#_12","title":"\u53c2\u8003\u8d44\u6599","text":"<ol> <li>Rust\u7a0b\u5e8f\u8bbe\u8ba1\u8bed\u8a00 \u7b80\u4f53\u4e2d\u6587\u7248 \u2014\u2014 \u7f16\u5199\u81ea\u52a8\u5316\u6d4b\u8bd5</li> <li>Rust\u8bed\u8a00\u5723\u7ecf \u2014\u2014 \u81ea\u52a8\u5316\u6d4b\u8bd5</li> </ol>"},{"location":"design/Cargo-fuzz/","title":"Cargo-fuzz \u4ecb\u7ecd","text":""},{"location":"design/Cargo-fuzz/#fuzz","title":"\u4ec0\u4e48\u662f Fuzz","text":"<p>Fuzz \uff08\u6a21\u7cca\u6d4b\u8bd5\uff09\u662f\u4e00\u79cd\u8f6f\u4ef6\u6d4b\u8bd5\u6280\u672f\u3002\u5176\u6838\u5fc3\u601d\u60f3\u662f\u5c06\u81ea\u52a8\u6216\u534a\u81ea\u52a8\u751f\u6210\u7684\u968f\u673a\u6570\u636e\u8f93\u5165\u5230\u4e00\u4e2a\u7a0b\u5e8f\u4e2d\uff0c\u5e76\u76d1\u89c6\u7a0b\u5e8f\u5f02\u5e38\uff0c\u5982\u5d29\u6e83\uff0c\u65ad\u8a00\uff08assertion\uff09\u5931\u8d25\uff0c\u4ee5\u53d1\u73b0\u53ef\u80fd\u7684\u7a0b\u5e8f\u9519\u8bef\uff0c\u6bd4\u5982\u5185\u5b58\u6cc4\u6f0f\u3002\u6a21\u7cca\u6d4b\u8bd5\u5e38\u5e38\u7528\u4e8e\u68c0\u6d4b\u8f6f\u4ef6\u6216\u8ba1\u7b97\u673a\u7cfb\u7edf\u7684\u5b89\u5168\u6f0f\u6d1e\u3002</p>"},{"location":"design/Cargo-fuzz/#cargo-fuzz_1","title":"Cargo-fuzz \u7b80\u4ecb","text":"<p>Cargo-fuzz \u662f\u7528\u4e8e\u6a21\u7cca\u6d4b\u8bd5 Rust \u4ee3\u7801\u7684\u63a8\u8350\u5de5\u5177\u3002</p> <p>Cargo-fuzz \u672c\u8eab\u4e0d\u662f fuzzer\uff0c\u800c\u662f\u8c03\u7528 fuzzer \u7684\u5de5\u5177\u3002\u76ee\u524d\uff0c\u5b83\u552f\u4e00\u652f\u6301\u7684 fuzzer \u662f libFuzzer\uff08\u4f7f\u7528 libfuzzer-sys crate), \u4f46\u5b83\u53ef\u4ee5\u6269\u5c55\u5230\u672a\u6765\u652f\u6301\u5176\u4ed6 fuzzer\u3002libFuzzer \u9700\u8981 LLVM sanitizer \u7a0b\u5e8f\u652f\u6301\uff0c\u56e0\u6b64\u76ee\u524d\u8fd9\u53ea\u9002\u7528\u4e8e x86-64 Linux\u3001x86-64 macOS \u548c Apple-Silicon (aarch64) macOS\u3002</p>"},{"location":"design/Cargo-fuzz/#cargo-fuzz_2","title":"Cargo-fuzz \u5b89\u88c5","text":"<p>\u56e0\u4e3a\u6a21\u7cca\u6d4b\u8bd5\u8981\u4f7f\u7528 <code>-Z</code> \u7f16\u8bd1\u5668\u6807\u5fd7\u6765\u63d0\u4f9b\u5730\u5740 sanitization\uff0c\u56e0\u6b64\u9700\u8981\u5b89\u88c5 nightly \u7f16\u8bd1\u5668\u3002</p> <p>\u5b89\u88c5\u5e76\u8bbe\u7f6e\u4f7f\u7528 nightly \u7f16\u8bd1\u5668</p> <pre><code>rustup override set nightly\n</code></pre> <p>\u5b89\u88c5 cargo-fuzz</p> <pre><code>cargo install cargo-fuzz\n</code></pre>"},{"location":"design/Cargo-fuzz/#cargo-fuzz_3","title":"Cargo-fuzz \u4f7f\u7528","text":"<p>\u4ee5 rust-url \u9879\u76ee\u4e3a\u4f8b\uff0c\u514b\u9686\u5bf9\u5e94\u4ee3\u7801\u5e76 checkout \u6307\u5b9a\u7248\u672c</p> <pre><code>git clone https://github.com/servo/rust-url.git\ncd rust-url\ngit checkout bfa167b4e0253642b6766a7aa74a99df60a94048\n</code></pre> <p>1\u3001\u521d\u59cb\u5316 cargo-fuzz\uff08\u4e3b\u52a8\u6307\u5b9a target \u4e3a fuzz_test \uff09</p> <pre><code>cargo fuzz init -t fuzz_test\n</code></pre> <p>2\u3001\u7f16\u5199 fuzz \u6d4b\u8bd5\u7a0b\u5e8f</p> <pre><code>// fuzz/fuzz_targets/fuzz_test.rs\n\n#![no_main]\n\nextern crate libfuzzer_sys;\nextern crate url;\n\nuse libfuzzer_sys::fuzz_target;\n\nfuzz_target!(|data: &amp;[u8]| {\n    if let Ok(s) = std::str::from_utf8(data) {\n        let _ = url::Url::parse(s);\n    }\n});\n</code></pre> <p>3\u3001\u67e5\u770b\u5f53\u524d\u5b58\u5728\u7684 fuzz target \u53ef\u4ee5\u786e\u8ba4\u5bf9\u5e94\u7684 target \u540d\u79f0\u4e3a fuzz_test</p> <pre><code>cargo fuzz list\n</code></pre> <p>4\u3001\u8fd0\u884c fuzz \u6d4b\u8bd5\uff08\u8be5\u6d4b\u8bd5\u6d4b\u5e8f\u5728\u8fd0\u884c\u4e00\u5b9a\u65f6\u95f4\u540e\u4f1a\u51fa\u73b0 panic\uff09</p> <pre><code>cargo fuzz run fuzz_test\n</code></pre>"},{"location":"design/Cargo-fuzz/#structure-aware-fuzzing","title":"Structure-Aware Fuzzing","text":"<p>\u89c2\u5bdf\u524d\u6587 fuzz \u6d4b\u8bd5\u7a0b\u5e8f\u53ef\u4ee5\u53d1\u73b0\uff0cfuzz \u6d4b\u8bd5\u7a0b\u5e8f\u7684\u5165\u53c2\u662f\u5b57\u7b26\u4e32\u7c7b\u578b\u7684\uff0c\u4f46\u4e8b\u5b9e\u4e0a\u5e76\u975e\u6bcf\u4e2a fuzz target \u90fd\u5e0c\u671b\u5c06\u5b57\u7b26\u4e32\u4f5c\u4e3a\u8f93\u5165\u3002\u5e78\u8fd0\u7684\u662f\uff0c\u53ea\u8981\u5b9e\u73b0\u4e86<code>Arbitrary</code> trait\uff0c<code>libfuzzer-sys</code> crate \u53ef\u4ee5\u8ba9\u6211\u4eec\u5b9a\u4e49\u4efb\u4f55\u7c7b\u578b\u7684 fuzz target\u3002\u4ee5\u4e0b\u4ee5\u81ea\u5b9a\u4e49\u7684 alloc \u5206\u914d\u5668\u4e3a\u4f8b\u8fdb\u884c\u8bf4\u660e\uff1a</p> <p>1\u3001\u521b\u5efa my_alloc \u9879\u76ee</p> <pre><code>cargo init my_alloc\n</code></pre> <p>2\u3001\u5b9e\u73b0\u81ea\u5b9a\u4e49\u7684 my_allocator \u6a21\u5757</p> <pre><code>// src/lib/lib.rs\n\npub mod my_allocator {\n    use std::alloc::{alloc, dealloc, Layout};\n    use std::alloc::realloc as stdRealloc;\n\n    pub fn malloc (size: usize) -&gt; *mut u8 {\n        let ptr = unsafe { alloc(Layout::from_size_align(size, std::mem::align_of::&lt;u8&gt;()).unwrap()) };\n        ptr\n    }\n\n    pub fn free (ptr: *mut u8) {\n        unsafe { dealloc(ptr, Layout::from_size_align(std::mem::size_of_val(&amp;ptr), std::mem::align_of::&lt;u8&gt;()).unwrap()) };\n    }\n\n    pub fn realloc (ptr: *mut u8, size: usize) -&gt; *mut u8 {\n        let new_ptr = unsafe { stdRealloc(ptr, Layout::from_size_align(std::mem::size_of_val(&amp;ptr), std::mem::align_of::&lt;u8&gt;()).unwrap(), size) };\n        new_ptr\n    }\n}\n</code></pre> <p>3\u3001\u914d\u7f6e\u5e93</p> <pre><code>// Cargo.toml\n\n[lib]\nname = \"my_alloc\"\npath = \"src/lib/lib.rs\"\n</code></pre> <p>4\u3001\u521b\u5efa fuzz_malloc_free target</p> <pre><code>cargo fuzz add fuzz_malloc_free\n</code></pre> <p>5\u3001\u7f16\u5199 fuzz_malloc_free \u6d4b\u8bd5\u7a0b\u5e8f</p> <pre><code>// fuzz/fuzz_targets/fuzz_malloc_free.rs\n\n#![no_main]\n\nuse libfuzzer_sys::{arbitrary::Arbitrary, fuzz_target};\nuse my_alloc::my_allocator;\n\n#[derive(Arbitrary, Debug)]\nenum AllocatorMethod {\n    Malloc,\n    Free,\n    Realloc,\n}\n\nfuzz_target!(|methods: Vec&lt;AllocatorMethod&gt;| {\n    for method in methods {\n        match method {\n            AllocatorMethod::Malloc =&gt; {\n                let _ptr: *mut u8 = my_allocator::malloc(10);\n            }\n            AllocatorMethod::Free =&gt; {\n                let ptr: *mut u8 = my_allocator::malloc(10);\n                my_allocator::free(ptr);\n            }\n            AllocatorMethod::Realloc =&gt; {\n                let ptr: *mut u8 = my_allocator::malloc(10);\n                let _new_ptr: *mut u8 = my_allocator::realloc(ptr, 20);\n            }\n        }\n    }\n});\n</code></pre> <p>6\u3001\u6dfb\u52a0\u4f9d\u8d56</p> <pre><code>// fuzz/Cargo.toml\n\n[dependencies]\narbitrary = \"1.0\"\nlibfuzzer-sys = { version = \"0.4.0\", features = [\"arbitrary-derive\"] }\n</code></pre> <p>7\u3001\u8fd0\u884c fuzz \u6d4b\u8bd5</p> <pre><code>cargo fuzz run fuzz_malloc_free\n</code></pre>"},{"location":"design/Cargo-fuzz/#_1","title":"\u53c2\u8003\u6587\u6863","text":"<p>rust fuzz book</p>"},{"location":"design/cores/01-devel-doc/","title":"\u6269\u5c55\u5b50\u7c7b\u5f00\u53d1\u6307\u5357","text":"<p>sysmaster\u4e3aLinux\u7cfb\u7edf\u4e0b\u7684\u4e00\u53f7\u8fdb\u7a0b\uff0c\u662flinux\u5185\u6838\u542f\u52a8\u540e\u7b2c\u4e00\u4e2a\u7528\u6237\u6001\u8fdb\u7a0b\uff0c\u5728\u7cfb\u7edf\u542f\u52a8\u8fc7\u7a0b\u4e2d\u548c\u5173\u673a\u8fc7\u7a0b\u4e2d\uff0c\u5b8c\u6210\u76f8\u5173\u8d44\u6e90\u7684\u521d\u59cb\u5316\u548c\u56de\u6536\u5de5\u4f5c\uff1a</p> <p>\u5f00\u673a\u8fc7\u7a0b\u4e2d\u4e3b\u8981\u5b8c\u6210\u4ee5\u4e0b\u5de5\u4f5c\uff1a</p> <ol> <li>\u8bbe\u5907\u9a71\u52a8\u7684\u52a0\u8f7d\u4ee5\u53ca\u4ee5\u53ca\u521d\u59cb\u5316\uff0c\u5982\u78c1\u76d8\u8bbe\u5907\uff0c\u7f51\u7edc\u8bbe\u5907\u7b49\u3002</li> <li>\u6587\u4ef6\u7cfb\u7edf\u521d\u59cb\u5316\u53ca\u6302\u8f7d\u3002</li> <li>\u7cfb\u7edf\u914d\u7f6e\u7684\u521d\u59cb\u5316\uff0c\u5982\u7f51\u7edc\u914d\u7f6e\u7b49\uff0c\u5176\u4ed6\u9700\u8981\u5728\u7cfb\u7edf\u542f\u52a8\u8fc7\u7a0b\u4e2d\u91cd\u65b0\u521d\u59cb\u5316\u7684\u90e8\u5206\u3002</li> <li>\u968f\u7cfb\u7edf\u542f\u52a8\u800c\u81ea\u542f\u52a8\u7684\u8fdb\u7a0b\u7684\u542f\u52a8\u3002</li> </ol> <p>\u5173\u673a\u8fc7\u7a0b\u4e3b\u8981\u5b8c\u6210\u4ee5\u4e0b\u5de5\u4f5c\uff1a 1.\u8d44\u6e90\u7684\u56de\u6536\uff0c\u5982\u7f13\u5b58\u7684\u6301\u4e45\u5316\u3002 2.\u4e1a\u52a1\u8fdb\u7a0b\u7684\u5173\u95ed</p> <p>sysmaster\u652f\u6491\u4ee5\u4e0a\u5de5\u4f5c\uff0c\u63d0\u4f9b\u53ef\u4ee5\u6269\u5c55\u7684\u5f00\u53d1\u6846\u67b6\uff0c\u652f\u6301\u5f00\u53d1\u591a\u79cd\u7ba1\u7406\u5355\u5143\uff08\u540e\u6587\u79f0\u4e3aUnit\uff09\uff0c\u5b8c\u6210\u9700\u8981\u5728\u5f00\u673a\u548c\u5173\u673a\u8fc7\u7a0b\u4e2d\u53ef\u4ee5\u65b9\u4fbf\u6269\u5c55\u9700\u8981\u6ce8\u5165\u7684\u7cfb\u7edf\u542f\u52a8\u8fc7\u7a0b\u4e2d\u9700\u8981\u6267\u884c\u7684\u5de5\u4f5c\uff0c\u6269\u5c55Unit\u7684\u5f00\u53d1\u6d41\u7a0b\u5982\u4e0b\uff1a</p> <p>\u9700\u8981\u542f\u52a8\u7684\u8fdb\u7a0b\uff0c\u521d\u59cb\u5316\u7684\u7cfb\u7edf\u914d\u7f6e\uff0c\u5982\u7f51\u7edc\u914d\u7f6e\uff0c \u672c\u6587\u5f53\u8be6\u7ec6\u63cf\u8ff0\uff0c\u5982\u4f55\u57fa\u4e8esysmaster\u5f00\u53d1\u6846\u67b6\uff0csysmaster\u6269\u5c55\u5f00\u53d1\u65b0\u7684\u5b50\u7c7b\uff0c\u5177\u4f53\u7684\u5f00\u53d1\u6d41\u7a0b\u5982\u4e0b\uff1a</p> <p></p>"},{"location":"design/cores/01-devel-doc/#unitsubclass","title":"\u5b50\u7c7bUnitSubClass\u5b9e\u73b0","text":"<p>\u5b50Unit\u7684\u884c\u4e3a\u7ea6\u675f\u901a\u8fc7\u4e09\u4e2atrait\u6765\u5b9a\u4e49\uff0c\u5206\u522b\u662f\uff1a</p> <pre><code>//\u5b9a\u4e49Unit\u5355\u5143\u6240\u6709\u53ef\u4ee5\u6267\u884c\u7684\u884c\u4e3a\uff0c\u5177\u4f53\u7684\u884c\u4e3a\u5217\u8868\u53ef\u4ee5\u53c2\u8003\u4ee3\u7801\u6587\u4ef6\uff1a\n//sysmaster/src/manager/unit/unit_entry/u_entry.rs\npub trait UnitObj;\n//\u7531\u4e8erust\u4e0d\u652f\u6301\u9762\u5411\u5bf9\u8c61\uff0c\u6b64trait\u5b9e\u73b0\u4ece\u5b50Unit\u5230UnitObj\u7684downgrade.\npub trait UnitSubClass;\n//\u5c06UnitManager\uff08UnitManager\u662f\u6240\u6709\u5b50\u7c7b\u7ba1\u7406\u7236\u7c7b\uff0c\u7531\u4e8erust\u4e0d\u652f\u6301\u591a\u6001\uff0c\u65e0\u6cd5\u57fa\u4e8e\u57fa\u7c7b\u505a\u8f6c\u6362\uff0c\u6240\u4ee5\u589e\u52a0\u6b64trait\uff09 attach\u5230\u5b50\u7c7b\u5b9e\u4f8b\u4e0a\npub trait UnitMngUtil;\n</code></pre> <ol> <li>\u524d\u7f6e\u6761\u4ef6\u8bf4\u660e</li> </ol> <p>\u5f53\u524dsysmaster\u91c7\u7528\u5355\u7ebf\u7a0b\u8fd0\u884c\u73af\u5883\uff0c\u6240\u4ee5\u5404sysmaster\u7ba1\u7406\u5355\u5143\uff08unit\uff09\u5728\u5b9e\u73b0\u65f6\u9700\u8981\u4ee5\u5f02\u6b65\u65e0\u963b\u585e\u65b9\u5f0f\u7f16\u7a0b.</p> <ol> <li> <p>\u5b50\u7c7b\u884c\u4e3a\u5206\u7c7b\u8bf4\u660e unit\u4f5c\u4e3a\u6240\u7ba1\u7406\u7684\u7cfb\u7edf\u8d44\u6e90\u5728sysmaster\u4e2d\u7684\u6295\u5f71\uff0cunit\u5728\u901a\u8fc7os\u63a5\u53e3\u64cd\u4f5c\u5bf9\u5e94\u7cfb\u7edf\u8d44\u6e90\u65f6\uff0c\u540c\u65f6\u7ef4\u62a4\u5bf9\u5e94\u7cfb\u7edf\u8d44\u6e90\u7684\u72b6\u6001\u548c\u5386\u53f2\u64cd\u4f5c\u7ed3\u679c\u3002</p> <ul> <li> <p>\u5b50\u7c7b\u751f\u547d\u5468\u671f\u884c\u4e3a\uff1a \u6839\u636e\u4e1a\u52a1\u8bc9\u6c42\u63d0\u70bc\u51fa\u5176\u6240\u9700\u7ba1\u7406\u7684\u7cfb\u7edf\u8d44\u6e90\uff0c\u5e76\u901a\u8fc7os\u63a5\u53e3\u5bf9\u8fd9\u4e9b\u7cfb\u7edf\u8d44\u6e90\u8fdb\u884c\u7ba1\u7406\uff0c\u5bf9\u5916\u63d0\u4f9b\u7cfb\u7edf\u8d44\u6e90\u7684\u64cd\u4f5c\u63a5\u53e3\uff0c\u5305\u62ec\uff1astart\u3001stop\u3001reload\u3002</p> </li> <li> <p>\u5b50\u7c7b\u7684\u72b6\u6001\u7ba1\u7406</p> <ul> <li>\u72b6\u6001\u6620\u5c04 unit\u6846\u67b6\u4e3a\u5404\u4e2a\u5b50\u7c7b\u5b9a\u4e49\u4e86\u6807\u51c6\u7684\u72b6\u6001\u673a\uff0c\u5e76\u57fa\u4e8e\u6b64\u72b6\u6001\u9a71\u52a8Unit\u7684\u751f\u547d\u5468\u671f\u884c\u4e3a\uff0c\u5404\u4e2a\u5b50\u7c7bUnit\u4e5f\u53ef\u4ee5\u5b9e\u73b0\u81ea\u5df1\u7684\u72b6\u6001\u7ba1\u7406\uff0c\u4f46\u662f\u9700\u8981\u5c06\u81ea\u5df1\u7684\u72b6\u6001\u901a\u8fc7\u63a5\u53e3\u6620\u5c04\u5230unit\u6846\u67b6\u7684\u57fa\u7840\u72b6\u6001\uff0c\u8fd9\u4e2a\u901a\u8fc7\u5b9e\u73b0\u63a5\u53e3</li> </ul> <pre><code>fn current_active_state(&amp;self) -&gt; UnitActiveState;\n</code></pre> <ul> <li>\u72b6\u6001\u9a71\u52a8 \u72b6\u6001\u673a\u7684\u9a71\u52a8\uff0c\u7531\u4e2a\u5b50\u7c7b\u6839\u636e\u81ea\u8eab\u7684\u884c\u4e3a\u6765\u9a71\u52a8\uff0c\u5f53\u5b50\u7c7b\u5728\u53d8\u66f4\u81ea\u5df1\u7684\u72b6\u6001\u7684\u65f6\u5019\uff0c\u9700\u8981\u663e\u793a\u7684\u8c03\u7528unit\u7684notify\u63a5\u53e3\uff0c\u901a\u77e5unit\uff0c\u72b6\u6001\u53d1\u751f\u4e86\u53d8\u66f4\uff0c\u6765\u9a71\u52a8\u72b6\u6001\u673a\u7684\u72b6\u6001\u8fc1\u79fb\uff0c\u4e3a\u65b9\u4fbf\u5404\u7c7bunit\u5b9e\u73b0\uff0cnotify\u63a5\u53e3\u652f\u6301\u91cd\u5165\u3002</li> </ul> </li> </ul> <pre><code>fn set_state(&amp;self, state: ServiceState) {\nlet original_state = self.state();\n*self.state.borrow_mut() = state;\n// check the new state\nif !vec![\nServiceState::Start,\nServiceState::StartPost,\nServiceState::Running,\nServiceState::Reload,\nServiceState::Stop,\nServiceState::StopWatchdog,\nServiceState::StopSigterm,\nServiceState::StopSigkill,\nServiceState::StopPost,\nServiceState::FinalWatchdog,\nServiceState::FinalSigterm,\nServiceState::FinalSigkill,\n]\n.contains(&amp;state)\n{\nself.pid.unwatch_main();\nself.main_command.borrow_mut().clear();\n}\nif !vec![\nServiceState::Condition,\nServiceState::StartPre,\nServiceState::Start,\nServiceState::StartPost,\nServiceState::Reload,\nServiceState::Stop,\nServiceState::StopWatchdog,\nServiceState::StopSigterm,\nServiceState::StopSigkill,\nServiceState::StopPost,\nServiceState::FinalWatchdog,\nServiceState::FinalSigterm,\nServiceState::FinalSigkill,\nServiceState::Cleaning,\n]\n.contains(&amp;state)\n{\nself.pid.unwatch_control();\nself.control_command.borrow_mut().clear();\n}\nlog::debug!(\n\"original state: {:?}, change to: {:?}\",\noriginal_state,\nstate\n);\n// todo!()\n// trigger the unit the dependency trigger_by\nlet service_type = self.config.service_type();\nlet os = service_state_to_unit_state(service_type, original_state);\nlet ns = service_state_to_unit_state(service_type, state);\nself.comm\n.unit()\n.notify(os, ns, UnitNotifyFlags::UNIT_NOTIFY_RELOAD_FAILURE);\n}\n</code></pre> </li> <li> <p>\u5b50\u7c7b\u7684\u4f9d\u8d56\u5173\u7cfb\u52a8\u6001\u7ba1\u7406[\u53ef\u9009]     sysmaster\u6846\u67b6\u660e\u786e\u5b9a\u4e49\u4e86\u5b50\u7c7b\u7684\u4f9d\u8d56\u5173\u7cfb\uff0c\u5e76\u4e14\u4f1a\u6839\u636e\u4f9d\u8d56\u5173\u7cfb\uff0c\u6267\u884c\u5b50\u7c7b\u7684\u884c\u4e3a\uff0c\u4f9d\u8d56\u5173\u7cfb\u9664\u4e86\u901a\u8fc7\u914d\u7f6e\u6587\u4ef6\u914d\u7f6e\u5916\uff0c\u8fd8\u53ef\u4ee5\u901a\u8fc7\u63a5\u53e3\u52a8\u6001\u6dfb\u52a0\uff0c\u8fd9\u6837\u5b50\u7c7b\u53ef\u4ee5\u63d0\u524d\u5b9a\u4e49\u4e00\u4e9b\u7f3a\u7701\u7684\uff0c\u516c\u5171\u4f9d\u8d56\uff0c\u800c\u65e0\u9700\u518d\u6bcf\u4e2a\u914d\u7f6e\u6587\u4ef6\u589e\u52a0\u8fd9\u6837\u7684\u914d\u7f6e\u3002\u964d\u4f4e\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684\u91cd\u590d\u914d\u7f6e\uff0c\u51cf\u5c11\u914d\u7f6e\u5de5\u4f5c\u91cf\uff0c\u4e5f\u53ef\u4ee5\u5bf9\u7ba1\u7406\u5458\u9690\u85cf\u8fd9\u4e9b\u914d\u7f6e\u3002</p> <pre><code>\u3010\u7f16\u7801\u793a\u4f8b\u3011\u5f85\u8865\u5145\n//todo\n</code></pre> </li> <li> <p>\u8fdb\u7a0b\u7ba1\u7406[\u53ef\u9009]    \u6269\u5c55\u5b50unit\u5728\u5b9e\u73b0\u7684\u65f6\u5019\uff0c\u5e38\u89c1\u7684\u4e00\u79cd\u573a\u666f\u662f\u9700\u8981\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u8fdb\u7a0b\u6765\u6267\u884c\u81ea\u5df1\u8981\u5b8c\u6210\u7684\u52a8\u4f5c\uff0c\u5982\u542f\u52a8\u4e00\u4e2a\u5b88\u62a4\u8fdb\u7a0b\uff0c\u901a\u8fc7\u4e00\u4e2a\u65b0\u7684\u96c6\u6210\u6765\u914d\u7f6e\u7f51\u7edc\uff0c\u7b49\u7b49\uff0c\u4e3a\u6b64\uff0cunit\u6846\u67b6\u63d0\u4f9b\u4e86\u4e00\u4e9b\u516c\u5171\u7684\u8fdb\u7a0b\u64cd\u4f5c\u7684\u80fd\u529b\u6765\u8fdb\u884c(sysmaster\u8fdb\u7a0b\u4e4b\u5916\uff09\u72ec\u7acb\u8fdb\u7a0b\u7684\u64cd\u4f5c\uff0c\u4ee5\u65b9\u4fbf\u5404\u7c7bunit\u5728\u6b64\u573a\u666f\u4e2d\u7684\u5f00\u53d1\u3002</p> </li> <li>\u8fdb\u7a0b\u901a\u4fe1\uff1a\u652f\u6301\u5404\u7c7bunit\u901a\u8fc7\u7cfb\u7edf\u8c03\u7528kill\u5411\u6307\u5b9a\u8fdb\u7a0b\u7ec4\u53d1\u9001\u5404\u79cd\u4fe1\u53f7\u3002</li> <li>\u8fdb\u7a0bid\u8ddf\u8e2a\uff1a\u5728\u5404\u7c7bunit\u63d0\u4f9bpid-unit\u5bf9\u5e94\u5173\u7cfb\u6570\u636e\u7684\u60c5\u51b5\u4e0b\uff0c\u652f\u6301\u6839\u636epid\u5bf9\u5e94\u5173\u7cfb\u8fdb\u884csigchld\u4fe1\u53f7\u5206\u53d1(sigchld_events)\u3002</li> <li> <p>\u8fdb\u7a0b\u62c9\u8d77\uff1a\u652f\u6301\u5404\u7c7bunit\u901a\u8fc7\u7cfb\u7edf\u8c03\u7528fork+execve\u62c9\u8d77\u5b50\u8fdb\u7a0b\uff08\u542bcgroup\u8bbe\u7f6e\uff09\uff0c\u540c\u65f6\u652f\u6301\u591a\u79cd\u8fd0\u884c\u73af\u5883\u53c2\u6570\u8bbe\u7f6e\u3002</p> <pre><code>\n</code></pre> </li> <li> <p>\u5b9e\u73b0\u5b50\u7c7b\u914d\u7f6e\u6587\u4ef6\u89e3\u6790</p> </li> </ol> <p>\u914d\u7f6e\u6587\u4ef6\u4e3atoml\u683c\u5f0f\uff0c\u5177\u4f53\u683c\u5f0f\u5982\u4e0b\uff1a</p> <p>```toml        [Unit]        Description=\"CN\"        Documentation=\"192.168.1.1\"        Requires=\"c.service\"        Wants = \"b.service\"</p> <pre><code>   [SubUnitName]\n   ExecCondition=[\"/usr/bin/sleep 5\"]\n   ExecStart=[\"/usr/bin/echo 'test'\"]\n   ExecStop = [\"/usr/bin/kill $MAINPID\"]\n\n   [Install]\n   WantedBy=\"dbus.service\"\n```\n\nsysmaster\u6846\u67b6\u4f7f\u7528Confique\u6765\u89e3\u6790\u914d\u7f6e\uff0c\u53ef\u4ee5\u65b9\u4fbf\u7684\u5c06\u914d\u7f6e\u6587\u4ef6\u8f6c\u5316\u6210\u5b50\u7c7b\u914d\u7f6e\u6570\u636e\u7ed3\u6784\uff0c\u4ee3\u7801\u793a\u4f8b\u5982\u4e0b\uff1a\n\n```rust\n   #[derive(Config, Default)]\n    pub(crate) struct UeConfig {\n        #[config(nested)]\n        pub Unit: UeConfigUnit,   // section [Unit]\n        #[config(nested)]\n        pub Install: UeConfigInstall, // section [Install]\n    }\n\n    #[derive(Config, Default)]\n    pub(crate) struct UeConfigUnit {\n        #[config(default = \"\")]\n        pub Description: String,\n        #[config(default = \"\")]\n        pub Documentation: String,\n        #[config(default = false)]\n        pub IgnoreOnIsolate: bool,\n        // #[config(deserialize_with = JobMode::deserialize_with)]\n        // #[config(default = \"replace\")]\n        // pub on_success_job_mode: JobMode,\n        #[config(deserialize_with = JobMode::deserialize_with)]   // \u914d\u7f6e\u5bf9\u5e94\u5b57\u6bb5\u7684\u89e3\u6790\u51fd\u6570\n        #[config(default = \"replace\")]\n        pub OnFailureJobMode: JobMode,\n        #[config(deserialize_with = Vec::&lt;String&gt;::deserialize_with)]\n        #[config(default = \"\")]\n        pub Wants: Vec&lt;String&gt;,\n        #[config(deserialize_with = Vec::&lt;String&gt;::deserialize_with)]\n        #[config(default = \"\")]\n        pub Requires: Vec&lt;String&gt;,\n        #[config(deserialize_with = Vec::&lt;String&gt;::deserialize_with)]\n        #[config(default = \"\")]\n        pub Before: Vec&lt;String&gt;,\n        #[config(deserialize_with = Vec::&lt;String&gt;::deserialize_with)]\n        #[config(default = \"\")]\n        pub After: Vec&lt;String&gt;,\n    }\n\n    #[derive(Config, Default)]\n    pub(crate) struct UeConfigInstall {\n        #[config(default = \"\")]\n        pub Alias: String,\n        #[config(deserialize_with = Vec::&lt;String&gt;::deserialize_with)]\n        #[config(default = \"\")]\n        pub WantedBy: Vec&lt;String&gt;,\n        #[config(deserialize_with = Vec::&lt;String&gt;::deserialize_with)]\n        #[config(default = \"\")]\n        pub RequiredBy: Vec&lt;String&gt;,\n        #[config(default = \"\")]\n        pub Also: String,\n        #[config(default = \"\")]\n        pub DefaultInstance: String,\n        // #[config(default = \"\")]\n        // pub install_alias: String,\n        // #[config(default = \"\")]\n        // pub install_also: String,\n        // #[config(default = \"\")]\n        // pub install_default_install: String,\n    }\n    ```\n\u914d\u7f6e\u6587\u4ef6\u7684\u6570\u636e\u7ed3\u6784\u7684\u5b57\u6bb5, confique\u652f\u6301\u57fa\u672c\u7684\u6570\u636e\u7c7b\u578b,\u4e00\u4e9b\u590d\u6742\u7684\u6570\u636e\u7c7b\u578b,\u9700\u8981\u5b9e\u73b0\u81ea\u884c\u5b9e\u73b0Trait DeserializeWith.\n```rust\npub trait DeserializeWith: Sized {\nfn deserialize_with&lt;'de, D&gt;(de: D) -&gt; Result&lt;Self, D::Error&gt;\nwhere\n    D: Deserializer&lt;'de&gt;;\n}\n\nimpl DeserializeWith for Vec&lt;String&gt; {\n    fn deserialize_with&lt;'de, D&gt;(de: D) -&gt; Result&lt;Self, D::Error&gt;\n    where\n        D: Deserializer&lt;'de&gt;,\n    {\n        let s = String::deserialize(de)?;\n        let mut vec = Vec::new();\n\n        for l in s.split_whitespace() {\n            vec.push(l.to_string());\n        }\n\n        Ok(vec)\n    }\n}\n```\n\n\u5728\u914d\u7f6e\u52a0\u8f7d\u65f6,\u5c06\u914d\u7f6efile()\u6dfb\u52a0\u8fdb\u6765,\u6700\u7ec8load\u8d77\u6765,\u4e4b\u540e\u6570\u636e\u7ed3\u6784\u4e2d\u7684\u5b57\u6bb5\u4fbf\u53ef\u4ee5\u8bbf\u95ee.\u6ce8\u610f, confique\u5f53\u524d\u4f7f\u7528\u7684toml\u683c\u5f0f\u7684\u914d\u7f6e\u6587\u4ef6.\n\n```rust\n    let mut builder = UeConfig::builder().env();\n\n    // fragment\n    for v in files.get_unit_id_fragment_pathbuf(name) {\n        builder = builder.file(&amp;v);\n    }\n\n    let mut configer = builder.load()?;\n```\n</code></pre> <ol> <li>\u63d2\u4ef6\u6ce8\u518c    \u5404\u7c7bunit\u4ee5\u63d2\u4ef6\u65b9\u5f0f\u96c6\u6210\u5230sysmaster\u4e2d\uff0cunit\u6846\u67b6\u63d0\u4f9b\u4e86\u63d2\u4ef6\u6ce8\u518c\u80fd\u529b\u7684\u5b8fdeclare_unitobj_plugin\uff0c\u4ee5\u652f\u6301\u5404\u5b50unit\u7684\u6ce8\u518c\uff0c\u63d2\u4ef6\u662f\u4e00\u52a8\u6001\u5e93\u5f62\u5f0f\u52a0\u8f7d\u7684\uff0c\u52a8\u6001\u5e93\u7684\u547d\u540d\u9700\u8981\u548c\u5b50\u7c7b\u7684\u540d\u79f0\u4fdd\u6301\u4e00\u81f4\uff0c\u5982service\uff0c\u5219\u52a8\u6001\u5e93\u7684\u540d\u79f0\u5e94\u8be5\u4e3alibservice.so</li> </ol> <pre><code>declare_unitobj_plugin!(ServiceUnit, ServiceUnit::default, PLUGIN_NAME, LOG_LEVEL);\n</code></pre> <ol> <li>\u589e\u52a0\u9644\u52a0\u529f\u80fd \u589e\u52a0\u914d\u7f6e\u9879\uff1a\u540c\u6b65\u9aa43 \u589e\u52a0\u5904\u7406\u903b\u8f91\uff1a\u56f4\u7ed5\u5bf9\u8c61\u7ba1\u7406\u903b\u8f91\u589e\u52a0\u65b0\u589e\u9644\u52a0\u529f\u80fd\uff0c\u5728\u4e0d\u5b9e\u8d28\u5f71\u54cd\u5bf9\u8c61\u7ba1\u7406\u903b\u8f91\u7684\u6761\u4ef6\u4e0b\uff0c\u5c3d\u53ef\u80fd\u5c06\u65b0\u589e\u9644\u52a0\u529f\u80fd\u4ee5\u72ec\u7acb\u6a21\u5757\u65b9\u5f0f\u5448\u73b0\u3002</li> </ol> <p>\u4e8c\u3001\u53c2\u8003\u5b50\u6a21\u5757\u4f9d\u8d56\u5173\u7cfb // xxx_base -&gt; {xxx_comm | xxx_config} // {xxx_mng_util | xxx} // {xxx_mng | xxx_load} -&gt; // {xxx} -&gt; xxx_unit</p>"},{"location":"design/cores/01-job%20queue/","title":"job\u961f\u5217\u7684\u8bbe\u8ba1","text":"<p>\u5728\u539f\u4e00\u53f7\u8fdb\u7a0b\u4e2d\uff0c\u901a\u8fc7\u4efb\u52a1\uff08job\uff09\u5f15\u64ce\u6765\u89e3\u9664\u5355\u5143\uff08unit\uff09\u95f4\u5173\u8054\u8054\u52a8\u548c\u5355\u4e2aunit\u5904\u7406\u7684\u8026\u5408\u3002\u5728\u65b0\u7684\u4e00\u53f7\u8fdb\u7a0b\u81ea\u7814\u66ff\u4ee3\u9879\u76ee\u4e2d\uff0c\u6211\u4eec\u4ecd\u7136\u9700\u8981\u8fd9\u4e48\u4e00\u4e2a\u6a21\u5757\u5c06unit\u95f4\u8054\u52a8\u903b\u8f91\u540c\u5355\u4e2aunit\u5904\u7406\u903b\u8f91\u9694\u79bb\u5f00\u3002</p>"},{"location":"design/cores/01-job%20queue/#11","title":"1.1 \u76ee\u7684","text":"<p>\u672c\u6587\u6863\u5bf9\u7cfb\u7edf\u4e2djob\u6a21\u5757\u7684\u529f\u80fd\u8fdb\u884c\u6d89\u53ca\uff0c\u660e\u786e\u4e3b\u8981\u601d\u8def\u548c\u4e3b\u8981\u5904\u7406\u8fc7\u7a0b\uff0c\u4f5c\u4e3a\u4eca\u540e\u7684\u7f16\u7801\u9636\u6bb5\u7684\u8f93\u5165\u548c\u7f16\u7801\u4eba\u5458\u3001\u6d4b\u8bd5\u4eba\u5458\u7684\u6307\u5bfc\u3002</p>"},{"location":"design/cores/01-job%20queue/#12","title":"1.2 \u8303\u56f4","text":"<p>job\u6a21\u5757\u6d89\u53ca\u5982\u4e0b\u573a\u666f\uff1ajob\u7684\u6267\u884c\u3001\u901a\u544a\u3001\u7ec8\u7ed3\u3001\u53d6\u6d88\u3001\u67e5\u8be2\uff0c\u6240\u6d89\u53ca\u7684\u4ea4\u4e92\u5bf9\u8c61\u5305\u62ec\uff1aunit\u3001\u7ebf\u7a0b\u8fd0\u884c\u73af\u5883\u3002</p>"},{"location":"design/cores/01-job%20queue/#2","title":"2 \u7279\u6027\u9700\u6c42\u6982\u8ff0","text":"\u9700\u6c42\u7f16\u53f7 \u9700\u6c42\u540d\u79f0 \u7279\u6027\u63cf\u8ff0 \u4f18\u5148\u7ea7 1 \u652f\u6301job\u6267\u884c \u7ba1\u7406\u4fa7\u53ea\u80fd\u901a\u8fc7job\u5f15\u64ce\u6765\u6267\u884cunit\u52a8\u4f5c\uff0cjob\u5f15\u64ce\u6765\u4fdd\u8bc1unit\u53ca\u5176\u5173\u8054unit\u72b6\u6001\u7684\u4e00\u81f4\u6027\u3002 \u9ad8 2 \u652f\u6301job\u901a\u544a \u5bf9\u4e8eapp\u4fa7\u81ea\u89e6\u53d1unit\u52a8\u4f5c\uff0c\u901a\u8fc7\u5411job\u5f15\u64ce\u901a\u544a\u6269\u6563\u5230\u5173\u8054unit\u4e0a\uff0c\u4ee5\u4fdd\u8bc1unit\u53ca\u5176\u5173\u8054unit\u72b6\u6001\u7684\u4e00\u81f4\u6027\u3002 \u9ad8 3 \u652f\u6301job\u7ec8\u7ed3 unit\u5728\u81ea\u8eab\u72b6\u6001\u53d1\u751f\u53d8\u5316\u65f6\u901a\u8fc7\u5411job\u5f15\u64ce\u901a\u544a\u72b6\u6001\u53d8\u5316\uff0c\u4ee5\u5c1d\u8bd5\u7ec8\u7ed3\u5bf9\u5e94job\u3002 \u9ad8 4 \u652f\u6301job\u53d6\u6d88 \u652f\u6301\u7ba1\u7406\u4fa7\u53d6\u6d88\u6307\u5b9ajob\u3002 \u4e2d 5 \u652f\u6301job\u67e5\u8be2 \u652f\u6301\u67e5\u8be2\u7b26\u5408\u6307\u5b9a\u8981\u6c42\u7684job\u4fe1\u606f\u3002 \u4e2d"},{"location":"design/cores/01-job%20queue/#3","title":"3 \u9700\u6c42\u573a\u666f\u5206\u6790","text":""},{"location":"design/cores/01-job%20queue/#31","title":"3.1 \u9700\u6c42\u6765\u6e90","text":"<p>\u5728\u5206\u6790\u8fc7\u539f\u4e00\u53f7\u8fdb\u7a0b\u5b9e\u73b0\u540e\uff0c\u6211\u4eec\u8ba4\u4e3ajob\u5f15\u64ce\u7684\u5b58\u5728\u662f\u5408\u7406\u7684\u3002\u5bf9\u4e8e\u4e00\u53f7\u8fdb\u7a0b\u800c\u8a00\uff0c\u9700\u8981\u6709\u4e00\u4e2a\u6a21\u5757\u6765\u9694\u79bbunit\u95f4\u8054\u52a8\u903b\u8f91\u548c\u5355\u4e2aunit\u5904\u7406\u903b\u8f91\uff0c\u65e0\u8bba\u662f\u539f\u4e00\u53f7\u8fdb\u7a0b\u8fd8\u662f\u65b0\u7684\u4e00\u53f7\u8fdb\u7a0b\u3002</p>"},{"location":"design/cores/01-job%20queue/#32","title":"3.2 \u4ef7\u503c\u5206\u6790","text":"<p>\u8fd9\u6837unit\u95f4\u8054\u52a8\u903b\u8f91\u548c\u5355\u4e2aunit\u5904\u7406\u903b\u8f91\u5373\u53ef\u4ee5\u72ec\u7acb\u5f00\u53d1\uff0c\u4e5f\u53ef\u4ee5\u7075\u6d3b\u7ec4\u5408\uff0c\u540c\u65f6\u4e5f\u964d\u4f4e\u4e86\u6574\u4f53\u7684\u4ee3\u7801\u590d\u6742\u5ea6\u3002</p>"},{"location":"design/cores/01-job%20queue/#33","title":"3.3 \u573a\u666f\u5206\u6790","text":"<p>\u573a\u666f1\uff1aunit\uff08\u8bb0\u5f55\uff09\u6267\u884c\u52a8\u4f5c \u4ea4\u4e92\u5bf9\u8c61\uff1aunit-manager \u5916\u90e8\u8f93\u5165\uff1a\u52a8\u4f5c\u7684\u5bf9\u8c61(unit)+\u7c7b\u578b(kind)+\u9009\u9879(mode) \u5916\u90e8\u8f93\u51fa\uff1a\u52a8\u4f5c\u8bb0\u5f55\u7ed3\u679c\uff08\u975e\u6267\u884c\u7ed3\u679c\uff09\u3010\u8bb0\u5f55\u6210\u529f\uff1f\u5931\u8d25\uff1f\u3011</p> <p>\u573a\u666f2\uff1a\uff08\u4e0d\u53ef\u6a21\u62df\uff09unit\u81ea\u751f\u6210\u52a8\u4f5c\u901a\u544a \u4ea4\u4e92\u5bf9\u8c61\uff1aunit\u5b50\u7c7b \u5916\u90e8\u8f93\u5165\uff1a\u52a8\u4f5c\u7684\u5bf9\u8c61(unit)+\u7c7b\u578b(kind)+\u9009\u9879(mode) \u5916\u90e8\u8f93\u51fa\uff1a\u901a\u544a\u5165\u53c2\u68c0\u6d4b\u7ed3\u679c\uff08\u975e\u8bb0\u5f55\u7ed3\u679c\uff09\u3010\u5165\u53c2\u5408\u6cd5\uff1f\u975e\u6cd5\uff1f\u3011</p> <p>\u573a\u666f3\uff1aunit\uff08\u5b9e\u9645\uff09\u6267\u884c\u52a8\u4f5c \u4ea4\u4e92\u5bf9\u8c61\uff1a\u7ebf\u7a0b\u8fd0\u884c\u73af\u5883 \u5916\u90e8\u8f93\u5165\uff1a\u65e0 \u5916\u90e8\u8f93\u51fa\uff1a\u65e0</p> <p>\u573a\u666f4\uff1aunit\u7ec8\u7ed3\u6267\u884c\u52a8\u4f5c \u4ea4\u4e92\u5bf9\u8c61\uff1aunit\u5b50\u7c7b--unit\u72b6\u6001\uff08\u53d8\u8fc1\uff09\u8ba2\u9605\u2192unit-manager \u5916\u90e8\u8f93\u5165\uff1a\u52a8\u4f5c\u7684\u5bf9\u8c61(unit)+\u5386\u53f2\u72b6\u6001(os)+\u5f53\u524d\u72b6\u6001(ns)+\u5f53\u524d\u9644\u52a0\u72b6\u6001(flags)[reload\u7ed3\u679c\u3001\u81ea\u542f\u52a8\u72b6\u6001] \u5916\u90e8\u8f93\u51fa\uff1a\u7ec8\u7ed3\u5165\u53c2\u68c0\u6d4b\u7ed3\u679c\uff08\u975e\u7ec8\u7ed3\u7ed3\u679c\uff09\u3010\u5165\u53c2\u5408\u6cd5\uff1f\u975e\u6cd5\uff1f\u3011</p> <p>\u573a\u666f5\uff1a\u53d6\u6d88\u52a8\u4f5c \u4ea4\u4e92\u5bf9\u8c61\uff1aunit-manager \u5916\u90e8\u8f93\u5165\uff1a\u52a8\u4f5c\u7684\u6807\u8bc6(job-id) \u5916\u90e8\u8f93\u51fa\uff1a\u53d6\u6d88\u7ed3\u679c\u3010\u53d6\u6d88\u6210\u529f\uff1f\u53d6\u6d88\u5bf9\u8c61\u4e0d\u5b58\u5728\uff1f\u53d6\u6d88\u5bf9\u8c61\u4e0d\u652f\u6301\uff1f\u3011</p> <p>\u573a\u666f6\uff1a\u8bfb\u53d6\u52a8\u4f5c\u4fe1\u606f \u4ea4\u4e92\u5bf9\u8c61\uff1aunit-manager \u5916\u90e8\u8f93\u5165\uff1a\u52a8\u4f5c\u7684\u6807\u8bc6(job-id) \u5916\u90e8\u8f93\u51fa\uff1a\u52a8\u4f5c\u4fe1\u606f\u3010\u53ef\u80fd\u5b58\u5728\uff0c\u53ef\u80fd\u4e0d\u5b58\u5728\u3011</p>"},{"location":"design/cores/01-job%20queue/#34","title":"3.4 \u5f71\u54cd\u5206\u6790","text":"<p>\u4ece\u4f9d\u8d56\u5173\u7cfb\u4e0a\u770b\uff0cjob\u5904\u4e8e\u5355\u4e2aunit\u5904\u7406\u903b\u8f91\uff08unit_entry\uff09\u4e4b\u4e0a\u3001\u6574\u4f53unit\u7ba1\u7406\u903b\u8f91\uff08unit_manager\uff09\u4e4b\u4e0b\u3002\u4ece\u4e1a\u52a1\u903b\u8f91\u4e0a\u770b\uff0cjob\u4f5c\u4e3a\u7ba1\u7406\u4fa7unit\uff08\u5199\u7c7b\uff09\u52a8\u4f5c\u7684\u552f\u4e00\u5165\u53e3\uff0c\u5bf9\u5176\u4f9d\u8d56\u5173\u7cfb\u4e4b\u4e0a\u7684\u6a21\u5757\u5c4f\u853dunit\u95f4\u7684\u4f9d\u8d56\u903b\u8f91\u3002</p>"},{"location":"design/cores/01-job%20queue/#35","title":"3.5 \u5df2\u6709\u5b9e\u73b0\u65b9\u6848\u5206\u6790","text":"<p>\u539f\u4e00\u53f7\u8fdb\u7a0b\u4ee5\u5176\u7ecf\u9a8c\u4ece\u4e1a\u52a1\u573a\u666f\u4e2d\u62bd\u8c61\u5904\u4e86\u4e00\u5957\u673a\u5236\uff0c\u5728\u8f83\u957f\u7684\u65f6\u95f4\u6bb5\u4e2d\u4e0d\u65ad\u6f14\u8fdb\u5e76\u7ecf\u53d7\u4f4f\u8003\u9a8c\uff0c\u5386\u53f2\u8bc1\u660e\u6b64\u673a\u5236\u8db3\u4ee5\u5e94\u5bf9\u7edd\u5927\u90e8\u5206\u5f53\u524d\u542f\u52a8\u573a\u666f\u3002\u5f53\u7136\uff0c\u5176\u957f\u671f\u6f14\u8fdb\uff0c\u5f53\u524d\u7684\u67b6\u6784\u8026\u5408\u8f83\u4e3a\u4e25\u91cd\uff0c\u9020\u6210\u540e\u7eed\u6f14\u8fdb\u6027\u4e0d\u8db3\u3001\u53ef\u9760\u6027\u95ee\u9898\u8f83\u5927\u7b49\u95ee\u9898\u3002\u6240\u4ee5\u6211\u4eec\u5bf9\u5176\u6709\u4e24\u65b9\u9762\u7684\u8003\u8651\uff1a\u7b2c\u4e00\u3001\u7d27\u76ef\u9694\u79bbunit\u95f4\u8054\u52a8\u903b\u8f91\u548c\u5355\u4e2aunit\u5904\u7406\u903b\u8f91\u8fd9\u4e2a\u603b\u76ee\u6807\uff0c\u4e0d\u5c40\u9650\u5176\u5185\u90e8\u5177\u4f53\u5b9e\u73b0\uff1b\u7b2c\u4e8c\u3001\u5728\u5bf9\u4e1a\u52a1\u628a\u63e1\u4e0d\u5927\u7684\u60c5\u51b5\u4e0b\uff0c\u4e0d\u8f7b\u6613\u6539\u52a8\u539f\u6709\u4e1a\u52a1\u573a\u666f\u76f8\u5173\u8bbe\u7f6e\uff0c\u5178\u578b\u4f8b\u5b50\u4e3a\uff1a\u5bf9\u5916\u679a\u4e3e\u8bbe\u5b9a\u3002</p>"},{"location":"design/cores/01-job%20queue/#4","title":"4 \u7279\u6027/\u529f\u80fd\u5b9e\u73b0\u65b9\u6848","text":""},{"location":"design/cores/01-job%20queue/#41","title":"4.1 \u603b\u4f53\u65b9\u6848","text":"<p>\u7b2c\u4e00\uff0c\u6211\u4eec\u9700\u8981\u786e\u7acbjob\u540cunit\u76f4\u63a5\u7684\u5b9a\u4f4d\u548c\u4f9d\u8d56\u5173\u7cfb\u3002\u5176\u5206\u6790\u8fc7\u7a0b\u5982\u4e0b\uff1a \u4e1a\u52a1\u7279\u5f81\uff1aunit\u884c\u4e3a\u540cjob\u4e4b\u95f4\u5e76\u975e\u5305\u542b\u5173\u7cfb\uff0c\u5b58\u5728\u5982\u4e0b\u5173\u8054\u7c7b\u578b\uff1a\uff08a\uff09\u975e\u5bf9\u5e94unit\u884c\u4e3a\u89e6\u53d1job\u53d8\u66f4\uff1b\uff08b\uff09job\u89e6\u53d1unit\u884c\u4e3a\uff1b\uff08c\uff09\u975ejob\u89e6\u53d1unit\u884c\u4e3a\uff1b \u9009\u62e9\u601d\u8def\uff1aunit+job\u7ec4\u6210\u4e00\u4e2a\u6a21\u5757\uff1funit-&gt;job\uff1fjob-&gt;unit\uff1funit-manager|\u5b50\u7c7bunit-&gt;job-&gt;unit&lt;-\u5b50\u7c7bunit\uff1f \u8003\u8651\u56e0\u7d20\uff1a\uff081\uff09\u529f\u80fd\uff0c\u53ef\u8986\u76d6\u7684\u4e1a\u52a1\u573a\u666f\uff1b\uff082\uff09\u67b6\u6784\uff0c\u6574\u4f53\u4ee3\u7801\u590d\u6742\u5ea6\uff1b \u91c7\u7528\u7b56\u7565\uff1aunit-manager|\u5b50\u7c7bunit-&gt;job-&gt;unit&lt;-\u5b50\u7c7bunit \u7ea6\u675f\uff1a\u62c6\u5206unit\u548cjob\u7684\u91cd\u8981\u95ee\u9898\u662funit\u548cjob\u95f4\u7684\u6620\u5c04\u6027\u80fd\u4e0b\u964d\u3001\u6570\u636e\u4f20\u9012\u6027\u80fd\u4e0b\u964d\uff0c\u5bf9\u5e94\u7684\u6539\u5584\u624b\u6bb5\u662fjob\u652f\u6301\u6309unit\u7ec4\u7ec7\u65f6\u91c7\u7528\u9ad8\u901f\u6620\u5c04\uff08\u9009\u62e9\u7279\u5b9akey\u8fdb\u884chash\u8ba1\u7b97\uff09\u3001\u51cf\u5c11\u5728unit\u6574\u4f53\u4e1a\u52a1\u903b\u8f91\u4e2djob\u7684\u5d4c\u5165\u6b21\u6570\u548c\u8f93\u5165\u8f93\u51fa\u4fe1\u606f\u91cf\u3002</p> <p>\u7b2c\u4e8c\u3001job\u4f5c\u4e3a\u7ba1\u7406\u4fa7unit\uff08\u5199\u7c7b\uff09\u52a8\u4f5c\u7684\u552f\u4e00\u5165\u53e3\uff0c\u6211\u4eec\u9700\u8981\u660e\u786eunit\u52a8\u4f5c\u5982\u4f55\u7ba1\u7406\u3002\u5176\u5206\u6790\u8fc7\u7a0b\u5982\u4e0b\uff1a \u4e1a\u52a1\u7279\u5f81\uff1a\uff081\uff09\u4e1a\u52a1\u52a8\u4f5c\u4e2d\u5305\u62ec\u540c\u6b65\u3001\u5f02\u6b65\uff1b\uff082\uff09\u4e1a\u52a1\u52a8\u4f5c\u95f4\u5b58\u5728\u8fde\u5e26\u5173\u8054\uff1b \u9009\u62e9\u601d\u8def\uff1artc\uff1fpipeline\uff1f \u8003\u8651\u56e0\u7d20\uff1a\uff081\uff09\u53ef\u9760\u6027\uff0c\u52a8\u4f5c\u6267\u884c\u5f15\u64ce\u5177\u6709\u7684\u6700\u5c0f\u8c03\u5ea6\u9897\u7c92\u5ea6\uff1b\uff082\uff09\u53ef\u7ef4\u62a4\u6027\uff0c\u4ee5\u7edf\u4e00\u7684\u6a21\u5f0f\u7ba1\u7406\u6240\u6709\u52a8\u4f5c\uff1b \u91c7\u7528\u7b56\u7565\uff1apipeline + trigger-finish \u7ea6\u675f\uff1apipeline\u7684\u5178\u578b\u95ee\u9898\u662f\u5206\u5272\u7684\u52a8\u4f5c\u4e4b\u95f4\u5b58\u5728\u65f6\u5e8f\u63a7\u5236\u529b\u5f31\u3001\u573a\u666f\u6613\u6269\u5927\u3001\u6570\u636e\u4f20\u9012\u6027\u80fd\u5dee\u3001\u4e1a\u52a1\u903b\u8f91\u5448\u73b0\u4e0d\u76f4\u89c2\uff0c\u5bf9\u5e94\u7684\u6539\u5584\u624b\u6bb5\u662f\u52a8\u4f5c\u95f4\u91c7\u7528\u56fa\u5b9a\u987a\u5e8f\uff08\u7c7b\u4f3c\u9501\u95f4\uff09\u5e76\u8fdb\u884c\u5c01\u88c5\u3001\u4e0d\u540c\u573a\u666f\u95f4\u5982\u65e0\u5fc5\u8981\u91c7\u7528\u4e0d\u540c\u53c2\u91cf\u627f\u8f7d\u3001\u6570\u636e\u91c7\u7528\u7edf\u4e00\u7ba1\u7406\u4e14\u91c7\u7528\u6307\u9488\u6216\u544a\u8bc9key\u503c\u4f20\u9012\u3001\u5173\u8054\u4e1a\u52a1\u903b\u8f91\u4ee3\u7801\u4f4d\u7f6e\u96c6\u4e2d\u653e\u7f6e\u3002</p> <p>\u7b2c\u4e09\u3001job\u5f15\u64ce\u4e00\u4e2a\u975e\u5e38\u663e\u8457\u7684\u6027\u80fd\u52a0\u901f\u70b9\u5728\u4e8ejob\u7684\u5408\u5e76\u7ba1\u7406\uff0c\u800cjob\u5408\u5e76\u7ba1\u7406\u7b56\u7565\u4f1a\u5f71\u54cd\u5230job\u7684\u7edd\u5927\u90e8\u5206\u65b9\u9762\u3002\u5176\u5206\u6790\u8fc7\u7a0b\u5982\u4e0b\uff1a \u4e1a\u52a1\u7279\u5f81\uff1a\uff081\uff09unit\u90e8\u5206\u52a8\u4f5c\u8017\u65f6\u8fdc\u8d85job\u7f16\u6392\u8017\u65f6\u3001\u90e8\u5206\u52a8\u4f5c\u8017\u65f6\u5c0f\u4e8ejob\u7f16\u6392\u8017\u65f6\uff1b\uff082\uff09unit\u90e8\u5206\u52a8\u4f5c\u7531\u4e00\u7cfb\u5217\u5b50\u5f02\u6b65\u52a8\u4f5c\u7ec4\u5408\u5b8c\u6210\uff0c\u4e14\u6b64\u7c7b\u52a8\u4f5c\u4e3a\u4e3b\u529f\u80fd\u573a\u666f\u3002 \u9009\u62e9\u601d\u8def\uff1a\u5df2\u89e6\u53d1\u672a\u5b8c\u6210job\u5141\u8bb8\u5408\u5e76\uff1f\u5df2\u89e6\u53d1\u672a\u5b8c\u6210job\u4e0d\u5141\u8bb8\u5408\u5e76\uff1f\u5df2\u89e6\u53d1\u672a\u5b8c\u6210job\u9650\u5b9a\u5728\u56fa\u5b9a\u6709\u9650\u573a\u666f\u4e2d\u624d\u5141\u8bb8\u5408\u5e76\uff1f \u8003\u8651\u56e0\u7d20\uff1a\uff081\uff09\u529f\u80fd\uff0c\u5408\u5e76\u4e0e\u5426\u4e0d\u80fd\u6539\u53d8unit\u7684\u6700\u7ec8\u72b6\u6001\uff1b\uff082\uff09\u6027\u80fd\uff0c\u4e3b\u529f\u80fd\u573a\u666f\u7684\u6027\u80fd\u8981\u6709\u7ade\u4e89\u529b\uff1b\uff083\uff09\u67b6\u6784\uff0c\u6574\u4f53\u4ee3\u7801\u590d\u6742\u5ea6\uff1b \u91c7\u7528\u7b56\u7565\uff1a\u5df2\u89e6\u53d1\u672a\u5b8c\u6210job\u9650\u5b9a\u5728\u56fa\u5b9a\u6709\u9650\u573a\u666f[* + {stop | restart}]\u4e2d\u624d\u5141\u8bb8\u5408\u5e76 \u7ea6\u675f\uff1a\u5df2\u89e6\u53d1\u672a\u5b8c\u6210job\u9650\u5b9a\u5728\u56fa\u5b9a\u6709\u9650\u573a\u666f\u4e2d\u624d\u5141\u8bb8\u5408\u5e76\u7684\u524d\u63d0\u662f\u4e0d\u6539\u53d8unit\u7684\u6700\u7ec8\u72b6\u6001\uff0c\u5176\u5178\u578b\u95ee\u9898\u662fjob\u90e8\u5206\u7684\u590d\u6742\u5ea6\u4e0a\u5347\u3001job\u7f16\u6392\u8017\u65f6\u4e0a\u5347\uff0c\u5bf9\u5e94\u7684\u6539\u5584\u624b\u6bb5\u662fjob\u5408\u7406\u5212\u5206\u5b50\u6a21\u5757\u5206\u5272\u573a\u666f\u3001\u5f15\u5165\u5408\u7406\u7ea6\u675f+\u4fdd\u6301\u5185\u90e8\u72b6\u6001\u51cf\u5c11\u4e3b\u529f\u80fd\u573a\u666f\u7f16\u6392\u8017\u65f6\u3002</p> <p>\u7b2c\u56db\u3001job\u5f15\u64ce\u5bf9\u5916\u5448\u73b0\u7684\u53e6\u4e00\u4e2a\u91cd\u8981\u5173\u8054\u7279\u6027\u662f\u65f6\u5e8f\u63a7\u5236\uff0c\u6211\u4eec\u63a5\u7740\u8981\u89e3\u51b3\u7684\u662fjob\u7684\u65f6\u5e8f\u63a7\u5236\u7b56\u7565\u3002\u5176\u5206\u6790\u8fc7\u7a0b\u5982\u4e0b\uff1a \u4e1a\u52a1\u7279\u5f81\uff1a\uff08\u4e0d\u540cunit\u6240\u5c5e\uff09job\u95f4\u5b58\u5728\u65f6\u5e8f\u8bc9\u6c42\uff1a\uff081\uff09\u6765\u81ea\u4e8e\u6267\u884c\u987a\u5e8f\u914d\u7f6e\u4e14\u53d7\u5f53\u524d\u6267\u884c\u72b6\u6001\u5f71\u54cd\uff1b\uff082\uff09\u6765\u81ea\u4e8eunit\u81ea\u8eab\u52a8\u4f5c\u6267\u884c\u903b\u8f91\uff1b\uff083\uff09\u4e0d\u9f13\u52b1\u8fc7\u591a\u4f7f\u7528\u65f6\u5e8f\uff0c\u5e94\u7528\u6570\u91cf\u4e0d\u5e94\u8be5\u5360\u5927\u591a\u6570\u3002 \u9009\u62e9\u601d\u8def\uff1a\u5bbd\u5165\u4e25\u51fa\uff1f\u4e25\u5165\u5bbd\u51fa\uff1f \u8003\u8651\u56e0\u7d20\uff1a\uff081\uff09\u529f\u80fd\uff0c\u53ef\u8986\u76d6\u7684\u4e1a\u52a1\u573a\u666f\uff1b\uff082\uff09\u6027\u80fd\uff0c\u4e3b\u529f\u80fd\u573a\u666f\u7684\u6027\u80fd\u8981\u6709\u7ade\u4e89\u529b\uff1b\uff083\uff09\u67b6\u6784\uff0c\u6574\u4f53\u4ee3\u7801\u590d\u6742\u5ea6\uff1b \u91c7\u7528\u7b56\u7565\uff1a\u5bbd\u5165\u4e25\u51fa\uff0c\u5373\u5728\u6dfb\u52a0\u5230\u6267\u884c\u961f\u5217\u4e2d\u65f6\u6761\u4ef6\u5bbd\u677e\uff0c\u4f46\u5728\u5b9e\u9645\u6267\u884c\u65f6\u91c7\u7528\u4e25\u683c\u5224\u65ad\u6761\u4ef6\u3002\u5982\u679c\u6761\u4ef6\u4e0d\u6ee1\u8db3\u4f1a\u4ece\u6267\u884c\u961f\u5217\u4e2d\u6458\u51fa\uff0c\u7b49\u5f85\u5173\u8054job\u6267\u884c\u5b8c\u6210\u540e\u518d\u6b21\u5173\u8054\u5165\u961f\u3002 \u7ea6\u675f\uff1a\u5bbd\u5165\u4e25\u51fa\u7684\u5178\u578b\u95ee\u9898\u662f\u5728\u4e0d\u6ee1\u8db3\u6761\u4ef6\u7684\u6837\u672c\u8f83\u591a\u65f6\u6574\u4f53\u6027\u80fd\u8f83\u5dee\uff0c\u5bf9\u5e94\u7684\u6539\u5584\u624b\u6bb5\u662f\u5728\u68c0\u6d4b\u5230\u8fc7\u591a\u6837\u672c\u4e0d\u6ee1\u8db3\u6761\u4ef6\u65f6\u5207\u6362\u5230\u4e25\u5165\u5bbd\u51fa\u7684\u7b56\u7565\uff08\u8003\u8651\u5230\u8fd9\u79cd\u573a\u666f\u662f\u4e0d\u9f13\u52b1\u7684\u884c\u4e3a\uff0c\u76ee\u524d\u5c1a\u672a\u652f\u6301\uff09\u3002</p>"},{"location":"design/cores/01-job%20queue/#42","title":"4.2 \u7279\u6027\u529f\u80fd\u8bbe\u8ba1","text":"<p>\u5728\u505a\u51fa\u6574\u4f53\u7b56\u7565\u9009\u62e9\u540e\uff0c\u6211\u4eec\u5bf9job\u6a21\u5757\u5185\u5404\u5b50\u6a21\u5757\u7684\u5b9a\u4f4d\u548c\u4f9d\u8d56\u5173\u7cfb\u5236\u5b9a\u5982\u4e0b\uff1a \u5b50\u6a21\u5757\u5b9a\u4f4d job_entry: \u4f5c\u4e3ajob\u548cunit\u7684\u8fde\u63a5\u70b9\u548c\u5355\u4e2ajob\u7684\u7c7b\u578b\u5dee\u5f02\u5c4f\u853d\u66fe\uff0c\u63d0\u4f9bunit\u52a8\u4f5c\u5b9e\u9645\u89e6\u53d1\u3001unit\u72b6\u6001\u5173\u8054job\u7ed3\u679c\u3001\u590d\u5408\u7c7b\u578b\u5206\u89e3\u7b49\u80fd\u529b\u3002 job_unit_entry: \u4f5c\u4e3a\u5355\u4e2aunit\u5185job\u95f4\u5173\u7cfb\u7684\u7ef4\u62a4\u8005\uff0c\u63d0\u4f9b\u5355\u4e2aunit\u5185job\u95f4\u7684\u5408\u5e76\u3001\u6392\u5e8f\u3001\u89e6\u53d1\u3001\u7ec8\u6b62\u80fd\u529b\uff0c\u662f\u6574\u4e2ajob\u6a21\u5757\u7684\u673a\u5236\u6838\u5fc3\u3002 job_alloc: \u4f5c\u4e3ajob-id\u7684\u7ba1\u7406\u8005\uff0c\u63d0\u4f9bjob-id\u7684\u5206\u914d\u80fd\u529b\u3002 job_table: \u4f5c\u4e3ajob\u7684\u5b9e\u9645\u62e5\u6709\u8005\uff0c\u63d0\u4f9b\u6309id\u3001unit\u3001\u5df2\u5c31\u7eea\u72b6\u6001\u7ec4\u7ec7\uff08\u6dfb\u52a0\u3001\u5220\u9664\u3001\u5408\u5e76\u3001\u8fd0\u884c\u3001\u7ec8\u7ed3\u3001\u67e5\u627e\uff09job\u7684\u80fd\u529b\uff0c\u662f\u6574\u4e2ajob\u6a21\u5757\u7684\u673a\u5236\u6574\u5408\u8282\u70b9\u3002 job_transaction: \u627f\u8f7d\uff08\u4e0d\u540cunit\u95f4\uff09job\u7684\u5173\u8054\u5c55\u5f00\u6570\u636e\uff0c\u5c06\u5916\u90e8\u8f93\u5165\u6267\u884c\u52a8\u4f5c\u8bc9\u6c42\u6620\u5c04\u4e3ajob\uff08\u7fa4\uff09\u3002 job_notify: \u627f\u8f7d\uff08\u4e0d\u540cunit\u95f4\uff09job\u7684\u901a\u544a\u5c55\u5f00\u6570\u636e\uff0c\u5c06\u5916\u90e8\u8f93\u5165\u6267\u884c\u52a8\u4f5c\u7ed3\u679c\u3001\u4e8b\u4ef6\u6620\u5c04\u4e3a\u6267\u884c\u52a8\u4f5c\u8bc9\u6c42\uff08\u7fa4\uff09\u3002 job_stat: \u4f5c\u4e3ajob\u7edf\u8ba1\u4fe1\u606f\u7684\u7ba1\u7406\u8005\uff0c\u63d0\u4f9bjob\u7edf\u8ba1\u4fe1\u606f\u7684\u66f4\u65b0\u3001\u67e5\u770b\u80fd\u529b\u3002 job_manager: \u4f5c\u4e3ajob\u7684\u603b\u4f53\u7ba1\u7406\u8005\uff0c\u8d1f\u8d23\u5404\u5b50\u6a21\u5757\u62fc\u88c5\u548c\u5bf9\u5916\u754c\u9762\u5c01\u88c5\uff0c\u63d0\u4f9bjob\u7684\u5bf9\u5916\u64cd\u4f5c\uff08\u6267\u884c\u52a8\u4f5c\u751f\u6210\u3001\u6267\u884c\u4e8b\u4ef6\u901a\u544a\u3001\u8fd0\u884c\u3001\u7ec8\u7ed3\u3001\u5220\u9664\u3001\u67e5\u8be2\u3001\u8c03\u6d4b\uff09\u754c\u9762\u3002</p> <p>\u5b50\u6a21\u5757\u95f4\u4f9d\u8d56\u5173\u7cfb---\u4e0d\u542b\u5916\u90e8\u6a21\u5757\u4f9d\u8d56\u5173\u7cfb job_entry: NA job_unit_entry: job_entry job_alloc: job_entry job_table: job_entry, job_unit_entry, job_alloc job_transaction: job_entry, job_alloc, job_table job_notify: job_entry job_stat: job_entry job_manager: job_entry, job_alloc, job_table, job_transaction, job_notify, job_stat</p> <p>\u4ece\u6574\u4f53\u5904\u7406\u6d41\u7a0b\u4e0a\u6765\u770b\uff0cjob\u5305\u62ec6\u4e2a\u573a\u666f\uff0c\u5728\u524d\u8ff0\u7ae0\u8282\u63cf\u8ff0\u7684\u5bf9\u5916\u5448\u73b0\u57fa\u7840\u4e0a\uff0c\u6211\u4eec\u8fd9\u91cc\u518d\u8865\u5145\u5176\u5185\u90e8\u4fe1\u606f\u5982\u4e0b\uff1a</p> <p>\u573a\u666f1\uff1aunit\uff08\u8bb0\u5f55\uff09\u6267\u884c\u52a8\u4f5c \u4ea4\u4e92\u5bf9\u8c61\uff1aunit-manager \u5916\u90e8\u8f93\u5165\uff1a\u52a8\u4f5c\u7684\u5bf9\u8c61(unit)+\u7c7b\u578b(kind)+\u9009\u9879(mode) \u5185\u90e8\u8f93\u51fa\uff1a\u8f93\u5165\u52a8\u4f5c\u53ca\u5176\u5173\u8054\u52a8\u4f5c\u88ab\u4e8b\u52a1\u6027\u8bb0\u5f55 \u5916\u90e8\u8f93\u51fa\uff1a\u52a8\u4f5c\u8bb0\u5f55\u7ed3\u679c\uff08\u975e\u6267\u884c\u7ed3\u679c\uff09\u3010\u8bb0\u5f55\u6210\u529f\uff1f\u5931\u8d25\uff1f\u3011 \u6d89\u53ca\u6a21\u5757\uff1ajob_entry + job_unit_entry + job_alloc + job_table + job_transaction + job_manager</p> <p>\u573a\u666f2\uff1a\uff08\u4e0d\u53ef\u6a21\u62df\uff09unit\u81ea\u751f\u6210\u52a8\u4f5c\u901a\u544a \u4ea4\u4e92\u5bf9\u8c61\uff1aunit\u5b50\u7c7b \u5916\u90e8\u8f93\u5165\uff1a\u52a8\u4f5c\u7684\u5bf9\u8c61(unit)+\u7c7b\u578b(kind)+\u9009\u9879(mode) \u5185\u90e8\u8f93\u51fa\uff1a\u8f93\u5165\u52a8\u4f5c\u7684\u5173\u8054\u52a8\u4f5c\u88ab\u4e8b\u52a1\u6027\u8bb0\u5f55 \u5916\u90e8\u8f93\u51fa\uff1a\u901a\u544a\u5165\u53c2\u68c0\u6d4b\u7ed3\u679c\uff08\u975e\u8bb0\u5f55\u7ed3\u679c\uff09\u3010\u5165\u53c2\u5408\u6cd5\uff1f\u975e\u6cd5\uff1f\u3011 \u6d89\u53ca\u6a21\u5757\uff1ajob_entry + job_unit_entry + job_alloc + job_table + job_transaction + job_notify + job_manager</p> <p>\u573a\u666f3\uff1aunit\uff08\u5b9e\u9645\uff09\u6267\u884c\u52a8\u4f5c \u4ea4\u4e92\u5bf9\u8c61\uff1a\u7ebf\u7a0b\u8fd0\u884c\u73af\u5883 \u5916\u90e8\u8f93\u5165\uff1a\u65e0 \u5185\u90e8\u8f93\u51fa\uff1a\u5b9e\u9645\u52a8\u4f5c\u89e6\u53d1\u7ed3\u679c\uff08\u975e\u6267\u884c\u7ed3\u679c\uff09\u3010\u89e6\u53d1\u6210\u529f\uff1f\u5931\u8d25\uff1f\u3011 \u5916\u90e8\u8f93\u51fa\uff1a\u65e0 \u6d89\u53ca\u6a21\u5757\uff1ajob_entry + job_unit_entry + job_table + job_manager</p> <p>\u573a\u666f4\uff1aunit\u7ec8\u7ed3\u6267\u884c\u52a8\u4f5c \u4ea4\u4e92\u5bf9\u8c61\uff1aunit\u5b50\u7c7b--unit\u72b6\u6001\uff08\u53d8\u8fc1\uff09\u8ba2\u9605\u2192unit-manager \u5916\u90e8\u8f93\u5165\uff1a\u52a8\u4f5c\u7684\u5bf9\u8c61(unit)+\u5386\u53f2\u72b6\u6001(os)+\u5f53\u524d\u72b6\u6001(ns)+\u5f53\u524d\u9644\u52a0\u72b6\u6001(flags)[reload\u7ed3\u679c\u3001\u81ea\u542f\u52a8\u72b6\u6001] \u5185\u90e8\u8f93\u51fa\uff1a\u5c1d\u8bd5\u5220\u9664\u76f8\u5173job + \u5931\u8d25\u56de\u9000\u5173\u8054\u52a8\u4f5c + \uff08\u53ef\u6a21\u62df\uff09unit\u81ea\u751f\u6210\u52a8\u4f5c\u901a\u544a + \u6839\u636e\u72b6\u6001\u53d8\u5316\u89e6\u53d1\u5173\u8054\u52a8\u4f5c \u5916\u90e8\u8f93\u51fa\uff1a\u7ec8\u7ed3\u5165\u53c2\u68c0\u6d4b\u7ed3\u679c\uff08\u975e\u7ec8\u7ed3\u7ed3\u679c\uff09\u3010\u5165\u53c2\u5408\u6cd5\uff1f\u975e\u6cd5\uff1f\u3011 \u6d89\u53ca\u6a21\u5757\uff1ajob_entry + job_unit_entry + job_table + job_transaction + job_notify + job_manager</p> <p>\u573a\u666f5\uff1a\u53d6\u6d88\u52a8\u4f5c \u4ea4\u4e92\u5bf9\u8c61\uff1aunit-manager \u5916\u90e8\u8f93\u5165\uff1a\u52a8\u4f5c\u7684\u6807\u8bc6(job-id) \u5185\u90e8\u8f93\u51fa\uff1a\u5220\u9664\u76f8\u5173job + \u56de\u9000\u5173\u8054\u52a8\u4f5c + job\u81ea\u751f\u6210unit\u72b6\u6001\u53d8\u8fc1\u4e8b\u4ef6\u901a\u544a \u5916\u90e8\u8f93\u51fa\uff1a\u53d6\u6d88\u7ed3\u679c\u3010\u53d6\u6d88\u6210\u529f\uff1f\u53d6\u6d88\u5bf9\u8c61\u4e0d\u5b58\u5728\uff1f\u53d6\u6d88\u5bf9\u8c61\u4e0d\u652f\u6301\uff1f\u3011 \u6d89\u53ca\u6a21\u5757\uff1ajob_entry + job_unit_entry + job_table + job_transaction + job_manager</p> <p>\u573a\u666f6\uff1a\u8bfb\u53d6\u52a8\u4f5c\u4fe1\u606f \u4ea4\u4e92\u5bf9\u8c61\uff1aunit-manager \u5916\u90e8\u8f93\u5165\uff1a\u52a8\u4f5c\u7684\u6807\u8bc6(job-id) \u5185\u90e8\u8f93\u51fa\uff1a\u65e0 \u5916\u90e8\u8f93\u51fa\uff1a\u52a8\u4f5c\u4fe1\u606f\u3010\u53ef\u80fd\u5b58\u5728\uff0c\u53ef\u80fd\u4e0d\u5b58\u5728\u3011 \u6d89\u53ca\u6a21\u5757\uff1ajob_entry + job_unit_entry + job_table + job_manager</p> <p>\u4ece\u5185\u90e8\u52a8\u4f5c\u4e2d\u6211\u4eec\u53ef\u4ee5\u5408\u5e76\u4e00\u4e9b\u76f8\u4f3c\u9879\uff0c\u5408\u5e76\u540euse case\u4e3a\uff1a use case 1\uff1ajob\u521b\u5efa \u5bf9\u5e94\u539f\u573a\u666f1\u548c\u539f\u573a\u666f2\u3002 \u5728\u8fd9\u4e24\u4e2a\u573a\u666f\u4e2d\uff0c\u5747\u6839\u636e\u8f93\u5165\u52a8\u4f5c\u8fdb\u884c\u5173\u8054\u6269\u5c55\uff0c\u5176\u533a\u522b\u5728\u4e8e\u662f\u5426\u5c06\u8f93\u5165\u52a8\u4f5c\u8bb0\u5f55\u5230\u5185\u90e8\u4e2d\u3002</p> <p>use case 2\uff1ajob\u6267\u884c \u5bf9\u5e94\u539f\u573a\u666f3\u3002</p> <p>use case 3\uff1ajob\u7ec8\u7ed3 \u5bf9\u5e94\u539f\u573a\u666f4\u548c\u539f\u573a\u666f5. \u5728\u8fd9\u4e24\u4e2a\u573a\u666f\u4e2d\uff0c\u5747\u6839\u636e\u8f93\u5165\u5220\u9664\u76f8\u5173job\u5e76\u8fdb\u4e00\u6b65\u505a\u76f8\u5173\u5173\u8054\u52a8\u4f5c\uff0c\u5176\u533a\u522b\u5728\u4e8e\u76f8\u5173\u5173\u8054\u52a8\u4f5c\u4e0d\u5c3d\u76f8\u540c\u3002</p> <p>use case 4\uff1ajob\u67e5\u627e \u5bf9\u5e94\u539f\u573a\u666f6\u3002</p>"},{"location":"design/cores/01-job%20queue/#43-job","title":"4.3 job\u521b\u5efa\u5b9e\u73b0","text":""},{"location":"design/cores/01-job%20queue/#431","title":"4.3.1 \u8bbe\u8ba1\u601d\u8def","text":"<p>job\u521b\u5efa\u6db5\u76d6unit\uff08\u8bb0\u5f55\uff09\u6267\u884c\u52a8\u4f5c\u548c\uff08\u4e0d\u53ef\u6a21\u62df\uff09unit\u81ea\u751f\u6210\u52a8\u4f5c\u901a\u544a\uff0c\u4e8c\u8005\u5b58\u5728\u4e00\u5b9a\u7684\u76f8\u4f3c\uff0c\u4e5f\u5b58\u5728\u4e00\u5b9a\u7684\u5dee\u5f02\u3002\u5982\u4f55\u786e\u5b9a\u5171\u7528\u8303\u56f4\uff1f\u5176\u5206\u6790\u8fc7\u7a0b\u5982\u4e0b\uff1a \u4e1a\u52a1\u7279\u5f81\uff1a\u5728\u591a\u79cd\u573a\u666f\u4e2d\u4f1a\u89e6\u53d1\u4e1a\u52a1\u52a8\u4f5c\u7684\u8fde\u5e26\u5173\u8054\uff0c\u4e0d\u540c\u4e1a\u52a1\u573a\u666f\u4e2d\u6240\u5173\u8054\u52a8\u4f5c\u7684\u8303\u56f4\u3001\u6a21\u5f0f\u5747\u6709\u5dee\u5f02\uff1a\uff08a\uff09\u89e6\u53d1\u6267\u884cunit\u52a8\u4f5c[\u56fe\u5355\u70b9\u63a2\u7d22{1-&gt;N(1)}\u3001\u56fe\u591a\u70b9\u63a2\u7d22{1-&gt;M(1)-&gt;N(M(1))}]\uff1b\uff08b\uff09\u901a\u544a\u975ejob\u89e6\u53d1unit\u884c\u4e3a[\u56fe\u5355\u70b9\u63a2\u7d22{nop(1)-&gt;n(1)-&gt;N(n(1))}]\uff1b\uff08c\uff09unit\u52a8\u4f5c\u6267\u884c\u7ed3\u679c\u786e\u5b9a[\u56fe\u5355\u70b9\u63a2\u7d22{nop(1)-&gt;n'(1)-&gt;N(n'(1))}]\uff1b \u9009\u62e9\u601d\u8def\uff1a\u57fa\u4e8e\u4e1a\u52a1\u573a\u666f\u5b9a\u5236\u4e0d\u540c\u5904\u7406\u903b\u8f91\uff1f\u5408\u5e76\u5185\u90e8\u76f8\u540c\u5904\u7406\u903b\u8f91+\u57fa\u4e8e\u4e1a\u52a1\u573a\u666f\u5b9a\u5236\u6570\u636e\uff1f \u8003\u8651\u56e0\u7d20\uff1a\uff081\uff09\u529f\u80fd\uff0c\u53ef\u8986\u76d6\u7684\u4e1a\u52a1\u573a\u666f\uff1b\uff082\uff09\u67b6\u6784\uff0c\u6574\u4f53\u4ee3\u7801\u590d\u6742\u5ea6\uff1b \u91c7\u7528\u7b56\u7565\uff1a\u5408\u5e76\u5185\u90e8\u76f8\u540c\u5904\u7406\u903b\u8f91{N(M)} + \u57fa\u4e8e\u4e1a\u52a1\u573a\u666f\u5b9a\u5236\u6570\u636e{n or n'} \u7ea6\u675f\uff1a\u5206\u79bb\u673a\u5236\u548c\u6570\u636e\u7684\u524d\u63d0\u662f\u8986\u76d6\u4e1a\u52a1\u573a\u666f\uff0c\u5176\u5178\u578b\u95ee\u9898\u662f\u673a\u5236\u9700\u8981\u5e94\u5bf9\u7684\u573a\u666f\u8fc7\u591a\u5bfc\u81f4\u903b\u8f91\u590d\u6742\uff0c\u5bf9\u5e94\u7684\u6539\u5584\u624b\u6bb5\u662f\u5408\u7406\u5212\u5b9a\u673a\u5236\u5e94\u7528\u8303\u56f4\uff0c\u6bd4\u5982\uff1a\u4e0d\u5f3a\u884c\u8ffd\u6c42\u4e00\u5957\u6846\u67b6\uff0c\u5c06\u6846\u67b6\u62c6\u5206\u4e3a\u51e0\u4e2a\u4e92\u4e0d\u5173\u8054\u7684\u5b50\u6846\u67b6\u518d\u4e00\u6b21\u4e3a\u57fa\u7840\u8fdb\u884c\u4e0d\u540c\u7684\u7ec4\u5408\u3002</p>"},{"location":"design/cores/01-job%20queue/#432","title":"4.3.2 \u5b9e\u4f53\u5173\u7cfb\u5206\u6790","text":"<p>UnitManager-------------------------------+       |                                   |       |                                   |       +---------&gt;JobManager---------------+------------&gt;UnitDb--------------+                     |                                                       |                     +-&gt;JobTable(jobs)---+---&gt;JobUnitTable---&gt;JobUnit---&gt;Job-+-&gt;unit                     |                   ^                     |                   |                     +-&gt;JobTable(stage)--+</p> <p>\u76f8\u5173\u5185\u90e8\u5b9e\u4f53\u6982\u5ff5\u89e3\u91ca\u5982\u4e0b\uff1a 1\u3001JobManager \uff081\uff09\u6682\u5b58\u533a\uff08stage\uff09\uff1a \u7531\u4e8eunit\u4e4b\u95f4\u5b58\u5728\u914d\u7f6e\u4f9d\u8d56\u5173\u7cfb\uff0c\u5916\u90e8\u89e6\u53d1\u7684\u5355\u4e2a\u52a8\u4f5c\u4f1a\u8054\u52a8\u591a\u4e2a\u5176\u4ed6\u52a8\u4f5c\uff0c\u4e3a\u4e86\u4fdd\u969c\u6574\u4f53\u52a8\u4f5c\u7fa4\u7684\u5b8c\u6574\u6027\uff0c\u9700\u8981\u4e00\u4e2a\u6682\u5b58\u533a\u7528\u4e8e\u4e34\u65f6\u4fdd\u5b58\u5904\u7406\u65b0\u589e\u52a8\u4f5c\u7fa4\u3002\u5f85\u6574\u4f53\u52a8\u4f5c\u7fa4\u6821\u9a8c\u5904\u7406\u5b8c\u6bd5\u540e\u4f1a\u5408\u5e76\u5230\u6b63\u5f0f\u4ed3\u5e93\u4e2d\uff0c\u6682\u5b58\u533a\u5185\u5bb9\u4f1a\u88ab\u6e05\u9664\u3002</p> <p>2\u3001JobUnit \uff081\uff09\u5df2\u89e6\u53d1job\uff1a \u52a8\u4f5c\u5df2\u7ecf\u88ab\u89e6\u53d1\uff0c\u6b63\u5728\u6267\u884c\u4e2d\uff0c\u8fd8\u672a\u5b8c\u6210\u6574\u4f53\u52a8\u4f5c\u3002 \u4e00\u4e2aunit\u53ea\u80fd\u6709\u4e00\u4e2a\u5df2\u89e6\u53d1job\u3002 \u53ea\u5728\u6307\u5b9a\u60c5\u51b5\u4e0b\u624d\u53ef\u4ee5\u88ab\u6253\u65ad\uff08\u4f8b\u5916\u63cf\u8ff0\u89c1\u4e0b\uff09\uff0c\u5176\u4ed6\u60c5\u51b5\u4e2d\u4e0d\u80fd\u88ab\u5220\u9664\u3001\u4e0d\u80fd\u88ab\u6253\u65ad\uff0c\u53ea\u80fd\u7531unit\u4e1a\u52a1\u903b\u8f91\u81ea\u8eab\uff08\u901a\u8fc7\u901a\u544aunit\u72b6\u6001\u53d8\u8fc1\uff09\u7ec8\u7ed3\u3002 \u5220\u9664\u4f8b\u5916\u573a\u666f\uff1aunit\u5220\u9664\u3002 \u6253\u65ad\u4f8b\u5916\u573a\u666f\uff1a\u540e\u7eed\u9996\u4e2a\u672a\u89e6\u53d1\u52a8\u4f5c\u62e5\u6709\u505c\u6b62\u5c5e\u6027(stop or restart)\u3002 \u7ec4\u5408\u7c7b\u578b\u7531\u591a\u4e2a\u6807\u91cf\u7c7b\u578b\u52a8\u4f5c\u7ec4\u5408\u800c\u6210\uff0c\u5176\u4e2d\u6bcf\u4e2a\u7ec4\u5408\u7684\u6807\u91cf\u7c7b\u578b\u52a8\u4f5c\u540c\u5e38\u89c4\u6807\u91cf\u7c7b\u578b\u52a8\u4f5c\u4e00\u6837\uff0c\u5747\u9700\u8981\u7531unit\u4e1a\u52a1\u903b\u8f91\u7ec8\u7ed3\u3002\u6bcf\u5355\u4e2a\u7ec4\u5408\u6807\u91cf\u7c7b\u578b\u52a8\u4f5c\u5b8c\u6210\u540e\uff0c\u4f1a\u91cd\u65b0\u89e6\u53d1\u4e0b\u4e00\u4e2a\u7ec4\u5408\u6807\u91cf\u7c7b\u578b\u52a8\u4f5c\uff0c\u76f4\u81f3\u6240\u6709\u7ec4\u5408\u6807\u91cf\u7c7b\u578b\u52a8\u4f5c\u5b8c\u6210\u3002 \uff082\uff09\u672a\u89e6\u53d1job\uff1a \u52a8\u4f5c\u8fd8\u672a\u88ab\u89e6\u53d1\uff0c\u6b63\u5728\u7b49\u5f85\u5f15\u64ce\u8c03\u5ea6\u89e6\u53d1\u6267\u884c\u3002 \u4e00\u4e2aunit\u53ef\u80fd\u5b58\u5728\u591a\u4e2a\u672a\u89e6\u53d1job\uff0c\u8fd9\u4e9b\u672a\u89e6\u53d1job\u4ee5\u67d0\u79cd\u987a\u5e8f\u6392\u5217\uff0c\u7b49\u5f85\u5f15\u64ce\u4f9d\u5e8f\u89e6\u53d1\u3002 \u53ef\u4ee5\u88ab\u5220\u9664\u3001\u88ab\u5408\u5e76\u3002 \u4e0d\u540c\u7c7b\u578b\u52a8\u4f5c\u95f4\u6839\u636e\u89c4\u5219\u5b58\u5728\u51b2\u7a81\uff0c\u5f53\u51b2\u7a81\u53d1\u751f\u65f6\u6839\u636e\u52a8\u4f5c\u6a21\u5f0f\u8fdb\u884c\u5931\u8d25\u9000\u51fa\u6216\u8005\u66ff\u6362\u3002 \u6682\u505c+\u7ee7\u7eed\uff1ajob\u53ef\u4ee5\u6839\u636e\u914d\u7f6e\u7684\u65f6\u5e8f\u6216\u8005unit\u4e1a\u52a1\u903b\u8f91\u8981\u6c42\u88ab\u6682\u505c\uff0c\u4ee5\u7b49\u5f85\u5176\u4ed6\u6307\u5b9a\u4e8b\u52a1\u89e6\u53d1\u6216\u8005\u5b8c\u6210\uff0c\u7b49\u5f85\u6761\u4ef6\u6ee1\u8db3\u540e\u53ef\u4ee5\u7ee7\u7eed\u89e6\u53d1\u6267\u884c\u3002\u5df2\u89e6\u53d1job\u548c\u672a\u89e6\u53d1job\u5747\u53ef\u80fd\u88ab\u6682\u505c\u3002</p> <p>3\u3001Job \uff081\uff09\u7c7b\u578b\uff1a \u6839\u636e\u662f\u5426\u4f9d\u8d56unit\u72b6\u6001\u53ef\u4ee5\u5206\u4e3a\uff1a\u57fa\u7840\u7c7b\u578b\u3001\u590d\u5408\u7c7b\u578b\u3002 \u57fa\u7840\u7c7b\u578b\u6839\u636e\u662f\u5426\u7531\u5176\u4ed6\u7c7b\u578b\u52a8\u4f5c\u7ec4\u5408\u53ef\u4ee5\u5206\u4e3a\uff1a\u6807\u91cf\u7c7b\u578b\u3001\u7ec4\u5408\u7c7b\u578b\u3002 \u57fa\u7840\u7c7b\u578b\u6839\u636e\u662f\u5426\u6539\u53d8unit\u72b6\u6001\u53ef\u4ee5\u5206\u4e3a\uff1a\u53ef\u53d8\u7c7b\u578b\u3001\u4e0d\u53ef\u53d8\u7c7b\u578b\u3002</p>"},{"location":"design/cores/01-job%20queue/#433","title":"4.3.3 \u5b9e\u73b0\u5206\u6790","text":"<p>\u53c2\u89c1\u4f2a\u7801 exec: build changes in stage-&gt;commit stage to jobs-&gt;clear stage notify: build inputs -&gt; exec inputs</p>"},{"location":"design/cores/01-job%20queue/#44-job","title":"4.4 job\u6267\u884c\u5b9e\u73b0","text":""},{"location":"design/cores/01-job%20queue/#441","title":"4.4.1 \u8bbe\u8ba1\u601d\u8def","text":"<p>\u4ece\u4e4b\u524d\u7684\u603b\u4f53\u5206\u6790\u7ae0\u8282\u53ef\u77e5\uff0c\u6211\u4eec\u901a\u8fc7\u5f02\u6b65\u673a\u5236\u6765\u89e6\u53d1\u6267\u884cjob\uff0cjob\u89e6\u53d1unit\u6267\u884c\u52a8\u4f5c\u540e\u7b49\u5f85\uff0c\u6700\u7ec8\u7531unit\u624b\u52a8\u7ec8\u7ed3\u3002\u90a3\u4e48\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\uff0cjob\u5185\u90e8\u9700\u8981\u63a8\u8fdb\u6bcf\u4e2ajob\u7684\u53ef\u89e6\u53d1\u72b6\u6001\u3001\u89e6\u53d1\u72b6\u6001\u548c\u5b8c\u6210\u72b6\u6001\u3002\u6b64\u5916\uff0c\u7531\u4e8e\u5728\u63a7\u5236\u65f6\u5e8f\u4e2d\u91c7\u7528\u5bbd\u8fdb\u4e25\u51fa\u7684\u7b56\u7565\uff0c\u6211\u4eec\u9700\u8981\u53cd\u590d\u6539\u53d8job\u7684\u72b6\u6001\u3002\u5728job\u7684\u6267\u884c\u6d41\u7a0b\u4e2d\uff0c\u9664\u4e86\u6b63\u786e\u89e6\u53d1unit\u52a8\u4f5c\u5916\uff0c\u5176\u4e3b\u8981\u4efb\u52a1\u5c31\u662f\u6b63\u786e\u7684\u7ef4\u6301job\u7684\u5404\u79cd\u72b6\u6001\u3002</p>"},{"location":"design/cores/01-job%20queue/#442","title":"4.4.2 \u5b9e\u4f53\u5173\u7cfb\u5206\u6790","text":"<p>JobManager---------------------&gt;UnitDb-----------------------+   |  |                            ^                          |   |  |                            |                          |   |  +-&gt;JobTable(jobs)-------&gt;JobUnitTable---&gt;JobUnit---&gt;Job-+-&gt;unit   |   |   +----&gt;Events</p> <p>\u76f8\u5173\u5185\u90e8\u5b9e\u4f53\u6982\u5ff5\u89e3\u91ca\u5982\u4e0b\uff1a 1\u3001JobUnitTable \u5c31\u7eea\u961f\u5217\uff1a \u4fdd\u5b58\u7cfb\u7edf\u5185\u6240\u6709\u5df2\u5c31\u7eea\u7684unit\u53ca\u5bf9\u5e94\u5f85\u89e6\u53d1job\u6d88\u606f\uff0c\u5176\u4ee5unit\u53ca\u76f8\u5173\u5c5e\u6027\u4e3akey\u8fdb\u884c\u4f18\u5148\u7ea7\u6392\u5e8f\u3002 \u5355\u4e2aunit\u5185\u7684job\u53d8\u5316\u5747\u4f1a\u6539\u53d8unit\u7684\u5c31\u7eea\u72b6\u6001\uff0c\u4ece\u800c\u5f71\u54cd\u5c31\u7eea\u961f\u5217\u3002\u51fa\u4e8e\u6027\u80fd\u8003\u8651\uff0c\u5728\u6279\u91cf\u64cd\u4f5cjob\u65f6\u4f1a\u901a\u8fc7\u6807\u8bb0\u4f4d\u6765\u8bb0\u5f55\u4e2d\u95f4\u72b6\u6001\uff0c\u7b49\u5f85\u6240\u6709\u64cd\u4f5c\u5b8c\u6210\u540e\u7edf\u4e00\u540c\u6b65\u3002</p> <p>2\u3001JobUnit \u5c31\u7eea\uff1a \u5f53\u524d\u67d0\u4e2aunit\u4e2d\u5b58\u5728\u53ef\u4ee5\u6ee1\u8db3\u5c31\u7eea\u6761\u4ef6\u4e14\u53ef\u4ee5\u7acb\u5373\u89e6\u53d1\u6267\u884c\u7684job\u65f6\uff0c\u6b64unit\u7684\u72b6\u6001\u5373\u4e3a\u5c31\u7eea\u3002 \u88ab\u6682\u505c\u7684unit\u5904\u4e8e\u975e\u5c31\u7eea\u72b6\u6001\u3002 \u4e00\u4e2aunit\u5982\u679c\u5b58\u5728\u4e00\u4e2a\u5df2\u89e6\u53d1job\uff0c\u5728\u6b64\u5df2\u89e6\u53d1job\u5168\u90e8\u5b8c\u6210\u6216\u8005\u88ab\u6253\u65ad\u4e4b\u524d\uff0c\u6b64unit\u5904\u4e8e\u975e\u5c31\u7eea\u72b6\u6001\uff0c\u5176\u4ed6\u975e\u89e6\u53d1job\u53ea\u80fd\u7b49\u5f85\u3002</p> <p>3\u3001Job \u8fd0\u884c\u7c7b\u578b\uff1a\u5b9e\u9645\u89e6\u53d1unit\u52a8\u4f5c\u65f6\u751f\u6548\u7684\u7c7b\u578b\uff0c\u7528\u4e8e\u5206\u89e3\u7ec4\u5408\u7c7b\u578b\u3002</p>"},{"location":"design/cores/01-job%20queue/#443","title":"4.4.3 \u5b9e\u73b0\u5206\u6790","text":"<p>\u53c2\u89c1\u4f2a\u7801 loop -&gt; try to trigger something to run -&gt; try to finish it in two case: case 1. the job has been finished synchronously in context; case 2. the trigger is finished(failed or over); -...-&gt; nothing is triggered -&gt; break loop</p>"},{"location":"design/cores/01-job%20queue/#44-job_1","title":"4.4 job\u7ec8\u7ed3\u5b9e\u73b0","text":""},{"location":"design/cores/01-job%20queue/#441_1","title":"4.4.1 \u8bbe\u8ba1\u601d\u8def","text":"<p>job\u7ec8\u7ed3\u6db5\u76d6unit\u7ec8\u7ed3\u6267\u884c\u52a8\u4f5c\u548c\u53d6\u6d88\u52a8\u4f5c\uff0c\u4e8c\u8005\u5b58\u5728\u4e00\u5b9a\u7684\u76f8\u4f3c\uff0c\u4e5f\u5b58\u5728\u4e00\u5b9a\u7684\u5dee\u5f02\u3002\u5982\u4f55\u786e\u5b9a\u5171\u7528\u8303\u56f4\uff1f\u5176\u5206\u6790\u8fc7\u7a0b\u5982\u4e0b\uff1a \u4e1a\u52a1\u7279\u5f81\uff1a\u5728\u591a\u79cd\u573a\u666f\u4e2d\u4f1a\u7ec8\u7ed3\u4e1a\u52a1\u52a8\u4f5c\uff0c\u4e0d\u540c\u4e1a\u52a1\u573a\u666f\u4e2d\u7ec8\u7ed3\u4e1a\u52a1\u52a8\u4f5c\u65f6\u6240\u5b8c\u6210\u7684\u4e8b\u52a1\u5747\u6709\u5dee\u5f02\uff1a\uff08a\uff09\u4e3b\u52a8\u7ec8\u7ed3unit\u52a8\u4f5c[cancel/timeout/dependency/collect]\uff1b\uff08b\uff09\u89e6\u53d1unit\u52a8\u4f5c\u5931\u8d25[again + done/skip/invalid/assert/un-support/dependency/once/fail]\uff1b\uff08c\uff09unit\u52a8\u4f5c\u4e2d\u7ec8\u7ed3\u5bf9\u5e94unit\u52a8\u4f5c[done/fail]\uff1b\uff08d\uff09unit\u52a8\u4f5c\u4e2d\u7ec8\u7ed3\u4e0d\u5bf9\u5e94unit\u52a8\u4f5c[done/fail]\uff1b \u5b8c\u6210\u4e8b\u52a1\u540c\u7ec8\u7ed3\u4e1a\u52a1\u573a\u666f\u5bf9\u5e94\u5173\u7cfb\u4e3a\uff1a 1\u3001\u6b63\u5e38+\u5f02\u5e38\uff1a\u8bb0\u5f55\u7ed3\u679c+\u91ca\u653e\u81ea\u8eab\u8d44\u6e90\uff1b---a,b,c,d 2\u3001\u6b63\u5e38\uff1arestart\u7c7b\u578bjob\u91cd\u6fc0\u6d3b\uff1b---b,c,d 3\u3001\u5f02\u5e38\uff1a\u5173\u8054job\u56de\u9000\uff1b---a,b,c,d 4\u3001\u5f02\u5e38\uff1a\u975e\u5bf9\u5e94unit\u884c\u4e3a\u89e6\u53d1job\u53d8\u66f4\u573a\u666f\u4e2dunit\u72b6\u6001\u53d8\u8fc1\u4e8b\u4ef6\u6a21\u62df+\u901a\u544a\uff1b---a,b 5\u3001\u6b63\u5e38+\u5f02\u5e38\uff1a\u6267\u884c\u987a\u5e8f\u5173\u8054job\u91cd\u6fc0\u6d3b\uff1b---a,b,c,d 6\u3001\u975ejob\u89e6\u53d1unit\u884c\u4e3a\u573a\u666f\u4e2djob\u6a21\u62df+\u901a\u544a\uff1b---d 7\u3001unit\u72b6\u6001\u53d8\u8fc1\u4e8b\u4ef6\u901a\u544a\uff1b---c,d \u9009\u62e9\u601d\u8def\uff1a\u57fa\u4e8e\u4e1a\u52a1\u573a\u666f\u5b9a\u5236\u4e0d\u540c\u5904\u7406\u903b\u8f91\uff1f\u5408\u5e76\u5185\u90e8\u76f8\u540c\u5904\u7406\u903b\u8f91+\u57fa\u4e8e\u4e1a\u52a1\u573a\u666f\u5b9a\u5236\u6570\u636e\uff1f \u8003\u8651\u56e0\u7d20\uff1a\uff081\uff09\u529f\u80fd\uff0c\u53ef\u8986\u76d6\u7684\u4e1a\u52a1\u573a\u666f\uff1b\uff082\uff09\u67b6\u6784\uff0c\u6574\u4f53\u4ee3\u7801\u590d\u6742\u5ea6\uff1b \u91c7\u7528\u7b56\u7565\uff1a\u57fa\u4e8e\u4e1a\u52a1\u573a\u666f\u5b9a\u5236\u4e0d\u540c\u5904\u7406\u903b\u8f91{\u516c\u5171\u673a\u5236[\u52a8\u4f5c1,2,3,5] + \u573a\u666f\u5b9a\u5236[\u52a8\u4f5c4 | \u52a8\u4f5c6,7]} \u7ea6\u675f\uff1a\u57fa\u4e8e\u4e1a\u52a1\u573a\u666f\u5b9a\u5236\u4e0d\u540c\u5904\u7406\u903b\u8f91\u7684\u5178\u578b\u95ee\u9898\u662f\u5b9a\u5236\u5165\u53e3\u8fc7\u591a\u5bfc\u81f4\u673a\u5236\u590d\u6742\u6216\u8005\u91cd\u590d\u4ee3\u7801\u8fc7\u591a\uff0c\u5bf9\u5e94\u7684\u6539\u5584\u624b\u6bb5\u662f\u5212\u5b9a\u5408\u7406\u7684\u516c\u5171\u673a\u5236\u8303\u56f4\u3001\u5408\u7406\u7684\u7ec4\u5408\u5404\u4e1a\u52a1\u5b50\u573a\u666f\u7fa4\u3002</p>"},{"location":"design/cores/01-job%20queue/#442_1","title":"4.4.2 \u5b9e\u4f53\u5173\u7cfb\u5206\u6790","text":"<p>UnitManager-------------------------------+   |   |                                   |   |   |                                   |   |   +---------&gt;JobManager---------------+------------&gt;UnitDb--------------+   |                 |                                                       |   |                 +-&gt;JobTable(jobs)-------&gt;JobUnitTable---&gt;JobUnit---&gt;Job-+-&gt;unit---+\u2192DataManager---&gt;Table   |                                                                                   ^   |                                                                                   |   +-----------------------------------------------------------------------------------+</p> <p>\u76f8\u5173\u5185\u90e8\u5b9e\u4f53\u6982\u5ff5\u89e3\u91ca\u5982\u4e0b\uff1a 1\u3001JobManager \u4e0a\u4e0b\u6587\uff1a\u7531\u4e8ejob\u53ef\u80fd\u4f1a\u88abunit\u4e1a\u52a1\u903b\u8f91\u5728\u89e6\u53d1\u6d41\u7a0b\u4e2d\u540c\u6b65\u7ec8\u7ed3\uff0c\u4e3a\u4e86\u907f\u514djob\u7684\u8fd0\u884c\u6d41\u7a0b\u548c\u7ec8\u7ed3\u6d41\u7a0b\u5b58\u5728\u4ea4\u96c6\uff0c\u9700\u8981\u5efa\u7acb\u4e00\u4e2a\u540c\u6b65\u7ec8\u7ed3\u4e0a\u4e0b\u6587\u7528\u4e8e\u4e34\u65f6\u4fdd\u5b58\u7ec8\u7ed3\u4fe1\u606f\u3002\u8fd9\u6837unit\u4e1a\u52a1\u903b\u8f91\u540c\u6b65\u7ec8\u7ed3\u6d41\u7a0b\u4e2d\u5b9e\u9645\u4e0a\u4e0d\u505a\u7ec8\u7ed3\u5904\u7406\uff0c\u5f85job\u8fd0\u884c\u6d41\u7a0b\u7ed3\u675f\u540e\u4f1a\u91cd\u65b0\u5904\u7406\u7ec8\u7ed3\u4e0a\u4e0b\u6587\u4e2d\u8bb0\u5f55\u7684\u7ec8\u7ed3\u4fe1\u606f\uff0c\u5904\u7406\u5b8c\u6210\u540e\u4e0a\u4e0b\u6587\u4fe1\u606f\u4f1a\u88ab\u6e05\u9664\u3002</p> <p>2\u3001Table \u63d0\u4f9b\u6570\u636e\u5b58\u50a8\u548c\u6570\u636e\u53d8\u66f4\u901a\u544a\u8ba2\u9605\u80fd\u529b\uff0c\u7528\u6765\u6253\u65ad\u4e1a\u52a1\u903b\u8f91\u65e0\u5173\u4f46\u5b58\u5728\u6570\u636e\u5173\u8054\u7684\u5faa\u73af\u3002</p>"},{"location":"design/cores/01-job%20queue/#443_1","title":"4.4.3 \u5b9e\u73b0\u5206\u6790","text":"<p>\u53c2\u89c1\u4f2a\u7801 try_finish: (synchronous)finish in context -&gt; record and wait -&gt; (asynchronous)finish not in context -&gt; judgement -&gt; delete itself -&gt; remove relational jobs on failure -&gt; simulate job events -&gt; start on previous result remove: delete itself -&gt; remove relational jobs on failure -&gt; simulate and notify unit events</p>"},{"location":"design/cores/01-job%20queue/#44-job_2","title":"4.4 job\u67e5\u627e\u5b9e\u73b0","text":""},{"location":"design/cores/01-job%20queue/#441_2","title":"4.4.1 \u8bbe\u8ba1\u601d\u8def","text":"<p>job\u5728job\u5f15\u64ce\u5185\u90e8\u6709\u4e24\u79cd\u4fdd\u5b58\u65b9\u5f0f\uff1a\u7b2c\u4e00\uff0c\u57fa\u4e8e\u552f\u4e00\u7684id\u4fdd\u5b58\uff1b\u7b2c\u4e8c\uff0c\u57fa\u4e8eunit\u4fdd\u5b58\u3002\u5728\u57fa\u4e8eunit\u4fdd\u5b58\u7684\u573a\u666f\u4e2d\uff0c\u5355\u4e2aunit\u53ef\u4ee5\u5b58\u57281\u4e2a\u5df2\u89e6\u53d1job\u548c\u591a\u4e2a\u672a\u89e6\u53d1job\uff0c\u5176\u4e2d\u591a\u4e2a\u672a\u89e6\u53d1job\u7684unit-type\u552f\u4e00\u3002\u6211\u4eec\u57fa\u4e8e\u8fd9\u4e9b\u7ec4\u7ec7\u65b9\u5f0f\u5411\u5916\u63d0\u4f9b\u67e5\u8be2\u80fd\u529b\uff0c\u5305\u62ec\u57fa\u4e8eid\u7684\u67e5\u8be2\u548c\u57fa\u4e8eunit+\u89e6\u53d1\u72b6\u6001+unit-type\u7684\u67e5\u8be2\u3002</p>"},{"location":"design/cores/01-job%20queue/#442_2","title":"4.4.2 \u5b9e\u4f53\u5173\u7cfb\u5206\u6790","text":"<p>JobManager     |     |     +-&gt;JobTable(jobs)-------&gt;JobUnitTable---&gt;JobUnit---&gt;Job---&gt;unit</p>"},{"location":"design/cores/01-job%20queue/#443_2","title":"4.4.3 \u5b9e\u73b0\u5206\u6790","text":"<p>\u53c2\u89c1\u4f2a\u7801 get_xxx: just lookup it</p>"},{"location":"design/cores/01-job%20queue/#5-function-safety","title":"5 \u53ef\u9760\u6027/\u53ef\u7528\u6027/Function Safety\u8bbe\u8ba1","text":"<p>NA</p>"},{"location":"design/cores/01-job%20queue/#6","title":"6 \u5b89\u5168/\u9690\u79c1/\u97e7\u6027\u8bbe\u8ba1","text":"<p>NA</p>"},{"location":"design/cores/01-job%20queue/#7","title":"7 \u6570\u636e\u7ed3\u6784\u8bbe\u8ba1(\u53ef\u9009)","text":"<p>NA</p>"},{"location":"design/cores/01-job%20queue/#8","title":"8 \u5176\u4ed6","text":"<p>NA</p>"},{"location":"design/cores/01-job%20queue/#9","title":"9 \u53c2\u8003\u8d44\u6599","text":"<p>NA</p>"},{"location":"design/cores/01-service/","title":"service\u8bbe\u8ba1\u6587\u6863","text":""},{"location":"design/cores/01-service/#1","title":"1    \u6982\u8ff0","text":"<p>service\u662f\u5f53\u524dunit\u7c7b\u578b\u7684\u4e00\u79cd\uff0c\u7528\u6765\u542f\u52a8\u5bf9\u5e94\u7684\u670d\u52a1\uff0c \u662f\u670d\u52a1\u7ba1\u7406\u6700\u4e3b\u8981\u7684\u4e00\u79cd\u3002</p>"},{"location":"design/cores/01-service/#11","title":"1.1    \u76ee\u7684","text":"<p>service\u6a21\u5757\u4e3b\u8981\u7528\u6765\u5b9e\u73b0\u670d\u52a1\u7684\u542f\u52a8\uff0c\u5b9e\u73b0\u670d\u52a1\u7684\u7ba1\u7406\u5982\u542f\u52a8\u3001\u505c\u6b62\u3001\u91cd\u542f\u7b49\u3002</p>"},{"location":"design/cores/01-service/#2","title":"2    \u7279\u6027\u9700\u6c42\u6982\u8ff0","text":"<p>\u88681\uff1a\u7279\u6027\u9700\u6c42\u5217\u8868</p> \u9700\u6c42\u7f16\u53f7 \u9700\u6c42\u540d\u79f0 \u7279\u6027\u63cf\u8ff0 \u4f18\u5148\u7ea7 1 Simple \u542f\u52a8\u670d\u52a1\u65f6forking\u5373\u8ba4\u4e3a\u670d\u52a1\u5df2\u7ecf\u542f\u52a8\u5b8c\u6210 \u9ad8 2 Forking sysmaster fork\u7684\u5b50\u8fdb\u7a0b\u4e3a\u7ba1\u7406\u8fdb\u7a0b\uff0c \u7ba1\u7406\u8fdb\u7a0b\u9000\u51fa\u670d\u52a1\u542f\u52a8\u6210\u529f\uff0c \u901a\u8fc7pid_file\u4f20\u9012\u8fdb\u7a0bid \u9ad8 3 Notify \u670d\u52a1\u4e3b\u52a8\u901a\u544a\u5b50\u8fdb\u7a0b\u7684\u72b6\u6001\u7ed9sysmaster \u9ad8 4 Oneshot \u62c9\u8d77\u7684\u670d\u52a1\u9000\u51fa\u4e4b\u540e\u5373\u8ba4\u4e3a\u670d\u52a1\u542f\u52a8\u5b8c\u6210 \u9ad8"},{"location":"design/cores/01-service/#3","title":"3    \u9700\u6c42\u573a\u666f\u5206\u6790","text":""},{"location":"design/cores/01-service/#31","title":"3.1    \u7279\u6027\u9700\u6c42\u6765\u6e90\u4e0e\u4ef7\u503c\u6982\u8ff0","text":"<p>service\u662f\u670d\u52a1\u7ba1\u7406\u7684\u4e3b\u8981\u5b9e\u73b0\uff0c \u7528\u4e8e\u5b9e\u73b0\u8fdb\u7a0b\u6216\u5e94\u7528\u7684\u62c9\u8d77\u3001\u505c\u6b62\u3001\u91cd\u542f\u7b49\u529f\u80fd\u3002</p>"},{"location":"design/cores/01-service/#32","title":"3.2    \u7279\u6027\u573a\u666f\u5206\u6790","text":"<p>\u9700\u8981\u62c9\u8d77\u8fdb\u7a0b\u6216\u5e94\u7528\u65f6\u4f7f\u7528\u3002</p>"},{"location":"design/cores/01-service/#33","title":"3.3    \u7279\u6027\u5f71\u54cd\u5206\u6790","text":""},{"location":"design/cores/01-service/#4","title":"4    \u7279\u6027/\u529f\u80fd\u5b9e\u73b0\u539f\u7406","text":""},{"location":"design/cores/01-service/#41","title":"4.1    \u603b\u4f53\u65b9\u6848","text":"<p>\u6574\u4e2a\u7279\u6027\u5305\u542b9\u4e2a\u6a21\u5757\uff0c\u5305\u62ecservice_base\u3001service_comm\u3001service_config\u3001service_mng\u3001service_spawn\u3001service_pid\u3001service_unit</p> <ol> <li> <p>service_base\uff1a\u57fa\u7840\u6570\u636e\u7ed3\u6784\u7684\u5b9a\u4e49\u3002</p> </li> <li> <p>service_comm\uff1a\u5305\u62ec\u516c\u5171\u6570\u636e\u7ed3\u6784\u7684\u5f15\u7528\uff0c\u5f53\u524d\u5305\u542bUnitManager\u548cUnit\u7684\u5f15\u7528\u3002</p> </li> <li> <p>service_config\uff1a\u5b9e\u73b0service\u914d\u7f6e\u6587\u4ef6\u7684\u6570\u636e\u7ed3\u6784\u5b9a\u4e49\u548c\u8f6c\u6362\u3002</p> </li> <li> <p>service_mng\uff1a \u5b9e\u73b0service\u542f\u52a8\u6d41\u7a0b\u7684\u72b6\u6001\u8f6c\u6362\u3002</p> </li> <li> <p>service_spawn\uff1a\u5b9e\u73b0service\u6267\u884ccmd\u7684\u5165\u53e3\u3002</p> </li> <li> <p>service_pid\uff1a\u5b9e\u73b0service pid\u7684\u7ba1\u7406\u3002</p> </li> <li> <p>service_unit\uff1a\u5b9e\u73b0socket\u5b50\u7c7b\u578b\u7684\u5b9a\u4e49\uff0c \u5b9e\u73b0UnitObj\u3001UnitSubClass\u3001UnitMngUtil\u4e09\u4e2atrait\u3002</p> </li> </ol>"},{"location":"design/cores/01-service/#42-service","title":"4.2    service\u72b6\u6001\u8f6c\u6362\u56fe","text":"<pre><code>\u72b6\u6001\u8f6c\u6362\u5305\u62ec\u5b50\u7c7b\u5185\u90e8\u7684\u72b6\u6001\u8f6c\u6362\u4ee5\u53caunit\u6574\u4f53\u7684\u72b6\u6001\u8f6c\u6362\uff0c\u5177\u4f53\u7684\u5bf9\u5e94\u5173\u7cfb\u5982\u56fe\u4e2d\u6240\u793a\u3002\n</code></pre>"},{"location":"design/cores/01-service/#43-service_forking","title":"4.3    service_forking\u542f\u52a8\u8bbe\u8ba1","text":"<p>\u542f\u52a8\u7c7b\u578b\u4e3aforking\u6a21\u5f0f\u65f6\uff0c sysmaster fork\u51fa\u6765\u7684\u5b50\u8fdb\u7a0b\u4e3a\u4e2d\u95f4\u7ba1\u7406\u8fdb\u7a0b\uff0c\u4e2d\u95f4\u7ba1\u7406\u8fdb\u7a0b\u9000\u51fa\u8ba4\u4e3a\u670d\u52a1\u542f\u52a8\u5b8c\u6210\uff0c \u4e2d\u95f4\u7ba1\u7406\u8fdb\u7a0b \u9000\u51fa\u540e\u518d\u542f\u52a8\u5bf9\u5e94\u7684\u4e3b\u8fdb\u7a0b\u3002</p>"},{"location":"design/cores/01-service/#44-service_notify","title":"4.4    service_notify\u542f\u52a8\u8bbe\u8ba1","text":"<ol> <li> <p>sysmaster\u542f\u52a8inotify\u76d1\u542c\u5957\u63a5\u5b50\uff0c \u5e76\u5c06unix\u5957\u63a5\u5b50\u7684\u8def\u5f84\u4f20\u9012\u7ed9\u5b50\u8fdb\u7a0b\u3002</p> </li> <li> <p>\u5b50\u8fdb\u7a0b\u901a\u8fc7unix\u5957\u63a5\u5b50\u901a\u544a\u72b6\u6001\u7ed9sysmaster\u3002</p> </li> </ol>"},{"location":"design/cores/01-service/#45","title":"4.5    \u7279\u6027\u4e0b\u7684\u975e\u529f\u80fd\u9700\u6c42\u8bbe\u8ba1","text":"<p>NA</p>"},{"location":"design/cores/01-service/#5function-safety","title":"5\u53ef\u9760\u6027/\u53ef\u7528\u6027/Function Safety\u8bbe\u8ba1","text":"<p>NA</p>"},{"location":"design/cores/01-service/#6","title":"6    \u5b89\u5168/\u9690\u79c1/\u97e7\u6027\u8bbe\u8ba1","text":"<p>NA</p>"},{"location":"design/cores/01-service/#7","title":"7    \u7279\u6027\u975e\u529f\u80fd\u6027\u8d28\u91cf\u5c5e\u6027\u76f8\u5173\u8bbe\u8ba1","text":"<p>NA</p>"},{"location":"design/cores/01-service/#8","title":"8    \u6570\u636e\u7ed3\u6784\u8bbe\u8ba1\uff08\u53ef\u9009\uff09","text":"<p>\u672c\u7ae0\u8282\u5b8c\u6210\u6570\u636e\u5e93\u7ed3\u6784\u7684\u8bbe\u8ba1\uff08\u6570\u636e\u5e93\u8868\u7ed3\u6784\uff0c\u53ef\u4ee5\u4f7f\u7528Power Designer\u5b8c\u6210\uff09\uff0c\u53ef\u9009\u7ae0\u8282\u3002</p>"},{"location":"design/cores/01-service/#9","title":"9    \u8bcd\u6c47\u8868","text":"<p>NA</p>"},{"location":"design/cores/01-service/#10","title":"10   \u5176\u5b83\u8bf4\u660e","text":"<p>NA</p>"},{"location":"design/cores/01-service/#11_1","title":"11   \u53c2\u8003\u8d44\u6599\u6e05\u5355","text":"<p>NA</p>"},{"location":"design/cores/01-socket/","title":"Socket\u8bbe\u8ba1\u8bf4\u660e\u4e66","text":""},{"location":"design/cores/01-socket/#1","title":"1    \u6982\u8ff0","text":"<p>socket\u662f\u5f53\u524dunit\u7c7b\u578b\u7684\u4e00\u79cd\uff0c\u7528\u6765\u521b\u5efasocket\u5957\u63a5\u5b57\u3002</p>"},{"location":"design/cores/01-socket/#11","title":"1.1    \u76ee\u7684","text":"<p>socket\u6a21\u5757\u4e3b\u8981\u7528\u6765\u5b9e\u73b0\u670d\u52a1\u7684\u5ef6\u8fdf\u542f\u52a8\uff0csocket\u4f18\u5148\u542f\u52a8\uff0c\u5f53\u5bf9\u5e94\u7684socket\u6536\u5230EPOLL_IN\u4e8b\u4ef6\u65f6\uff0c \u89e6\u53d1\u5bf9\u5e94\u7684service\u670d\u52a1\u542f\u52a8\u3002</p>"},{"location":"design/cores/01-socket/#2","title":"2    \u7279\u6027\u9700\u6c42\u6982\u8ff0","text":"<p>\u88681\uff1a\u7279\u6027\u9700\u6c42\u5217\u8868</p> \u9700\u6c42\u7f16\u53f7 \u9700\u6c42\u540d\u79f0 \u7279\u6027\u63cf\u8ff0 \u4f18\u5148\u7ea7 1 Stream\u7c7b\u578b\u5957\u63a5\u5b57 \u652f\u6301\u521b\u5efaStream\u7c7b\u578b\u7684\u5957\u63a5\u5b57\uff0c\u540c\u65f6\u652f\u6301IPv4\u548cIPv6\u3002 \u9ad8 2 Datagram\u7c7b\u578b\u5957\u63a5\u5b57 \u652f\u6301\u521b\u5efaDatagram\u7c7b\u578b\u7684\u5957\u63a5\u5b57\uff0c \u540c\u65f6\u652f\u6301IPv4\u548cIPv6 \u9ad8 3 Netlink\u7c7b\u578b\u5957\u63a5\u5b57 \u652f\u6301\u521b\u5efaNetlink\u7c7b\u578b\u7684\u5957\u63a5\u5b57 \u9ad8"},{"location":"design/cores/01-socket/#3","title":"3    \u9700\u6c42\u573a\u666f\u5206\u6790","text":""},{"location":"design/cores/01-socket/#31","title":"3.1    \u7279\u6027\u9700\u6c42\u6765\u6e90\u4e0e\u4ef7\u503c\u6982\u8ff0","text":"<p>socket\u7c7b\u578b\u7528\u6765\u521b\u5efa\u5957\u63a5\u5b57\uff0c\u4e0eservice\u89e3\u8026\uff0c \u53ef\u4ee5\u5355\u72ec\u542f\u52a8\uff0c\u5f53socket\u6709\u5bf9\u5e94\u7684EPOLL_IN\u4e8b\u4ef6\u65f6\u5019\uff0c\u89e6\u53d1\u542f\u52a8\u5bf9\u5e94\u7684service\u6587\u4ef6\uff0c\u4ece\u800c\u63d0\u5347\u670d\u52a1\u7684\u542f\u52a8\u901f\u5ea6\u3002</p>"},{"location":"design/cores/01-socket/#32","title":"3.2    \u7279\u6027\u573a\u666f\u5206\u6790","text":"<p>\u5f53service\u4f7f\u7528\u5230socket\u5957\u63a5\u5b57\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528\u8be5\u7279\u6027\uff0c\u5b9e\u73b0socket\u4e0eservice\u7684\u5e76\u53d1\u542f\u52a8\u3002</p>"},{"location":"design/cores/01-socket/#33","title":"3.3    \u7279\u6027\u5f71\u54cd\u5206\u6790","text":"<p>\u6bcf\u4e00\u4e2asocket\u6587\u4ef6\u9700\u8981\u6709\u4e00\u4e2a\u5bf9\u5e94\u7684service\u914d\u7f6e\u6587\u4ef6\u3002</p>"},{"location":"design/cores/01-socket/#34","title":"3.4    \u53cb\u5546\u5b9e\u73b0\u65b9\u6848\u5206\u6790","text":"\u53cb\u5546 \u7279\u70b9 Systemd \u5f53\u524d\u652f\u6301socket\u7c7b\u578b\u66f4\u591a"},{"location":"design/cores/01-socket/#4","title":"4    \u7279\u6027/\u529f\u80fd\u5b9e\u73b0\u539f\u7406","text":""},{"location":"design/cores/01-socket/#41","title":"4.1    \u603b\u4f53\u65b9\u6848","text":"<p>\u6574\u4e2a\u7279\u6027\u5305\u542b9\u4e2a\u6a21\u5757\uff0c\u5305\u62ecsocket_base\u3001socket_comm\u3001socket_config\u3001socket_mng\u3001socket_load\u3001socket_spawn\u3001socket_pid\u3001socket_port\u3001socket_unit</p> <ol> <li> <p>socket_base\uff1a\u57fa\u7840\u6570\u636e\u7ed3\u6784\u7684\u5b9a\u4e49\u3002</p> </li> <li> <p>socket_comm\uff1a\u5305\u62ec\u516c\u5171\u6570\u636e\u7ed3\u6784\u7684\u5f15\u7528\uff0c\u5f53\u524d\u5305\u542bUnitManager\u548cUnit\u7684\u5f15\u7528\u3002</p> </li> <li> <p>socket_config\uff1a\u5b9e\u73b0socket\u914d\u7f6e\u6587\u4ef6\u7684\u6570\u636e\u7ed3\u6784\u5b9a\u4e49\u548c\u8f6c\u6362\u3002</p> </li> <li> <p>socket_mng\uff1a \u5b9e\u73b0socket\u542f\u52a8\u6d41\u7a0b\u7684\u72b6\u6001\u8f6c\u6362\u3002</p> </li> <li> <p>socket_load\uff1a\u5b9e\u73b0socket_config\u914d\u7f6e\u7684\u89e3\u6790\u3002</p> </li> <li> <p>socket_spawn\uff1a\u5b9e\u73b0socket\u6267\u884ccmd\u7684\u5165\u53e3\u3002</p> </li> <li> <p>socket_pid\uff1a\u5b9e\u73b0socket\u5185\u90e8pid\u7684\u7ba1\u7406\u3002</p> </li> <li> <p>socket_port\uff1a\u5b9e\u73b0socket\u5957\u63a5\u5b57\u7684\u7ba1\u7406\u3002</p> </li> <li> <p>socket_unit\uff1a\u5b9e\u73b0socket\u5b50\u7c7b\u578b\u7684\u5b9a\u4e49\uff0c \u5b9e\u73b0UnitObj\u3001UnitSubClass\u3001UnitMngUtil\u4e09\u4e2atrait\u3002</p> </li> </ol>"},{"location":"design/cores/01-socket/#42-socket","title":"4.2    socket\u72b6\u6001\u8f6c\u6362\u56fe","text":"<pre><code>\u72b6\u6001\u8f6c\u6362\u5305\u62ec\u5b50\u7c7b\u5185\u90e8\u7684\u72b6\u6001\u8f6c\u6362\u4ee5\u53caunit\u6574\u4f53\u7684\u72b6\u6001\u8f6c\u6362\uff0c\u5177\u4f53\u7684\u5bf9\u5e94\u5173\u7cfb\u5982\u56fe\u4e2d\u6240\u793a\u3002\n</code></pre>"},{"location":"design/cores/01-socket/#43-socket_load","title":"4.3    socket_load\u6a21\u5757\u8bbe\u8ba1","text":"<pre><code>socket_load\u6a21\u5757\u8d1f\u8d23Socket Section\u5b57\u6bb5\u7684\u89e3\u6790\u3002\u9664\u4e86\u5b57\u6bb5\u7684\u89e3\u6790\u4e4b\u5916\uff0c \u8fd8\u8981\u5efa\u7acbsocket\u4e0e\u5bf9\u5e94\u7684service\u7684\u5bf9\u5e94\u7684\u5173\u7cfb\u3002\n</code></pre> <p>\u5177\u4f53\u7684\u6d41\u7a0b\u89c1\u4e0a\u56fe\u3002</p>"},{"location":"design/cores/01-socket/#44-socket_start","title":"4.4    socket_start\u6a21\u5757\u8bbe\u8ba1","text":"<pre><code>socket\u7684start\u4e3b\u8981\u5206\u4e3a\u4e24\u6b65\uff1a\n</code></pre> <ol> <li> <p>\u521b\u5efa\u5bf9\u5e94\u7684socket\u5957\u63a5\u5b57\uff0c \u5e76\u76d1\u542c\u3002</p> </li> <li> <p>socket\u63a5\u6536EPOLL_IN\u4e8b\u4ef6\uff0c \u542f\u52a8\u5bf9\u5e94\u7684service.</p> </li> </ol>"},{"location":"design/cores/01-socket/#45","title":"4.5    \u7279\u6027\u4e0b\u7684\u975e\u529f\u80fd\u9700\u6c42\u8bbe\u8ba1","text":"<p>NA</p>"},{"location":"design/cores/01-socket/#5-function-safety","title":"5    \u53ef\u9760\u6027/\u53ef\u7528\u6027/Function Safety\u8bbe\u8ba1","text":"<p>NA</p>"},{"location":"design/cores/01-socket/#6","title":"6    \u5b89\u5168/\u9690\u79c1/\u97e7\u6027\u8bbe\u8ba1","text":"<p>NA</p>"},{"location":"design/cores/01-socket/#7","title":"7    \u7279\u6027\u975e\u529f\u80fd\u6027\u8d28\u91cf\u5c5e\u6027\u76f8\u5173\u8bbe\u8ba1","text":"<p>NA</p>"},{"location":"design/cores/01-socket/#8","title":"8    \u6570\u636e\u7ed3\u6784\u8bbe\u8ba1\uff08\u53ef\u9009\uff09","text":"<p>\u672c\u7ae0\u8282\u5b8c\u6210\u6570\u636e\u5e93\u7ed3\u6784\u7684\u8bbe\u8ba1\uff08\u6570\u636e\u5e93\u8868\u7ed3\u6784\uff0c\u53ef\u4ee5\u4f7f\u7528Power Designer\u5b8c\u6210\uff09\uff0c\u53ef\u9009\u7ae0\u8282\u3002</p>"},{"location":"design/cores/01-socket/#9","title":"9    \u8bcd\u6c47\u8868","text":"<p>NA</p>"},{"location":"design/cores/01-socket/#10","title":"10   \u5176\u5b83\u8bf4\u660e","text":"<p>NA</p>"},{"location":"design/cores/01-socket/#11_1","title":"11   \u53c2\u8003\u8d44\u6599\u6e05\u5355","text":"<p>NA</p>"},{"location":"design/cores/01-unit/","title":"Unit\u8bbe\u8ba1\u8bf4\u660e\u4e66","text":""},{"location":"design/cores/01-unit/#1","title":"1    \u6982\u8ff0","text":"<p>unit\u662f\u6240\u6709sysmaster\u7ba1\u7406\u7684subunit\u7684\u57fa\u7840\uff0csysmaster\u901a\u8fc7\u914d\u7f6e\u6587\u4ef6\u6765\u5b9a\u4e49\u6bcf\u4e2a\u5177\u4f53subunit\u5b9e\u4f8b\u7684\u884c\u4e3a\uff0cunit\u8d1f\u8d23\u51fa\u6240\u6709subunit\u8fd0\u884c\u65f6\u529f\u80fd\u884c\u4e3a\u7684\u5b9a\u4e49\uff0c\u4ee5\u53ca\u8bbe\u7f6e\u4e3a\u5f00\u673a\u81ea\u52a8\u65f6\u9700\u8981\u7684\u4fe1\u606f</p>"},{"location":"design/cores/01-unit/#_1","title":"\u76ee\u7684","text":"<p>\u672c\u6587\u7528\u63cf\u8ff0unit\u652f\u6301\u7684\u5c5e\u6027\uff08\u901a\u8fc7\u914d\u7f6e\u6587\u4ef6\u5b9a\u4e49\uff09\uff0c\u5e76\u6e05\u6670\u63cf\u8ff0\u6bcf\u4e2a\u5b9a\u4e49\u7684\u914d\u7f6e\u6587\u4ef6\u7684\u5177\u4f53\u76ee\u7684\uff0c\u548c\u4f7f\u7528\u7684\u573a\u666f\u3002\u5e76\u8bb0\u5f55unit\u6bcf\u4e2a\u914d\u7f6e\u6f14\u8fdb\u8fc7\u7a0b\u3002</p>"},{"location":"design/cores/01-unit/#2","title":"2    \u7279\u6027\u9700\u6c42\u6982\u8ff0","text":"<p>\u88681\uff1a\u7279\u6027\u9700\u6c42\u5217\u8868</p> \u9700\u6c42\u7f16\u53f7 \u9700\u6c42\u540d\u79f0 \u7279\u6027\u63cf\u8ff0 \u4f18\u5148\u7ea7 1 \u652f\u6301unit\u57fa\u672c\u529f\u80fd\u5b9a\u4e49 \u652f\u6301\u5b9a\u4e49unit\u8fd0\u884c\u65f6\u516c\u5171\u884c\u4e3a\u7684\u5b9a\u4e49 \u9ad8 2 \u652f\u6301unit\u8bbe\u7f6e\u4e3a\u5f00\u673a\u542f\u52a8\u529f\u80fd\u5b9a\u4e49 \u5b9a\u4e49unit\u8bbe\u7f6e\u4e3a\u5f00\u673a\u65f6\uff0c\u9700\u8981\u6267\u884c\u7684\u52a8\u4f5c \u9ad8"},{"location":"design/cores/01-unit/#3","title":"3    \u9700\u6c42\u573a\u666f\u5206\u6790","text":"<p>sysmaster\u901a\u8fc7unit\u7ba1\u7406\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u5404\u7c7b\u670d\u52a1\u7684\u751f\u547d\u5468\u671f\uff0c\u6bcf\u7c7b\u670d\u52a1\u8fd0\u884c\u65f6\u9700\u8981\u6267\u884c\u751f\u547d\u7c7b\u578b\u7684\u64cd\u4f5c\uff0c\u901a\u8fc7\u914d\u7f6e\u6587\u4ef6\u6765\u8fdb\u884c\u5b9a\u4e49\uff0c\u5bf9\u516c\u5171\u7684\u884c\u4e3a\u8fdb\u884c\u540c\u4e00\u7684\u5b9a\u4e49\uff0c\u5c06\u91cd\u590d\u5de5\u4f5c\u964d\u5230\u6700\u4f4e\uff0c\u6b64\u90e8\u5206\u9700\u6c42\u5206\u6790\uff0c\u9700\u8981\u7ed3\u5408\u7cfb\u7edf\u7ef4\u62a4\u8fc7\u7a0b\u4e2d\u7ecf\u5e38\u7528\u5230\u7684\u5c5e\u6027\uff0c\u5e76\u9700\u8981\u8003\u8651\u548csystemd\u517c\u5bb9\u7684\u517c\u5bb9\u6027</p>"},{"location":"design/cores/01-unit/#32","title":"3.2    \u7279\u6027\u573a\u666f\u5206\u6790","text":"<p>\u7cfb\u7edf\u4e2d\u7684\u670d\u52a1\u6267\u884c\u7684\u4e3b\u8981\u52a8\u4f5c\u5305\u542bload\u3001reload\u3001start\u3001restart\u3001stop\u5e76\u4e14\u8fd8\u9700\u8981\u652f\u6301\u5bf9\u4e8e\u5177\u4f53\u670d\u52a1\u72b6\u6001\u7684\u67e5\u8be2\uff0cunit\u516c\u5171\u5c5e\u6027\u7528\u4e8e\u5b9a\u4e49unit\u6267\u884c\u5177\u4f53\u52a8\u4f5c\u662f\u7684\u884c\u4e3a\uff0c\u5e76\u4e14unit\u652f\u6301\u4e00\u4e9b\u8fd0\u884c\u65f6\u7684\u4f9d\u8d56\u5173\u7cfb\uff0c\u4e5f\u9700\u8981\u5728unit\u914d\u7f6e\u6587\u4ef6\u4e2d\u8fdb\u884c\u5b9a\u4e49\uff0c\u53c2\u8003\u65e5\u5e38\u4f7f\u7528\u60c5\u51b5\uff0c\u4ee5\u53ca\u517c\u5bb9\u6027\u8003\u8651\uff0cunit\u516c\u5171\u5c5e\u6027\u5206\u6210\u4e24\u4e2a\u90e8\u5206\uff1a</p> <ol> <li>[Base]</li> </ol> \u914d\u7f6e\u540d\u79f0 \u503c\u7c7b\u578b \u914d\u7f6e\u9879\u8bf4\u660e \u4f7f\u7528\u573a\u666f \u4f18\u5148\u7ea7 \u662f\u5426\u652f\u6301 \u5bb9\u5668 \u865a\u673a \u7269\u7406\u673a Description String unit\u7684\u63cf\u8ff0\uff0c\u7528\u4e8e\u8bf4\u660eunit\u7684\u529f\u80fd \u4f7f\u7528sctl\u547d\u4ee4\u67e5\u8be2unit\u4fe1\u606f\u65f6\u7528\u4e8e\u663e\u793a \u9ad8 \u662f \u221a \u221a \u221a Documentation String \u914d\u7f6e\u5177\u4f53\u670d\u52a1\u7684\u5e2e\u52a9\u6587\u6863 \u663e\u793a\u914d\u7f6e\u7684\u5e2e\u52a9\u6587\u6863 \u4f4e \u5426 \u221a \u221a \u221a Requires String \u53ef\u4ee5\u914d\u7f6e\u591a\u4e2a\uff0c\u4e4b\u95f4\u4f7f\u7528\u7a7a\u683c\u9694\u5f00 \u914d\u7f6e\u4f9d\u8d56\u7684\u5176\u4ed6unit\uff0c\u5e76\u652f\u6301\u540c\u6b65\u542f\u52a8\uff0cunit\u5982\u679c\u72b6\u6001\"failed\"\uff0c\u5219\u6b64\u5355\u5143\u542f\u52a8\u5931\u8d25 \u9ad8 \u662f \u221a \u221a \u221a Wants String \u53ef\u4ee5\u914d\u7f6e\u591a\u4e2a\uff0c\u4e4b\u95f4\u4f7f\u7528\u7a7a\u683c\u9694\u5f00 require\u5f31\u5316\u7248\u672c\uff0c\u4e0d\u53d7\u88ab\u4f9d\u8d56\u5355\u5143\u7684\u542f\u52a8\u72b6\u6001\u5f71\u54cd \u9ad8 \u662f \u221a \u221a \u221a Before String \u53ef\u4ee5\u914d\u7f6e\u591a\u4e2a\uff0c\u4e4b\u95f4\u4f7f\u7528\u7a7a\u683c\u9694\u5f00 \u5982\u679c\u8be5\u5b57\u6bb5\u6307\u5b9a\u7684 Unit \u4e5f\u8981\u542f\u52a8\uff0c\u90a3\u4e48\u5fc5\u987b\u5728\u5f53\u524d Unit \u4e4b\u540e\u542f\u52a8 \u9ad8 \u662f \u221a \u221a \u221a After String \u53ef\u4ee5\u914d\u7f6e\u591a\u4e2a\uff0c\u4e4b\u95f4\u4f7f\u7528\u7a7a\u683c\u9694\u5f00 \u5982\u679c\u8be5\u5b57\u6bb5\u6307\u5b9a\u7684 Unit \u4e5f\u8981\u542f\u52a8\uff0c\u90a3\u4e48\u5fc5\u987b\u5728\u5f53\u524d Unit \u4e4b\u524d\u542f\u52a8 \u9ad8 \u662f \u221a \u221a \u221a Conflicts String \u53ef\u4ee5\u914d\u7f6e\u591a\u4e2a\uff0c\u4e4b\u95f4\u4f7f\u7528\u7a7a\u683c\u9694\u5f00 \u8fd9\u91cc\u6307\u5b9a\u7684 Unit \u4e0d\u80fd\u4e0e\u5f53\u524d Unit \u540c\u65f6\u8fd0\u884c \u9ad8 \u662f \u221a \u221a \u221a Condition... String \u5f53\u524d Unit \u8fd0\u884c\u5fc5\u987b\u6ee1\u8db3\u7684\u6761\u4ef6\uff0c\u5426\u5219\u8df3\u8fc7\u8fd0\u884c\uff0c\u4fdd\u6301\u5f53\u524d\u72b6\u6001\u4e0d\u53d8\uff0c\u4e0d\u4f1a\u5f71\u54cdrequire\u4f9d\u8d56\u6b64unit\u7684\u542f\u52a8 \u9ad8 \u662f \u221a \u221a \u221a Assert... String \u5f53\u524d Unit \u8fd0\u884c\u5fc5\u987b\u6ee1\u8db3\u7684\u6761\u4ef6\uff0c\u5426\u5219\u4f1a\u62a5\u542f\u52a8\u5931\u8d25 \u9ad8 \u662f \u221a \u221a \u221a DefaultDependencies boolean \u662f\u5426\u589e\u52a0\u9ed8\u8ba4\u4f9d\u8d56\uff0c\u9ed8\u8ba4\u4e3ayes \u4e0d\u540c\u7c7b\u578b\u7684unit\uff0c\u6709\u4e0d\u540c\u7684\u9ed8\u8ba4\u4f9d\u8d56\uff0c\u5177\u4f53\u6709\u5404\u4e2a\u5b50\u7c7b\u5206\u6790 \u9ad8 \u662f \u221a \u221a \u221a OnFailureJobMode enumerate \u9ad8 \u662f \u221a \u221a \u221a StartLimitInterval number \u9ad8 \u662f \u221a \u221a \u221a StartLimitBurst number \u9ad8 \u662f \u221a \u221a \u221a StartLimitAction enumerate \u9ad8 \u662f \u221a \u221a \u221a SuccessAction enumerate \u9ad8 \u662f \u221a \u221a \u221a FailureAction enumerate \u9ad8 \u662f \u221a \u221a \u221a BindsTo String \u4e0eRequires\u7c7b\u4f3c\uff0c\u5b83\u6307\u5b9a\u7684 Unit \u5982\u679c\u9000\u51fa\uff0c\u4f1a\u5bfc\u81f4\u5f53\u524d Unit \u505c\u6b62\u8fd0\u884c \u4f4e \u5426 X X X AllowIsolate bool \u9ed8\u8ba4\u503c\u4e3ano \u4e3a\u517c\u5bb9sysv\u7684runlevel\u5207\u6362\uff0c\u652f\u6301\u5728\u7ebf\u5207\u6362\uff0c\u4f7f\u7528\u4e0d\u5e7f\uff0c\u6682\u65f6\u4e0d\u652f\u6301 \u4f4e \u5426 X X X IgnoreOnIsolate bool \u9ed8\u8ba4\u503c\u4e3ayes \u652f\u6301target\u5207\u6362\u65f6\uff0c\u8be5\u670d\u52a1\u4e0d\u505c\u6b62\u8fd0\u884c \u4f4e \u5426 X X X <ol> <li>[Dist]</li> </ol> \u914d\u7f6e\u540d\u79f0 \u503c\u7c7b\u578b \u914d\u7f6e\u9879\u8bf4\u660e \u4f7f\u7528\u573a\u666f \u4f18\u5148\u7ea7 \u662f\u5426\u652f\u6301 \u5bb9\u5668 \u865a\u673a \u7269\u7406\u673a WantedBy String \u53ef\u4ee5\u914d\u7f6e\u591a\u4e2a\uff0c\u4e4b\u95f4\u4f7f\u7528\u7a7a\u683c\u9694\u5f00 \u4e3b\u52a8\u671f\u671b\u88ab\u5176\u4ed6\u5355\u5143wanted\uff0c\u89e6\u53d1\u81ea\u5df1\u542f\u52a8 \u9ad8 \u662f \u221a \u221a \u221a RequiredBy String \u53ef\u4ee5\u914d\u7f6e\u591a\u4e2a\uff0c\u4e4b\u95f4\u4f7f\u7528\u7a7a\u683c\u9694\u5f00 \u4e3b\u52a8\u671f\u671b\u88ab\u5176\u4ed6\u5355\u5143required\uff0c\u89e6\u53d1\u81ea\u5df1\u542f\u52a8 \u9ad8 \u662f \u221a \u221a \u221a"},{"location":"design/cores/01-unit/#33","title":"3.3   \u7279\u6027\u5f71\u54cd\u5206\u6790","text":""},{"location":"design/cores/01-unit/#4","title":"4 \u7279\u6027/\u529f\u80fd\u5b9e\u73b0\u539f\u7406","text":""},{"location":"design/cores/01-unit/#41","title":"4.1 \u603b\u4f53\u65b9\u6848","text":"<pre><code>\u8981\u5b9e\u73b0\u901a\u8fc7unit\u7ba1\u7406\u7cfb\u7edf\u4e2d\u7684\u670d\u52a1\uff0c\u5305\u542b\u4ee5\u4e0b\u6b65\u9aa4\uff1a\n1. \u89e3\u6790unit\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u8f6c\u6362\u6210unit\u5bf9\u8c61\n2. \u6267\u884cunit\u5bf9\u5e94\u7684\u52a8\u4f5c\n\u6574\u4f53\u6a21\u5757\u5212\u5206\u5305\u62ec\uff1a\n1. load\u6a21\u5757\uff0c\u5c06\u914d\u7f6e\u6587\u4ef6\u8f6c\u6362\u6210unit\n2. unit_dataStore\uff0c\u4fdd\u5b58unit\u7684\u72b6\u6001\n3. unit\u6a21\u5757\uff0c\u5305\u542bunit\u5c5e\u6027\n</code></pre>"},{"location":"design/cores/01-unitManger/","title":"unitManager\u7684\u8bbe\u8ba1","text":""},{"location":"design/cores/01-unitManger/#_1","title":"\u7b80\u4ecb","text":""},{"location":"design/cores/01-unitManger/#_2","title":"\u76ee\u7684","text":"<p>Unit\u662fSysMaster\u7ba1\u7406\u7684\u57fa\u672c\u5355\u5143\uff0c\u4e0d\u540c\u7c7b\u578b\u7684Unit\u53ef\u4ee5\u7ba1\u7406\u4e0d\u540c\u7684\u8d44\u6e90\uff0csysMaster Unit\u7c7b\u578b\u652f\u6301\u6269\u5c55\uff0c\u901a\u8fc7\u63d2\u4ef6\u7684\u65b9\u5f0f\uff0c\u5728\u542f\u52a8\u8fc7\u7a0b\u4e2d\u52a0\u8f7d\u4e0d\u540c\u7c7b\u578b\u7684Unit\u5b9e\u73b0\uff0c\u6765\u5b9e\u73b0\u4e0d\u540c\u7684\u4e1a\u52a1\u76ee\u7684\u3002Unit\u7ba1\u7406\u5206\u4e3a\u4e24\u4e2a\u9636\u6bb5\uff1a</p> <ol> <li>Unit\u52a0\u8f7d\uff1a\u52a0\u8f7d\u914d\u7f6e\u6587\u4ef6\uff0c\u5e76\u5b8c\u6210\u914d\u7f6e\u6587\u4ef6\u89e3\u6790\uff0c\u751f\u6210Unit\u5bf9\u8c61\u3002</li> <li>Unit\u6267\u884c\uff1a\u6839\u636eUnit\u914d\u7f6e\u6587\u4ef6\uff0c\u6267\u884cUnit\u5b9a\u4e49\u7684\u52a8\u4f5c\uff0c\u5e76\u7ef4\u62a4Unit\u72b6\u6001\u3002</li> </ol>"},{"location":"design/cores/01-unitManger/#_3","title":"\u4e0a\u4e0b\u6587","text":"<p>unit\u662fSysMaster\u7ba1\u7406\u7684\u57fa\u672c\u5355\u5143\uff0c\u662fSysMaster\u5bf9\u7cfb\u7edf\u7ba1\u7406\u7684\u5165\u53e3\uff0cSysMaster\u4e3b\u8981\u662f\u5bf9Linux\u64cd\u4f5c\u7cfb\u7edf\u4e2d\uff0c\u91cd\u70b9\u7ba1\u7406\u968f\u7cfb\u7edf\u5f00/\u5173\u673a\u6d41\u7a0b\u7684\u670d\u52a1\uff0c\u4ee5\u53ca\u5728\u65e5\u5e38\u8fd0\u884c\u8fc7\u7a0b\u4e2d\uff0c\u7ba1\u7406\u5458\u3001\u5176\u4ed6\u5e94\u7528\u5bf9\u7cfb\u7edf\u4e2d\u7684\u5e94\u7528/\u8d44\u6e90\u8fdb\u884c\u751f\u547d\u5468\u671f\u7ba1\u7406\u3002</p>"},{"location":"design/cores/01-unitManger/#_4","title":"\u573a\u666f\u5206\u6790","text":""},{"location":"design/cores/01-unitManger/#_5","title":"\u4e1a\u52a1\u573a\u666f\u5206\u6790","text":"<p>Linux\u5728\u542f\u52a8\u8fc7\u7a0b\u4e2d\uff0c\u7b2c\u4e00\u4e2a\u542f\u52a8\u7684\u8fdb\u7a0b\u4e3a1\u53f7\u8fdb\u7a0b\uff0c\u5e76\u4e14\u57281\u53f7\u8fdb\u7a0b\u542f\u52a8\u540e\uff0c\u9700\u8981\u5bf9\u7cfb\u7edf\u4e2d\u7684\u4e00\u4e9b\u8bbe\u5907/\u521d\u59cb\u5316\u670d\u52a1\u8fdb\u884c\u542f\u52a8\u521d\u59cb\u5316\uff0c\u56e0\u6b64\u9700\u89811\u53f7\u8fdb\u7a0b\u5e76\u4e14\u80fd\u591f\u7ba1\u7406\u7cfb\u7edf\u8bbe\u5907\u3001\u5e94\u7528\u521d\u59cb\u5316\u7684\u7ba1\u7406\u6846\u67b6\u3002\u56e0\u6b64\u7ba1\u7406\u6846\u67b6\u9700\u8981\u6ee1\u8db3\u4ee5\u4e0b\u57fa\u672c\u573a\u666f\uff1a</p> <ol> <li>\u4ece\u914d\u7f6e\u6587\u4ef6load\u76f8\u5173\u7684\u7ba1\u7406\u5b9a\u4e49\uff0c\u5e76\u89e3\u6790\u5b8c\u6210\u89e3\u6790</li> <li>\u652f\u6301\u542f\u52a8Unit</li> <li>\u652f\u6301\u505c\u6b62Unit</li> <li>\u652f\u6301\u76d1\u63a7Unit\u72b6\u6001\u3002</li> </ol> <p>\u9664\u4e86\u4ee5\u4e0a\u57fa\u672c\u573a\u666f\uff0c\u7ed3\u5408Linux\u7cfb\u7edf\u7684\u5b9e\u9645\u60c5\u51b5\uff0c\u4ee5\u53ca\u5df2\u6709\u7684\u6846\u67b6systemd\u6846\u67b6\uff0cUnit\u548cUnit\u4e4b\u95f4\u6709\u5404\u79cd\u4f9d\u8d56\u5173\u7cfb\uff0c\u5e76\u4e14\u5728\u7cfb\u7edf\u542f\u52a8\u8fc7\u7a0b\u4e2d\u9700\u8981\u7ba1\u7406\u4e0d\u540c\u7684\u8d44\u6e90\uff0c\u5982\u78c1\u76d8\u8bbe\u5907\u521d\u59cb\u5316\u4ee5\u53ca\u6302\u8f7d\uff0c\u7f51\u7edc\u8bbe\u5907\u7684\u521d\u59cb\u5316\u4ee5\u53ca\u914d\u7f6e\uff0c\u5e94\u7528\u7a0b\u5e8f\u7684\u542f\u52a8\uff0c\u7cfb\u7edf\u5176\u4ed6\u8d44\u6e90/\u4e00\u4e9b\u53c2\u6570\u7684\u521d\u59cb\u5316\u3002</p> <p>Linux\u7cfb\u7edf\u8fd8\u652f\u6301\u4e0d\u540c\u7684\u542f\u52a8\u6a21\u5f0f\uff0c\u6bcf\u79cd\u6a21\u5f0f\u542f\u52a8\u7684Unit\u8303\u56f4\u4e5f\u4e0d\u540c\uff0c\u56e0\u6b641\u53f7\u8fdb\u7a0b\u4e5f\u8981\u652f\u6301\u4e0d\u540c\u7684\u542f\u52a8\u6a21\u5f0f/\u7ea7\u522b\uff0c\u542f\u52a8\u4e0d\u540c\u7684Unit\u7684\u96c6\u5408\u3002</p>"},{"location":"design/cores/01-unitManger/#_6","title":"\u529f\u80fd\u8bbe\u8ba1","text":""},{"location":"design/cores/01-unitManger/#_7","title":"\u529f\u80fd\u57df\u5212\u5206","text":"<p>\u7ed3\u5408\u573a\u666f\u5206\u6790\uff0c\u672c\u7ae0\u5b8c\u6210UnitManger\u529f\u80fd\u57df\u7684\u5212\u5206\uff0c\u529f\u80fd\u57df\u7684\u5212\u5206\u903b\u8f91\u5982\u4e0b\uff1a</p> <ol> <li>Unit\u4e3a\u57fa\u672c\u7ba1\u7406\u5355\u5143\uff0c\u5e76\u4e14\u4f1a\u6709\u4e0d\u540c\u7c7b\u578b\u7684Unit\uff0c\u56e0\u6b64\u9700\u8981\u5148\u62bd\u8c61\u4e00\u4e2aUnit\u63a5\u53e3\u5c42\uff0c\u5e76\u4e14\u9700\u8981\u6709\u4e0d\u540c\u7684\u5b9e\u73b0\u3002</li> <li>\u56e0\u4e3a\u4e0d\u540c\u7c7b\u578b\u7684Unit\u7684\u5b58\u5728\uff0cUnit\u7ba1\u7406\u6846\u67b6\u8bbe\u8ba1\u6210\u53ef\u6269\u5c55\u7684\uff0c\u53ef\u4ee5\u52a8\u6001\u52a0\u8f7d\u4e0d\u540cUnit\u7684\u5b9e\u73b0\u3002</li> <li>\u6bcf\u4e2aUnit\u6709\u72ec\u7acb\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u56e0\u6b64\u9700\u8981\u6709\u4e00\u4e2a\u914d\u7f6e\u6587\u4ef6\u7ba1\u7406\u7684\u6a21\u5757\uff0c\u6765\u7ba1\u7406Unit\u914d\u7f6e\u6587\u4ef6\uff0c\u5e76\u5b8c\u6210\u4ece\u914d\u7f6e\u6587\u4ef6\u89e3\u6790\u751f\u6210Unit\u5bf9\u8c61\u3002</li> <li>Unit\u72b6\u6001\u4f1a\u53d1\u751f\u53d8\u5316\uff0c\u5e76\u4e14\u8fd8\u9700\u8981\u7ef4\u62a4Unit\u7684\u4f9d\u8d56\u5173\u7cfb\uff0c\u56e0\u6b64\u9700\u8981\u5b9a\u4e49\u4e00\u4e2aDataStore\u6a21\u5757\uff0c\u7edf\u4e00\u5b58\u50a8Unit\u5bf9\u8c61\u3002</li> <li>Unit\u5bf9\u8c61\u662f\u6709\u751f\u547d\u5468\u671f\u7684\uff0c\u56e0\u6b64\u9700\u8981\u6709\u4e00\u4e2a\u6574\u4f53\u7684\u7ba1\u7406\u6a21\u5757\uff0c\u5c06\u6240\u6709\u6a21\u5757\u4e32\u8054\u8d77\u6765\u3002</li> <li>Unit\u5bf9\u8c61\u6bcf\u6b21\u542f\u52a8\uff0c\u901a\u8fc7Job\u51fa\u53d1\uff0c\u56e0\u6b64\u9700\u8981\u5212\u5206\u51fa\u4e00\u4e2aJob\u5f15\u64ce\u3002</li> </ol> <p></p>"},{"location":"design/cores/01-unitManger/#unit","title":"unit\u63a5\u53e3\u5b9a\u4e49","text":"<p>Unit\u63a5\u53e3\u5b9a\u4e49Unit\u5b50\u7c7b\u7684\u516c\u5171\u884c\u4e3a\uff0c\u6bcf\u79cd\u5b50\u7c7b\u5fc5\u987b\u5b9e\u73b0\u8fd9\u4e9b\u63a5\u53e3\uff0c\u5177\u4f53\u7684\u63a5\u53e3\u5305\u542b</p>"},{"location":"design/cores/01-unitManger/#unit_1","title":"unit\u52a0\u8f7d","text":""},{"location":"design/cores/01-unitManger/#unit_2","title":"unit\u7684\u914d\u7f6e\u7ba1\u7406","text":"<p>\u6bcf\u4e2aunit\u90fd\u4f1a\u5305\u542b\u914d\u7f6e\u6587\u4ef6\uff0c\u5e76\u4e14Unit\u7684\u914d\u7f6e\u6587\u4ef6\u548cUnit\u540c\u540d\uff0c\u5e76\u4e14\u4ee5Unit\u7684\u7c7b\u578b\u4f5c\u4e3a\u6269\u5c55\u540d\uff0c\u5982XXX.service, XXX.socket\u3002</p> <p>unit\u914d\u7f6e\u6587\u4ef6\u5b58\u50a8\u8def\u5f84\u4e3a\uff1a | \u914d\u7f6e\u6587\u4ef6\u8def\u5f84              | \u4f18\u5148\u7ea7     | | ------------------------- | ---------- | | /etc/sysmaster/system     | \u7b2c\u4e00\u4f18\u5148\u7ea7 | | /run/sysmaster/system     | \u7b2c\u4e8c\u4f18\u5148\u7ea7 | | /usr/lib/sysmaster/system | \u7b2c\u4e09\u4f18\u5148\u7ea7 |</p> <p>\u914d\u7f6e\u76ee\u5f55\u4e0b\u53ef\u4ee5\u5b58\u5728\u540c\u540d\u7684\u6587\u4ef6\uff0c\u540c\u540d\u7684\u6587\u4ef6\u9ad8\u4f18\u5148\u7ea7\u7684\u4f1a\u8986\u76d6\u4f4e\u4f18\u5148\u7ea7\u7684\u7684\u914d\u7f6e\uff0cUnit\u7684\u914d\u7f6e\u6587\u4ef6\u548cUnit\u7684\u5bf9\u5e94\u5173\u7cfb\u4f1a\u5728\u9996\u6b21\u52a0\u8f7d\u7684\u65f6\u5019\u5b8c\u6210\u7f13\u5b58\uff0c\u53ea\u6709\u5728\u76ee\u5f55\u53d1\u751f\u66f4\u65b0\u7684\u65f6\u5019\u624d\u4f1a\u5237\u65b0\u7f13\u5b58\u7684\u6620\u5c04\u5173\u7cfb\u3002</p> <p>unit\u914d\u7f6e\u5b9a\u4e49\u5305\u542b\u4e09\u4e2a\u90e8\u5206\uff0c\u5177\u4f53\u63cf\u8ff0\u5982\u4e0b\uff1a</p> <p><code>toml [Unit]\uff1a\u6240\u6709Unit\u90fd\u53ef\u4ee5\u914d\u7f6e\u7684\u914d\u7f6e\u9879\uff0c\u5177\u4f53\u89c1uu_config::UeConfigUnit [SelfDefSection] [Install] Unit\u5b89\u88c5\u65f6\uff08\u5b89\u88c5\u6982\u5ff5\uff0c\u89c1\u540e\u7eed\u5907\u6ce8\uff09\u7684\u914d\u7f6e\u9879</code></p> <p>unit\u914d\u7f6e\u4f7f\u7528toml\u683c\u5f0f\uff0c\u901a\u8fc7\u5bf9toml\u6587\u4ef6\u89e3\u6790\uff0c\u586b\u5145\u5230\u5177\u4f53unit\u5bf9\u8c61\u4e2d\uff0cunit\u52a0\u8f7d\u6d41\u7a0b\u89c1\u4e0b\u4e00\u7ae0\u8282</p>"},{"location":"design/cores/01-unitManger/#unit_3","title":"unit\u7684\u52a0\u8f7d","text":"<p>unit\u5bf9\u8c61\u52a0\u8f7d\u662f\u6240\u6709Unit\u6267\u884c\u540e\u7eed\u7684\u52a8\u4f5c\u7684\u524d\u63d0\uff0c\u901a\u8fc7\u89e3\u6790Unit\u7684\u5bf9\u5e94\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u751f\u6210Unit\u5bf9\u8c61\uff0c\u5e76\u52a0\u8f7d\u5230sysmaster\u5185\u90e8\uff0c\u5177\u4f53\u6d41\u7a0b\u5982\u4e0b\uff1a</p> <p></p>"},{"location":"design/cores/01-unitManger/#unit_4","title":"unit\u5bf9\u8c61\u521b\u5efa","text":"<p>unit\u5bf9\u8c61\u5305\u542bunit\u4ee5\u53ca\u5b50Unit\uff0c\u5bf9\u8c61\u5173\u7cfb\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>unit\u4e3aunitManger\u7ba1\u7406\u7684\u5355\u5143\uff0csubUnit\u4e3a\u5b50unit\uff0c\u6bcf\u79cd\u7c7b\u578b\u90fd\u8981\u6c42\u5b9e\u73b0unitObj\u63a5\u53e3\uff0c\u4e0d\u540c\u7c7b\u578b\u6709\u4e0d\u540c\u7684\u7684\u5b9e\u73b0\uff0c\u901a\u8fc7Plugin\u6846\u67b6\u6765\u521b\u5efa\u3002</p>"},{"location":"design/cores/01-unitManger/#unit_5","title":"unit\u5bf9\u8c61\u7684\u5b58\u50a8","text":"<p>\u6bcf\u4e2a\u914d\u7f6e\u6587\u4ef6\uff0c\u89e3\u6790\u5b8c\u6210\u4e4b\u540e\uff0c\u4f1a\u751f\u6210\u4e00\u4e2aunit\u5bf9\u8c61\uff0cunit\u5168\u5c40\u552f\u4e00\uff0c\u540c\u4e00\u4fdd\u5b58\u5230datastore\u4e2d\uff0cdatastore\u4f7f\u7528hashmap\uff0c\u5e76\u4e14\u4f7f\u7528name\u4f5c\u4e3akey\u6765\u4fdd\u5b58unit\u5bf9\u8c61\u3002\u4f7f\u7528\u8fc7\u7a0b\u4e2d\uff0cunit\u4f7f\u7528\u5f15\u7528\u7684\u65b9\u5f0f\u66f4\u65b0\u6570\u636e\uff0c\u5f53\u524dsysmater\u4f7f\u7528\u7684\u662f\u5355\u7ebf\u7a0b\uff0c\u56e0\u6b64\u4e0d\u8003\u8651\u6570\u636e\u5e76\u53d1\u95ee\u9898\u3002</p>"},{"location":"design/extends/02-devmaster-architecture/","title":"devmaster\u8bbe\u8ba1\u6587\u6863","text":"<p>Abstract \u6458\u8981\uff1a <code>devmaster</code>\u662f<code>sysmaster</code>\u7684\u8bbe\u5907\u7ba1\u7406\u6a21\u5757\uff0c\u5176\u673a\u5236\u4e0e\u7b56\u7565\u5206\u79bb\u7684\u8bbe\u8ba1\u601d\u60f3\u63d0\u4f9b\u4e86\u4f18\u79c0\u7684\u7075\u6d3b\u6027\u548c\u53ef\u6269\u5c55\u80fd\u529b\uff0c\u53e6\u4e00\u65b9\u9762<code>devmaster</code>\u91c7\u7528\u4e86\u5e76\u53d1\u7a0b\u5e8f\u6846\u67b6\uff0c\u6709\u6548\u5730\u5229\u7528\u4e86\u591a\u6838\u786c\u4ef6\u8d44\u6e90\u7684\u5e76\u53d1\u80fd\u529b\u3002<code>devmaster</code>\u901a\u8fc7<code>inotify</code>\u673a\u5236\u76d1\u542c\u8bbe\u5907\u5199\u64cd\u4f5c\u5e76\u540c\u6b65\u89e6\u53d1<code>change</code>\u7c7b\u578b\u7684<code>uevent</code>\u4e8b\u4ef6\uff0c\u5e76\u901a\u8fc7\u76d1\u542c\u5185\u6838\u4e0a\u62a5\u7684<code>uevent</code>\u4e8b\u4ef6\u4ece\u800c\u611f\u77e5\u8bbe\u5907\u52a8\u4f5c\uff0c\u4f7f\u5f97\u5728\u8bbe\u5907\u70ed\u63d2\u62d4\u3001\u683c\u5f0f\u5316\u7b49\u64cd\u4f5c\u540e\u80fd\u53ca\u65f6\u66f4\u65b0\u8bbe\u5907\u4fe1\u606f\u3002</p> <p><code>devmaster</code>\u5728\u8bbe\u5907\u5904\u7406\u4e0a\u4f7f\u7528\u4e86\u89c4\u5219\u89e3\u6790\u7b56\u7565\uff0c\u4f7f\u7528\u8005\u53ef\u4ee5\u6839\u636e\u4e1a\u52a1\u9700\u6c42\u7f16\u5199\u5b9a\u5236\u5316\u7684\u8bbe\u5907\u5904\u7406\u89c4\u5219\uff0c\u907f\u514d\u4e86\u7b56\u7565\u786c\u7f16\u7801\u95ee\u9898\uff0c\u63d0\u9ad8<code>devmaster</code>\u5728\u4f7f\u7528\u4e0a\u7684\u7075\u6d3b\u6027\u548c\u53ef\u6269\u5c55\u6027\u3002\u4e3a\u4e86\u5145\u5206\u5229\u7528\u786c\u4ef6\u8bbe\u5907\u7684\u591a\u6838\u5904\u7406\u80fd\u529b\uff0c<code>devmaster</code>\u91c7\u7528\u4e86\u5355\u751f\u4ea7\u8005\u591a\u6d88\u8d39\u8005\u7684\u5e76\u53d1\u6846\u67b6\uff0c<code>daemon</code>\u8fdb\u7a0b\u96c6\u4e2d\u76d1\u542c<code>uevent</code>\u4e8b\u4ef6\u5e76\u901a\u8fc7\u4efb\u52a1\u961f\u5217\u5bf9\u4e8b\u4ef6\u8fdb\u884c\u7f13\u5b58\u8c03\u5ea6\uff0c\u5f53\u4efb\u52a1\u961f\u5217\u4e2d\u5b58\u5728\u5f85\u5904\u7406\u4e8b\u4ef6\u65f6\uff0c<code>worker</code>\u7ba1\u7406\u5668\u4f1a\u5206\u914d\u4e00\u4e2a\u7a7a\u95f2\u7684<code>worker</code>\u8fdb\u884c\u4efb\u52a1\u6d3e\u53d1\uff0c\u540c\u4e00\u65f6\u523b\u8fd0\u884c\u6709\u591a\u4e2a<code>worker</code>\u540c\u65f6\u5904\u7406\u591a\u4e2a\u65e0\u4f9d\u8d56\u5173\u7cfb\u7684\u8bbe\u5907\u4e8b\u4ef6\u3002<code>devmaster</code>\u4f7f\u7528\u72b6\u6001\u673a\u6a21\u578b\u7ba1\u7406<code>worker</code>\u548c\u8bbe\u5907\u4e8b\u4ef6\u7684\u6267\u884c\u72b6\u6001\uff0c\u53ca\u65f6\u8fdb\u884c\u56de\u6536\u3001\u91ca\u653e\u7b49\u72b6\u6001\u66f4\u65b0\u52a8\u4f5c\u3002\u8bbe\u5907\u7ba1\u7406\u662f\u652f\u63011\u53f7\u8fdb\u7a0b\u5728\u865a\u62df\u673a\u3001\u7269\u7406\u673a\u7b49\u573a\u666f\u4e0b\u90e8\u7f72\u8fd0\u884c\u5fc5\u4e0d\u53ef\u5c11\u7684\u80fd\u529b\uff0c\u56e0\u6b64<code>devmaster</code>\u662f<code>sysmaster</code>\u7684\u6838\u5fc3\u6269\u5c55\u6a21\u5757\u4e4b\u4e00\u3002</p> <p>Keywords \u5173\u952e\u8bcd\uff1a \u8bbe\u5907\u7ba1\u7406</p>"},{"location":"design/extends/02-devmaster-architecture/#1","title":"1 \u6982\u8ff0","text":"<p>devmaster\u662fsysmaster\u7684\u8bbe\u5907\u7ba1\u7406\u6a21\u5757\uff0c\u662f\u652f\u64911\u53f7\u8fdb\u7a0b\u5728\u865a\u62df\u673a\u3001\u7269\u7406\u673a\u73af\u5883\u4e2d\u90e8\u7f72\u8fd0\u884c\u7684\u6838\u5fc3\u80fd\u529b\u4e4b\u4e00\u3002devmaster\u91c7\u7528\u4e86\u673a\u5236\u548c\u7b56\u7565\u5206\u79bb\u7684\u67b6\u6784\uff0c\u5e76\u8bbe\u8ba1\u4e86\u4e00\u5957\u5e76\u53d1\u7a0b\u5e8f\u6846\u67b6\uff0c\u5728\u63d0\u4f9b\u4f18\u79c0\u7684\u7075\u6d3b\u6027\u548c\u53ef\u6269\u5c55\u6027\u7684\u57fa\u7840\u4e0a\uff0c\u5145\u5206\u53d1\u6325\u4e86\u591a\u6838\u786c\u4ef6\u8d44\u6e90\u7684\u5e76\u53d1\u80fd\u529b\u3002</p>"},{"location":"design/extends/02-devmaster-architecture/#2","title":"2 \u76f8\u5173\u5de5\u4f5c","text":"\u4e1a\u754c\u65b9\u6848 \u7279\u70b9 \u5e94\u7528\u5e73\u53f0 systemd-udev \u57fa\u4e8e\u5185\u6838\u7684uevent\u4e8b\u4ef6\u9a71\u52a8\uff0c\u5e76\u4f7f\u7528\u591aworker\u673a\u5236\u5bf9\u8bbe\u5907\u8fdb\u884c\u5e76\u53d1\u5904\u7406\u3002udev\u8bbe\u8ba1\u4e86\u4e00\u79cd\u673a\u5236\u548c\u7b56\u7565\u5206\u79bb\u7684\u8bbe\u5907\u5904\u7406\u6d41\u7a0b\uff0c\u63d0\u4f9b\u4e86\u4f18\u79c0\u7684\u4e1a\u52a1\u5b9a\u5236\u80fd\u529b \u4f7f\u7528systemd\u7684Linux\u7cfb\u7edf busybox-mdev \u5229\u7528sysfs\u673a\u5236\u4e3b\u52a8\u521b\u5efa\u8bbe\u5907\u8282\u70b9\uff0c\u6216\u4f7f\u7528\u5185\u6838hotplugin\u56de\u8c03\u673a\u5236\u88ab\u52a8\u521b\u5efa\u6216\u5220\u9664\u8bbe\u5907\u8282\u70b9\u3002\u6bcf\u89e6\u53d1\u4e00\u6b21uevent\u5c31\u4f1a\u521b\u5efa\u4e00\u4e2a\u5b50\u8fdb\u7a0b\uff0c\u9ad8\u5e76\u53d1\u573a\u666f\u4e0b\u5bb9\u6613\u8d44\u6e90\u7d27\u5f20 \u5d4c\u5165\u5f0f\u7cfb\u7edf android-vold \u4ecb\u4e8eKernel\u548cFramework\u4e4b\u95f4\uff0c\u76d1\u542cuevent\u4e8b\u4ef6\u5e76\u505a\u7b80\u5355\u7684\u8bbe\u5907\u5904\u7406\uff0c\u590d\u6742\u4e1a\u52a1\u903b\u8f91\u901a\u8fc7Framework\u5c42\u7684\u5b58\u50a8\u7ba1\u7406\u5668\u95f4\u63a5\u6d3e\u53d1\u7ed9\u5177\u4f53\u670d\u52a1\u548cAPP\u5b9e\u73b0 Android\u64cd\u4f5c\u7cfb\u7edf macos X \u7531\u8bbe\u5907\u9a71\u52a8\u76f4\u63a5\u521b\u5efa\u8bbe\u5907\u8282\u70b9\uff0c\u5177\u4f53\u8bbe\u5907\u7684\u5904\u7406\u7b56\u7565\u9700\u8981\u5177\u4f53\u5206\u6790 Macos"},{"location":"design/extends/02-devmaster-architecture/#3","title":"3 \u8bbe\u8ba1\u65b9\u6848","text":"<p>\u672c\u8282\u5bf9devmaster\u7684\u8bbe\u8ba1\u65b9\u6848\u8fdb\u884c\u8ba8\u8bba\u3002\u9996\u5148\u6211\u4eec\u5c06\u5206\u6790devmaster\u7684\u603b\u4f53\u67b6\u6784\uff0c\u5e76\u4ecb\u7ecd\u6d89\u53ca\u4ee3\u7801\u7684\u76ee\u5f55\u7ed3\u6784\uff0c\u7136\u540e\u6211\u4eec\u5c06\u4ecb\u7ecddevmaster\u7684\u57fa\u672c\u8fd0\u884c\u6846\u67b6\uff0c\u5e76\u7ec6\u7c92\u5ea6\u5206\u6790\u5404\u4e2a\u5b50\u6a21\u5757\u7684\u5de5\u4f5c\u539f\u7406\uff0c\u6700\u540e\u6211\u4eec\u901a\u8fc7\u65f6\u5e8f\u56fe\u4ecb\u7ecddevmaster\u7684\u6838\u5fc3\u529f\u80fd\u573a\u666f\u3002</p>"},{"location":"design/extends/02-devmaster-architecture/#31","title":"3.1 \u603b\u4f53\u67b6\u6784","text":"<p>devmaster\u5305\u542b\u4e24\u4e2a\u53ef\u6267\u884c\u6587\u4ef6\uff1a\u5e38\u9a7b\u8fdb\u7a0bdevmaster\u548c\u5ba2\u6237\u7aef\u5de5\u5177devctl</p> <ol> <li>devmaster\u4f5c\u4e3a\u5e38\u9a7b\u8fdb\u7a0b\u6301\u7eed\u76d1\u542c\u5185\u6838\u4e0a\u62a5\u7684uevent\u4e8b\u4ef6\uff0c\u63a5\u6536\u4e8b\u4ef6\u540e\u83b7\u53d6\u7a7a\u95f2\u7684worker\u6216\u521b\u5efa\u65b0\u7684worker\uff0c\u5e76\u6d3e\u53d1\u8bbe\u5907\u5904\u7406\u4efb\u52a1\u3002\u540c\u65f6\uff0cudevd\u4f1a\u4e0e\u5ba2\u6237\u7aef\u7a0b\u5e8fudevadm\u8fdb\u884c\u4ea4\u4e92\uff0c\u5bf9\u8fdb\u884c\u7684\u8fd0\u884c\u72b6\u6001\u8fdb\u884c\u63a7\u5236\u3002</li> <li>devctl\u4f5c\u4e3a\u5ba2\u6237\u7aef\u5de5\u5177\u8d1f\u8d23\u4e0edevmaster\u8fdb\u884c\u4ea4\u4e92\uff0c\u6bd4\u5982\u53d1\u9001\u63a7\u5236\u547d\u4ee4\uff0c\u4e5f\u53ef\u4ee5\u76d1\u542cuevent\u4e8b\u4ef6\u3001\u89e6\u53d1\u4e8b\u4ef6\u3001\u8c03\u8bd5\u89c4\u5219\u7b49\u3002</li> </ol> <p>\u5982\u4e0b\u6240\u793a\u4e3adevmaster\u7684\u603b\u4f53\u67b6\u6784\u56fe\uff0c\u5404\u5b50\u6a21\u5757\u7684\u529f\u80fd\u63cf\u8ff0\u8be6\u60c5\u89c1\u9644\u5f55\u7684\u7279\u6027\u5217\u8868\u3002</p> <p></p>"},{"location":"design/extends/02-devmaster-architecture/#32","title":"3.2 \u76ee\u5f55\u7ed3\u6784","text":"<ol> <li> <p>\u6e90\u7801\u4f4d\u7f6e: extends/devmaster</p> </li> <li> <p>\u516c\u5171\u51fd\u6570\u5e93: libs/device</p> </li> <li> <p>\u89c4\u5219\u6587\u4ef6\u4e0e\u914d\u7f6e\u6587\u4ef6\uff1atodo</p> </li> </ol>"},{"location":"design/extends/02-devmaster-architecture/#33","title":"3.3 \u57fa\u672c\u6846\u67b6","text":"<p>devmaster\u91c7\u7528\u57fa\u4e8eepoll\u7684event\u5f02\u6b65\u7f16\u7a0b\u6846\u67b6\uff0c\u5f53\u5185\u6838\u4e0a\u62a5uevent\u4e8b\u4ef6\u6216\u8005\u7528\u6237\u901a\u8fc7devctl\u5de5\u5177\u53d1\u9001\u63a7\u5236\u547d\u4ee4\u540e\uff0c\u5c06\u6fc0\u6d3bdevmaster\u8fdb\u5165\u8bbe\u5907\u5904\u7406\u6d41\u7a0b\u3002\u57fa\u672c\u6846\u67b6\u5206\u6210\u4e09\u4e2a\u5c42\u6b21\uff0c\u7b2c\u4e00\u5c42\u6b21\u5305\u542bControlManager\u548cMonitor\u6a21\u5757\uff0c\u8d1f\u8d23\u63a5\u6536\u8bbe\u5907\u4e8b\u4ef6\uff0cControlManager\u8d1f\u8d23\u63a5\u6536devctl\u53d1\u9001\u7684\u63a7\u5236\u6307\u4ee4\uff0c\u7528\u6237\u53ef\u4ee5\u901a\u8fc7devct\u5bf9devmaster\u7684\u6846\u67b6\u529f\u80fd\u8fdb\u884c\u8c03\u8bd5\uff0cMonitor\u8d1f\u8d23\u76d1\u542c\u5185\u6838\u4e0a\u62a5\u7684uevent\u4e8b\u4ef6\uff0c\u7b2c\u4e8c\u5c42\u6b21\u4e3aJobQueue\u6a21\u5757\uff0cdevmaster\u63a5\u6536\u5230\u8bbe\u5907\u4e8b\u4ef6\u540e\u9700\u8981\u63d2\u5165\u5230\u4efb\u52a1\u961f\u5217\u4e2d\u8fdb\u884c\u7f13\u5b58\uff0c\u5e76\u7b49\u5f85\u6d3e\u53d1\u7ed9\u7a7a\u95f2worker\u8fdb\u7a0b\u8bbe\u5907\u5904\u7406\uff0c\u961f\u5217\u4e2d\u7684\u5404\u4e2a\u4e8b\u4ef6\u5177\u6709\u72b6\u6001\uff0cJobQueue\u9700\u8981\u7ef4\u62a4\u548c\u5237\u65b0\u4e8b\u4ef6\u72b6\u6001\uff0c\u7b2c\u4e09\u5c42\u6b21\u4e3aWorkerManager\u6a21\u5757\uff0c\u5f53\u4efb\u52a1\u961f\u5217\u4e2d\u5b58\u5728\u5f85\u5904\u7406\u4e8b\u4ef6\u65f6\uff0c\u7531WorkerManager\u5206\u914d\u6216\u8005\u521b\u5efa\u7a7a\u95f2\u7684worker\uff0c\u5e76\u6d3e\u53d1\u4e8b\u4ef6\u7ed9worker\u8fdb\u884c\u5904\u7406\uff0cWorkerManager\u9700\u8981\u7ef4\u62a4\u548c\u5237\u65b0worker\u7684\u72b6\u6001\uff0cworker\u63a5\u6536\u5230\u5f85\u5904\u7406\u4e8b\u4ef6\u65f6\uff0c\u4f1a\u5728\u65e5\u5fd7\u4e2d\u6253\u5370\u63a5\u6536\u8bb0\u5f55\uff0c\u5904\u7406\u6210\u529f\u540e\uff0c\u5411\u5916\u5e7f\u64ad\u8bbe\u5907\u4fe1\u606f\uff0c\u5e76\u5411WorkerManager\u901a\u8fc7tcp\u53d1\u9001\u5e94\u7b54\u6d88\u606f\u3002\u5404\u6a21\u5757\u95f4\u7684\u4f9d\u8d56\u5173\u7cfb\u5982\u4e0b\u56fe\u6240\u793a\uff0cControlManager\u548cMonitor\u6301\u6709JobQueue\u7684\u5f15\u7528\uff0c\u5f53\u63a5\u6536\u5230\u8bbe\u5907\u4e8b\u4ef6\u540e\uff0c\u63d2\u5165\u5230\u4efb\u52a1\u961f\u5217\u4e2d\uff0cJobQueue\u548cWorkerManager\u76f8\u4e92\u6301\u6709\u5f15\u7528\uff0cJobQueue\u4e2d\u5b58\u5728\u5f85\u5904\u7406\u4efb\u52a1\u65f6\uff0c\u4f1a\u5411WorkerManager\u5206\u53d1\uff0c\u5982\u679c\u83b7\u53d6\u5230\u7a7a\u95f2worker\uff0c\u5219\u66f4\u65b0\u4efb\u52a1\u72b6\u6001\uff0cWorkerManager\u83b7\u53d6\u5230\u7a7a\u95f2\u7684worker\u65f6\uff0c\u4f1a\u5c06\u8bbe\u5907\u4efb\u52a1\u53d1\u9001\u7ed9\u8be5worker\u8fdb\u884c\u5904\u7406\uff0c\u5904\u7406\u5b8c\u6210\u540e\uff0cWorkerManager\u901a\u8fc7JobQueue\u66f4\u65b0\u4efb\u52a1\u72b6\u6001\u3002</p> <p></p>"},{"location":"design/extends/02-devmaster-architecture/#34","title":"3.4 \u6a21\u5757\u5206\u6790","text":"<p>\u672c\u8282\u5c06\u8be6\u7ec6\u4ecb\u7ecddevmaster\u57fa\u672c\u6846\u67b6\u4e2d\u7684\u5404\u4e2a\u5b50\u6a21\u5757\u3002</p>"},{"location":"design/extends/02-devmaster-architecture/#341-monitor","title":"3.4.1 Monitor","text":"<p>devmaster\u7684Monitor\u8d1f\u8d23\u76d1\u542c\u5185\u6838\u4e0a\u62a5\u7684uevent\u4e8b\u4ef6\uff0c\u4ece\u4e8b\u4ef6\u4e2d\u63d0\u53d6\u8bbe\u5907\u4fe1\u606f\uff0c\u751f\u6210Device\u5b9e\u4f8b\u5e76\u63d2\u5165\u5230JobQueue\u4fdd\u5b58\u3002</p>"},{"location":"design/extends/02-devmaster-architecture/#342-controlmanager","title":"3.4.2 ControlManager","text":"<p>devmaster\u901a\u8fc7ControlManager\u6a21\u5757\u63a5\u6536devctl\u5de5\u5177\u53d1\u9001\u7684\u63a7\u5236\u547d\u4ee4\uff0cControlManager\u76d1\u542c\u7684\u7aef\u53e3\u5730\u5740\u4e3a\uff080.0.0.0:1224\uff09\uff0c\u5f53\u524d\u652f\u6301\u7684\u63a7\u5236\u547d\u4ee4\u5982\u4e0b\uff1a</p> <ol> <li>devctl test \uff1a\u8be5\u547d\u4ee4\u6267\u884c\u540e\u5411ControlManager\u53d1\u9001\"test \"\u6d88\u606f\uff0cControlManager\u63a5\u6536\u540e\u6839\u636edevname\u6a21\u62df\u4e00\u4e2aDevice\u5b9e\u4f8b\uff0c\u5e76\u63d2\u5165\u5230JobQueue\u4e2d\u8fdb\u884c\u4efb\u52a1\u8c03\u5ea6\u3002 <li>devctl kill\uff1a\u8be5\u547d\u4ee4\u6267\u884c\u540e\u5411ControlManager\u53d1\u9001\"kill \"\u6d88\u606f\uff0cControlManager\u63a5\u6536\u540e\u8c03\u7528WorkerManager\u7684start_kill_workers_timer\u65b9\u6cd5\uff0c\u8fdb\u884cworker\u56de\u6536\u3002</li>"},{"location":"design/extends/02-devmaster-architecture/#343-jobqueue","title":"3.4.3 JobQueue","text":"<p>devmaster\u5728\u77ed\u65f6\u95f4\u5185\u76d1\u6d4b\u5230\u5927\u91cfuevent\u4e8b\u4ef6\u65f6\uff0c\u53ef\u80fd\u65e0\u5145\u8db3\u6570\u91cf\u7684worker\u6765\u540c\u65f6\u6ee1\u8db3\u4efb\u52a1\u8c03\u5ea6\uff0c\u56e0\u6b64\u4f7f\u7528JobQueue\u5c06\u8bbe\u5907\u4e8b\u4ef6\u7f13\u5b58\u8d77\u6765\uff0c\u7b49\u5f85worker\u8fdb\u5165\u7a7a\u95f2\u72b6\u6001\u540e\u518d\u8fdb\u884c\u6d3e\u53d1\u5904\u7406\u3002</p> <ol> <li> <p>\u6570\u636e\u7ed3\u6784\uff1aJobQueue\u4f7f\u7528VecDeque\u4f5c\u4e3a\u5185\u90e8\u5bb9\u5668\uff0c\u961f\u5217\u5143\u7d20\u7684\u7c7b\u578b\u4e3aDeviceJob\u6570\u636e\u7ed3\u6784\uff0cDeviceJob\u5bf9Device\u8fdb\u884c\u5c01\u88c5\uff0c\u9644\u52a0\u4efb\u52a1\u72b6\u6001\u3001\u5e8f\u5217\u53f7\u4ee5\u53caworker\u5f15\u7528\u3002JobQueue\u5728\u5b58\u50a8\u4efb\u52a1\u65f6\uff0c\u6839\u636e\u8bbe\u5907\u7684\u5e8f\u5217\u53f7\u8fdb\u884c\u81ea\u5c0f\u5230\u5927\u5730\u6392\u5e8f\u3002DeviceJob\u5177\u6709\u4e09\u79cd\u72b6\u6001\uff1aUndef\u8868\u793a\u5c1a\u672a\u521d\u59cb\u5316\uff0c\u76ee\u524d\u751f\u6210DeviceJob\u5b9e\u4f8b\u65f6\u5c06\u72b6\u6001\u9ed8\u8ba4\u521d\u59cb\u5316\u4e3aQueued\uff0cUndef\u72b6\u6001\u672a\u88ab\u4f7f\u7528\uff1bQueue\u8868\u793a\u4efb\u52a1\u5df2\u5165\u961f\uff0c\u5e76\u7b49\u5f85\u6d3e\u53d1\u5904\u7406\uff0c\u8be5\u72b6\u6001\u4e0bDeviceJob\u4e2d\u5bf9worker\u7684\u5f15\u7528\u4e3a\u7a7a\uff0c\u8868\u793a\u5c1a\u672a\u5f97\u5230worker\u5904\u7406\uff1bRunning\u8868\u793a\u4efb\u52a1\u6b63\u5728\u88ab\u67d0\u4e2aworker\u5904\u7406\u4e2d\uff0c\u6bcf\u4e2aDeviceJob\u540c\u4e00\u65f6\u95f4\u4ec5\u5141\u8bb8\u88ab\u552f\u4e00\u7684worker\u5904\u7406\uff0c\u8be5\u72b6\u6001\u4e0bDeviceJob\u4e2d\u5305\u542b\u5bf9\u8be5worker\u7684\u5f15\u7528\u3002</p> </li> <li> <p>\u8bbe\u5907\u4e8b\u4ef6\u5165\u961f\uff1a\u4e0a\u5c42\u6a21\u5757\u8c03\u7528job_queue_insert\u51fd\u6570\u5411JobQueue\u53d1\u9001Device\u5b9e\u4f8b\u540e\uff0cJobQueue\u5c06Device\u5c01\u88c5\u4e3aDeviceJob\u5e76\u63d2\u5165\u5230\u5bb9\u5668\u4e2d\u5b58\u50a8\u3002\u5165\u961f\u8fc7\u7a0b\u4e2d\u4f1a\u68c0\u67e5Device\u5b9e\u4f8b\u4e2d\u7684\u5e8f\u5217\u53f7seqnum\u662f\u5426\u5927\u4e8e0\uff0c\u5185\u6838\u4e0a\u62a5\u7684uevent\u4e2d\u7684\u8bbe\u5907\u5c5e\u6027\u5305\u542b\u5927\u4e8e0\u7684\u5e8f\u5217\u53f7\uff0cJobQueue\u4ec5\u652f\u6301\u6765\u6e90\u81ea\u5185\u6838uevent\u7684\u8bbe\u5907\u4e8b\u4ef6\uff0cControlManager\u63a5\u6536\u5230devctl test \u53d1\u9001\u7684\u63a7\u5236\u547d\u4ee4\u540e\uff0c\u4f1a\u4eff\u9020\u4e00\u4e2a\u5408\u6cd5\u7684Device\u5b9e\u4f8b\uff0c\u5e76\u53d1\u9001\u7ed9JobQueue\u8fdb\u884c\u8c03\u8bd5\u3002\u65b0\u63d2\u5165\u7684DeviceJob\u4f1a\u6839\u636e\u5e8f\u5217\u53f7seqnum\u5927\u5c0f\u63d2\u5165\u5230\u7279\u5b9a\u4f4d\u7f6e\uff0c\u4fdd\u6301JobQueue\u961f\u5217\u7684\u6709\u5e8f\u3002 <li> <p>\u4efb\u52a1\u6d3e\u53d1\uff1a\u4e0a\u5c42\u6a21\u5757\u8c03\u7528job_queue_start\u51fd\u6570\u5f00\u59cb\u4efb\u52a1\u6d3e\u53d1\uff0cJobQueue\u8f6e\u8be2\u961f\u5217\u4e2d\u7684\u8bbe\u5907\u4efb\u52a1\uff0c\u5982\u679c\u4efb\u52a1\u72b6\u6001\u4e3aQueued\uff0c\u5219\u901a\u8fc7WorkerManager\u8fdb\u884cworker\u8c03\u5ea6\uff0c\u5982\u679cWorkerManager\u6210\u529f\u5c06\u4efb\u52a1\u6d3e\u53d1\u7ed9\u7a7a\u95f2\u7684worker\u8fdb\u884c\u5904\u7406\uff0cJobQueue\u4e2d\u4f1a\u66f4\u65b0\u8be5\u4efb\u52a1\u7684\u72b6\u6001\u4e3aRunning\uff0c\u5e76\u5c06\u8be5\u4efb\u52a1\u548c\u5206\u914d\u7684worker\u7ed1\u5b9a\u3002\u8fdb\u884c\u8bbe\u5907\u4e8b\u4ef6\u5165\u961f\u540e\uff0c\u9700\u8981\u7d27\u8ddf\u4efb\u52a1\u6d3e\u53d1\u52a8\u4f5c\u3002</p> </li> <li> <p>\u4efb\u52a1\u6e05\u7406\uff1aworker\u5904\u7406\u5b8c\u8bbe\u5907\u540e\uff0c\u4f1a\u5411WorkerManager\u53d1\u9001\u5df2\u5b8c\u6210\u7684\u5e94\u7b54\u4fe1\u53f7\uff0c\u6b64\u65f6WorkerManager\u4e2d\u8c03\u7528job_free\u51fd\u6570\uff0c\u5c06worker\u7ed1\u5b9a\u7684\u8bbe\u5907\u4efb\u52a1\u4eceJobQueue\u4e2d\u6e05\u9664\u3002</p> </li>"},{"location":"design/extends/02-devmaster-architecture/#344-workermanager","title":"3.4.4 WorkerManager","text":"<p>WorkerManager\u6a21\u5757\u8d1f\u8d23\u7ba1\u7406\u8c03\u5ea6worker\uff0c\u9700\u8981\u627f\u62c5\u4efb\u52a1\u6d3e\u53d1\u3001\u72b6\u6001\u66f4\u65b0\u3001worker\u56de\u6536\u7b49\u5de5\u4f5c\u3002</p> <ol> <li>\u6570\u636e\u7ed3\u6784\uff1aworker\u7684\u7ed3\u6784\u4f53\u7c7b\u578b\u4e3aWorker\uff0c\u6bcf\u4e2aworker\u6301\u6709\u4e00\u4e2a\u7ebf\u7a0b\u53e5\u67c4\uff0c\u6bcf\u4e2a\u7ebf\u7a0b\u540c\u4e00\u65f6\u95f4\u6700\u591a\u80fd\u5904\u7406\u4e00\u4e2a\u8bbe\u5907\uff0cWorker\u67095\u79cd\u72b6\u6001\uff1aUNDEF\u7528\u4e8e\u6807\u8bc6\u72b6\u6001\u673a\u8d77\u59cb\u70b9\uff0c\u521b\u5efaworker\u5b9e\u4f8b\u540e\u7684\u8d77\u59cb\u72b6\u6001\u662fUNDEF\uff0c\u4e4b\u540e\u7acb\u523b\u8fdb\u5165IDLE\u72b6\u6001\uff1bIDLE\u8868\u793aWorker\u7ebf\u7a0b\u5904\u4e8e\u7a7a\u95f2\u72b6\u6001\uff0c\u7b49\u5f85WorkerManager\u6d3e\u53d1\u4efb\u52a1\uff0cWorkerManager\u53ea\u4f1a\u5411\u5904\u4e8eIDLE\u72b6\u6001\u7684worker\u53d1\u9001\u4efb\u52a1\uff1bRUNNING\u8868\u793a\u6b63\u5728\u5904\u7406\u4e00\u4e2a\u4efb\u52a1\uff0c\u540c\u4e00\u65f6\u95f4\u4e00\u4e2aworker\u53ea\u80fd\u5904\u7406\u4e00\u4e2a\u4efb\u52a1\uff0cWorkerManager\u5728\u6d3e\u53d1\u4efb\u52a1\u65f6\u4f1a\u68c0\u67e5worker\u72b6\u6001\uff0c\u5982\u679c\u5904\u4e8eRUNNING\uff0c\u5219\u4e0d\u4f1a\u5411\u8be5worker\u53d1\u9001\u4efb\u52a1\uff1bKILLING\u8868\u793a\u5df2\u5411\u8be5worker\u7684\u7ebf\u7a0b\u53d1\u9001kill\u63a7\u5236\u547d\u4ee4\uff0cworker\u5185\u90e8\u4f7f\u7528channel\u5411\u6267\u884c\u4e2d\u7684\u7ebf\u7a0b\u53d1\u9001\u6d88\u606f\uff0c\u5982\u679cworker\u7ebf\u7a0b\u6b63\u5728\u5904\u7406\u4efb\u52a1\uff0c\u53d1\u9001\u7684\u6d88\u606f\u4f1a\u4fdd\u5b58\u5728channel\u7f13\u5b58\u4e2d\uff0c\u7b49\u5f85\u4e0b\u4e00\u6b21\u7ebf\u7a0b\u901a\u8fc7recv\u8bfb\u53d6kill\u547d\u4ee4\u540e\uff0c\u518d\u8fdb\u884c\u7ebf\u7a0b\u56de\u6536\u7684\u6d41\u7a0b\uff1bKILLED\u4e3a\u7ec8\u6b62\u72b6\u6001\uff0c\u8868\u793a\u8fd9\u4e2aWorker\u5df2\u7ecf\u6740\u6b7b\uff0c\u7ebf\u7a0b\u5df2\u9000\u51fa\u8fd0\u884c\uff0c\u4e14WokerManager\u6536\u5230\u4e86\u7ebf\u7a0b\u53d1\u9001\u7684\u9000\u51fa\u54cd\u5e94\uff0c\u4e4b\u540eWorkerManager\u4f1a\u6e05\u7406worker\u7684\u6b8b\u7559\u8bb0\u5f55\u3002</li> </ol> <p></p> <ol> <li> <p>worker\u56de\u6536\uff1a\u5728\u4e00\u4e9b\u573a\u666f\u4e0b\u9700\u8981\u56de\u6536\u6b63\u5728\u8fd0\u884c\u7684worker\uff0c\u6bd4\u5982\u4e8b\u4ef6\u961f\u5217\u7a7a\u95f2\u6301\u7eedxx\u79d2\u3001\u63a7\u5236\u5757\u9000\u51fa\u3001\u63a7\u5236\u5757\u91cd\u65b0\u52a0\u8f7d\u6570\u636e\u3001\u6536\u5230devctl\u7684\u7279\u5b9a\u63a7\u5236\u547d\u4ee4\u7b49\u7b49\u3002worker\u56de\u6536\u901a\u8fc7\u8c03\u7528manager_kill_workers\u51fd\u6570\u89e6\u53d1\uff0c\u8be5\u51fd\u6570\u4e2d\u4f1a\u5411\u6240\u6709worker\u53d1\u9001kill\u63a7\u5236\u547d\u4ee4\uff0c\u6b64\u65f6\u5904\u4e8eIDLE\u72b6\u6001\u7684worker\u8fdb\u5165KILLING\u72b6\u6001\u5e76\u76f4\u63a5\u7ed3\u675f\u8fd0\u884c\uff0c\u5904\u4e8eRUNNING\u72b6\u6001\u7684worker\u4f1a\u8fdb\u5165KILLING\u72b6\u6001\uff0c\u7136\u540e\u7b49\u5f85\u5f53\u524d\u4efb\u52a1\u5b8c\u6210\u518d\u7ed3\u675f\u8fd0\u884c\u3002\u5f53\u524d\u4ec5\u652f\u6301\u4f7f\u7528devctl\u547d\u4ee4\u624b\u52a8\u89e6\u53d1worker\u56de\u6536\uff0c\u81ea\u52a8\u56de\u6536\u529f\u80fd\u9700\u8981\u7b49event\u652f\u6301on_post\u7279\u6027\u540e\u518d\u8fdb\u884c\u5f00\u53d1\u3002</p> </li> <li> <p>WorkerManager\u7ed3\u6784\u4f53\u5bf9\u6240\u6709worker\u96c6\u4e2d\u7ba1\u7406\uff1a\u4e3a\u6bcf\u4e2aworker\u5206\u914d\u4e00\u4e2achannel\uff0cworker\u6301\u6709\u53d1\u9001\u7aef\uff0cworker\u5185\u90e8\u6267\u884c\u7684\u7ebf\u7a0b\u4e2d\u6301\u6709\u63a5\u6536\u7aef\uff0cworker\u5904\u4e8e\u7a7a\u95f2\u72b6\u6001\u65f6\uff0c\u5141\u8bb8\u5411\u5176\u6d3e\u53d1WorkerMessage\uff0cWorkerMessage\u53ef\u4ee5\u662f\u8bbe\u5907\u4efb\u52a1DeviceJob\uff0c\u4e5f\u53ef\u4ee5\u662f\u63a7\u5236\u547d\u4ee4Cmd\uff1bWorkerManager\u901a\u8fc7\u552f\u4e00\u7684Tcp\u7aef\u53e3\uff08\"0.0.0.0:1223\"\uff09\u96c6\u4e2d\u76d1\u542c\u6240\u6709worker\u7684\u54cd\u5e94\u6d88\u606f\uff0c\u6d88\u606f\u6eaf\u6e90\u901a\u8fc7\u6d88\u606f\u5185\u5bb9\u8fdb\u884c\u533a\u5206\uff0c\u5982\u679cworker\u5b8c\u6210\u4e86\u8bbe\u5907\u4efb\u52a1\uff0c\u4f1a\u8fd4\u56definished id\uff0c\u5f53WorkerManager\u6536\u5230\u5e94\u7b54\u540e\uff0c\u6839\u636eid\u627e\u5230worker\u5e76\u91cd\u7f6e\u72b6\u6001\u4e3aIDLE\uff0c\u5237\u65b0\u4e0e\u8be5worker\u7ed1\u5b9a\u7684DeviceJob\u4e8b\u4ef6\u72b6\u6001\uff0c\u5e76\u4eceJobQueue\u4e2d\u628a\u5bf9\u5e94\u7684DeviceJob\u6e05\u9664\uff0c\u5982\u679cworker\u7ebf\u7a0b\u9000\u51fa\u4e86\u8fd0\u884c\uff0c\u4f1a\u8fd4\u56dekilled id\uff0cWorkerManager\u5c06\u8be5worker\u8bb0\u5f55\u4ece\u63a7\u5236\u5757\u4e2d\u6e05\u9664\u3002\u53e6\u5916\uff0cworker\u5728\u5904\u7406\u5b8c\u8bbe\u5907\u540e\uff0c\u4f1a\u901a\u8fc7netlink\u5411\u7528\u6237\u6001\u8fdb\u7a0b\u5e7f\u64ad\u8bbe\u5907\u4fe1\u606f\uff0c\u4f7f\u7528devctl monitor\u53ef\u4ee5\u76d1\u542c\u5230\u8be5\u4fe1\u606f\u3002</p> </li> </ol> <p></p>"},{"location":"design/extends/02-devmaster-architecture/#35","title":"3.5 \u6838\u5fc3\u529f\u80fd","text":"<p>\u672c\u8282\u5c06\u4ee5\u65f6\u5e8f\u56fe\u7684\u5f62\u5f0f\u4ecb\u7ecddevmaster\u7684\u51e0\u4e2a\u6838\u5fc3\u529f\u80fd\u573a\u666f\u3002</p>"},{"location":"design/extends/02-devmaster-architecture/#351","title":"3.5.1 \u4e8b\u4ef6\u9a71\u52a8\u7684\u8bbe\u5907\u5904\u7406\u6d41\u7a0b","text":"<ol> <li>Monitor\u76d1\u542c\u5230uevent\u4e8b\u4ef6\u540e\uff0c\u89e3\u6790uevent\u62a5\u6587\u5e76\u63d0\u53d6Device\u6570\u636e\u3002</li> </ol> <p>\u3010\u89c2\u6d4b\u70b9\uff1adevmaster debug\u65e5\u5fd7<code>Monitor: received device &lt;devpath&gt;</code>\u3011</p> <ol> <li>\u5c06Device\u6570\u636e\u63d2\u5165JobQueue\u4e2d\u3002</li> </ol> <p>\u3010\u89c2\u6d4b\u70b9\uff1adevmaster debug\u65e5\u5fd7 <code>Job Queue: insert job &lt;seqnum&gt;</code>\u3011</p> <ol> <li>JobQueue\u5c06\u961f\u5217\u4e2d\u7684\u4e8b\u4ef6\u6d3e\u53d1\u7ed9WorkerManager\u3002</li> </ol> <p>\u3010\u89c2\u6d4b\u70b9\uff1adevmaster debug\u65e5\u5fd7<code>Worker Manager: start dispatch job &lt;seqnum&gt;</code>\u3011</p> <ol> <li>WorkerManager\u83b7\u53d6\u7a7a\u95f2worker\uff0c\u5c06\u8bbe\u5907\u4efb\u52a1\u53d1\u9001\u7ed9worker\uff0c\u5e76\u8bbe\u7f6e\u8be5worker\u7684\u72b6\u6001\u4e3aRUNNING\u3002</li> </ol> <p>\u3010\u89c2\u6d4b\u70b91\uff1adevmaster debug\u65e5\u5fd7<code>Worker Manager: set worker &lt;worker number&gt; to state Running</code>\u3011</p> <p>\u3010\u89c2\u6d4b\u70b92\uff1adevmaster debug\u65e5\u5fd7<code>Job Queue: dispatch job &lt;seqnum&gt; to worker &lt;worker number&gt;</code>\u3011</p> <ol> <li>worker\u63a5\u6536\u5230\u8bbe\u5907\u4efb\u52a1\u540e\uff0c\u8fdb\u884c\u8bbe\u5907\u5904\u7406\u3002</li> </ol> <p>\u3010\u89c2\u6d4b\u70b91\uff1adevmaster info\u65e5\u5fd7<code>Worker &lt;worker number&gt;: received device &lt;devpath&gt;</code>\u3011</p> <p>\u3010\u89c2\u6d4b\u70b92\uff1adevmaster info\u65e5\u5fd7<code>Worker &lt;worker number&gt;: processing &lt;devpath&gt;</code>\u3011</p> <ol> <li>\u8bbe\u5907\u5904\u7406\u5b8c\u6210\u540e\uff0c\u5411\u5916\u5e7f\u64ad\u8bbe\u5907\u4fe1\u606f\uff0c\u5e76\u5411WorkerManager\u53d1\u9001\u5e94\u7b54\u6d88\u606f</li> </ol> <p>\u3010\u89c2\u6d4b\u70b91\uff1adevmaster info\u65e5\u5fd7<code>Worker &lt;worker number&gt;: finished job</code>\u3011</p> <ol> <li>devctl monitor\u547d\u4ee4\u53ef\u4ee5\u76d1\u542c\u5230worker\u5e7f\u64ad\u7684\u4fe1\u606f\uff0c\u5e76\u5b9e\u65f6\u6253\u5370\u3002\u3010\u89c2\u6d4b\u70b9\uff1adevctl monitor\u6253\u5370\u3011</li> </ol> <p>\u3010\u89c2\u6d4b\u70b9\uff1adevctl monitor\u547d\u4ee4\u6355\u6349\u8bbe\u5907\u4fe1\u606f\u5e7f\u64ad<code>USERSPACE [] &gt;&gt; &lt;action&gt; &lt;devpath&gt; (&lt;subsystem&gt;)</code>\u3011</p> <ol> <li>WorkerManager\u6536\u5230\u5e94\u7b54\u6d88\u606f\u540e\uff0c\u8bbe\u7f6eworker\u72b6\u6001\u4e3aIDLE\uff0c\u5e76\u5728JobQueue\u4e2d\u6e05\u7406\u4e0e\u8be5worker\u7ed1\u5b9a\u7684\u8bbe\u5907\u4efb\u52a1</li> </ol> <p>\u3010\u89c2\u6d4b\u70b91\uff1adevmaster debug\u65e5\u5fd7<code>Worker Manager: received message \"finished &lt;worker number&gt;\"</code>\u3011</p> <p>\u3010\u89c2\u6d4b\u70b92\uff1adevmaster debug\u65e5\u5fd7<code>Job Queue: succeeded to free job &lt;seqnum&gt;</code>\u3011</p> <p>\u3010\u89c2\u6d4b\u70b93\uff1adevmaster debug\u65e5\u5fd7<code>Worker Manager: set worker &lt;worker number&gt; to state IDLE</code>\u3011</p> <p></p>"},{"location":"design/extends/02-devmaster-architecture/#4","title":"4 \u5b9e\u9a8c\u5bf9\u6bd4","text":""},{"location":"design/extends/02-devmaster-architecture/#5","title":"5 \u9644\u5f55","text":""},{"location":"design/extends/02-devmaster-architecture/#51","title":"5.1 \u7279\u6027\u5217\u8868","text":"\u9700\u6c42\u7f16\u53f7 \u9700\u6c42\u540d\u79f0 \u7279\u6027\u63cf\u8ff0 \u4f18\u5148\u7ea7 1 Monitor \u4f7f\u7528netlink\u673a\u5236\u6ce8\u518csocket\uff0c\u76d1\u542c\u5e76\u63a5\u53d7\u5185\u6838\u4e0a\u62a5\u7684uevent\u4e8b\u4ef6\uff0c\u5c06\u4e8b\u4ef6\u8f93\u9001\u5230\u4e8b\u4ef6\u961f\u5217\u8fdb\u884c\u7ba1\u7406\uff0c\u540c\u65f6\u627f\u62c5libdevmaster\u5bf9\u5916\u5e7f\u64ad\u7684\u529f\u80fd\uff0c\u6bcf\u5f53\u67d0\u4e2a\u4e8b\u4ef6\u5904\u7406\u7ed3\u675f\u540e\uff0c\u5411\u5916\u5e7f\u64ad\u5904\u7406\u7ed3\u675f\u7684\u6d88\u606f \u9ad8 2 JobQueue \u4f7f\u7528\u961f\u5217\u6570\u636e\u7ed3\u6784\u7ba1\u7406monitor\u63a5\u53d7\u7684uevent\u4e8b\u4ef6\uff0c\u5c06\u961f\u5217\u4e2d\u7684\u4e8b\u4ef6\u6d3e\u53d1\u7ed9worker\u8fdb\u884c\u5e76\u53d1\u5904\u7406\uff0c\u5e76\u53ca\u65f6\u66f4\u65b0\u961f\u5217\u4e0e\u4e8b\u4ef6\u72b6\u6001 \u9ad8 3 WorkerManager \u91c7\u7528\u7ebf\u7a0b\u6c60\u6a21\u578b\u521b\u5efa\u5e76\u7ba1\u7406worker\uff0c\u5f53\u63a5\u6536\u4e8b\u4ef6\u961f\u5217\u6d3e\u53d1\u7684\u4efb\u52a1\u65f6\uff0c\u4ece\u7ebf\u7a0b\u6c60\u4e2d\u83b7\u53d6\u4e00\u4e2a\u7a7a\u95f2\u7684worker\u8fdb\u884c\u5904\u7406\uff0c\u5982\u679c\u4e0d\u5b58\u5728\u7a7a\u95f2worker\uff0c\u5219\u521b\u5efa\u4e00\u4e2a\u65b0\u7684worker\u7ebf\u7a0b\u8fdb\u884c\u5904\u7406,worker\u4e2d\u8fdb\u884c\u89c4\u5219\u5904\u7406\uff0c\u9700\u8981\u8bbe\u8ba1\u770b\u95e8\u72d7\u673a\u5236\u9632\u6b62\u5904\u7406\u8d85\u65f6\uff0c\u5f53worker\u7a7a\u95f2\u8fc7\u4e45\u65f6\uff0c\u9700\u8981\u8fdb\u884c\u7ebf\u7a0b\u56de\u6536 \u9ad8 4 \u89c4\u5219\u5904\u7406 \u8d1f\u8d23\u5bfc\u5165\u548c\u7ba1\u7406\u89c4\u5219\u6587\u4ef6\uff0c\u5904\u7406\u8bbe\u5907\u4efb\u52a1\u65f6\u9700\u8981\u6267\u884c\u89c4\u5219\u89e3\u6790\u52a8\u4f5c\uff0c\u89c4\u5219\u89e3\u6790\u8fc7\u7a0b\u9700\u8981\u4e00\u4e9b\u7279\u6b8a\u8bbe\u5907\u7ec4\u4ef6\u4e0ebuiltin\u5de5\u5177\u7684\u652f\u6301\uff0c\u5e76\u4e14\u9700\u8981\u5b9e\u73b0hwdb\u5bf9\u8bbe\u5907\u4fe1\u606f\u8fdb\u884c\u6301\u4e45\u5316\u5b58\u50a8 \u4e2d 5 \u4fe1\u53f7\u5904\u7406 \u63a5\u6536SIGINT\u548cSIGTERM\u4fe1\u53f7\u65f6\uff0c\u8fdb\u5165\u8fdb\u7a0b\u9000\u51fa\u6d41\u7a0b\uff0c\u63a5\u6536SIGHUP\u4fe1\u53f7\u65f6\uff0c\u91cd\u65b0\u52a0\u8f7d\u8fdb\u7a0b \u4e2d 6 device \u63d0\u4f9b\u8bbe\u5907\u76f8\u5173\u7684\u516c\u5171\u51fd\u6570\u3001\u6570\u636e\u7ed3\u6784\u7b49\u652f\u6301 \u4e2d 7 Watch \u4f7f\u7528inotify\u673a\u5236\u76d1\u63a7\u8bbe\u5907\u8282\u70b9\u7684IN_CLOSE_WRITE\u64cd\u4f5c\uff0c\u5e76\u901a\u8fc7sysfs\u673a\u5236\u6a21\u62df\u8bbe\u5907\u7684change\u4e8b\u4ef6 \u4f4e 8 ControlManager \u4f7f\u7528UnixSocket\u673a\u5236\uff0c\u76d1\u542c\u5ba2\u6237\u7aef\u7a0b\u5e8fdevctl\u53d1\u8d77\u7684\u8fde\u63a5\u8bf7\u6c42\uff0c\u5efa\u7acb\u8fde\u63a5\u540e\u8fdb\u884c\u62a5\u6587\u4ea4\u4e92\uff0c\u5e76\u6839\u636e\u63a7\u5236\u8bf7\u6c42\u8fdb\u884c\u63a7\u5236\u54cd\u5e94 \u4f4e 9 \u63a7\u5236\u54cd\u5e94 \u6839\u636e\u5ba2\u6237\u7aef\u7a0b\u5e8f\u7684\u63a7\u5236\u8bf7\u6c42\uff0c\u8fdb\u884c\u914d\u7f6e\u8bbe\u7f6e\u3001\u884c\u4e3a\u63a7\u5236\u3001\u5ef6\u65f6\u63a7\u5236\u7b49\u52a8\u4f5c \u4f4e 10 \u914d\u7f6e\u7ba1\u7406 \u652f\u6301\u914d\u7f6e\u6587\u4ef6\u5bfc\u5165\u3001\u89e3\u6790\u547d\u4ee4\u884c\u53c2\u6570\u3001\u89e3\u6790\u73af\u5883\u53d8\u91cf\u7b49\u529f\u80fd\uff0c\u5bf9devmaster\u7684\u8fd0\u884c\u53c2\u6570\u8fdb\u884c\u63a7\u5236 \u4f4e 11 devctl monitor devctl\u76d1\u542c\u5185\u6838\u4e0a\u62a5\u7684uevent\u4e8b\u4ef6\uff0c\u5e76\u6839\u636e\u4e8b\u4ef6\u62a5\u6587\u5934\u533a\u5206\u62a5\u6587\u6765\u6e90\u81ea\u5185\u6838\u8fd8\u662f\u7528\u6237\u6001\uff0c\u5b9e\u65f6\u6253\u5370 \u9ad8 12 devctl trigger devctl\u901a\u8fc7sysfs\u673a\u5236\u89e6\u53d1\u6307\u5b9a\u52a8\u4f5c\u7684\u8bbe\u5907\u4e8b\u4ef6\uff0c\u518d\u901a\u8fc7\u5185\u6838\u4e0a\u62a5\u7528\u6237\u6001\u7a0b\u5e8f \u9ad8 13 devctl info devctl\u901a\u8fc7sysfs\u673a\u5236\u548c\u8bfb\u53d6\u6570\u636e\u5e93\u83b7\u53d6\u8bbe\u5907\u4fe1\u606f\u5e76\u6253\u5370 \u4e2d 14 devctl test-builtin devctl\u7528\u4e8e\u8c03\u8bd5builtin\u5185\u7f6e\u547d\u4ee4 \u4e2d 15 devctl test devctl\u6a21\u62df\u8bbe\u5907\u4e8b\u4ef6\uff0c\u67e5\u770b\u5339\u914d\u7684\u89c4\u5219\uff0c\u7528\u4e8e\u8c03\u8bd5\u89c4\u5219\u89e3\u6790 \u4e2d 16 devctl control devctl\u4e0edevmaster\u4ea4\u4e92\uff0c\u5411devmaster\u53d1\u9001\u63a7\u5236\u4fe1\u606f \u4f4e 17 devctl settle devctl\u4e0edevmaster\u4ea4\u4e92\uff0c\u7b49\u5f85devmaster\u7684\u4e8b\u4ef6\u961f\u5217\u6e05\u7a7a \u4f4e"},{"location":"design/extends/02-devmaster-architecture/#52","title":"5.2 \u63a5\u53e3\u5b9a\u4e49","text":""},{"location":"design/extends/02-devmaster-architecture/#1-devctl-monitor","title":"1. devctl monitor","text":"\u63a5\u53e3\u540d\u79f0 devctl monitor \u63a5\u53e3\u63cf\u8ff0 \u76d1\u542c\u5185\u6838\u4e0a\u62a5\u7684uevent\u4e8b\u4ef6\u548cdevmaster\u5904\u7406\u5b8c\u8bbe\u5907\u540e\u53d1\u51fa\u7684\u4e8b\u4ef6\uff0c\u5206\u522b\u4ee5<code>KERNEL</code>\u548c<code>USERSPACE</code>\u4f5c\u4e3a\u524d\u7f00\u8fdb\u884c\u533a\u5206\u3002 \u63a5\u53e3\u7c7b\u578b \u547d\u4ee4\u884c \u63a5\u53e3\u5b9a\u4e49 devctl monitor Input\u53c2\u6570 \u65e0 Output\u53c2\u6570 \u65e0 \u7ea6\u675f\u548c\u6ce8\u610f\u4e8b\u9879 devmaster\u672a\u5904\u4e8e\u8fd0\u884c\u72b6\u6001\u65f6\uff0c\u4ec5\u80fd\u76d1\u542c\u5230\u6765\u81ea\u5185\u6838\u7684\u8bbe\u5907\u6d88\u606f\uff0c\u5e76\u6253\u5370 KERNEL \u8bb0\u5f55\u3002\u5982\u679cdevmaster\u6b63\u5728\u8fd0\u884c\uff0c\u4e14\u63a5\u6536\u5230uevent\u5e76\u6210\u529f\u5904\u7406\u5b8c\u8bbe\u5907\uff0c\u4f1a\u5e7f\u64ad\u8bbe\u5907\u4fe1\u606f\uff0c\u6b64\u65f6devctl monitor\u547d\u4ee4\u5c06\u6253\u5370 USERSPACE \u8bb0\u5f55\u3002"},{"location":"design/extends/02-devmaster-architecture/#2-devctl-trigger","title":"2. devctl trigger","text":"\u63a5\u53e3\u540d\u79f0 devctl trigger [OPTIONS] [DEVICES]... \u63a5\u53e3\u63cf\u8ff0 \u6a21\u62df\u4e00\u4e2a\u8bbe\u5907\u4e8b\u4ef6\uff0c\u4f7f\u5185\u6838\u4e0a\u62a5\u5bf9\u5e94\u7684uevent\u4e8b\u4ef6\uff0c\u7528\u4e8e\u91cd\u653e\u5185\u6838\u521d\u59cb\u5316\u8fc7\u7a0b\u4e2d\u7684\u51b7\u63d2(coldplug)\u8bbe\u5907\u4e8b\u4ef6\u3002 \u63a5\u53e3\u7c7b\u578b \u547d\u4ee4\u884c \u63a5\u53e3\u5b9a\u4e49 devctl trigger [OPTIONS] [DEVICES]... Input\u53c2\u6570 [DEVICES]: \u4ee5/sys\u6216/dev\u5f00\u5934\u7684\u8bbe\u5907\u8def\u5f84\u3002 Output\u53c2\u6570 \u65e0 \u7ea6\u675f\u548c\u6ce8\u610f\u4e8b\u9879 \u53ef\u4ee5\u6307\u5b9a\u82e5\u5e72\u4e2a\u89e6\u53d1\u7684\u8bbe\u5907\uff0c\u6216\u8005\u9ed8\u8ba4\u89e6\u53d1\u7cfb\u7edf\u4e2d\u6240\u6709\u7684\u8bbe\u5907\u3002\u4f7f\u7528devctl monitor\u76d1\u542c\u8bbe\u5907\u4e8b\u4ef6\u662f\u5426\u6210\u529f\u89e6\u53d1\u3002"},{"location":"design/extends/02-devmaster-public-article/","title":"devMaster: \u65b0\u4e00\u4ee3\u8bbe\u5907\u7ba1\u7406\u5668","text":""},{"location":"design/extends/02-devmaster-public-article/#linuxdevmaster","title":"\u8ba4\u8bc6<code>Linux</code>\u7684\u8bbe\u5907\u7ba1\u7406\u5668\u548c<code>devMaster</code>","text":"<p>\u8bbe\u5907\u7ba1\u7406\u5668\u627f\u62c5\u7740\u8bbe\u5907\u70ed\u63d2\u62d4\u5904\u7406\u3001\u8bbe\u5907\u8282\u70b9\u521b\u5efa\u4e0e\u66f4\u65b0\u7b49\u64cd\u4f5c\uff0c\u662f\u7cfb\u7edf\u521d\u59cb\u5316\u6d41\u7a0b\u4e2d\u5fc5\u4e0d\u53ef\u5c11\u7684\u4e00\u4e2a\u73af\u8282\u3002<code>devMaster</code>\u4f5c\u4e3a<code>sysMaster</code>\u7684\u8bbe\u5907\u7ba1\u7406\u6a21\u5757\uff0c\u662f\u652f\u6491\u7cfb\u7edf\u5feb\u901f\u542f\u52a8\u3001\u4fdd\u8bc1\u7cfb\u7edf\u529f\u80fd\u6b63\u5e38\u8fd0\u884c\u7684\u91cd\u8981\u529f\u80fd\u7ec4\u4ef6\u3002</p> <p>\u8bbe\u5907\u7ba1\u7406\u5668\u4f5c\u4e3a\u94fe\u63a5\u7528\u6237\u6001\u8f6f\u4ef6\u4e0e\u5e95\u5c42\u7269\u7406\u8bbe\u5907\u7684\u6865\u6881\uff0c\u652f\u6491\u7740\u8bb8\u591a\u7528\u6237\u6001\u57fa\u7840\u8f6f\u4ef6\uff0c\u6bd4\u5982<code>lvm2</code>\u3001<code>NetworkManager</code>\u7b49\u7b49\uff0c\u662f\u7cfb\u7edf\u7528\u6237\u6001\u7684\u6838\u5fc3\u7ec4\u4ef6\u4e4b\u4e00\u3002<code>Linux</code>\u7684\u8bbe\u5907\u7ba1\u7406\u673a\u5236\u5212\u5206\u4e3a\u5185\u6838\u6001\u548c\u7528\u6237\u6001\uff1a\u5185\u6838\u627f\u62c5\u8bbe\u5907\u53d1\u73b0\u7684\u529f\u80fd\uff0c\u5e76\u901a\u8fc7<code>sysfs</code>\u4e0b\u7684<code>kobject</code>\u63d0\u4f9b\u8bbe\u5907\u4fe1\u606f\u67e5\u8be2\u4ee5\u53ca\u4e0e\u5185\u6838\u4ea4\u4e92\u7684\u63a5\u53e3\uff0c\u53e6\u5916\u5185\u6838\u4f1a\u901a\u8fc7<code>netlink</code>\u901a\u77e5\u7528\u6237\u6001\u8fdb\u7a0b\uff0c\u6216\u8005\u4f7f\u7528<code>hotplug</code>\u673a\u5236\u76f4\u63a5\u8c03\u7528\u7528\u6237\u6001\u7a0b\u5e8f\uff1b\u7528\u6237\u6001\u8bbe\u5907\u7ba1\u7406\u5668\uff0c\u6bd4\u5982\u4e3b\u6d41\u7684<code>udev(userspace device)</code>\uff0c\u76d1\u542c\u5185\u6838\u4e0a\u62a5\u7684\u8bbe\u5907\u4e8b\u4ef6\uff0c\u5e76\u6839\u636e\u8bbe\u5907\u5c5e\u6027\u6267\u884c\u4e00\u7cfb\u5217\u7075\u6d3b\u7684\u7ba1\u7406\u52a8\u4f5c\uff0c\u603b\u4f53\u6765\u770b\u5177\u5907\u4ee5\u4e0b\u51e0\u7c7b\u529f\u80fd\uff1a</p> <ol> <li>\u7ba1\u7406\u9759\u6001\u8bbe\u5907\u8282\u70b9\uff1a\u4f46\u662f\u968f\u7740<code>devtmpfs</code>\u5728<code>2009</code>\u5e74\u6536\u5f55\u8fdb<code>Linux 2.6.32</code>\uff0c\u9759\u6001\u8bbe\u5907\u8282\u70b9\u7531\u5185\u6838\u8fdb\u884c\u521b\u5efa\uff0c\u4ee4\u4e00\u822c\u542f\u52a8\u7a0b\u5e8f\u4e0d\u5fc5\u7b49\u5f85<code>udev</code>\u3002</li> <li>\u8bbe\u5907\u547d\u540d\u6620\u5c04\uff1a\u5185\u6838\u521b\u5efa\u7684\u8bbe\u5907\u8282\u70b9\uff0c\u6bd4\u5982<code>/dev/sda</code>\uff0c\u5f80\u5f80\u4e0d\u5177\u5907\u76f4\u89c2\u53ef\u7406\u89e3\u7684\u540d\u79f0\uff0c\u800c<code>udev</code>\u53ef\u4ee5\u63d0\u4f9b\u4e00\u79cd\u7c7b\u4f3c<code>DNS</code>\u7684\u547d\u540d\u6620\u5c04\u673a\u5236\uff0c\u5c06\u8bbe\u5907\u6620\u5c04\u5230\u56fa\u5b9a\u53ef\u7406\u89e3\u7684\u540d\u79f0\u4e0a\u3002</li> <li>\u7f51\u5361\u4fdd\u5e8f\uff1a\u670d\u52a1\u5668\u53ef\u80fd\u901a\u8fc7\u677f\u8f7d\u96c6\u6210\u3001<code>PCIe</code>\u63d2\u69fd\u6269\u5c55\u7b49\u65b9\u5f0f\uff0c\u6301\u6709\u591a\u5757\u7f51\u5361\uff0c\u800c\u5185\u6838\u53d1\u73b0\u5e76\u547d\u540d\u7f51\u5361\u7684\u7f16\u53f7\u5177\u6709\u968f\u673a\u6027\uff0c\u5bfc\u81f4\u7f51\u5361\u8282\u70b9\u7684\u540d\u79f0\u65e0\u6cd5\u5bf9\u5e94\u7269\u7406\u987a\u5e8f\uff0c<code>udev</code>\u901a\u8fc7\u8bfb\u53d6\u7f51\u5361\u6240\u5728\u7684<code>PCI</code>\u603b\u7ebf\u53f7\u3001\u63d2\u69fd\u7d22\u5f15\u7b49\u56fa\u5b9a\u4fe1\u606f\uff0c\u5c06\u7f51\u5361\u540d\u79f0\u56fa\u5b9a\u5230\u7279\u5b9a\u7f16\u53f7\u4e0a\u3002</li> <li>\u63a7\u5236\u8bbe\u5907\u8282\u70b9\u7684\u6743\u9650\u3001\u52a8\u6001\u5206\u914d\u8bbe\u5907\u7684\u4e3b/\u6b21\u8bbe\u5907\u53f7\u7b49\u7b49\u3002</li> </ol> <p></p> <p>\u5728\u4e0d\u540c\u7684\u5e94\u7528\u573a\u666f\u4e0b\uff0c\u8bbe\u5907\u7ba1\u7406\u5668\u63d0\u4f9b\u7684\u80fd\u529b\u4e5f\u4f1a\u76f8\u5e94\u5730\u6269\u5c55\u6216\u88c1\u526a\u3002\u4f8b\u5982\uff0c\u5728\u5d4c\u5165\u5f0f\u548c\u79fb\u52a8\u7ec8\u7aef\u573a\u666f\u4e0b\uff0c\u8bbe\u5907\u6570\u91cf\u548c\u79cd\u7c7b\u76f8\u5bf9\u56fa\u5b9a\u4e14\u8ba1\u7b97\u8d44\u6e90\u6709\u9650\uff0c\u56e0\u6b64\u8bbe\u5907\u7ba1\u7406\u5668\u66f4\u8d8b\u5411\u4e8e\u529f\u80fd\u7cbe\u7b80\u548c\u573a\u666f\u5b9a\u5236\u5316\uff0c\u6bd4\u5982<code>mdev</code>\u4ec5\u652f\u6301\u70ed\u63d2\u62d4\u65f6\u7684\u8bbe\u5907\u8282\u70b9\u66f4\u65b0\u3001<code>vold</code>\u4ec5\u63d0\u4f9b\u53ef\u63d2\u62d4\u5b58\u50a8\u8bbe\u5907\u7684\u6302\u8f7d\u5378\u8f7d\u529f\u80fd\u7b49\u3002\u800c\u5728\u901a\u7528\u670d\u52a1\u5668\u548c\u684c\u9762<code>OS</code>\u4e0a\uff0c\u7531\u4e8e\u7269\u7406\u8bbe\u5907\u79cd\u7c7b\u4e30\u5bcc\u3001\u6570\u91cf\u4f17\u591a\uff0c\u4e14\u4e0a\u5c42\u5e94\u7528\u7684\u4e1a\u52a1\u903b\u8f91\u66f4\u52a0\u590d\u6742\uff0c\u8fd9\u8981\u6c42\u8bbe\u5907\u7ba1\u7406\u5668\u63d0\u4f9b\u66f4\u9ad8\u7684\u7075\u6d3b\u6027\u548c\u53ef\u6269\u5c55\u6027\u3002</p> \u8bbe\u5907\u7ba1\u7406\u5668 \u5e94\u7528\u573a\u666f \u8bf4\u660e \u70ed\u63d2\u62d4 \u5e76\u53d1\u5904\u7406 \u652f\u6301\u901a\u7528\u8bbe\u5907 \u7b56\u7565\u5b9a\u5236 \u66f4\u65b0\u540c\u6b65 <code>android vold</code> \u79fb\u52a8\u7ec8\u7aef\u8bbe\u5907 \u652f\u6301\u5bf9\u53ef\u63d2\u62d4\u5b58\u50a8\u8bbe\u5907\u7684\u6302\u8f7d\u548c\u5378\u8f7d\u7ba1\u7406 \u2714\ufe0f \u2714\ufe0f <code>busybox mdev</code> \u5d4c\u5165\u5f0f\u8bbe\u5907 \u5229\u7528\u5185\u6838\u7684<code>hotplug</code>\u56de\u8c03\u673a\u5236\u89e6\u53d1\u8bbe\u5907\u8282\u70b9\u66f4\u65b0 \u2714\ufe0f \u2714\ufe0f \u2714\ufe0f <code>systemd udev</code> \u670d\u52a1\u5668/\u684c\u9762<code>PC</code> \u4e3b\u6d41\u7684\u7528\u6237\u6001\u8bbe\u5907\u7ba1\u7406\u5668\uff0c\u5177\u5907\u826f\u597d\u7684\u53ef\u6269\u5c55\u6027\uff0c\u652f\u6301\u4e0a\u5c42\u8f6f\u4ef6\u5b9a\u5236\u8bbe\u5907\u5904\u7406\u89c4\u5219 \u2714\ufe0f \u2714\ufe0f \u2714\ufe0f \u2714\ufe0f \u2714\ufe0f <p><code>udev</code>\u4f5c\u4e3a\u6781\u5177\u4ee3\u8868\u6027\u7684\u901a\u7528OS\u7528\u6237\u6001\u8bbe\u5907\u7ba1\u7406\u5668\uff0c\u57fa\u672c\u5360\u636e\u4e86\u4e3b\u6d41\u7684<code>Linux</code>\u53d1\u884c\u7248\u5e73\u53f0\u3002\u76f8\u6bd4\u4e8e\u65e9\u671f\u5185\u6838\u6001\u7684\u8bbe\u5907\u7ba1\u7406\u65b9\u6848<code>devfs/devtmpfs</code>\uff0c<code>udev</code>\u63d0\u4f9b\u66f4\u7075\u6d3b\u3001\u66f4\u5f3a\u5927\u7684\u5b9a\u5236\u5316\u8bbe\u5907\u5904\u7406\u80fd\u529b\uff0c\u6bd4\u5982\u521b\u5efa\u8bbe\u5907\u8f6f\u94fe\u63a5\u3001\u6301\u4e45\u5316\u547d\u540d\u3001\u7f51\u5361\u4fdd\u5e8f\u7b49\u7b49\uff0c\u4f7f\u5f97\u4e0a\u5c42\u8f6f\u4ef6\u53ef\u4ee5\u66f4\u7075\u6d3b\u3001\u66f4\u65b9\u4fbf\u5730\u5b9e\u73b0\u4e1a\u52a1\u903b\u8f91\u3002\u4f46\u662f\u968f\u7740<code>HAL(hardware abstraction layer)</code>\u548c<code>udev</code>\u7684\u529f\u80fd\u6574\u5408\uff0c\u4ee5\u53ca\u540e\u7eed<code>udev</code>\u4e0e<code>systemd</code>\u9879\u76ee\u7684\u5408\u5e76\uff0c<code>udev</code>\u7684\u529f\u80fd\u8d8a\u6765\u8d8a\u81c3\u80bf\uff0c\u8d8a\u6765\u8d8a\u4f9d\u8d56\u4e8e<code>systemd</code>\u7684\u521d\u59cb\u5316\u7cfb\u7edf\u751f\u6001\uff0c\u8fd9\u8fdd\u80cc\u4e86\u8f6f\u4ef6\u8bbe\u8ba1\u7684\u5206\u5c42\u89e3\u8026\u539f\u5219\uff0c\u5bfc\u81f4\u5176\u4ed6\u8f6f\u4ef6\u88ab\u5f3a\u884c\u7ed1\u5b9a\u5230<code>systemd</code>\u751f\u6001\u4e2d\u3002</p> <p><code>sysMaster</code>\u9879\u76ee\u4f5c\u4e3a<code>openEuler</code>\u5bf9\u65b0\u4e00\u4ee3\u7cfb\u7edf\u521d\u59cb\u5316\u548c\u670d\u52a1\u7ba1\u7406\u7cfb\u7edf\u7684\u63a2\u7d22\uff0c\u96c6\u6210\u8bbe\u5907\u7ba1\u7406\u529f\u80fd\u662f\u5fc5\u4e0d\u53ef\u5c11\u7684\u3002<code>devMaster</code>\u4f5c\u4e3a<code>sysMaster</code>\u7684\u8bbe\u5907\u7ba1\u7406\u7ec4\u4ef6\uff0c\u4e00\u65b9\u9762\u652f\u6491<code>sysMaster</code>\u7684\u5feb\u901f\u542f\u52a8\u4ee5\u53ca\u7528\u6237\u6001\u8f6f\u4ef6\u7684\u751f\u6001\u517c\u5bb9\uff0c\u53e6\u4e00\u65b9\u9762\u901a\u8fc7\u5bf9<code>Linux</code>\u751f\u6001\u4e0b\u4e3b\u6d41\u8bbe\u5907\u7ba1\u7406\u65b9\u6848\u7684\u73b0\u72b6\u548c\u4f18\u52a3\u8fdb\u884c\u4e86\u603b\u7ed3\u548c\u601d\u8003\uff0c\u5e0c\u671b\u63d0\u4f9b\u4e00\u79cd\u5206\u5c42\u89e3\u8026\u3001\u53ef\u6269\u5c55\u6027\u5f3a\u3001\u9762\u5411\u901a\u7528<code>OS</code>\u7684\u8bbe\u5907\u7ba1\u7406\u80fd\u529b\u3002</p>"},{"location":"design/extends/02-devmaster-public-article/#devmaster_1","title":"<code>devMaster</code>\u7684\u613f\u666f\u4e0e\u539f\u7406","text":"<p>\u4f5c\u4e3a\u7cfb\u7edf\u521d\u59cb\u5316\u4ee5\u53ca\u5e38\u6001\u8fd0\u884c\u4e0b\u5173\u952e\u7684\u7cfb\u7edf\u529f\u80fd\uff0c\u7528\u6237\u6001\u8bbe\u5907\u7ba1\u7406\u5668\u9700\u8981\u5177\u5907\u6781\u9ad8\u7684\u53ef\u9760\u6027\u3001\u8fd0\u884c\u6548\u7387\u4ee5\u53ca\u53ef\u6269\u5c55\u6027\uff0c\u662f\u652f\u6491\u865a\u62df\u673a/\u7269\u7406\u673a\u542f\u52a8\u4e0e\u8fd0\u884c\u5fc5\u4e0d\u53ef\u5c11\u7684\u7cfb\u7edf\u7ec4\u4ef6\u3002\u56e0\u6b64\uff0c<code>devMaster</code>\u7684\u76ee\u6807\u4e3b\u8981\u5305\u542b\u4ee5\u4e0b\u51e0\u70b9\uff1a</p> <ol> <li>\u6d88\u9664\u7cfb\u7edf\u5c42\u9762\u7684\u5185\u5b58\u5b89\u5168\u95ee\u9898\uff0c\u964d\u4f4e\u9ad8\u5e76\u53d1\u573a\u666f\u4e0b\u7684\u8bbe\u5907\u7ade\u4e89\u7684\u8d1f\u9762\u5f71\u54cd\uff0c\u63d0\u9ad8\u8bbe\u5907\u7ba1\u7406\u5668\u7684\u53ef\u9760\u6027\u548c\u9c81\u68d2\u6027\u3002</li> <li>\u5357\u5411\u517c\u5bb9<code>Linux</code>\u548c\u9e3f\u8499\u5fae\u5185\u6838\u751f\u6001\uff0c\u5317\u5411\u517c\u5bb9\u73b0\u6709\u7528\u6237\u6001\u8f6f\u4ef6\u7684<code>udev</code>\u89c4\u5219\u914d\u7f6e\u548c<code>libudev</code>\u52a8\u6001\u5e93\u63a5\u53e3\u8c03\u7528\uff0c\u652f\u6301\u65e0\u7f1d\u8fc1\u79fb<code>devMaster</code>\u5de5\u5177\u94fe\u3002</li> <li>\u91c7\u7528\u5206\u5c42\u89e3\u8026\u7684\u8f6f\u4ef6\u8bbe\u8ba1\uff0c\u4fdd\u8bc1\u8bbe\u5907\u7ba1\u7406\u5668\u7684\u8f7b\u91cf\u7ea7\u3001\u9ad8\u6548\u7387\uff0c\u540c\u65f6\u5177\u5907\u6781\u81f4\u7684\u53ef\u6269\u5c55\u80fd\u529b\u3002</li> </ol> <p></p> <p><code>devMaster</code>\u7684\u8f6f\u4ef6\u67b6\u6784\u9075\u5faa\u9ad8\u5185\u805a\u3001\u4f4e\u8026\u5408\u7684\u8bbe\u8ba1\u539f\u5219\uff0c\u4fdd\u8bc1\u5404\u7ec4\u4ef6\u804c\u8d23\u72ec\u7acb\uff0c\u63d0\u9ad8\u8f6f\u4ef6\u53ef\u590d\u7528\u3001\u53ef\u66ff\u6362\u3001\u53ef\u6269\u5c55\u80fd\u529b\uff0c\u964d\u4f4e\u5f00\u53d1\u7ef4\u6d4b\u6210\u672c\u3002<code>devMaster</code>\u4e3b\u8981\u5305\u542b\u56db\u90e8\u5206\u7ec4\u4ef6\uff0c\u5206\u4e3a\u5e38\u9a7b\u8fdb\u7a0b<code>devmaster</code>\u3001\u5ba2\u6237\u7aef\u5de5\u5177<code>devctl</code>\u3001\u5bf9\u5916\u5e93\u4ee5\u53ca\u517c\u5bb9\u6027\u5de5\u5177\u3002<code>devMaster</code>\u4f7f\u7528<code>Rust</code>\u8bed\u8a00\u7f16\u5199\uff0c\u80fd\u591f\u539f\u751f\u6d88\u9664\u5185\u5b58\u5b89\u5168\u7c7b\u95ee\u9898\u3002<code>devMaster</code>\u7684\u6838\u5fc3\u539f\u7406\u5982\u4e0b\uff1a</p> <ol> <li>\u4e8b\u4ef6\u9a71\u52a8\uff1a\u5b9e\u65f6\u76d1\u542c\u8bbe\u5907\u70ed\u63d2\u62d4\u4e8b\u4ef6\uff0c\u5e76\u5229\u7528\u961f\u5217\u5206\u7ea7\u6280\u672f\uff0c\u6ee1\u8db3\u4e8b\u4ef6\u9ad8\u5e76\u53d1\u573a\u666f\uff0c\u7f13\u89e3\u8bbe\u5907\u7ade\u4e89\u95ee\u9898\uff0c\u540c\u65f6\u4f7f\u7528<code>worker</code>\u6c60\u673a\u5236\u652f\u6491\u4e8b\u4ef6\u5e76\u53d1\u5904\u7406\u80fd\u529b\uff0c\u63d0\u9ad8\u4e8b\u4ef6\u5904\u7406\u7684\u541e\u5410\u91cf\uff0c\u652f\u6491\u79d2\u7ea7\u542f\u52a8\u80fd\u529b\u3002</li> <li>\u673a\u5236\u4e0e\u7b56\u7565\u5206\u79bb\uff1a\u901a\u8fc7\u5c06\u4e8b\u4ef6\u5904\u7406\u7684\u884c\u4e3a\u5b9a\u4e49\u5728\u5916\u90e8\u89c4\u5219\u6587\u4ef6\u4e2d\uff0c\u907f\u514d\u8bbe\u5907\u5904\u7406\u903b\u8f91\u786c\u7f16\u7801\uff0c\u5e76\u652f\u6301\u8bbe\u5907\u89c4\u5219\u6309\u9700\u7ec4\u5408\u3001\u5b9a\u5236\u3001\u88c1\u526a\uff0c\u63d0\u4f9b\u7075\u6d3b\u3001\u5f3a\u5927\u7684\u53ef\u6269\u5c55\u80fd\u529b\u3002</li> <li>\u53ef\u7ef4\u53ef\u6d4b\uff1a\u901a\u8fc7\u5ba2\u6237\u7aef\u5de5\u5177<code>devctl</code>\u63d0\u4f9b\u5bf9<code>devmaster</code>\u7684\u7528\u6237\u7aef\u63a7\u5236\u63a5\u53e3\uff0c\u63d0\u5347<code>devmaster</code>\u7684\u53ef\u7ef4\u53ef\u6d4b\u80fd\u529b\uff0c\u5e76\u517c\u5bb9<code>udevadm</code>\u9009\u9879\uff0c\u652f\u6301\u7528\u6237\u4f7f\u7528\u4e60\u60ef\u7684\u5e73\u6ed1\u8fc1\u79fb\u3002</li> <li><code>Rust</code>\u5de5\u5177\u94fe\uff1a\u5bf9\u5916\u5e93\u63d0\u4f9b\u5f00\u53d1\u8005\u83b7\u53d6\u786c\u4ef6\u8bbe\u5907\u4fe1\u606f\u4ee5\u53ca\u4e0e<code>devmaster</code>\u4ea4\u4e92\u7684\u5bf9\u5916\u63a5\u53e3\uff0c\u5b8c\u5584<code>Rust</code>\u8bed\u8a00\u5728\u8bbe\u5907\u7ba1\u7406\u9886\u57df\u7684\u4e09\u65b9\u5e93\u4e0e\u5de5\u5177\u94fe\u3002</li> <li>\u751f\u6001\u517c\u5bb9\uff1a\u63d0\u4f9b\u5b8c\u5584\u7684\u5357\u5317\u5411\u517c\u5bb9\u6027\u5de5\u5177\uff0c\u6bd4\u5982<code>udev</code>\u89c4\u5219\u8f6c\u8bd1\u5de5\u5177\u3001\u5bf9\u5916\u5e93\u7684<code>Rust2C</code>\u63a5\u53e3\u8fc1\u79fb\u3001\u7279\u6b8a\u8bbe\u5907\u7ec4\u4ef6\u7b49\uff0c\u652f\u6301<code>udev</code>\u5230<code>devMaster</code>\u751f\u6001\u7684\u65e0\u7f1d\u8fc1\u79fb\u3002\u4f9d\u6258\u6b27\u62c9\u9e3f\u8499\u751f\u6001\uff0c\u6253\u901a\u5d4c\u5165\u5f0f/\u7269\u7406\u673a/\u865a\u62df\u673aOS\u5168\u573a\u666f\u3002</li> </ol> <p>\u603b\u7684\u6765\u8bf4\uff0c<code>devMaster</code>\u7684\u8bbe\u8ba1\u65e8\u5728\u7b80\u5316\u7cfb\u7edf\u67b6\u6784\uff0c\u5e76\u901a\u8fc7\u591a\u9879\u5173\u952e\u6280\u672f\u786e\u4fdd\u8bbe\u5907\u7ba1\u7406\u5668\u5177\u5907\u673a\u5236\u7684\u53ef\u6269\u5c55\u6027\u3001\u53ef\u9760\u6027\u3001\u53ef\u7ef4\u53ef\u6d4b\u80fd\u529b\u3001\u8f6f\u4ef6\u6027\u80fd\u4ee5\u53ca\u751f\u6001\u517c\u5bb9\u80fd\u529b\uff0c\u662f\u4e00\u6b3e\u975e\u5e38\u6709\u4ef7\u503c\u7684\u8bbe\u5907\u7ba1\u7406\u5de5\u5177\u3002</p>"},{"location":"design/extends/02-devmaster-public-article/#devmaster_2","title":"<code>devMaster</code>\u5168\u666f\u56fe","text":"<p>\u4eca\u5e74<code>sysMaster</code>\u5c06\u805a\u7126\u7cfb\u7edf\u5feb\u901f\u542f\u52a8\u80fd\u529b\uff0c\u800c<code>devMaster</code>\u4f5c\u4e3a\u652f\u6491\u5feb\u901f\u542f\u52a8\u7684\u6838\u5fc3\u529f\u80fd\u7ec4\u4ef6\uff0c\u5728<code>2022\u5e7412\u6708\u4efd</code>\u5b8c\u6210\u4e86\u9876\u5c42\u8bbe\u8ba1\u5e76\u89c4\u5212\u4e86\u9884\u8ba13\u4e2a\u5b63\u5ea6\u7684\u5f00\u53d1\u8def\u6807\uff0c<code>2023\u5e741\u6708\u4efd</code>\u671f\u95f4<code>devMaster</code>\u5728<code>sysMaster</code>\u9879\u76ee\u4e2d\u8d21\u732e\u4e86\u7b2c\u4e00\u6b21\u63d0\u4ea4\u5e76\u81ea\u6b64\u5f00\u59cb\u4e86\u6b63\u5f0f\u7684\u7f16\u7801\u5de5\u4f5c\u3002<code>devMaster</code>\u76ee\u524d\u4ecd\u5904\u4e8e\u5feb\u901f\u8fed\u4ee3\uff0c\u5728\u7b2c\u4e00\u4e2a\u5b63\u5ea6\u4e2d\uff0c\u6211\u4eec\u5df2\u5b8c\u6210\u4e86\u4e8b\u4ef6\u9a71\u52a8\u7684\u8f6f\u4ef6\u8fd0\u884c\u6846\u67b6\u7f16\u7801\uff0c\u5305\u62ec\u4e8b\u4ef6\u76d1\u542c\u6a21\u5757\u3001\u4e8b\u4ef6\u961f\u5217\u6a21\u5757\u548cworker\u6c60\uff0c\u53e6\u5916\u6211\u4eec\u4e5f\u5b8c\u6210\u4e86<code>libdevice</code>\u5e93\u7684\u4e3b\u4f53\u529f\u80fd\u4ee5\u53ca<code>devctl</code>\u90e8\u5206\u5b50\u547d\u4ee4\u7684\u5f00\u53d1\u3002\u5728\u7b2c\u4e8c\u4e2a\u5b63\u5ea6\u4e2d\uff0c\u6211\u4eec\u91cd\u70b9\u6295\u5165\u89c4\u5219\u5904\u7406\u6a21\u5757\uff0c\u76ee\u524d\u5df2\u652f\u6301\u89c4\u5219\u52a0\u8f7d\u4ee5\u53ca\u90e8\u5206\u89c4\u5219\u6267\u884c\u529f\u80fd\uff0c\u5e76\u4e14\u5c06\u5728\u540e\u7eed\u5f15\u5165<code>devctl</code>\u7684\u7528\u6237\u8c03\u6d4b\u63a5\u53e3\u3002\u7b2c\u4e09\u4e2a\u5b63\u5ea6\uff0c\u6211\u4eec\u8ba1\u5212\u5b8c\u6210\u4f59\u4e0b\u7684\u8bf8\u5982\u914d\u7f6e\u7ba1\u7406\u3001\u63a7\u5236\u7ba1\u7406\u3001\u8282\u70b9\u76d1\u63a7\u3001\u517c\u5bb9\u6027\u5de5\u5177\u7b49\u7279\u6027\u7f16\u7801\uff0c\u5e76\u9010\u6b65\u5d4c\u5165<code>initramfs</code>\u542f\u52a8\u4ee5\u53ca\u4e3b\u7cfb\u7edf\u521d\u59cb\u5316\u6d41\u7a0b\uff0c\u652f\u6491\u7269\u7406\u76d8\u3001\u903b\u8f91\u5377\u3001PXE\u7b49\u4e0d\u540c\u7cfb\u7edf\u542f\u52a8\u9700\u6c42\uff0c\u6700\u7ec8\u8986\u76d6\u7269\u7406\u673a\u3001\u865a\u62df\u673a\u7b49\u5168\u573a\u666f\u7684\u5feb\u901f\u542f\u52a8\u80fd\u529b\u3002</p>"},{"location":"design/extends/02-switch-root/","title":"service\u8bbe\u8ba1\u6587\u6863","text":""},{"location":"design/extends/02-switch-root/#1","title":"1    \u6982\u8ff0","text":"<p>switch-root\u7528\u6765\u5207\u6362\u5230\u4e0d\u540c\u7684\u6839\u76ee\u5f55\u5e76\u6267\u884c\u65b0\u7684\u7cfb\u7edf\u7ba1\u7406\u8fdb\u7a0b</p>"},{"location":"design/extends/02-switch-root/#2","title":"2    \u7279\u6027\u9700\u6c42\u6982\u8ff0","text":"<p>NA</p>"},{"location":"design/extends/02-switch-root/#3","title":"3    \u9700\u6c42\u573a\u666f\u5206\u6790","text":""},{"location":"design/extends/02-switch-root/#31","title":"3.1    \u7279\u6027\u9700\u6c42\u6765\u6e90\u4e0e\u4ef7\u503c\u6982\u8ff0","text":"<p>switch-root\u662f\u5207\u6362\u6839\u76ee\u5f55\u4e3b\u8981\u5b9e\u73b0\uff0c \u7528\u4e8e\u5c06\u5df2\u5b89\u88c5\u7684/run\u3001/proc/\u3001dev/\u548c/sys\u79fb\u52a8\u5230newroot\uff0c\u4f7fnewroot\u6210\u4e3a\u65b0\u7684\u6839\u6587\u4ef6\u7cfb\u7edf\u5e76\u542f\u52a8init\u8fdb\u7a0b\u3002</p>"},{"location":"design/extends/02-switch-root/#32","title":"3.2    \u7279\u6027\u573a\u666f\u5206\u6790","text":"<p>\u7cfb\u7edf\u542f\u52a8\u540e\u5c06initrd\u5207\u6362\u5230\u65b0\u7684\u6839\u76ee\u5f55\u6587\u4ef6\u7cfb\u7edf</p>"},{"location":"design/extends/02-switch-root/#4","title":"4    \u7279\u6027/\u529f\u80fd\u5b9e\u73b0\u539f\u7406","text":""},{"location":"design/extends/02-switch-root/#41","title":"4.1    \u603b\u4f53\u65b9\u6848","text":"<p>\u603b\u4f53\u5305\u542b2\u4e2a\u90e8\u5206\uff0cswitch-root\u7a0b\u5e8f\u4ee5\u53casctl switch-root\u547d\u4ee4\u3002</p> <p>switch-root:\u5c06\"/dev\", \"/proc\", \"/sys\", \"/run\"move\u81f3\u65b0\u6839\u76ee\u5f55\u4e0b\uff0cpivot_root chroot chdir\u65b0\u7684\u6839\u76ee\u5f55\uff0c\u6e05\u9664\u65e7\u76ee\u5f55\u5185\u5bb9\u3002 sctl switch-root: \u8be5\u547d\u4ee4\u901a\u77e5sysMaster\uff0c\u5c06\u7528\u6237\u81ea\u5b9a\u4e49\u7684init\u53ca\u53c2\u6570\u4fe1\u606f\u5199\u5165\u6587\u4ef6\u4e2d\uff0c\u901a\u8fc7\u4fe1\u53f7\u901a\u77e5init\uff0cinit\u8bfb\u53d6\u6587\u4ef6\u4e2d\u4fe1\u606f\uff0c\u5982\u679c\u7528\u6237\u6307\u5b9ainit\uff0c\u5219reexec\u7528\u6237\u81ea\u5b9a\u4e49init\uff0c\u5426\u5219init\u5c06reexec\u81ea\u8eab\uff0c\u7136\u540ereexec sysMaster\uff0c\u5b8c\u6210\u5728\u65b0\u7684\u6839\u76ee\u5f55\u6587\u4ef6\u7cfb\u7edf\u4e2d\u6267\u884cinit\u8fdb\u7a0b  </p> <pre><code>          basic.target\n               |\n               v\n      initrd-switch-root.target\n               |\n               v\n    initrd-switch-root.service\n    (\u5148\u8fd0\u884cswitch-root\u5207\u6362\u6839\u76ee\u5f55)\n</code></pre> <p>(\u540e\u8fd0\u884csct switch-root\u5728\u65b0\u7684\u6839\u76ee\u5f55\u542f\u52a8init\u8fdb\u7a0b)                    |                    v          \u5207\u6362\u5230\u4e3b\u673a\u4e0a\u7684\u64cd\u4f5c\u7cfb\u7edf</p>"},{"location":"design/extends/02-switch-root/#5function-safety","title":"5\u53ef\u9760\u6027/\u53ef\u7528\u6027/Function Safety\u8bbe\u8ba1","text":"<p>NA</p>"},{"location":"design/extends/02-switch-root/#6","title":"6    \u5b89\u5168/\u9690\u79c1/\u97e7\u6027\u8bbe\u8ba1","text":"<p>NA</p>"},{"location":"design/extends/02-switch-root/#7","title":"7    \u7279\u6027\u975e\u529f\u80fd\u6027\u8d28\u91cf\u5c5e\u6027\u76f8\u5173\u8bbe\u8ba1","text":"<p>NA</p>"},{"location":"design/extends/02-switch-root/#8","title":"8    \u6570\u636e\u7ed3\u6784\u8bbe\u8ba1\uff08\u53ef\u9009\uff09","text":"<p>\u672c\u7ae0\u8282\u5b8c\u6210\u6570\u636e\u5e93\u7ed3\u6784\u7684\u8bbe\u8ba1\uff08\u6570\u636e\u5e93\u8868\u7ed3\u6784\uff0c\u53ef\u4ee5\u4f7f\u7528Power Designer\u5b8c\u6210\uff09\uff0c\u53ef\u9009\u7ae0\u8282\u3002</p>"},{"location":"design/extends/02-switch-root/#9","title":"9    \u8bcd\u6c47\u8868","text":"<p>NA</p>"},{"location":"design/extends/02-switch-root/#10","title":"10   \u5176\u5b83\u8bf4\u660e","text":"<p>NA</p>"},{"location":"design/extends/02-switch-root/#11","title":"11   \u53c2\u8003\u8d44\u6599\u6e05\u5355","text":"<p>NA</p>"},{"location":"design/libiraries/01-event/","title":"\u4e8b\u4ef6\u9a71\u52a8\u6a21\u5757\u7684\u8bbe\u8ba1","text":"<p>Keywords \u5173\u952e\u8bcd\uff1a epoll, \u4e8b\u4ef6\u9a71\u52a8\uff0c\u591a\u8def\u590d\u7528</p> <p>Abstract \u6458\u8981\uff1aevent**\u4e8b\u4ef6\u9a71\u52a8\u6846\u67b6\u662f\u4e00\u79cd\u57fa\u4e8eepoll**\u591a\u8def\u590d\u7528\u7684\u5f02\u6b65\u7f16\u7a0b\u6846\u67b6\uff0c\u5305\u542b\u8c03\u5ea6\u4e3b\u4f53\u3001epoll**\u5c01\u88c5\u53ca\u4e8b\u4ef6\u7c7b\u578b\u652f\u6301\u7b49\u6a21\u5757\u3002</p> <p>List of abbreviations \u7f29\u7565\u8bed\u6e05\u5355\uff1a</p> Abbreviations\u7f29\u7565\u8bed Full   spelling \u82f1\u6587\u5168\u540d Chinese   explanation \u4e2d\u6587\u89e3\u91ca"},{"location":"design/libiraries/01-event/#1","title":"1    \u6982\u8ff0","text":"<p>\u3010\u5173\u952e\u5185\u5bb9\u3011</p> <p>\u4f34\u968f\u7740sysmaster\u9879\u76ee\u7684\u63a8\u8fdb\uff0c\u9700\u8981\u5e95\u5c42\u7f16\u7a0b\u6846\u67b6\u7684\u652f\u6301\uff0c\u6765\u65b9\u4fbf\u7684\u7ba1\u7406\u548c\u8c03\u5ea6\u5f02\u6b65\u4e8b\u4ef6\uff0c\u5e76\u8fdb\u884c\u76f8\u5e94\u7684\u8c03\u5ea6\uff0c\u540c\u65f6\u65b9\u4fbf\u4ee3\u7801\u5f00\u53d1\uff0c\u4f7f\u5f00\u53d1\u8005\u514d\u4e8e\u5173\u6ce8\u5e95\u5c42\u7ec6\u8282\uff0c\u76f4\u63a5\u4f7f\u7528\u5c01\u88c5\u597d\u7684\u4e8b\u4ef6\u7c7b\u578b\u6765\u8fdb\u884c\u5f02\u6b65\u7f16\u7a0b\u3002</p>"},{"location":"design/libiraries/01-event/#11","title":"1.1    \u76ee\u7684","text":"<p>\u3010\u5173\u952e\u5185\u5bb9\u3011</p> <p>\u672c\u6587\u6863\u4e3b\u8981\u9488\u5bf9event\u6a21\u5757\u7684\u529f\u80fd\u8fdb\u884c\u8bbe\u8ba1\uff0c\u660e\u786e0\u5c42\u67b6\u6784\u4ee5\u53ca\u5185\u90e8\u5404\u4e2a\u7ec4\u4ef6\u7684\u8be6\u7ec6\u8bbe\u8ba1\uff0c\u660e\u786e\u4e3b\u8981\u6570\u636e\u7ed3\u6784\u548c\u4e3b\u8981\u5904\u7406\u8fc7\u7a0b\uff0c\u4f5c\u4e3a\u4eca\u540e\u7684\u7f16\u7801\u9636\u6bb5\u7684\u8f93\u5165\u548c\u7f16\u7801\u4eba\u5458\u3001\u6d4b\u8bd5\u4eba\u5458\u7684\u6307\u5bfc\u3002</p>"},{"location":"design/libiraries/01-event/#2","title":"2    \u7279\u6027\u9700\u6c42\u6982\u8ff0","text":"<p>\u88682\uff1a\u7279\u6027\u9700\u6c42\u5217\u8868</p> \u9700\u6c42\u7f16\u53f7 \u9700\u6c42\u540d\u79f0 \u7279\u6027\u63cf\u8ff0 \u4f18\u5148\u7ea7 1 Poll\u4e8b\u4ef6\u5c01\u88c5\u5c42 \u63d0\u4f9b\u4e00\u4e2a\u7edf\u4e00\u7684poll\u63a5\u53e3\u5c42\uff0c\u5c01\u88c5\u5bf9epoll\u7b49\u5e95\u5c42\u5f02\u6b65\u4e8b\u4ef6\u6ce8\u518c\u3001\u5220\u9664\u3001\u76d1\u542c\uff0c\u53ef\u4ee5\u5c4f\u853d\u5e95\u5c42\u5e73\u53f0\u548c\u67b6\u6784\u5dee\u5f02\u3002 \u9ad8 2 Event\u8c03\u5ea6\u6846\u67b6\u5b9e\u73b0 \u63d0\u4f9b\u5bf9\u5f02\u6b65\u4e8b\u4ef6\u7684\u6ce8\u518c\u3001\u8c03\u5ea6\u3001\u5220\u9664\uff0c\u652f\u6301\u4f18\u5148\u7ea7\u3002 \u9ad8 3 Source\u4e8b\u4ef6\u7c7b\u578b\u652f\u6301 \u63d0\u4f9b\u5bf9\u5e38\u89c1\u7684\u5f02\u6b65\u4e8b\u4ef6\u652f\u6301\uff0c\u5982io\u3001timer\u3001signal\u7b49\uff0c\u65b9\u4fbf\u5f00\u53d1\u8005\u4f7f\u7528 \u9ad8"},{"location":"design/libiraries/01-event/#3","title":"3    \u9700\u6c42\u573a\u666f\u5206\u6790","text":""},{"location":"design/libiraries/01-event/#31","title":"3.1    \u7279\u6027\u9700\u6c42\u6765\u6e90\u4e0e\u4ef7\u503c\u6982\u8ff0","text":"<p>\u7ed3\u5408\u4f20\u7edf1\u53f7\u8fdb\u7a0b\u4f18\u7f3a\u70b9\uff0c\u6709\u5fc5\u8981\u5168\u65b0\u6784\u5efa1\u53f7\u8fdb\u7a0b\u6765\u5e94\u5bf9\u672a\u6765\u573a\u666f\u3002\u4e8b\u4ef6\u9a71\u52a8\u5f02\u6b65\u7f16\u7a0b\u6846\u67b6\u4f5c\u4e3a\u8f6f\u4ef6\u5e95\u5ea7\uff0c\u9700\u8981\u7cbe\u786e\u8bbe\u8ba1\uff0c\u800c\u63d0\u4f9b\u7edf\u4e00\u7684\u6846\u67b6\u6709\u5229\u4e8e\u7b80\u5316\u9879\u76ee\u6a21\u578b\uff0c\u52a0\u901f\u8f6f\u4ef6\u5f00\u53d1\u3002</p>"},{"location":"design/libiraries/01-event/#32","title":"3.2    \u7279\u6027\u573a\u666f\u5206\u6790","text":"<p>\u4f7f\u7528\u8be5\u7279\u6027\u7684\u7528\u6237\u4e3b\u8981\u4e3a\u5f00\u53d1\u8005\uff0c\u5f00\u53d1\u8005\u901a\u8fc7\u4f7f\u7528\u7edf\u4e00\u7684\u63a5\u53e3\uff0c\u53ea\u9700\u8981\u6ce8\u518c\u4e8b\u4ef6\u7684\u7c7b\u578b\uff0c\u53ca\u6536\u5230\u4e8b\u4ef6\u540e\u5982\u4f55\u5904\u7406\uff0c\u4fbf\u80fd\u5b8c\u6210\u5f02\u6b65\u4ee3\u7801\u7684\u5f00\u53d1\u3002Event\u6846\u67b6\u5145\u5f53\u8c03\u5ea6\u5668\u89d2\u8272\uff0c\u7ba1\u7406\u3001\u76d1\u542c\u53ca\u8c03\u5ea6\u3002</p>"},{"location":"design/libiraries/01-event/#33","title":"3.3    \u7279\u6027\u5f71\u54cd\u5206\u6790","text":"<p>Event\u7f16\u7a0b\u6846\u67b6\u5c4f\u853d\u4e86\u5e95\u5c42\u5e73\u53f0\u5dee\u5f02\uff0c\u5c01\u88c5\u4e86\u7ec6\u8282\uff0c\u4f7f\u7528rust\u5f00\u53d1\uff0c\u5177\u6709\u9ad8\u53ef\u9760\u6027\u3002\u65e0\u5176\u4ed6\u4f9d\u8d56\uff0c\u552f\u4e00\u4ea4\u4e92\u662fAPI\u3002</p>"},{"location":"design/libiraries/01-event/#34","title":"3.4    \u53cb\u5546\u5b9e\u73b0\u65b9\u6848\u5206\u6790","text":"\u53cb\u5546 \u7279\u70b9 Systemd \u4ee5epoll\u4e3a\u57fa\u7840\uff0c\u5b9e\u73b0event\u8c03\u5ea6\u6846\u67b6  C\u8bed\u8a00\u3001\u4e0d\u652f\u6301mac\u3001windows\u7b49\u5e73\u53f0 Upstart \u5f53\u524d\u65e0\u6b64\u7279\u6027 Sysvinit \u5f53\u524d\u65e0\u6b64\u7279\u6027"},{"location":"design/libiraries/01-event/#4","title":"4    \u7279\u6027/\u529f\u80fd\u5b9e\u73b0\u539f\u7406","text":""},{"location":"design/libiraries/01-event/#41","title":"4.1    \u603b\u4f53\u65b9\u6848","text":"<p>\u6574\u4e2a\u7279\u6027\u5305\u542b\u4e09\u4e2a\u6a21\u5757\uff0cMod Event\uff0cMod Poll\u548cMod Sources\u3002</p> <p>1\uff0e Mod Poll\uff1a\u5c01\u88c5\u5e95\u5c42\u7684epoll\uff08unix\uff09\u3001kqueue\uff08mac\uff09\uff0c\u5411\u4e0a\u63d0\u4f9b\u7edf\u4e00\u7684Poll\u63a5\u53e3\u3002</p> <p>2\uff0e Mod Event\uff1a\u5b9e\u73b0\u4e00\u4e2a\u8c03\u5ea6\u6846\u67b6\uff0c\u5904\u7406\u4e8b\u4ef6\u6ce8\u518c\u3001\u76d1\u542c\u548c\u8c03\u5ea6\u3002\u540c\u65f6\u63d0\u4f9bTrait Source\uff0c\u5b9e\u73b0\u4e86\u8be5Trait\u7684Mod Sources\u90fd\u53ef\u4ee5\u65b9\u4fbf\u7684\u88abEvent\u8c03\u5ea6\u6846\u67b6\u7ba1\u7406\u3002</p> <p>3\uff0e Mod Sources\uff1a\u9ed8\u8ba4\u63d0\u4f9b\u5b9e\u73b0\u4e86Trait Source\u7684\u5e38\u89c1\u4e8b\u4ef6\u7c7b\u578b\uff0c\u4f9b\u7528\u6237\u4f7f\u7528\u3002</p> <p></p>"},{"location":"design/libiraries/01-event/#42-mod-poll","title":"4.2    Mod Poll\u6a21\u5757\u8bbe\u8ba1","text":"<p>Mod Poll\u662f\u5bf9\u5e95\u5c42\u5f02\u6b65IO\u7684\u5c01\u88c5\uff0c\u5448\u73b0\u7edf\u4e00\u7684struct Poll\u89c6\u56fe\u3002</p> \u7c7b\u53ca\u63a5\u53e3 <p>\u901a\u8fc7\u5728\u4e0d\u540c\u5e73\u53f0\u4e0b\uff0c\u5b9e\u73b0\u4e0a\u56fe\u4e2d\u7684\u63a5\u53e3\uff0c\u6765\u8fbe\u5230\u5bf9\u8be5\u5e73\u53f0\u7684\u652f\u6301\u3002\u5728linux\u4e0b\uff0c\u8fd9\u4e9b\u63a5\u53e3\u80cc\u540e\u662f\u7531epoll\u63a5\u53e3\u5b9e\u73b0\u3002\u5728mac\u4e0b\uff0c\u8fd9\u4e9b\u63a5\u53e3\u7531kqueue\u5b9e\u73b0\u3002</p> <p>\u4e0a\u5c42\u65e0\u9700\u5173\u6ce8\u7ec6\u8282\uff0c\u901a\u8fc7\u8c03\u7528Poll\u63d0\u4f9b\u7684\u63a5\u53e3\uff0c\u53ef\u4ee5\u65b9\u4fbf\u7684\u6ce8\u518c\u3001\u518d\u6ce8\u518c\u3001\u6ce8\u9500\u4e8b\u4ef6\u7684\u76d1\u542c\u3002</p> <p>\u8be5Mod\u88abMod Event\u8c03\u7528\u3002</p>"},{"location":"design/libiraries/01-event/#43-mod-event","title":"4.3    Mod Event\u6a21\u5757\u8bbe\u8ba1","text":"<p>Mod Event\u6709Event\u8c03\u5ea6\u5668\u548cTrait Source\u7ec4\u6210\u3002\u524d\u8005\u8d1f\u8d23\u4e8b\u4ef6\u7684\u7ba1\u7406\u548c\u8c03\u5ea6\uff0c\u540e\u8005\u8d1f\u8d23\u5b9a\u4e49\u80fd\u88ab\u8c03\u5ea6\u5668\u7ba1\u7406\u7684\u884c\u4e3a\u63a5\u53e3\u3002</p>"},{"location":"design/libiraries/01-event/#431-struct-event","title":"4.3.1  Struct Event","text":"\u7c7b\u53ca\u63a5\u53e3 <p>Struct Event\u5b9e\u73b0\u4e86\u8c03\u5ea6\u5668\uff0c\u53ef\u4ee5\u6839\u636e\u4f18\u5148\u7ea7\u6765\u8c03\u5ea6\u4e8b\u4ef6\u7684\u5904\u7406\u4ee3\u7801\u3002</p> <p>new()\u65b9\u6cd5\u521d\u59cb\u5316\u5e76\u521b\u5efa\u4e00\u4e2a\u8c03\u5ea6\u5668\u3002</p> <p>add_source()\u65b9\u6cd5\u662f\u5c06\u9700\u8981\u76d1\u542c\u7684\u4e8b\u4ef6\u6ce8\u518c\u5230\u8c03\u5ea6\u5668\u4e2d\u3002</p> <p>run()\u53carloop()\u65b9\u6cd5\u6267\u884c\u8c03\u5ea6\u5668\uff0c\u5f00\u59cb\u76d1\u542c\u3001\u8c03\u5ea6\u3002</p>"},{"location":"design/libiraries/01-event/#432-trait-source","title":"4.3.2  Trait Source","text":"<p>Trait Source\u5b9a\u4e49\u4e86\u7edf\u4e00\u7684\u884c\u4e3a\uff0c\u53ea\u6709\u5b9e\u73b0\u4e86\u8fd9\u4e9b\u63a5\u53e3\u7684\u4e8b\u4ef6\u7c7b\u578b\u624d\u80fd\u88abEvent\u8c03\u5ea6\u5668\u7eb3\u7ba1\u3002</p> trait\u53ca\u63a5\u53e3 <p>Struct Event\u5b9e\u73b0\u4e86\u8c03\u5ea6\u5668\uff0c\u53ef\u4ee5\u6839\u636e\u4f18\u5148\u7ea7\u6765\u8c03\u5ea6\u4e8b\u4ef6\u7684\u5904\u7406\u4ee3\u7801\u3002</p> <p>fd()\u7ed9\u51fa\u9700\u8981\u76d1\u542c\u7684fd\u3002</p> <p>epoll_filter()\u6307\u5b9a\u8981\u76d1\u542cfd\u4e0a\u7684\u4e8b\u4ef6\u7c7b\u578b\uff0c\u5982EPOLLIN\u3001EPOLLOUT\u7b49\u3002</p> <p>priority()\u8bbe\u7f6e\u4e8b\u4ef6\u7684\u4f18\u5148\u7ea7\u3002</p> <p>dispatch()\u76d1\u542c\u5230\u4e8b\u4ef6\u540e\uff0c\u88ab\u8c03\u5ea6\u5668\u8c03\u5ea6\u6267\u884c\u7684\u4e1a\u52a1\u4ee3\u7801\u3002</p>"},{"location":"design/libiraries/01-event/#44-trait-sources","title":"4.4 Trait Sources","text":"<p>Mod Sources\u4e0b\u5305\u542b\u82e5\u5e72\u5b9e\u73b0\u4e86trait Source\u7684\u4e8b\u4ef6\u7c7b\u578b\uff0c\u5982IO\uff0ctimer\uff0csignal\u7b49\u3002\u7528\u6237\u901a\u8fc7\u76f4\u63a5\u5b9a\u4e49\u6216\u5c01\u88c5\u8be5\u5bf9\u8c61\uff0c\u5176\u5b9e\u4f53\u53ef\u4ee5\u88abEvent\u8c03\u5ea6\u3002</p>"},{"location":"design/libiraries/01-event/#441","title":"4.4.1     \u8bbe\u8ba1\u601d\u8def","text":"<p>\u5404\u79cd\u4e8b\u4ef6\u7c7b\u578b\uff0c\u6839\u636e\u5b9e\u9645\u7684\u7528\u9014\u5bf9trait Source\u8fdb\u884c\u5c01\u88c5\uff0c\u5982signal\u7c7b\u578b\uff0c\u901a\u8fc7\u521b\u5efasignalfd\uff0c\u5c06\u6240\u8981\u76d1\u542c\u7684\u4e8b\u4ef6\u7edf\u4e00\u6302\u9760\u5230\u8be5fd\u4e2d\uff0c\u7136\u540e\u5c06fd\u6ce8\u518c\u5230event\u4e2d\uff0c\u4ece\u800c\u5b9e\u73b0\u5176\u529f\u80fd\u3002</p> <p>\u6bcf\u4e00\u4e2aTimer\u4e8b\u4ef6\u53ef\u4ee5\u521b\u5efa\u4e00\u4e2atimerfd\uff0c\u4f46\u7531\u4e8e\u7cfb\u7edf\u4e2d\u7684\u6587\u4ef6\u53e5\u67c4\u6570\u76ee\u6709\u9650\uff0c\u4e00\u79cd\u597d\u7684\u65b9\u6848\u662f\u4e3a\u6bcf\u79cd\u7c7b\u578b\u7684\u65f6\u949f\u6e90\u521b\u5efa\u4e00\u4e2atimefd\uff0c\u7136\u540e\u81ea\u8eab\u8bbe\u7f6e\u4e00\u4e2a\u8c03\u5ea6\u7b97\u6cd5\u6765\u7ba1\u7406timer\uff0c\u53ea\u9700\u5c11\u91cf\u7684fd\u4fbf\u53ef\u4ee5\u5b8c\u6210timer\u4e8b\u4ef6\u7684\u9a71\u52a8\u3002</p> <p>\u5176\u4ed6\u7c7b\u578b\u7684\u4e8b\u4ef6\u7c7b\u578b\u3002</p>"},{"location":"design/libiraries/01-event/#45","title":"4.5    \u7279\u6027\u4e0b\u7684\u975e\u529f\u80fd\u9700\u6c42\u8bbe\u8ba1","text":"<p>NA</p>"},{"location":"design/libiraries/01-event/#5-function-safety","title":"5    \u53ef\u9760\u6027/\u53ef\u7528\u6027/Function Safety\u8bbe\u8ba1","text":"<p>NA</p>"},{"location":"design/libiraries/01-event/#6","title":"6    \u5b89\u5168/\u9690\u79c1/\u97e7\u6027\u8bbe\u8ba1","text":"<p>NA</p>"},{"location":"design/libiraries/01-event/#7","title":"7    \u7279\u6027\u975e\u529f\u80fd\u6027\u8d28\u91cf\u5c5e\u6027\u76f8\u5173\u8bbe\u8ba1","text":"<p>NA</p>"},{"location":"design/libiraries/01-event/#8","title":"8    \u6570\u636e\u7ed3\u6784\u8bbe\u8ba1\uff08\u53ef\u9009\uff09","text":"<p>\u672c\u7ae0\u8282\u5b8c\u6210\u6570\u636e\u5e93\u7ed3\u6784\u7684\u8bbe\u8ba1\uff08\u6570\u636e\u5e93\u8868\u7ed3\u6784\uff0c\u53ef\u4ee5\u4f7f\u7528Power Designer\u5b8c\u6210\uff09\uff0c\u53ef\u9009\u7ae0\u8282\u3002</p>"},{"location":"design/libiraries/01-event/#9","title":"9    \u8bcd\u6c47\u8868","text":"\u8bcd\u6c47\u8868 \u540d\u79f0 \u63cf\u8ff0"},{"location":"design/libiraries/01-event/#10","title":"10   \u5176\u5b83\u8bf4\u660e","text":"<p>NA</p>"},{"location":"design/libiraries/01-event/#11_1","title":"11   \u53c2\u8003\u8d44\u6599\u6e05\u5355","text":"<p>\u8bf7\u7f57\u5217\u672c\u6587\u6863\u6240\u53c2\u8003\u7684\u6709\u5173\u53c2\u8003\u6587\u732e\u548c\u76f8\u5173\u6587\u6863\uff0c\u683c\u5f0f\u5982\u4e0b\uff1a</p> <p>\u4f5c\u8005\uff0b\u4e66\u540d\uff08\u6216\u6742\u5fd7\u3001\u6587\u732e\u3001\u6587\u6863\uff09\uff0b\u51fa\u7248\u793e\uff08\u6216\u671f\u53f7\u3001\u5377\u53f7\u3001\u516c\u53f8\u6587\u6863\u7f16\u53f7\uff09\uff0b\u51fa\u7248\u65e5\u671f+\u8d77\u6b62\u9875\u7801</p> <p>(1)  \u5f20\u4e07\u80dc\uff0c\u67b6\u6784\u4e0e\u6a21\u5757\u8bbe\u8ba1.ppt\uff0c2009</p>"},{"location":"man/all/","title":"Warnings","text":"<ol> <li>\u7531\u4e8eRust\u4f7f\u7528String\u5b57\u7b26\u4e32,\u5bf9\u4e8e\u957f\u5ea6\u65e0\u9650\u5236, \u5efa\u8bae\u7528\u6237\u5728\u64b0\u5199\u914d\u7f6e\u6587\u4ef6\u65f6\u63a7\u5236\u5728\u5408\u7406\u7684\u957f\u5ea6\u5185.</li> <li>sysmaster\u9ed8\u8ba4\u652f\u6301\u7684unit\u6700\u5927\u6570\u91cf\u4e3a500\u4e2a\uff0c\u8d85\u8fc7\u8be5\u503c\u53ef\u80fd\u4f1a\u5f02\u5e38\u9000\u51fa\u3002\u7528\u6237\u53ef\u4ee5\u901a\u8fc7\u4fee\u6539/etc/sysmaster/system.conf\u7684DbSize\u914d\u7f6e\u63d0\u9ad8unit\u4e0a\u9650\u3002\u4fee\u6539\u65b9\u6cd5\u8bf7\u53c2\u8003\uff1a\u5916\u7f6edb\u914d\u7f6e</li> </ol>"},{"location":"man/devctl/","title":"devctl \u547d\u4ee4","text":""},{"location":"man/devctl/#1","title":"1.\u7b80\u4ecb","text":"<p>devctl\u662fdevmaster\u7684\u7ba1\u7406\u5de5\u5177\uff0c\u5176\u529f\u80fd\u5305\u62ec\u63a7\u5236devmaster\u884c\u4e3a\u3001\u76d1\u542c\u8bbe\u5907\u4e8b\u4ef6\u3001\u8c03\u8bd5\u7b49\u7b49\u3002</p>"},{"location":"man/devctl/#_1","title":"\u9009\u9879","text":"<p>-h, --help     \u663e\u793a\u5e2e\u52a9\u4fe1\u606f</p> <p>-V, --version     \u663e\u793a\u7248\u672c\u4fe1\u606f</p>"},{"location":"man/devctl/#2","title":"2.\u5b50\u547d\u4ee4","text":""},{"location":"man/devctl/#devctl-monitor","title":"devctl monitor","text":"<p>\u76d1\u542c\u5185\u6838\u4e0a\u62a5\u7684uevent\u4e8b\u4ef6\u548cdevmaster\u5904\u7406\u5b8c\u8bbe\u5907\u540e\u53d1\u51fa\u7684\u4e8b\u4ef6\uff0c\u5206\u522b\u4ee5<code>KERNEL</code>\u548c<code>USERSPACE</code>\u4f5c\u4e3a\u524d\u7f00\u8fdb\u884c\u533a\u5206\u3002</p> <p>\u53c2\u6570\uff1a\u65e0</p> <p>\u9009\u9879\uff1a     -h, --help  \u663e\u793a\u5e2e\u52a9\u4fe1\u606f</p>"},{"location":"man/devctl/#deprecated-devctl-kill","title":"[deprecated] devctl kill","text":"<p>\u4f7fdevmaster\u7ec8\u6b62\u6240\u6709worker\uff0c\u6b63\u5728\u8fd0\u884c\u4e2d\u7684worker\u4f1a\u7b49\u5f85\u6267\u884c\u5b8c\u5f53\u524d\u4efb\u52a1\u518d\u7ec8\u6b62\uff0c\u671f\u95f4\u65e0\u6cd5\u518d\u63a5\u6536\u65b0\u7684\u4efb\u52a1\u3002</p> <p>\u53c2\u6570\uff1a\u65e0</p> <p>\u9009\u9879\uff1a     -h, --help  \u663e\u793a\u5e2e\u52a9\u4fe1\u606f</p>"},{"location":"man/devctl/#deprecated-devctl-test","title":"[deprecated] devctl test  <p>\u5411devmaster\u53d1\u9001\u6a21\u62df\u8bbe\u5907\uff0c\u8c03\u8bd5devmaster\u7684\u6846\u67b6\u529f\u80fd\u3002</p> <p>\u53c2\u6570\uff1a        \u6a21\u62df\u8bbe\u5907\u7684\u540d\u79f0 <p>\u9009\u9879\uff1a     -h, --help  \u663e\u793a\u5e2e\u52a9\u4fe1\u606f</p>","text":""},{"location":"man/devctl/#devctl-trigger-options-devices","title":"devctl trigger [OPTIONS] [DEVICES]... <p>\u6a21\u62df\u4e00\u4e2a\u8bbe\u5907\u52a8\u4f5c\uff0c\u4f7f\u5185\u6838\u4e0a\u62a5\u5bf9\u5e94\u7684uevent\u4e8b\u4ef6\uff0c\u7528\u4e8e\u91cd\u653e\u5185\u6838\u521d\u59cb\u5316\u8fc7\u7a0b\u4e2d\u7684\u51b7\u63d2(coldplug)\u8bbe\u5907\u4e8b\u4ef6\u3002</p> <p>\u53c2\u6570\uff1a     ...    \u4ee5/sys\u6216/dev\u5f00\u5934\u7684\u8bbe\u5907\u8def\u5f84 <p>\u9009\u9879\uff1a     -h, --help              \u663e\u793a\u5e2e\u52a9\u4fe1\u606f     -a, --action    \u6307\u5b9a\u8bbe\u5907\u4e8b\u4ef6\u7684\u52a8\u4f5c\u7c7b\u578b     -t, --type        \u6307\u5b9aenumerator\u7684\u7c7b\u578b\uff0c\u53ef\u4ee5\u662fdevices\uff08\u9ed8\u8ba4\uff09\u6216\u8005subsystems     -v, --verbose           \u6253\u5370enumerator\u641c\u7d22\u5230\u7684\u8bbe\u5907     -n, --dry-run           \u4e0d\u4f1a\u5b9e\u9645\u89e6\u53d1\u8bbe\u5907\u4e8b\u4ef6\uff0c\u914d\u5408--verbose\u9009\u9879\u4f7f\u7528\u65f6\uff0c\u53ef\u4ee5\u67e5\u770b\u7cfb\u7edf\u4e2d\u7684\u8bbe\u5907\u5217\u8868","text":""},{"location":"man/devmaster/","title":"devmaster \u7528\u6237\u624b\u518c","text":""},{"location":"man/devmaster/#_1","title":"\u914d\u7f6e\u6587\u4ef6","text":""},{"location":"man/devmaster/#_2","title":"\u914d\u7f6e\u6587\u4ef6\u8def\u5f84","text":"<p><code>/etc/devmaster/config.toml</code></p>"},{"location":"man/devmaster/#_3","title":"\u914d\u7f6e\u9009\u9879","text":"<p><code>rules_d</code>: \u89c4\u5219\u52a0\u8f7d\u8def\u5f84\uff0c\u9ed8\u8ba4\u503c\u4e3a<code>[\"/etc/devmaster/rules.d\", \"/run/devmaster/rules.d\", \"/usr/local/lib/devmaster/rules.d\", \"/usr/lib/devmaster/rules.d\"]</code>\u3002</p> <p><code>children_max</code>: \u6700\u5927worker\u7ebf\u7a0b\u5e76\u53d1\u6570\uff0c\u9ed8\u8ba4\u4e3a3\u3002</p> <p><code>log_level</code>: \u65e5\u5fd7\u7ea7\u522b\uff0c\u652f\u6301<code>\"trace\"</code>\uff0c<code>\"debug\"</code>\uff0c<code>\"info\"</code>\uff0c<code>\"warn\"</code>\uff0c<code>\"error\"</code>\uff0c<code>\"off\"</code>\uff0c\u9ed8\u8ba4\u503c\u4e3a<code>\"info\"</code>\u3002</p>"},{"location":"man/devmaster/#_4","title":"\u7f51\u5361\u91cd\u547d\u540d\u7b56\u7565\u8bbe\u7f6e","text":"<p>\u5f53\u524d\u652f\u6301\u7684\u7f51\u5361\u91cd\u547d\u540d\u7b56\u7565\u5305\u542b<code>v023</code>\u548c<code>latest</code>\uff0c<code>latest</code>\u91c7\u7528\u6700\u65b0\u7248\u672c\u7684\u7f51\u5361\u547d\u540d\u7b56\u7565\uff0c\u65b0\u7248\u672c\u7b56\u7565\u8986\u76d6\u8001\u7248\u672c\u7b56\u7565\u3002\u8bbe\u7f6e\u4e3a<code>v000</code>\u6216<code>0</code>\u5173\u95ed\u7f51\u5361\u91cd\u547d\u540d\u89c4\u5219\u3002</p> <ol> <li> <p>\u914d\u7f6e\u542f\u52a8\u53c2\u6570: <code>net.naming-scheme=&lt;scheme&gt;</code></p> </li> <li> <p>\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf: <code>NET_NAMING_SCHEME=&lt;scheme&gt;</code></p> </li> </ol> <p>NOTES: \u73af\u5883\u53d8\u91cf<code>NET_NAMING_SCHEME</code>\u7684\u503c\u4ee5':'\u5f00\u5934\u65f6\uff0c\u5219\u4f18\u5148\u4f7f\u7528\u542f\u52a8\u53c2\u6570\u914d\u7f6e\u7684\u7b56\u7565\uff0c\u5426\u5219\u4f18\u5148\u4f7f\u7528\u73af\u5883\u53d8\u91cf\u914d\u7f6e\u7684\u7b56\u7565\u3002</p>"},{"location":"man/exec/","title":"\u547d\u4ee4\u6267\u884c\u73af\u5883","text":"<p>sysmaster\u7684<code>socket</code>\u3001<code>service</code>\u4f1a\u62c9\u8d77\u8fdb\u7a0b\uff0c\u8be5\u6587\u6863\u63cf\u8ff0\u4ed6\u4eec\u72ec\u6709\u7684\u9488\u5bf9\u8fdb\u7a0b\u4e0a\u4e0b\u6587\u7684\u76f8\u5173\u914d\u7f6e\u3002</p> <p>\u6ce8\u610f\uff1a \u5f53\u524d\u6682\u4e0d\u652f\u6301<code>socket</code>\u4e2d\u914d\u7f6e\u4ee5\u4e0b\u5185\u5bb9\u3002</p>"},{"location":"man/exec/#workingdiretory","title":"WorkingDiretory","text":"<ul> <li>\u7c7b\u578b\uff1a\u5b57\u7b26\u4e32</li> </ul> <p>\u914d\u7f6e\u8fdb\u7a0b\u7684\u5de5\u4f5c\u76ee\u5f55\u3002\u652f\u6301\u914d\u7f6e\u4e3a\u7edd\u5bf9\u8def\u5f84\u6216<code>\"~\"</code>\u3002\u914d\u7f6e\u4e3a<code>\"~\"</code>\uff0c\u5de5\u4f5c\u76ee\u5f55\u5c06\u89e3\u6790\u4e3a\u5f53\u524d\u7528\u6237\u7684home\u76ee\u5f55\u3002\u652f\u6301\u5728\u8def\u5f84\u524d\u6dfb\u52a0<code>\"-\"</code>\uff0c\u8868\u793a\u5ffd\u7565\u76ee\u5f55\u4e0d\u5b58\u5728\u7684\u9519\u8bef\u3002</p>"},{"location":"man/exec/#rootdirectory","title":"RootDirectory","text":"<ul> <li>\u7c7b\u578b\uff1a\u5b57\u7b26\u4e32</li> </ul> <p>\u914d\u7f6e\u8fdb\u7a0b\u7684\u6839\u76ee\u5f55\uff0c\u4ec5\u652f\u6301\u7edd\u5bf9\u8def\u5f84\u3002\u547d\u4ee4\u6267\u884c\u524d\uff0csysmaster\u4f1a\u8c03\u7528chroot(2)\u4fee\u6539\u547d\u4ee4\u6267\u884c\u7684\u6839\u76ee\u5f55\u3002</p>"},{"location":"man/exec/#runtimedirectorystatedirectory","title":"RuntimeDirectory/StateDirectory","text":"<ul> <li>\u7c7b\u578b\uff1a\u5b57\u7b26\u4e32</li> </ul> <p>\u914d\u7f6e\u8fdb\u7a0b\u7684\u8fd0\u884c\u65f6\u76ee\u5f55\uff0c\u4ec5\u652f\u6301\u76f8\u5bf9\u8def\u5f84\u3002sysmaster\u4f1a\u5728\u542f\u52a8\u670d\u52a1\u65f6\uff0c\u5728\u76f8\u5e94\u7684\u76ee\u5f55\uff08\u53c2\u8003\u4e0b\u8868\uff09\u4e0b\u521b\u5efa\u914d\u7f6e\u7684\u8fd0\u884c\u65f6\u76ee\u5f55\uff0c\u5982\u679c\u670d\u52a1\u540c\u65f6\u914d\u7f6e\u4e86<code>User</code>\uff0c<code>Group</code>\uff0c\u4f1a\u4fee\u6539\u8fd0\u884c\u65f6\u76ee\u5f55\u7684\u5c5e\u7ec4\u3001\u5c5e\u4e3b\u3002</p> \u914d\u7f6e \u5728\u54ea\u513f\u521b\u5efa\u8fd0\u884c\u65f6\u76ee\u5f55 RuntimeDirectory /run StateDirectory /var/lib"},{"location":"man/exec/#runtimedirectorypreserve","title":"RuntimeDirectoryPreserve","text":"<ul> <li>\u7c7b\u578b\uff1a\u5b57\u7b26\u4e32</li> </ul> <p>\u5141\u8bb8\u914d\u7f6e\u4e3a<code>\"yes\"</code>\uff0c<code>\"no\"</code>\uff0c<code>\"restart\"</code>\uff0c\u9ed8\u8ba4\u503c\u4e3a<code>\"no\"</code>\u3002\u914d\u7f6e\u4e3a<code>\"yes\"</code>\u65f6\uff0c\u5173\u95ed\u670d\u52a1\u65f6\u4f1a\u4fdd\u7559<code>RuntimeDirectory</code>\u751f\u6210\u7684\u76ee\u5f55\u3002\u914d\u7f6e\u4e3a<code>\"no\"</code>\u65f6\uff0c\u5173\u95ed\u670d\u52a1\u65f6\u5c06\u5220\u9664\u8be5\u76ee\u5f55\u3002\u914d\u7f6e\u4e3a<code>\"restart\"</code>\u65f6\uff0c\u91cd\u542f\u670d\u52a1\u65f6\uff08\u624b\u52a8\u91cd\u542f\u6216Restart\u89e6\u53d1\uff09\u4f1a\u4fdd\u7559\u8be5\u76ee\u5f55\u3002</p>"},{"location":"man/init/","title":"Init","text":""},{"location":"man/init/#1","title":"1. \u7b80\u4ecb","text":"<p>init\u4f5c\u4e3a\u7528\u6237\u6001\u76841\u53f7\u8fdb\u7a0b\uff0c\u5176\u529f\u80fd\u5305\u62ec\u7ba1\u7406sysmaster\u3001\u56de\u6536\u50f5\u5c38\u8fdb\u7a0b\u3002</p>"},{"location":"man/init/#2","title":"2. \u53c2\u6570\u9009\u9879","text":"<ul> <li> <p>--timewait=value</p> <p>\u8bbe\u7f6e\u7b49\u5f85sysmaster\u8fde\u63a5\u8d85\u65f6\u65f6\u957fvalue\u79d2\uff0c\u8bbe\u7f6e\u4fdd\u6d3b\u8d85\u65f6\u7684\u65f6\u957f\u4e3avalue\u79d2\uff0c\u9ed8\u8ba4\u8d85\u65f6\u65f6\u957f\u4e3a10\u79d2\uff0c\u6700\u77ed\u8bbe\u7f6e\u8d85\u65f6\u65f6\u95f4\u4e3a10\u79d2\u3002</p> </li> <li> <p>--timecnt=value</p> <p>\u8bbe\u7f6e\u4fdd\u6d3b\u8d85\u65f6\u7684\u6700\u5927\u6b21\u6570\u4e3avalue\u6b21\uff0c\u4e0etimewait\u7ec4\u5408\u4f7f\u7528\uff0c\u8d85\u8fc7\u6700\u5927\u8d85\u65f6\u6b21\u6570\u540e\u8ba4\u4e3asysmaster\u5df2\u5931\u6d3b\uff0c\u6267\u884c\u91cd\u62c9\u8d77\u3002\u9ed8\u8ba4\u6700\u5927\u6b21\u6570\u4e3a5\u6b21\uff0c\u6700\u77ed\u8bbe\u7f6e\u8d85\u65f6\u6b21\u6570\u4e3a2\u6b21\u3002</p> </li> </ul>"},{"location":"man/init/#3","title":"3. \u6ce8\u610f\u4e8b\u9879","text":"<p>sysmaster\u4e8c\u8fdb\u5236\u7a0b\u5e8f\u5fc5\u987b\u5b58\u653e\u5728<code>/usr/lib/sysmaster/</code>\u76ee\u5f55\u4e0b\u3002</p>"},{"location":"man/init/#4","title":"4. \u73b0\u72b6","text":"<ul> <li>\u4e00\u53f7\u8fdb\u7a0b\u662f\u6240\u6709\u7528\u6237\u6001\u8fdb\u7a0b\u7684\u7956\u5148\uff0c\u4f4d\u7f6e\u5173\u952e\uff0c\u975e\u5e38\u5bb9\u6613\u5bfc\u81f4\u6574\u4e2a\u7cfb\u7edf\u5954\u6e83\u3002</li> <li>\u539f\u4e00\u53f7\u8fdb\u7a0b\u4f7f\u7528C\u8bed\u8a00\u5f00\u53d1\uff0c\u529f\u80fd\u590d\u6742\uff0c\u89c4\u6a21\u5e9e\u5927\uff0c\u5185\u5b58\u7c7b\u95ee\u9898\u8f83\u591a\u3002</li> <li>\u8fdb\u7a0b\u5347\u7ea7\u65f6\u4f1a\u4f7f\u7528execve\u7cfb\u7edf\u8c03\u7528\uff0c\u800c\u6b64\u8c03\u7528\u5b58\u5728\u5931\u8d25\u7684\u98ce\u9669\u3002</li> </ul>"},{"location":"man/init/#5","title":"5. \u76ee\u6807\uff1a\u4f7f\u7cfb\u7edf\u5177\u6709\u4e00\u4e2a\u7a33\u56fa\u7684\u4e00\u53f7\u8fdb\u7a0b\u4f5c\u4e3a\u652f\u6491\u70b9","text":"<ul> <li>\u4e00\u65e6\u6210\u529f\u8fd0\u884c\u5c31\u4e0d\u9700\u8981\u5173\u6ce8\u6216\u5347\u7ea7\u3002</li> <li>\u5728\u7cfb\u7edf\u5904\u4e8e\u53ef\u6062\u590d\u6545\u969c\u65f6\u63d0\u4f9b\u5347\u7ea7/\u91cd\u6267\u884c\u901a\u9053\uff0c\u7528\u4e8e\u6545\u969c\u6062\u590d\u3002</li> <li>\u5728\u7cfb\u7edf\u9677\u5165\u4e0d\u53ef\u6062\u590d\u6545\u969c\u65f6\u63d0\u4f9b\u9003\u751f\u901a\u9053\uff0c\u7528\u4e8e\u73b0\u573a\u6536\u96c6\u3002</li> </ul>"},{"location":"man/init/#6","title":"6. \u573a\u666f","text":"<ul> <li>\u7cfb\u7edf\u542f\u52a8</li> <li>\u7cfb\u7edf\u6b63\u5e38\u8fd0\u884c</li> <li>\u7cfb\u7edf\u53ef\u6062\u590d\u5f02\u5e38</li> <li>\u7cfb\u7edf\u4e0d\u53ef\u6062\u590d\u5f02\u5e38</li> </ul>"},{"location":"man/init/#7","title":"7. \u6574\u4f53\u601d\u8def","text":"<ul> <li>\u5c06\u670d\u52a1\u7ba1\u7406\u529f\u80fd\u4ece\u4e00\u53f7\u8fdb\u7a0b(init)\u4e2d\u5265\u79bb\u51fa\u6765\u4ee5\u72ec\u7acb\u8fdb\u7a0b(manager)\u5f62\u5f0f\u5b58\u5728\uff0c\u51cf\u5c11init\u8fdb\u7a0b\u5b8c\u6210\u7684\u4e8b\u52a1\u8303\u56f4\u3002</li> <li>\u4e1a\u52a1\u8fdb\u7a0b\u7684\u542f\u52a8\u3001\u76d1\u7ba1\u7531manager\u8fdb\u7a0b\u5b8c\u6210\uff0cinit\u8fdb\u7a0b\u901a\u8fc7\u542f\u52a8\u3001\u76d1\u7ba1manager\u8fdb\u7a0b\u6765\u5b8c\u5907\u6574\u4f53\u542f\u52a8\u3001\u53ef\u9760\u6027\u94fe\u6761\u3002</li> <li>manager\u5904\u4e8e\u53ef\u6062\u590d\u5f02\u5e38\u72b6\u6001\u65f6\uff0cinit\u8fdb\u7a0b\u7ef4\u6301manager\u5347\u7ea7/\u91cd\u6267\u884c\u901a\u9053\u3002</li> <li>manager\u5904\u4e8e\u4e0d\u53ef\u6062\u590d\u72b6\u6001\u65f6\uff0cinit\u8fdb\u7a0b\u7ef4\u6301\u7cfb\u7edf\u9003\u751f\u901a\u9053\u3002</li> <li>init\u4e2d\u7684\u529f\u80fd\u53ea\u5305\u62ec\uff1a\u76d1\u7ba1manager\u8fdb\u7a0b\u3001\u50f5\u5c38\u8fdb\u7a0b\u56de\u6536\u3002</li> </ul>"},{"location":"man/init/#8","title":"8. \u6280\u672f\u65b9\u6848","text":"<p>\u5f85\u8865\u5145</p>"},{"location":"man/init/#9","title":"9. \u73af\u5883\u53d8\u91cf","text":"<p>\u5728containerd\u7684\u5bb9\u5668\u73af\u5883\u4e2d\uff0c \u7531\u4e8e\u65e0\u65b9\u83b7\u53d6\u5f53\u524d\u6240\u5904\u7684\u5bb9\u5668\u73af\u5883\uff0c \u5728\u542f\u52a8\u65f6\u9700\u8981\u6307\u5b9acontainer\u73af\u5883\u53d8\u91cf\uff0c \u5982<code>container=containerd</code>\u3002</p>"},{"location":"man/sctl/","title":"sctl \u547d\u4ee4","text":""},{"location":"man/sctl/#start","title":"start","text":"<p>\u901a\u8fc7<code>sctl start</code>\u547d\u4ee4\u542f\u52a8\u4e00\u4e2a\u6216\u591a\u4e2aunit\uff0c\u5982\u679c\u542f\u52a8\u591a\u4e2aunit\uff0c\u5b83\u4eec\u4e4b\u95f4\u91c7\u7528\u7a7a\u683c\u5206\u9694\u3002</p>"},{"location":"man/sctl/#_1","title":"\u547d\u4ee4\u7684\u8fd4\u56de\u503c\uff1a","text":"<p>\u5f53\u547d\u4ee4\u6267\u884c\u6210\u529f\u65f6\uff0c\u8fd4\u56de0\uff0c\u5426\u5219\uff0c\u8fd4\u56de\u4e00\u4e2a\u6b63\u6570\u8868\u793a\u5bf9\u5e94\u7684linux\u6807\u51c6\u9519\u8bef\u7801\u3002</p> <p>\u6ce8\u610f\uff1a \u8fd4\u56de\u503c\u4e3a0\uff0c\u5e76\u4e0d\u610f\u5473\u7740\u5355\u5143\u88ab\u6210\u529f\u542f\u52a8\u6216\u8005\u5355\u5143\u7684\u542f\u52a8\u72b6\u6001\u4e3a<code>active</code>\uff0c\u53ea\u662f\u8bf4\u660e\u542f\u52a8\u8be5\u670d\u52a1\u7684\u52a8\u4f5c\u5df2\u6267\u884c\u6210\u529f\u3002</p>"},{"location":"man/sctl/#stop","title":"stop","text":"<p>\u901a\u8fc7<code>sctl stop</code>\u547d\u4ee4\u5173\u95ed\u4e00\u4e2a\u6216\u591a\u4e2aunit\uff0c\u5982\u679c\u5173\u95ed\u591a\u4e2aunit\uff0c\u5b83\u4eec\u4e4b\u95f4\u91c7\u7528\u7a7a\u683c\u5206\u9694\u3002</p>"},{"location":"man/sctl/#_2","title":"\u547d\u4ee4\u7684\u8fd4\u56de\u503c\uff1a","text":"<p>\u5f53\u547d\u4ee4\u6267\u884c\u6210\u529f\u65f6\uff0c\u8fd4\u56de0\uff0c\u5426\u5219\uff0c\u8fd4\u56de\u4e00\u4e2a\u6b63\u6570\u8868\u793a\u5bf9\u5e94\u7684linux\u6807\u51c6\u9519\u8bef\u7801\u3002</p> <p>\u6ce8\u610f\uff1a \u4e0e<code>start</code>\u547d\u4ee4\u7c7b\u4f3c\uff0c\u8fd4\u56de\u503c\u4e3a0,\u5e76\u4e0d\u610f\u5473\u7740\u5355\u5143\u88ab\u6210\u529f\u5173\u95ed\u6216\u8005\u5355\u5143\u7684\u5173\u95ed\u72b6\u6001\u4e3a<code>inactive</code>\uff0c\u53ea\u662f\u8bf4\u660e\u5173\u95ed\u670d\u52a1\u7684\u52a8\u4f5c\u5df2\u7ecf\u6267\u884c\u6210\u529f\u3002</p>"},{"location":"man/sctl/#status","title":"status","text":"<p>\u901a\u8fc7<code>sctl status</code>\u547d\u4ee4\u83b7\u53d6\u4e00\u4e2a\u6216\u591a\u4e2aunit\u7684\u5f53\u524d\u72b6\u6001\u3002</p>"},{"location":"man/sctl/#_3","title":"\u547d\u4ee4\u7684\u8fd4\u56de\u503c\uff1a","text":"<p>\u5f53\u547d\u4ee4\u6267\u884c\u6210\u529f\u65f6\uff0c\u8fd4\u56de0\uff0c\u5426\u5219\uff0c\u8fd4\u56de\u4e00\u4e2a\u6b63\u6570\u8868\u793a\u5bf9\u5e94\u7684linux\u6807\u51c6\u9519\u8bef\u7801\u3002</p> <p>\u6ce8\u610f\uff1a\u8bf7\u4e0d\u8981\u901a\u8fc7\u547d\u4ee4\u7684\u8fd4\u56de\u503c\u5224\u65ad\u670d\u52a1\u7684\u72b6\u6001\uff0c\u800c\u662f\u901a\u8fc7sctl status\u547d\u4ee4\u3002 <code>systemctl status</code>\u7684\u8fd4\u56de\u503c\u4f1a\u6839\u636e\u5355\u5143\u72b6\u6001\u53d8\u5316\uff0c\u4f8b\u5982\uff1a\u5f53\u670d\u52a1\u72b6\u6001\u4e3a<code>failed</code>\u65f6\uff0c<code>systemctl status</code>\u547d\u4ee4\u7684\u8fd4\u56de\u503c\u4e3a3\u3002sysmaster\u867d\u7136\u517c\u5bb9\u8be5\u7279\u6027\uff0c\u8fd4\u56de\u503c\u4e3a3\uff0c\u4f46\u4e0d\u63a8\u8350\u4f7f\u7528\u3002\u539f\u56e0\u5982\u4e0b\uff1a</p> <ol> <li>systemd\u6839\u636e\u5355\u5143\u72b6\u6001\u4fee\u6539\u8fd4\u56de\u503c\u7684\u903b\u8f91\u4e0d\u7edf\u4e00\uff0c\u5982<code>systemctl status</code>\u7684\u8fd4\u56de\u503c\u53d7\u5355\u5143\u72b6\u6001\u53d8\u5316\uff0c\u4f46\u662f<code>systemctl start</code>\u5374\u4e0d\u4f1a\u3002</li> <li>systemd\u4e0d\u5efa\u8bae\u901a\u8fc7\u547d\u4ee4\u7684\u8fd4\u56de\u503c\u5224\u65ad\u670d\u52a1\u7684\u72b6\u6001\uff0c\u8bf7\u53c2\u8003\uff1ahttps://www.freedesktop.org/software/systemd/man/systemctl.html#Exit%20status</li> </ol>"},{"location":"man/sctl/#reset-failed","title":"reset-failed","text":"<p>\u901a\u8fc7<code>sctl reset-failed</code>\u547d\u4ee4\u91cd\u7f6e\u4e00\u4e2a\u6216\u591a\u4e2aunit\u7684Failed\u72b6\u6001\u4e3aDead\u3002</p>"},{"location":"man/service/","title":"Service \u914d\u7f6e","text":""},{"location":"man/service/#type","title":"Type","text":"<p>service\u670d\u52a1\u7684\u7c7b\u578b\uff0c\u5f53\u524d\u652f\u6301<code>simple</code>\u3001<code>forking</code>\u3001<code>oneshot</code>\u3001<code>notify</code>\uff0c\u9ed8\u8ba4\u503c\u4e3a<code>simple</code>\u3002</p> <p><code>simple</code>\uff1a \u62c9\u8d77service\u670d\u52a1\u65f6\uff0c\u5f53\u6267\u884cfork\u6210\u529f\u5373\u8ba4\u4e3a\u670d\u52a1\u542f\u52a8\u6210\u529f\u3002</p> <p><code>forking</code>\uff1a \u4ee3\u8868ExecStart\u7684\u8fdb\u7a0b\u4f1a\u8c03\u7528fork\u7cfb\u7edf\u8c03\u7528\uff0c\u6b64\u65f6\u7236\u8fdb\u7a0b\u9000\u51fa\u4e4b\u540e\u8ba4\u4e3a\u8be5\u670d\u52a1\u542f\u52a8\u6210\u529f\u3002\u6b64\u65f6\u5efa\u8bae\u914d\u7f6ePIDFile\u9009\u9879\uff0c\u901a\u8fc7\u8be5\u9009\u9879\u83b7\u53d6\u4e3b\u670d\u52a1\u8fdb\u7a0b\u7684pid\u3002</p> <p><code>oneshot</code>\uff1a \u4e3b\u670d\u52a1\u8fdb\u7a0b\u9000\u51fa\u4e4b\u540e\u5373\u8ba4\u4e3a\u670d\u52a1\u542f\u52a8\u5b8c\u6210\uff0c\u6b64\u670d\u52a1\u7c7b\u578b\u9700\u540c\u65f6\u8bbe\u7f6e<code>RemainAfterExit</code>\uff0c\u5141\u8bb8\u914d\u7f6e\u591a\u6761\u547d\u4ee4\uff0c\u901a\u5e38\u7528\u4e8e\u77ed\u65f6\u95f4\u8fd0\u884c\u7684\u670d\u52a1\u3002</p> <p><code>notify</code>\uff1a \u6b64\u670d\u52a1\u9700\u8981\u4e3b\u8fdb\u7a0b\u901a\u8fc7sd_notify\u53d1\u9001\u901a\u77e5\u6d88\u606f\uff0c\u5f53\u524d\u652f\u6301\u7684notify\u6d88\u606f\u5305\u62ec<code>MAINPID=</code>\u3001<code>ERRNO=</code>\u3001<code>STOPPING=1</code>\u3001<code>WATCHDOG=</code>\u3001<code>WATCHDOG_USEC</code>\u3002</p> <pre><code>`MAINPID=`\uff1a\u901a\u8fc7\u6b64\u6d88\u606f\u63a5\u53d7\u4e3b\u670d\u52a1\u8fdb\u7a0b\u7684pid\u3002\n`ERRNO=`\uff1a\u63a5\u53d7\u4e3b\u670d\u52a1\u8fdb\u7a0b\u7684\u9519\u8bef\u7801\u3002\n`STOPPING=1`\uff1a\u5f53\u53c2\u6570\u4e3a1\u65f6\uff0c\u4e14\u5f53\u524d\u670d\u52a1\u5728Running\u72b6\u6001\u5219\u505c\u6b62\u5f53\u524d\u670d\u52a1\u3002\n`WATCHDOG=`\uff1a\u5f53\u53c2\u6570\u4e3a1\u65f6\uff0c\u5219\u542f\u52a8watchdog\u7684\u5b9a\u65f6\u5668\uff0c\u5f53\u53c2\u6570\u4e3atrigger\u65f6\uff0c\u5219\u670d\u52a1\u8fdb\u7a0bStopWatchdog\u72b6\u6001\u3002\n</code></pre>"},{"location":"man/service/#execconditionexecstartpreexecstartexecstopexecstartpost","title":"ExecCondition\u3001ExecStartPre\u3001ExecStart\u3001ExecStop\u3001ExecStartPost","text":"<p>\u670d\u52a1\u5728\u4e0d\u540c\u7684\u542f\u52a8\u9636\u6bb5\u6267\u884c\u7684\u547d\u4ee4\uff0c<code>ExecStart</code>\u662fService\u552f\u4e00\u5fc5\u987b\u914d\u7f6e\u7684\u9009\u9879\uff0c\u7528\u4e8e\u914d\u7f6eService\u9700\u8981\u6267\u884c\u7684\u547d\u4ee4\u3002</p>"},{"location":"man/service/#execstart","title":"ExecStart\u914d\u7f6e\u7684\u9650\u5236","text":"<ol> <li>\u914d\u7f6e\u7684\u547d\u4ee4\u5fc5\u987b\u4e3a\u7edd\u5bf9\u8def\u5f84</li> <li>\u9664\u975e\u670d\u52a1\u7684\u7c7b\u578b\u914d\u7f6e\u4e3a<code>OneShot</code>\uff0c\u5426\u5219\u53ea\u5141\u8bb8\u914d\u7f6e\u4e00\u6761\u547d\u4ee4</li> <li>\u547d\u4ee4\u7684\u7edd\u5bf9\u8def\u5f84\u524d\u652f\u6301\u6dfb\u52a0\u524d\u7f00\uff1a<code>-</code>\uff08\u6682\u4e0d\u652f\u6301\u5176\u4ed6systemd\u652f\u6301\u7684\u524d\u7f00\uff0c\u5982<code>@</code>\uff0c<code>:</code>)\u3002\u524d\u7f00<code>-</code>\u7684\u542b\u4e49\u662f\uff0c\u5373\u4f7f\u540e\u9762\u5217\u51fa\u7684\u547d\u4ee4\u6267\u884c\u5931\u8d25\u4e5f\u5f53\u4f5c\u6210\u529f\u5904\u7406\u3002</li> <li>\u5f53\u524d\u4e0d\u652f\u6301\u547d\u4ee4\u884c\u4e2d\u7684\u73af\u5883\u53d8\u91cf\u5c55\u5f00\uff0c\u5373\u4e0esystemd\u6dfb\u52a0<code>:</code>\u524d\u7f00\u7684\u884c\u4e3a\u4e00\u81f4\u3002\u5373\u540c\u65f6\u914d\u7f6e<code>Environment={name=\"test\"}, ExecStart=\"/bin/echo $name\"</code>\uff0csysMaster\u8f93\u51fa\u4e3a\"$name\"\uff0c\u800csystemd\u8f93\u51fa\u4e3a\"test\"\u3002\u5982\u679csystemd\u7684\u670d\u52a1\u914d\u7f6e\u6587\u4ef6\u4fee\u6539\u4e3a\"ExecStart=:/bin/echo \\(name\"\uff0c\u5219\u8f93\u51fa\u4e5f\u4e3a\"\\)name\"\u3002</li> </ol>"},{"location":"man/service/#pidfile","title":"PIDFile","text":"<p>\u5f53Type\u7c7b\u578b\u4e3a<code>forking</code>\u65f6\u4f7f\u7528\uff0c\u7528\u4e8e\u83b7\u53d6\u4e3b\u670d\u52a1\u8fdb\u7a0b\u7684pid\u3002</p>"},{"location":"man/service/#remainafterexit","title":"RemainAfterExit","text":"<p>\u652f\u6301\u7684\u503c\u4e3atrue\u6216false, \u5f53\u914d\u7f6e\u4e3atrue\u65f6\uff0c\u5f53\u4e3b\u670d\u52a1\u8fdb\u7a0b\u9000\u51fa\u65f6\uff0c\u670d\u52a1\u72b6\u6001\u4ecd\u7136\u4e3aactive\u72b6\u6001\u3002</p>"},{"location":"man/service/#nonblocking","title":"NonBlocking","text":"<ul> <li>\u7c7b\u578b\uff1a\u5e03\u5c14\u503c</li> </ul> <p>\u8be5\u914d\u7f6e\u4ec5\u5bf9socket\u6fc0\u6d3b\u7684\u670d\u52a1\u6709\u6548\uff0c\u8bbe\u7f6e\u4ecesocket\u7ee7\u627f\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\u7684O_NONBLOCK\u6807\u5fd7\u4f4d\u3002\u9ed8\u8ba4\u503c\u4e3a<code>false</code>\u3002</p>"},{"location":"man/service/#notifyaccess","title":"NotifyAccess","text":"<p>\u914d\u7f6e\u7c7b\u578b\u4e3a\u5b57\u7b26\u4e32\uff0c\u652f\u6301<code>none</code>\u3001<code>main</code>\uff0c\u5f53Type\u4e3aNotify\u65f6\u9ed8\u8ba4\u503c\u4e3a<code>main</code>\u3002\u5f53\u524d\u529f\u80fd\u672a\u5b9e\u73b0\u3002</p>"},{"location":"man/service/#sockets","title":"Sockets","text":"<p>\u914d\u7f6e\u7c7b\u578b\u4e3a\u5b57\u7b26\u4e32\uff0c\u5f53\u9700\u8981\u914d\u7f6e\u591a\u4e2a\u65f6\u4ee5\uff1b\u53f7\u9694\u5f00\uff0c\u8868\u793a\u8be5\u670d\u52a1\u9700\u8981\u4ecesocket\u7ee7\u627f\u5957\u63a5\u5b50\u3002</p>"},{"location":"man/service/#killmode","title":"KillMode","text":"<p>\u5f53\u9700\u8981\u505c\u6b62\u670d\u52a1\u8fdb\u7a0b\u65f6\uff0c\u6740\u6b7b\u670d\u52a1\u8fdb\u7a0b\u7684\u65b9\u6cd5\uff0c\u53d6\u503c\u8303\u56f4\u5982\u4e0b\uff1a <code>control-group</code>\u3001<code>process</code>\u3001<code>mixed</code>\uff0c\u9ed8\u8ba4\u503c\u4e3a<code>control-group</code>\u3002</p> <pre><code>`control-group`: \u8868\u793a\u6740\u6b7b\u8be5\u670d\u52a1\u7684cgroup\u5185\u7684\u6240\u6709\u8fdb\u7a0b\u3002\n`process`: \u4ec5\u6740\u6b7b\u4e3b\u8fdb\u7a0b\u3002\n`mixed`:  \u8868\u793a\u53ea\u5411\u8be5\u670d\u52a1\u7684cgroup\u5185\u7684\u8fdb\u7a0b\u53d1\u9001SigKill\u4fe1\u53f7\u3002\n</code></pre>"},{"location":"man/service/#watchdogsec","title":"WatchdogSec","text":"<p>\u914d\u7f6e\u8f6f\u4ef6\u72d7\u7684\u5b9a\u65f6\u65f6\u95f4\uff0c\u65f6\u95f4\u5355\u4f4d\u4e3a\u79d2\uff0c\u5f53\u503c\u5927\u4e8e0\u65f6\uff0c\u542f\u7528\u8f6f\u4ef6\u72d7\uff0c\u5e94\u7528\u901a\u8fc7\u53d1\u9001notify\u6d88\u606f\u5582\u72d7\uff0c\u5b9a\u65f6\u65f6\u95f4\u5185\u6536\u5230\"WATCHDOG=1\"\u6d88\u606f\u4ee3\u8868\u5e94\u7528\u6b63\u5e38\uff0c\u6536\u5230\u201cWATCHDOG=trigger\"\u6d88\u606f\u505c\u6b62\u5e94\u7528\uff0c\u6536\u5230\u201cWATCHDOG_USEC=15\u201d\u6d88\u606f\u8868\u793a\u5c06\u5b9a\u65f6\u65f6\u95f4\u4fee\u6539\u4e3a15\u79d2\u3002</p>"},{"location":"man/service/#restart","title":"Restart","text":"<p>\u914d\u7f6e\u5728\u670d\u52a1\u9000\u51fa\u6216\u7ec8\u6b62\u65f6\uff0c\u662f\u5426\u91cd\u65b0\u542f\u52a8\u670d\u52a1\uff0c\u53ef\u4ee5\u914d\u7f6e\u4e3a<code>no</code>,<code>on-success</code>\uff0c<code>on-failure</code>\uff0c<code>on-watchdog</code>, <code>on-abnormal</code>, <code>on-abort</code>, <code>always</code>, \u9ed8\u8ba4\u503c\u4e3a<code>no</code>\u3002</p> <pre><code>`no`: \u4ee3\u8868\u670d\u52a1\u542f\u52a8\u5931\u8d25\u65f6\uff0c\u4e0d\u91cd\u65b0\u542f\u52a8\u670d\u52a1\u3002\n`on-success`: \u5f53\u670d\u52a1\u6b63\u5e38\u9000\u51fa\u65f6\u91cd\u65b0\u542f\u52a8\u670d\u52a1\u3002\u6b63\u5e38\u9000\u51fa\u7801\u6709\u4e24\u79cd\u60c5\u51b5: 1\u3001\u9000\u51fa\u7801\u4e3a0\u3002 2\u3001\u5176\u4ed6\u7b26\u5408\u9884\u671f\u7684\u9000\u51fa\u7801\u6216\u4fe1\u53f7\u3002\n`on-failure`: \u5f53\u670d\u52a1\u975e\u6b63\u5e38\u9000\u51fa\u65f6\u91cd\u65b0\u542f\u52a8\u670d\u52a1\u3002\u975e\u6b63\u5e38\u9000\u51fa\u7801 1\u3001\u9000\u51fa\u7801\u975e0\u3002 2\u3001\u975e\u9884\u671f\u7684\u4fe1\u53f7\u6216\u8d85\u65f6\u5bfc\u81f4\u670d\u52a1\u9000\u51fa\u7b49\u3002\n`on-watchdog`: \u5f53watchdog\u8d85\u65f6\u5bfc\u81f4\u8fdb\u7a0b\u9000\u51fa\u65f6\u91cd\u65b0\u542f\u52a8\u670d\u52a1\u3002\n`on-abnormal`: \u5f53\u670d\u52a1\u8d85\u65f6\u6216\u63a5\u6536\u5230\u5f02\u5e38\u7684\u9000\u51fa\u4fe1\u53f7\u65f6\u5019\uff0c\u91cd\u65b0\u542f\u52a8\u670d\u52a1\u3002\n`on-abort`: \u5f53\u670d\u52a1\u56e0\u672a\u6355\u83b7\u7684\u5f02\u5e38\u9000\u51fa\u65f6\u91cd\u65b0\u62c9\u8d77\u670d\u52a1\u3002\n`always`: \u65e0\u8bba\u670d\u52a1\u56e0\u4f55\u539f\u56e0\u9000\u51fa\u90fd\u91cd\u65b0\u62c9\u8d77\u670d\u52a1\u3002\n</code></pre>"},{"location":"man/service/#restartsec","title":"RestartSec","text":"<ul> <li>\u7c7b\u578b\uff1a\u6570\u503c</li> </ul> <p>\u5f53\u670d\u52a1\u9000\u51fa\u65f6\uff0c\u95f4\u9694\u591a\u957f\u65f6\u95f4\u91cd\u65b0\u62c9\u8d77\u670d\u52a1\uff0c\u914d\u7f6e\u4e3a\u6b63\u6574\u6570\uff0c\u5355\u4f4d\u4e3a\u5fae\u79d2\u3002</p>"},{"location":"man/service/#restartpreventexitstatus","title":"RestartPreventExitStatus","text":"<p>\u914d\u7f6e\u8fdb\u7a0b\u7684\u9000\u51fa\u7801\u6216\u4fe1\u53f7\uff0c\u5f53\u670d\u52a1\u8fdb\u7a0b\u7684\u9000\u51fa\u7801\u6216\u4fe1\u53f7\u7b26\u5408\u6b64\u9009\u9879\u65f6\u4e0d\u91cd\u65b0\u62c9\u8d77\u670d\u52a1\uff0c\u6b64\u65f6\u5ffd\u7565Restart\u7684\u914d\u7f6e\u3002\u53ef\u4ee5\u914d\u7f6e\u4e3a\u6574\u6570\u6216\u4fe1\u53f7\u540d\uff0c\u4e2d\u95f4\u4ee5\u7a7a\u683c\u5206\u5f00\u9ed8\uff0c\u9ed8\u8ba4\u4e3a\u7a7a\u5b57\u7b26\u4e32\u3002 \u5982RestartPreventExitStatus=\u201c1 2 SIGKILL\u201d\uff0c\u5f53\u524d\u4fe1\u53f7\u4ec5\u652f\u6301\u4ee5SIG\u5f00\u5934\u7684\u4fe1\u53f7\u3002</p>"},{"location":"man/service/#execreload","title":"ExecReload","text":"<p>\u4e3b\u8981\u7528\u4e8e\u670d\u52a1\u91cd\u65b0\u52a0\u8f7d\u914d\u7f6e\u6587\u4ef6\u7b49\u64cd\u4f5c\uff0c\u914d\u7f6e\u683c\u5f0f\u5982<code>ExecStart</code>\uff0c\u53ef\u4ee5\u914d\u7f6e\u4e3a\u7a7a\uff0c\u5f53\u670d\u52a1active\u72b6\u6001\u65f6\uff0c\u624d\u4f1a\u751f\u6548\u3002</p>"},{"location":"man/service/#environment","title":"Environment","text":"<p>\u914d\u7f6e\u8fdb\u7a0b\u7684\u73af\u5883\u53d8\u91cf\uff0c\u91c7\u7528toml\u5185\u8054\u8868\u7684\u683c\u5f0f\uff0c\u5982Environment = {var0=\"val0\", var2=\"val1\"};</p> <p>\u5176\u4e2d\u73af\u5883\u53d8\u91cf\u5b9a\u4e49\u5728\u82b1\u62ec\u53f7<code>{}</code>\u4e2d\uff0c\u591a\u4e2a\u952e\u503c\u5bf9\u4ee5<code>,</code>\u5206\u5272\uff0cvalue\u7684\u503c\u4ee5\u53cc\u5f15\u53f7<code>\"\"</code>\u5305\u542b\u3002</p> <p>\u6ce8\u610f\uff1a \u73af\u5883\u53d8\u91cf\u4e0d\u4f1a\u9ed8\u8ba4\u5728\u547d\u4ee4\u884c\u4e2d\u5c55\u5f00\uff0c\u548csystemd\u5728ExecXXX\u5b57\u6bb5\u663e\u5f0f\u914d\u7f6e<code>:</code>\u7684\u884c\u4e3a\u4e00\u81f4\u3002</p>"},{"location":"man/service/#environmentfile","title":"EnvironmentFile","text":"<p>\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf\u7684\u6587\u4ef6\u8bfb\u53d6\u8def\u5f84\uff0c\u53ea\u652f\u6301\u7edd\u5bf9\u8def\u5f84\uff0c\u914d\u7f6e\u591a\u4e2a\u8def\u5f84\u65f6\u4ee5<code>;</code>\u9694\u5f00\uff0c\u5982\u679c\u8def\u5f84\u4ee5<code>-</code>\u5f00\u5934\uff0c\u5219\u5ffd\u7565\u8be5\u6587\u4ef6\uff0c\u6587\u4ef6\u4e2d\u7684\u5185\u5bb9\u683c\u5f0f\u4e3a<code>key=value</code>\uff0c\u82e5\u4e3a\u7a7a\u884c\u6216\u4ee5#\u5f00\u5934\u5219\u5ffd\u7565\u8be5\u884c\u3002</p>"},{"location":"man/service/#killsignal","title":"KillSignal","text":"<p>\u8bbe\u7f6e\u6740\u6b7b\u8fdb\u7a0b\u7684\u7b2c\u4e00\u6b65\u4f7f\u7528\u7684\u4fe1\u53f7, \u914d\u7f6e\u7c7b\u578b\u4e3a\u5b57\u7b26\u4e32\u3002\u9ed8\u8ba4\u503c\u4e3a<code>SIGTERM</code>\u4fe1\u53f7\u3002</p>"},{"location":"man/service/#timeoutsec","title":"TimeoutSec","text":"<p>\u670d\u52a1\u542f\u52a8\u6216\u505c\u6b62\u65f6\u7684\u8d85\u65f6\u65f6\u95f4\uff0c\u53d6\u503c\u8303\u56f4\u4e3a0~u64::MAX, \u5f53\u503c\u4e3a0\u6216u64::Max\u65f6\uff0c\u4e0d\u542f\u52a8\u5b9a\u65f6\u5668\u3002\u5f53<code>TimeoutSec</code>\u7684\u503c\u4e0d\u4e3a0\u4e14<code>TimeoutStartSec</code>\u6216<code>TimeoutStopSec</code>\u503c\u4e3a0\u65f6\uff0c\u5219\u5c06<code>TimeoutStartSec</code>\u6216<code>TimeoutStopSec</code>\u7684\u503c\u66f4\u65b0\u4e3a<code>TimeoutSec</code>\u9009\u9879\u7684</p>"},{"location":"man/service/#timeoutstartsec","title":"TimeoutStartSec","text":"<p>\u670d\u52a1\u542f\u52a8\u65f6\u7684\u8d85\u65f6\u65f6\u95f4\uff0c\u53d6\u503c\u8303\u56f4\u4e3a0~u64::MAX, \u5f53\u503c\u4e3a0\u6216u64::Max\u65f6\uff0c\u4e0d\u542f\u52a8\u5b9a\u65f6\u5668\u3002\u5f53\u6267\u884c<code>Condition</code>\u3001<code>StartPre</code>\u3001<code>Start</code>\u3001<code>StartPost</code>\u3001<code>Reload</code>\u547d\u4ee4\u65f6\u7684\u8d85\u65f6\u65f6\u95f4\u3002</p>"},{"location":"man/service/#timeoutstopsec","title":"TimeoutStopSec","text":"<p>\u670d\u52a1\u505c\u6b62\u65f6\u7684\u8d85\u65f6\u65f6\u95f4\uff0c\u53d6\u503c\u8303\u56f4\u4e3a0~u64::MAX, \u5f53\u503c\u4e3a0\u6216u64::Max\u65f6\uff0c\u4e0d\u542f\u52a8\u5b9a\u65f6\u5668\u3002\u5f53\u6267\u884c<code>Stop</code>\u3001<code>StopPost</code>\u547d\u4ee4\u65f6\u7684\u8d85\u65f6\u65f6\u95f4\u3002</p>"},{"location":"man/service/#limitcorelimitnofilelimitnproc","title":"LimitCORE\u3001LimitNOFILE\u3001LimitNPROC","text":"<p>\u8bbe\u7f6e\u8fdb\u7a0b\u7684\u8d44\u6e90\u9650\u5236\uff0c\u53c2\u8003setrlimit(2)\uff0c\u914d\u7f6e\u7c7b\u578b\u4e3a\u5b57\u7b26\u4e32\u3002</p> <p>\u5f53\u524d\u652f\u6301\u4e24\u79cd\u683c\u5f0f\uff0c(1) \u4e0d\u5305\u62ec<code>':'</code>\u7684\u5f53\u4e2a\u5b57\u7b26\u4e32\uff0c\u6b64\u65f6soft\u3001hard\u8bbe\u7f6e\u4e3a\u540c\u4e00\u4e2a\u503c\uff0c(2) \u4f7f\u7528<code>':'</code>\u5206\u5272\u7684\u4e24\u4e2a\u5b57\u7b26\u4e32\uff0csoft\u4e3a<code>:</code>\u524d\u7684\u503c\uff0c hard\u4e3a<code>:</code>\u540e\u7684\u503c\u3002</p> <p>\u5355\u4e2a\u503c\u53ea\u652f\u6301\u914d\u7f6e\u4e3a\u6570\u503c\u578b\u6216\u201cinfinity\u201d\u5b57\u7b26\u4e32\uff0c\u914d\u7f6e\u4e3a\u201cinfinity\u201d\u65f6\u8d44\u6e90\u9650\u5236\u8bbe\u7f6e\u4e3a<code>ulimit</code>\u3002</p>"},{"location":"man/signal/","title":"sysmaster\u7684\u4fe1\u53f7\u5904\u7406","text":"<p>sysMaster\u91c7\u7528<code>1+1+N</code>\u67b6\u6784\uff0csysmaster\u4e0d\u518d\u4f5c\u4e3a1\u53f7\u8fdb\u7a0b\uff0c\u56e0\u6b64\u5185\u6838\u4e3a1\u53f7\u8fdb\u7a0b\u7684\u4fe1\u53f7\u505a\u7684\u7279\u6b8a\u5904\u7406\u4e0d\u518d\u751f\u6548\u3002\u4e0b\u8868\u5217\u51fa\u4e86init(1\u53f7\u8fdb\u7a0b)\u3001sysmaster\u3001systemd\u7684\u4fe1\u53f7\u5904\u7406\u65b9\u5f0f\u4ee5\u53casysMaster\u4e0esystemd\u9488\u5bf9\u4e0d\u540c\u4fe1\u53f7\u7684\u54cd\u5e94\u903b\u8f91\u5dee\u5f02\u3002</p> \u4fe1\u53f7 init sysmaster systemd sysmaster\u4e0esystemd\u5bf9\u5916\u8868\u73b0\u662f\u5426\u6709\u5dee\u5f02 1) SIGHUP \u6355\u83b7\u4e0d\u5904\u7406 daemon-reload daemon-reload N 2) SIGINT \u6355\u83b7\u4e0d\u5904\u7406 start ctrl-alt-del.target start ctrl-alt-del.target N 3) SIGQUIT \u6355\u83b7\u4e0d\u5904\u7406 \u6545\u969c\u6062\u590d crash handler Y 4) SIGILL \u6355\u83b7\u4e0d\u5904\u7406 \u6545\u969c\u6062\u590d crash handler Y 5) SIGTRAP \u6355\u83b7\u4e0d\u5904\u7406 IGN DFL N 6) SIGABRT \u6355\u83b7\u4e0d\u5904\u7406 1\u53f7\u8fdb\u7a0b\u4e0b\u53d1\u91cd\u6267\u884c/\u6545\u969c\u6062\u590d crash handler Y 7) SIGBUS \u6355\u83b7\u4e0d\u5904\u7406 \u6545\u969c\u6062\u590d crash handler Y 8) SIGFPE \u6355\u83b7\u4e0d\u5904\u7406 \u6545\u969c\u6062\u590d crash handler Y 9) SIGKILL \u5185\u6838\u4e3b\u52a8\u5c4f\u853d\u8be5\u4fe1\u53f7 DFL \u5185\u6838\u4e3b\u52a8\u5c4f\u853d\u8be5\u4fe1\u53f7 Y 10) SIGUSR1 \u6355\u83b7\u4e0d\u5904\u7406 IGN \u91cd\u8fdedbus Y 11) SIGSEGV \u6355\u83b7\u4e0d\u5904\u7406 \u6545\u969c\u6062\u590d crash handler Y 12) SIGUSR2 \u6355\u83b7\u4e0d\u5904\u7406 IGN \u8f93\u51fa\u6240\u6709\u5355\u5143\u7684\u914d\u7f6e\u4fe1\u606f Y 13) SIGPIPE \u6355\u83b7\u4e0d\u5904\u7406 IGN IGN N 14) SIGALRM \u6355\u83b7\u4e0d\u5904\u7406 IGN DFL N 15) SIGTERM \u6355\u83b7\u4e0d\u5904\u7406 daemon-reexec daemon-reexec N 16) SIGSTKFLT \u6355\u83b7\u4e0d\u5904\u7406 IGN DFL N 17) SIGCHLD \u50f5\u5c38\u5b50\u8fdb\u7a0b\u56de\u6536 \u50f5\u5c38\u5b50\u8fdb\u7a0b\u56de\u6536 \u50f5\u5c38\u5b50\u8fdb\u7a0b\u56de\u6536 N 18) SIGCONT \u6355\u83b7\u4e0d\u5904\u7406 IGN DFL N 19) SIGSTOP \u5185\u6838\u4e3b\u52a8\u5c4f\u853d\u8be5\u4fe1\u53f7 DFL \u5185\u6838\u4e3b\u52a8\u5c4f\u853d\u8be5\u4fe1\u53f7 Y 20) SIGTSTP \u6355\u83b7\u4e0d\u5904\u7406 IGN DFL N 21) SIGTTIN \u6355\u83b7\u4e0d\u5904\u7406 IGN DFL N 22) SIGTTOU \u6355\u83b7\u4e0d\u5904\u7406 IGN DFL N 23) SIGURG \u6355\u83b7\u4e0d\u5904\u7406 IGN DFL N 24) SIGXCPU \u6355\u83b7\u4e0d\u5904\u7406 IGN DFL N 25) SIGXFSZ \u6355\u83b7\u4e0d\u5904\u7406 IGN DFL N 26) SIGVTALRM \u6355\u83b7\u4e0d\u5904\u7406 IGN DFL N 27) SIGPROF \u6355\u83b7\u4e0d\u5904\u7406 IGN DFL N 28) SIGWINCH \u6355\u83b7\u4e0d\u5904\u7406 IGN start kbrequest.target Y 29) SIGIO \u6355\u83b7\u4e0d\u5904\u7406 IGN DFL N 30) SIGPWR \u6355\u83b7\u4e0d\u5904\u7406 IGN start sigpwr.target Y 31) SIGSYS \u6355\u83b7\u4e0d\u5904\u7406 \u6545\u969c\u6062\u590d DFL N 34) SIGRTMIN \u6355\u83b7\u4e0d\u5904\u7406 IGN start default.target Y 35) SIGRTMIN+1 \u6355\u83b7\u4e0d\u5904\u7406 IGN isolate rescue.target Y 36) SIGRTMIN+2 \u6355\u83b7\u4e0d\u5904\u7406 IGN isolate emergency.target Y 37) SIGRTMIN+3 \u6355\u83b7\u4e0d\u5904\u7406 IGN start halt.target Y 38) SIGRTMIN+4 \u6355\u83b7\u4e0d\u5904\u7406 IGN start poweroff.target Y 39) SIGRTMIN+5 \u6355\u83b7\u4e0d\u5904\u7406 IGN start reboot.target Y 40) SIGRTMIN+6 \u6355\u83b7\u4e0d\u5904\u7406 IGN start kexec.target Y 41) SIGRTMIN+7 \u6355\u83b7\u4e0d\u5904\u7406 IGN DFL N 42) SIGRTMIN+8 unrecover state IGN DFL N 43) SIGRTMIN+9 \u91cd\u6267\u884csysmaster IGN DFL N 44) SIGRTMIN+10 switch root IGN DFL Y 45) SIGRTMIN+11 \u6355\u83b7\u4e0d\u5904\u7406 IGN DFL N 46) SIGRTMIN+12 \u6355\u83b7\u4e0d\u5904\u7406 IGN DFL N 47) SIGRTMIN+13 \u6355\u83b7\u4e0d\u5904\u7406 IGN Immediate halt Y 48) SIGRTMIN+14 \u6355\u83b7\u4e0d\u5904\u7406 IGN Immediate poweroff Y 49) SIGRTMIN+15 \u6355\u83b7\u4e0d\u5904\u7406 IGN Immediate reboot Y 50) SIGRTMAX-14 SIGRTMIN+16 \u6355\u83b7\u4e0d\u5904\u7406 IGN Immediate kexec Y 51) SIGRTMAX-13 SIGRTMIN+17 \u6355\u83b7\u4e0d\u5904\u7406 IGN DFL N 52) SIGRTMAX-12 SIGRTMIN+18 \u6355\u83b7\u4e0d\u5904\u7406 IGN DFL N 53) SIGRTMAX-11 SIGRTMIN+19 \u6355\u83b7\u4e0d\u5904\u7406 IGN DFL N 54) SIGRTMAX-10 SIGRTMIN+20 \u6355\u83b7\u4e0d\u5904\u7406 IGN enable status messages Y 55) SIGRTMAX-9 SIGRTMIN+21 \u6355\u83b7\u4e0d\u5904\u7406 IGN disable status messages Y 56) SIGRTMAX-8 SIGRTMIN+22 \u6355\u83b7\u4e0d\u5904\u7406 IGN \u65e5\u5fd7\u7ea7\u522b\u8bbe\u4e3adebug Y 57) SIGRTMAX-7 SIGRTMIN+23 \u6355\u83b7\u4e0d\u5904\u7406 IGN \u65e5\u5fd7\u7ea7\u522b\u8bbe\u4e3ainfo Y 58) SIGRTMAX-6 SIGRTMIN+24 \u6355\u83b7\u4e0d\u5904\u7406 IGN Immediate exit (\u4ec5\u9650\u4e8e\u7528\u6237\u6a21\u5f0f) Y 59) SIGRTMAX-5 SIGRTMIN+25 \u6355\u83b7\u4e0d\u5904\u7406 IGN reexecute manager Y 60) SIGRTMAX-4 SIGRTMIN+26 \u6355\u83b7\u4e0d\u5904\u7406 IGN \u65e5\u5fd7\u8f93\u51fa\u8bbe\u4e3ajournal-or-kmsg Y 61) SIGRTMAX-3 SIGRTMIN+27 \u6355\u83b7\u4e0d\u5904\u7406 IGN \u65e5\u5fd7\u8f93\u51fa\u8bbe\u4e3aconsole Y 62) SIGRTMAX-2 SIGRTMIN+28 \u6355\u83b7\u4e0d\u5904\u7406 IGN \u65e5\u5fd7\u8f93\u51fa\u8bbe\u4e3akmsg Y 63) SIGRTMAX-1 SIGRTMIN+29 \u6355\u83b7\u4e0d\u5904\u7406 IGN \u65e5\u5fd7\u8f93\u51fa\u8bbe\u4e3asyslog-or-kmsg Y 64) SIGRTMAX SIGRTMIN+30 \u6355\u83b7\u4e0d\u5904\u7406 IGN DFL N <p>\u8868\u683c\u7684\u5177\u4f53\u8bf4\u660e\uff1a</p> <ol> <li>IGN\u3001DFL\u5206\u522b\u8868\u793a\u4fe1\u53f7\u5904\u7406\u51fd\u6570\uff1aSIG_IGN\uff08\u5ffd\u7565\uff09\u3001SIG_DFL\uff08\u7f3a\u7701\u7684\u4fe1\u53f7\u5904\u7406\u51fd\u6570\uff09\u3002\u5982\u679c1\u53f7\u8fdb\u7a0b\u6ca1\u6709\u6ce8\u518c\u4fe1\u53f7\u5904\u7406\u51fd\u6570\uff0c\u5373\u4f7f\u7528SIG_DFL\uff0c\u5185\u6838\u4f1a\u76f4\u63a5\u5c4f\u853d\u6389\u8be5\u4fe1\u53f7\u3002\u56e0\u6b641\u53f7\u8fdb\u7a0b\u5728\u5bf9\u5916\u8868\u73b0\u4e0a\uff0cSIG_IGN\u548cSIG_DFL\u662f\u4e00\u81f4\u7684\u3002</li> <li>SIGKILL\u3001SIGSTOP\u4fe1\u53f7\u662f\u5185\u6838\u4e3a1\u53f7\u8fdb\u7a0b\u65e0\u6761\u4ef6\u5c4f\u853d\u7684\uff0c\u4e14\u4e0d\u5141\u8bb8\u901a\u8fc7sigaction\u4fee\u6539\u5176\u4fe1\u53f7\u5904\u7406\u51fd\u6570\uff0csysmaster\u5f53\u524d\u6ca1\u6709\u65b9\u6848\u6d88\u9664\u8be5\u5dee\u5f02\u3002</li> <li>init\u8fdb\u7a0b\uff1a<ul> <li>SIGCHLD: \u56de\u6536\u6240\u6709\u50f5\u5c38\u5b50\u8fdb\u7a0b\u3002</li> <li>SIGRTMIN+8: \u8fdb\u5165\u4e0d\u53ef\u6062\u590d\u72b6\u6001\u3002</li> <li>SIGRTMIN+9: \u4e0b\u53d1SIGABRT\u4fe1\u53f7\u91cd\u6267\u884csysmaster\u3002</li> <li>SIGRTMIN+10: \u53ea\u5904\u7406sysmaster\u8fdb\u7a0b\u7684SIGRTMIN+10\u4fe1\u53f7\uff0c\u5176\u4f59\u8fdb\u7a0b\u5ffd\u7565\u3002\u91cd\u6267\u884cinit\u81ea\u8eab\uff0c\u91cd\u6267\u884csysmaster\u3002</li> <li>init\u6355\u83b7\u6240\u6709\u53ef\u6355\u83b7\u4fe1\u53f7\uff0c\u9664\u4e0a\u8ff0\u4fe1\u53f7\u505a\u4e86\u5904\u7406\u4ee5\u5916\uff0c\u5176\u4f59\u90fd\u5ffd\u7565\u4e0d\u5904\u7406\u3002</li> </ul> </li> <li>sysmaster\u8fdb\u7a0b\uff1a<ul> <li>SIGCHLD: \u56de\u6536\u6240\u6709\u50f5\u5c38\u5b50\u8fdb\u7a0b\u3002</li> <li>SIGSEGV,SIGILL,SIGFPE,SIGBUS,SIGQUIT,SIGSYS: \u5f53\u5b58\u5728switch.debug\u914d\u7f6e\u6587\u4ef6\u65f6\uff0c\u6267\u884c\u6545\u969c\u6062\u590d\u3002</li> <li>SIGABRT\uff1a\u5f53\u5b58\u5728switch.debug\u914d\u7f6e\u6587\u4ef6\u65f6\uff0c\u7528\u4e8einit\u91cd\u6267\u884csysmaster\u6216\u6267\u884c\u6545\u969c\u6062\u590d\u3002</li> <li>SIGUSR1\u3001SIGUSR2\u3001SIGWINCH\u3001SIGPWR\u3001SIGRTMIN+{0-6\u300113-16\u300120-29}sysmaster\u4e0esystemd\u7684\u5dee\u5f02\u540e\u7eed\u80fd\u591f\u6d88\u9664\u3002</li> </ul> </li> </ol>"},{"location":"man/socket/","title":"Socket \u914d\u7f6e","text":""},{"location":"man/socket/#execstartpreexecstartpostexecstoppreexecstoppost","title":"ExecStartPre\u3001ExecStartPost\u3001ExecStopPre\u3001ExecStopPost","text":"<p>\u670d\u52a1\u5728\u4e0d\u540c\u7684\u542f\u52a8\u9636\u6bb5\u6267\u884c\u7684\u547d\u4ee4\u3002\u914d\u7f6e\u591a\u6761\u547d\u4ee4\u65f6\u4ee5\uff1b\u53f7\u9694\u5f00\u3002</p>"},{"location":"man/socket/#listenstreamlistendatagramlistensequentialpacket","title":"ListenStream\u3001ListenDatagram\u3001ListenSequentialPacket","text":"<p>\u914d\u7f6eSOCK_STREAM\u3001SOCK_DGRAM\u5957\u63a5\u5b50\u7684\u76d1\u542c\u5730\u5740, \u652f\u6301\u4ee5\u4e0b\u7684\u914d\u7f6e\u683c\u5f0f\u3002</p> <p>\u5982\u679c\u5730\u5740\u4ee5\u201c/\u201d\u5f00\u5934, \u5219\u521b\u5efa\u4e00\u4e2aUNIX\u5957\u63a5\u5b57\uff08AF_UNIX\uff09\u3002</p> <p>\u5982\u679c\u5730\u5740\u4ee5\u201c@\u201d\u5f00\u5934, \u5219\u521b\u5efa\u4e00\u4e2a\u62bd\u8c61\u7a7a\u95f4\u7684UNIX\u5957\u63a5\u5b57\uff08AF_UNIX\uff09\u3002</p> <p>\u5982\u679c\u5730\u5740\u662f\u4e00\u4e2a\u6570\u503c\u7c7b\u578b\uff0c\u5219\u4f1a\u89c6\u4e3a\u4e00\u4e2aIPv6\u5957\u63a5\u5b50\u7684\u7aef\u53e3\u53f7\uff0c \u5982\u679c\u4e0d\u652f\u6301IPv6, \u5219\u521b\u5efa\u4e00\u4e2aIPv4\u5957\u63a5\u5b50\u7684\u7aef\u53e3\u53f7\u3002</p> <p>\u5982\u679c\u5730\u5740\u662f\u201ca.b.c.d:x\u201d\u683c\u5f0f\uff0c \u5219\u7ed1\u5b9aIPv4\u5957\u63a5\u5b50\u7684\u5730\u5740\u201ca.b.c.d\u201d\u7684\"x\"\u7aef\u53e3\u3002</p> <p>\u5982\u679c\u5730\u5740\u662f\u201c[a]:x\u201d, \u5219\u7ed1\u5b9aIPv6\u5957\u63a5\u5b50\u7684\u5730\u5740\"a\"\u7aef\u53e3\u201cx\u201d\u3002</p> <p>SOCK_SEQPACKET\u53ea\u6709\u5728Unix\u5957\u63a5\u5b50\u65f6\u624d\u6709\u6548\u3002</p>"},{"location":"man/socket/#listennetlink","title":"ListenNetlink","text":"<p>\u76d1\u542c\u5957\u63a5\u5b50\u7c7b\u578b\u4e3anetlink\uff0c \u914d\u7f6e\u683c\u5f0f\u4e3a\"{name} {group ID}\"\u3002</p> <p>\u5f53\u524d\u652f\u6301\u7684name\u4e3aroute, inet-diag, selinux, iscsi, audit, fib-lookup, netfilter, ip6-fw, dnrtmsg, kobject_ uevent\u3001scsitransport\u3001rdma\u7b49\u3002</p>"},{"location":"man/socket/#listenfifo","title":"ListenFIFO","text":"<ul> <li>\u7c7b\u578b\uff1a\u5b57\u7b26\u4e32</li> </ul> <p>\u521b\u5efa\u5e76\u76d1\u542c\u7528\u6237\u914d\u7f6e\u7684FIFO\u6587\u4ef6\uff0c\u8be6\u89c1\uff1afifo(7)\uff0c\u4ec5\u5141\u8bb8\u914d\u7f6e\u4e3a\u4e00\u4e2a\u7edd\u5bf9\u8def\u5f84\u3002</p>"},{"location":"man/socket/#listenspecial","title":"ListenSpecial","text":"<ul> <li>\u7c7b\u578b\uff1a\u5b57\u7b26\u4e32</li> </ul> <p>\u76d1\u542c\u4e00\u4e2a\u7279\u6b8a\u6587\u4ef6\uff0c\u4ec5\u5141\u8bb8\u914d\u7f6e\u4e3a\u7edd\u5bf9\u8def\u5f84\u3002\u7279\u6b8a\u6587\u4ef6\u6307\uff1a\u5b57\u7b26\u8bbe\u5907\u3001/proc\u3001/sys\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u3002</p>"},{"location":"man/socket/#receivebuffer-sendbuffer","title":"ReceiveBuffer \u3001SendBuffer","text":"<p>\u8bbe\u7f6esocket\u5957\u63a5\u5b50\u7684receive\u548csend\u7684buffer\u5927\u5c0f\uff0c \u5f53\u524d\u53ea\u652f\u6301\u6570\u503c\u578b\u914d\u7f6e\u3002</p>"},{"location":"man/socket/#passpacketinfo","title":"PassPacketInfo","text":"<p>\u914d\u7f6e\u7c7b\u578b\u4e3atrue\u6216false, \u8868\u793a\u662f\u5426\u5141\u8bb8AF_UNIX\u5957\u63a5\u5b50\u63a5\u53d7\u5bf9\u7aef\u8fdb\u7a0b\u5728\u8f85\u52a9\u6d88\u606f\u4e2d\u53d1\u9001\u8bc1\u4e66\uff0c \u8bbe\u7f6e\u7684\u662fIP_PKTINFO\u5957\u63a5\u5b50\u9009\u9879\u7684\u503c\uff0c \u9ed8\u8ba4\u4e3afalse\u3002</p>"},{"location":"man/socket/#passcredentials","title":"PassCredentials","text":"<p>\u914d\u7f6e\u7c7b\u578b\u4e3atrue\u6216false, \u8868\u793a\u662f\u5426\u5141\u8bb8AF_UNIX\u5957\u63a5\u5b50\u63a5\u53d7\u5bf9\u7aef\u8fdb\u7a0b\u5728\u8f85\u52a9\u6d88\u606f\u4e2d\u53d1\u9001\u8bc1\u4e66\uff0c \u8bbe\u7f6e\u7684\u662fSO_PASSCRED\u5957\u63a5\u5b50\u9009\u9879\u7684\u503c\uff0c \u9ed8\u8ba4\u4e3afalse\u3002</p>"},{"location":"man/socket/#passsecurity","title":"PassSecurity","text":"<p>\u914d\u7f6e\u7c7b\u578b\u4e3atrue\u6216false, \u8868\u793a\u662f\u5426\u5141\u8bb8AF_UNIX\u5957\u63a5\u5b50\u63a5\u53d7\u5bf9\u7aef\u8fdb\u7a0b\u5728\u8f85\u52a9\u6d88\u606f\u4e2d\u53d1\u9001\u5b89\u5168\u4e0a\u4e0b\u6587\uff0c \u8bbe\u7f6e\u7684\u662fSO_PASSSEC\u5957\u63a5\u5b50\u9009\u9879\u7684\u503c\uff0c \u9ed8\u8ba4\u4e3afalse\u3002</p>"},{"location":"man/socket/#socketmode","title":"SocketMode","text":"<p>\u8bbe\u7f6e\u6587\u4ef6\u7684\u8bbf\u95ee\u6a21\u5f0f\uff0c \u5f53\u4e3aunix\u5957\u63a5\u5b57\u6216FIFO\u6587\u4ef6\u65f6\u6709\u6548\uff0c \u9ed8\u8ba4\u503c\u4e3a0o666\u3002</p>"},{"location":"man/socket/#symlinks","title":"Symlinks","text":"<ul> <li>\u7c7b\u578b\uff1a\u5b57\u7b26\u4e32</li> </ul> <p>\u4e3a<code>AF_UNIX</code>\u3001<code>FIFO</code>\u7c7b\u578b\u7684socket\u521b\u5efa\u8f6f\u94fe\u63a5\uff0c\u4ec5\u652f\u6301\u914d\u7f6e\u4e3a\u7edd\u5bf9\u8def\u5f84\u3002\u5141\u8bb8\u7528\u6237\u914d\u7f6e<code>;</code>\u9694\u5f00\u7684\u591a\u4e2a\u8def\u5f84\u3002</p> <p>\u6ce8\u610f\uff1a \u5982\u679c\u4f7f\u7528\u8be5\u914d\u7f6e\uff0c\u5fc5\u987b\u786e\u4fdd\u6709\u4e14\u4ec5\u6709\u4e00\u4e2a<code>AF_UNXI</code>\u6216<code>FIFO</code>\u7684socket\u8def\u5f84\uff0c\u5426\u5219socket\u867d\u7136\u4f1a\u542f\u52a8\uff0c\u4f46\u8f6f\u94fe\u63a5\u5e76\u4e0d\u4f1a\u521b\u5efa\u51fa\u6765\u3002</p>"},{"location":"man/socket/#removeonstop","title":"RemoveOnStop","text":"<ul> <li>\u7c7b\u578b\uff1a\u5e03\u5c14\u503c</li> </ul> <p>\u914d\u7f6e\u5728socket\u5355\u5143\u505c\u6b62\u540e\u662f\u5426\u5220\u9664\u5efa\u7acb\u7684socket\u6587\u4ef6\uff0c\u4ee5\u53ca\u7531<code>Symlinks</code>\u914d\u7f6e\u751f\u6210\u7684\u8f6f\u94fe\u63a5\u3002\u914d\u7f6e\u4e3a<code>true</code>\u65f6\uff0c\u5220\u9664\uff1b\u914d\u7f6e\u4e3a<code>false</code>\u65f6\uff0c\u4e0d\u5220\u9664\u3002\u9ed8\u8ba4\u4e3a<code>false</code>\u3002</p>"},{"location":"man/socket/#socketusersocketgroup","title":"SocketUser\u3001SocketGroup","text":"<p>\u8bbe\u7f6e\u6587\u4ef6\u6240\u5c5e\u7684\u7528\u6237\u548c\u7528\u6237\u7ec4\uff0c\u5f53\u4e3aunix\u5957\u63a5\u5b50\u6216\u4e3aFIFO\u7c7b\u578b\u7684\u6587\u4ef6\u65f6\u6709\u6548\uff0c\u9ed8\u8ba4\u503c\u4e3a\u7a7a\u5b57\u7b26\u4e32\uff0c\u652f\u6301\u914d\u7f6e\u4e3a\u7528\u6237\u540d\u6216\u5bf9\u5e94\u7684\u7528\u6237id\u3002</p>"},{"location":"man/sysmaster.conf/","title":"sysmaster \u7cfb\u7edf\u914d\u7f6e","text":"<p>sysmaster\u652f\u6301\u4ece<code>/etc/sysmaster/system.conf</code>\u4e2d\u8bfb\u53d6\u7cfb\u7edf\u914d\u7f6e\uff0c\u7528\u4e8e\u914d\u7f6e<code>sysmaster</code>\u7684\u65e5\u5fd7\u3002</p>"},{"location":"man/sysmaster.conf/#_1","title":"\u65e5\u5fd7\u914d\u7f6e","text":"<p>\u652f\u6301\u901a\u8fc7<code>LogLevel</code>\u3001<code>LogTarget</code>\u5206\u522b\u914d\u7f6e\u65e5\u5fd7\u7684\u8f93\u51fa\u7ea7\u522b\u3001\u8f93\u51fa\u76ee\u6807\u3002\u5728\u914d\u7f6e<code>LogTarget=\"file\"</code>\u65f6\uff0c\u5141\u8bb8\u901a\u8fc7<code>LogFileSize</code>\uff0c<code>LogFileNumber</code>\u914d\u7f6e\u8f6c\u50a8\u65e5\u5fd7\u6587\u4ef6\u7684\u5927\u5c0f\u53ca\u6570\u91cf\u3002</p> <p>**\u6ce8\u610f\uff1a**\u65e5\u5fd7\u76f8\u5173\u7684\u914d\u7f6e\u4e3a\u5b57\u7b26\u4e32\uff0c\u4e0d\u80fd\u7701\u7565\u53cc\u5f15\u53f7\u3002</p>"},{"location":"man/sysmaster.conf/#loglevel","title":"LogLevel","text":"<ul> <li>\u7c7b\u578b\uff1a\u5b57\u7b26\u4e32</li> </ul> <p>\u652f\u6301\u914d\u7f6e\u4e3a<code>\"trace\"</code>\uff0c<code>\"debug\"</code>\uff0c<code>\"info\"</code>\uff0c<code>\"warn\"</code>\uff0c<code>\"error\"</code>\uff0c<code>\"off\"</code>\u3002\u7f3a\u7701\u503c\u4e3a<code>\"debug\"</code>\u3002</p>"},{"location":"man/sysmaster.conf/#logtarget","title":"LogTarget","text":"<ul> <li>\u7c7b\u578b\uff1a\u5b57\u7b26\u4e32</li> </ul> <p>\u652f\u6301\u914d\u7f6e\u4e3a<code>\"syslog\"</code>\uff0c<code>\"console-syslog\"</code>\uff0c<code>\"file\"</code>\uff0c\u7f3a\u7701\u503c\u4e3a<code>\"syslog\"</code>\u3002</p> <ul> <li>\u914d\u7f6e\u4e3a<code>\"syslog\"</code>\uff0c\u65e5\u5fd7\u5c06\u8f93\u51fa\u5230\u7cfb\u7edf\u65e5\u5fd7\u3002</li> <li>\u914d\u7f6e\u4e3a<code>\"console-syslog\"</code>\uff0c\u65e5\u5fd7\u5c06\u5728\u8f93\u51fa\u5230\u7cfb\u7edf\u65e5\u5fd7\u7684\u57fa\u7840\u4e0a\uff0c\u540c\u65f6\u6253\u5370\u5230\u7ec8\u7aef\u3002</li> <li>\u914d\u7f6e\u4e3a<code>\"file\"</code>\uff0c\u65e5\u5fd7\u5c06\u8f93\u51fa\u5230<code>/var/log/sysmaster/sysmaster.log</code>\uff0c\u6587\u4ef6\u6743\u9650\u4e3a600\uff0c<code>/var/log/sysmaster</code>\u76ee\u5f55\u7684\u6743\u9650\u4e3a700\u3002</li> </ul>"},{"location":"man/sysmaster.conf/#logfilesize","title":"LogFileSize","text":"<ul> <li>\u7c7b\u578b\uff1a\u6570\u503c\uff0c\u5355\u4f4d\uff08kB\uff09</li> </ul> <p>\u914d\u7f6e<code>LogTarget</code>\u4e3a<code>\"file\"</code>\u65f6\uff0csysmaster\u4f1a\u5c06\u65e5\u5fd7\u751f\u6210\u5230<code>/var/log/sysmaster/sysmaster.log</code>\uff0c\u5982\u679c<code>sysmaster.log</code>\u7684\u5927\u5c0f\u8d85\u8fc7<code>LogFileSize</code>\u7684\u914d\u7f6e\uff0c\u5c06\u8fdb\u884c\u65e5\u5fd7\u8f6c\u50a8\uff0c\u8f6c\u50a8\u7684\u6587\u4ef6\u540d<code>sysmaster.log.1</code>\uff0c<code>sysmaster.log.2</code>\u3002\u6570\u5b57\u8d8a\u5c0f\u8868\u793a\u65e5\u5fd7\u6587\u4ef6\u8d8a\u65b0\u3002</p> <p>\u6ce8\u610f\uff1a \u8fd9\u91cc\u7684\u8f6c\u50a8\u95e8\u9650\u5e76\u4e0d\u662f\u7cbe\u786e\u7684\u9075\u4ece\u7528\u6237\u914d\u7f6e\uff0c\u4e3a\u907f\u514d\u65e5\u5fd7\u88ab\u622a\u65ad\uff0c\u4f1a\u6709\u5fae\u5c0f\u6d6e\u52a8\u3002</p>"},{"location":"man/sysmaster.conf/#logfilenumber","title":"LogFileNumber","text":"<ul> <li>\u7c7b\u578b\uff1a\u6570\u503c</li> </ul> <p>\u914d\u7f6e\u8f6c\u50a8\u6587\u4ef6\u7684\u6570\u91cf\uff0c\u5f53\u6587\u4ef6\u6570\u91cf\u8d85\u9650\u65f6\uff0c\u4f1a\u81ea\u52a8\u5220\u9664\u6700\u65e7\u7684\u65e5\u5fd7\u6587\u4ef6\u3002</p>"},{"location":"man/sysmaster.conf/#db","title":"\u5916\u7f6edb\u914d\u7f6e","text":"<p>\u652f\u6301\u901a\u8fc7<code>DbSize</code>\u7b49\u914d\u7f6e\u8c03\u6574\u5916\u7f6edb\u53c2\u91cf\u3002</p>"},{"location":"man/sysmaster.conf/#dbsize","title":"DbSize","text":"<ul> <li>\u7c7b\u578b\uff1a\u6570\u503c</li> </ul> <p>DbSize\u53c2\u91cf\u652f\u6301\u914d\u7f6e\u4e3a\u6700\u5927\u5185\u5b58\u5360\u7528\u89c4\u683c\uff0c\u5355\u4f4d\u4e3a\u5b57\u8282\u3002\u5f53\u914d\u7f6e\u503c\u5c0f\u4e8e\u5f53\u524dsysmaster\u6240\u7528\u5185\u5b58\u503c\u65f6\uff0c\u4ee5\u5f53\u524dsysmaster\u6240\u7528\u5185\u5b58\u503c\u4e3a\u51c6\u3002\u6b64\u914d\u7f6e\u5728\u7cfb\u7edf\u542f\u52a8\u6216\u8005daemon-reexec\u540e\u751f\u6548\u3002</p>"},{"location":"man/systemd2sysmaster/","title":"systemd\u8fc1\u79fb\u5230sysmaster\u8bf4\u660e","text":""},{"location":"man/systemd2sysmaster/#toml","title":"toml\u914d\u7f6e\u683c\u5f0f","text":"<p>sysmaster\u7684\u5355\u5143\u914d\u7f6e\u6587\u4ef6\uff0c\u5982<code>.service</code>\u3001<code>.socket</code>\u7b49\u4f7f\u7528toml\u914d\u7f6e\u683c\u5f0f\u89e3\u6790\uff0c\u7ec6\u8282\u8bf7\u53c2\u8003\uff1ahttps://github.com/toml-lang/toml\u3002</p> <p>\u4e00\u4e9b\u5e38\u89c1\u7684\u914d\u7f6e\u95ee\u9898\uff1a</p> <ol> <li>\u5e03\u5c14\u91cf\u53ea\u5141\u8bb8\u914d\u7f6e\u4e3a<code>true</code>\u6216<code>false</code>\u3002 systemd\u652f\u6301\u89e3\u6790<code>yes</code>\u3001<code>no</code>\u3001<code>y</code>\u3001<code>n</code>\u7b49\u591a\u79cd\u5e03\u5c14\u91cf\u7684\u8868\u793a\u5f62\u5f0f\uff0c\u4f46sysmaster\u4e0d\u652f\u6301\u3002</li> <li>\u5b57\u7b26\u4e32\u8bf7\u4f7f\u7528<code>\"</code>\u3002 systemd\u5728\u914d\u7f6e\u5982\uff1a<code>ExecStart</code>\u3001<code>Description</code>\u7b49\u5b57\u7b26\u4e32\u7684\u503c\u65f6\uff0c\u65e0\u9700\u4f7f\u7528\u5f15\u53f7\uff0c\u4f46sysmaster\u5fc5\u987b\u4f7f\u7528\u5f15\u53f7\u3002</li> <li>\u76f8\u540c\u914d\u7f6e\u4ec5\u5141\u8bb8\u914d\u7f6e\u4e00\u6b21\u3002 systemd\u652f\u6301\u914d\u7f6e\u591a\u4e2a<code>After</code>\u3001<code>Before</code>\u7b49\uff0csysmaster\u4e0d\u652f\u6301\uff0c\u7528\u6237\u53ef\u4ee5\u4f7f\u7528<code>\"</code>\u5305\u88f9\u7684<code>;</code>\u5206\u9694\u7684\u591a\u4e2a\u5355\u5143\u540d\u66ff\u6362\u3002\u8fd9\u91cc\u91cd\u70b9\u8bf4\u660e\uff0c\u5728\u591a\u4e2a\u5355\u5143\u7684\u573a\u666f\u4e0b\uff0c\u90e8\u5206\u7528\u6237\u53ef\u80fd\u4f1a\u6839\u636etoml\u8bed\u6cd5\u8bef\u914d\u7f6e\u4e3a<code>[]</code>\u6570\u7ec4\uff0csysmaster\u5b9e\u9645\u4e0a\u662f\u6309\u7167\u5b57\u7b26\u4e32\u5904\u7406\uff0c\u5185\u90e8\u91cd\u65b0\u89e3\u6790\u3002</li> <li>\u5206\u9694\u7b26\u4ec5\u652f\u6301<code>;</code>\u3002 systemd\u652f\u6301\u5982<code>;</code>\uff0c\u7a7a\u683c\u7b49\u591a\u79cd\u591a\u6837\u7684\u5206\u9694\u7b26\uff0c\u4f46sysmaster\u4ec5\u5141\u8bb8\u4f7f\u7528<code>;</code>\u3002</li> <li>\u9519\u8bef\u914d\u7f6e\u4f1a\u5bfc\u81f4\u5355\u5143\u65e0\u6cd5\u542f\u52a8\u3002 systemd\u4f1a\u5ffd\u7565\u4e00\u4e9b\u975e\u5173\u952e\u7684\u914d\u7f6e\u9519\u8bef\uff0c\u4f46sysmaster\u4e25\u683c\u68c0\u67e5\u914d\u7f6e\u662f\u5426\u6b63\u786e\uff0c\u914d\u7f6e\u9519\u8bef\u5c06\u5bfc\u81f4\u5355\u5143\u65e0\u6cd5\u542f\u52a8\u3002</li> <li>\u4e0d\u5141\u8bb8\u914d\u7f6e\u4e3a\u7a7a\u3002 systemd\u5141\u8bb8\u7528\u6237\u5c06\u67d0\u4e2a\u9009\u9879\u914d\u7f6e\u4e3a\u7a7a\uff0c\u6b64\u65f6\u5b83\u4f1a\u91c7\u7528\u7f3a\u7701\u503c\u3002sysmaster\u4e0d\u5141\u8bb8\u914d\u7f6e\u4e3a\u7a7a\uff0c\u5982\u679c\u7528\u6237\u9700\u8981\u4f7f\u7528\u7f3a\u7701\u503c\uff0c\u53ef\u4ee5\u76f4\u63a5\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u5220\u9664\u8be5\u914d\u7f6e\u3002</li> <li>\u5c3d\u91cf\u907f\u514d\u4f7f\u7528dropin\u76ee\u5f55\u3002 systemd\u5141\u8bb8\u7528\u6237\u81ea\u5b9a\u4e49dropin\u76ee\u5f55\u4f5c\u4e3a\u539f\u6709\u5355\u5143\u914d\u7f6e\u7684\u8865\u5145\u3002\u4ee5<code>foo.service: After=bar1.service</code>\u3001<code>foo.service.d/10.conf: After=bar2.service</code>\u4e3a\u4f8b\uff0c\u5bf9\u540c\u4e00\u4f18\u5148\u7ea7\u76ee\u5f55\u4e0b\u7684\u8fd9\u4e24\u4e2a\u914d\u7f6e\u6587\u4ef6\u5b9a\u4e49\u4e86\u76f8\u540c\u7684\u5b57\u6bb5\uff0csystemd\u4f1a\u667a\u80fd\u5408\u5e76\uff0c\u597d\u50cf\u4ed6\u4eec\u662f\u5199\u5728\u540c\u4e00\u4e2a\u6587\u4ef6\u4e2d\u3002\u5373\uff1a\u4e0a\u8ff0\u5199\u6cd5\u7b49\u4ef7\u4e8e<code>foo.service: After=bar1.service, bar2.service</code>\u3002\u800csysmaster\u5e95\u5c42\u57fa\u4e8e<code>confique</code>\u7684\u89e3\u6790\u5668\uff0c\u4f1a\u6839\u636e\u6587\u4ef6\u7684\u6dfb\u52a0\u987a\u5e8f\uff0c\u968f\u673a\u9009\u62e9\u4e00\u4e2a\u3002\u5373\uff1a\u4e0a\u8ff0\u5199\u6cd5\u5728sysmaster\u4e2d\u7b49\u4ef7\u4e8e<code>foo.service: After=bar1.service</code> \u6216 <code>foo.service: After=bar2.service</code>\u3002</li> </ol>"},{"location":"man/unit/","title":"Unit \u914d\u7f6e","text":""},{"location":"man/unit/#unit_1","title":"Unit\u63cf\u8ff0","text":""},{"location":"man/unit/#description","title":"Description","text":"<ul> <li>\u7c7b\u578b\uff1a\u5b57\u7b26\u4e32</li> </ul> <p>\u5141\u8bb8\u914d\u7f6e\u4e3a\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u8bf4\u660e\u8be5unit\u7684\u4e3b\u8981\u529f\u80fd\u3002</p>"},{"location":"man/unit/#documentation","title":"Documentation","text":"<ul> <li>\u7c7b\u578b\uff1a\u5b57\u7b26\u4e32</li> </ul> <p>\u5141\u8bb8\u914d\u7f6e\u4e3a\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u8bf4\u660e\u8be5unit\u7684\u6587\u6863\u94fe\u63a5\u3002</p>"},{"location":"man/unit/#_1","title":"\u6761\u4ef6\u52a8\u4f5c","text":"<p>sysmaster\u517c\u5bb9systemd\u7684SuccessAction\u3001FailureAction\u3001StartLimitAction\u7b49\u914d\u7f6e\u3002\u8fd9\u4e9b\u914d\u7f6e\u5141\u8bb8\u67d0\u4e2aunit\u7684\u72b6\u6001\u53d1\u751f\u53d8\u66f4\u65f6\u4fee\u6539\u64cd\u4f5c\u7cfb\u7edf\u7684\u72b6\u6001\uff0c\u4f8b\u5982\u91cd\u542f\u3001\u5173\u673a\u6216\u9000\u51fa\u3002</p>"},{"location":"man/unit/#successactionfailureaction","title":"SuccessAction/FailureAction","text":"<ul> <li>\u7c7b\u578b\uff1a\u5b57\u7b26\u4e32</li> </ul> <p>\u914d\u7f6e\u5f53unit\u7ed3\u675f\uff08SuccessAction\uff09\u6216\u8fdb\u5165\u5931\u8d25\u72b6\u6001\uff08FailureAction\uff09\u65f6\u91c7\u53d6\u7684\u52a8\u4f5c\u3002\u53ef\u4ee5\u914d\u7f6e\u7684\u503c\u5305\u62ec\uff1a <code>\"none\"</code>\uff0c<code>\"reboot\"</code>\uff0c<code>\"reboot-force\"</code>\uff0c<code>\"reboot-immediate\"</code>\uff0c<code>\"poweroff\"</code>\uff0c<code>\"poweroff-force\"</code>\uff0c<code>\"poweroff-immediate\"</code>\uff0c<code>\"exit\"</code>\u548c<code>\"exit-force\"</code>\u3002</p> <p>\u5f53\u914d\u7f6e\u4e3a<code>none</code>\u65f6\uff0c\u4e0d\u89e6\u53d1\u4efb\u4f55\u52a8\u4f5c\uff0c\u6240\u6709unit\u7684\u9ed8\u8ba4\u503c\u4e3a<code>\"none\"</code>\u3002<code>\"reboot\"</code>\uff0c<code>\"poweroff\"</code>\uff0c<code>\"exit\"</code>\u4f1a\u5206\u522b\u89e6\u53d1<code>reboot.target</code>\uff0c<code>poweroff.target</code>\uff0c<code>exit.target</code>\uff0c\u4e0e\u6b63\u5e38\u7684\u7cfb\u7edf\u91cd\u542f\u3001\u5173\u673a\u3001\u9000\u51fa\u6d41\u7a0b\u4e00\u81f4\u3002<code>\"reboot-force\"</code>\uff0c<code>\"poweroff-force\"</code>\uff0c<code>\"exit-force\"</code>\u4f1a\u5206\u522b\u89e6\u53d1sysmaster\u4ee5\u76f8\u5e94\u7684\u72b6\u6001\u9000\u51fa\uff0c\u5f3a\u884c\u6740\u6b7b\u670d\u52a1\u53ca\u76f8\u5173\u8fdb\u7a0b\u3002<code>\"reboot-immediate\"</code>\uff0c<code>\"poweroff-immediate\"</code>\u4f1a\u5206\u522b\u89e6\u53d1\u7cfb\u7edf\u7acb\u5373\u91cd\u542f\u3001\u5173\u673a\uff0c\u76f4\u63a5\u8c03\u7528reboot(2)\u3002</p>"},{"location":"man/unit/#startlimitaction","title":"StartLimitAction","text":"<ul> <li>\u7c7b\u578b\uff1a\u5b57\u7b26\u4e32</li> </ul> <p>\u914d\u7f6e\u5f53unit\u89e6\u53d1\u542f\u52a8\u9650\u5236\u65f6\u91c7\u53d6\u7684\u52a8\u4f5c\u3002\u914d\u7f6e\u7684\u503c\u4e0e\u91c7\u53d6\u7684\u52a8\u4f5c\u4e0e<code>SuccessAction</code>\u3001<code>FailureAction</code>\u4e00\u81f4\u3002</p> <p>\u89e6\u53d1\u542f\u52a8\u9650\u5236\u6307\uff1asysmaster\u6700\u591a\u5141\u8bb8\u5355\u4e2aunit\u5728<code>StartLimitInterval</code>\u65f6\u95f4\u5185\u542f\u52a8<code>StartLimitBurst</code>\u6b21\u3002</p>"},{"location":"man/unit/#startlimitinterval","title":"StartLimitInterval","text":"<ul> <li>\u7c7b\u578b\uff1a\u6570\u503c</li> </ul> <p>\u9650\u5236\u542f\u52a8\u7684\u65f6\u95f4\u533a\u95f4, \u5355\u4f4d\u4e3a\u79d2\uff0c \u9ed8\u8ba4\u503c\u4e3a10\u79d2\u3002</p>"},{"location":"man/unit/#startlimitburst","title":"StartLimitBurst","text":"<ul> <li>\u7c7b\u578b\uff1a\u6570\u503c</li> </ul> <p>\u5355\u4f4d\u65f6\u95f4\u5185\u6700\u591a\u7684\u542f\u52a8\u6b21\u6570\uff0c \u9ed8\u8ba4\u503c\u4e3a5\u3002 \u53ea\u8981<code>StartLimitInterval</code>\u4e0e<code>StartLimitBurst</code>\u5176\u4e2d\u4e00\u9879\u914d\u7f6e\u4e3a0\u65f6\u4e0d\u542f\u52a8\u9650\u901f\u3002</p>"},{"location":"man/unit/#jobtimeoutactionjobtimeoutsec","title":"JobTimeoutAction\uff0cJobTimeoutSec","text":"<ul> <li>\u7c7b\u578b\uff1a\u5b57\u7b26\u4e32</li> </ul> <p><code>JobTimeoutAction</code>\u914d\u7f6eunit\u7684job\u8fd0\u884c\u8d85\u65f6\u65f6\u91c7\u53d6\u7684\u52a8\u4f5c\uff0c\u914d\u7f6e\u7684\u503c\u4e0e\u91c7\u53d6\u7684\u52a8\u4f5c\u4e0e<code>SuccessAction</code>\u3001<code>FailureAction</code>\u4e00\u81f4\u3002</p> <p><code>JobTimeoutSec</code>\u914d\u7f6eunit\u7684job\u8fd0\u884c\u8d85\u65f6\u65f6\u95f4\uff0c\u5355\u4f4d\u662f<code>\u79d2</code>\u3002systemd\u7981\u7528<code>JobTimeoutSec</code>\u7684\u914d\u7f6e\u4e3a<code>\"infinity\"</code>\uff0csysmaster\u4e0e\u4e4b\u4e0d\u540c\uff0c\u7981\u7528<code>JobTimeoutSec</code>\u9700\u8981\u914d\u7f6e\u4e3a<code>\"0\"</code>\u3002</p>"},{"location":"man/unit/#_2","title":"\u987a\u5e8f\u548c\u4f9d\u8d56","text":"<p>sysmaster\u652f\u6301\u914d\u7f6e\u5355\u5143\u4e4b\u95f4\u7684\u987a\u5e8f\u53ca\u4f9d\u8d56\u5173\u7cfb\uff0c\u53ef\u4ee5\u914d\u7f6e\u7684\u503c\u4e3a<code>;</code>\u5206\u9694\u7684\u5355\u5143\u3002\u5982<code>After=\"foo.service;bar.target\"</code>\u3002\u9700\u8981\u6ce8\u610f\uff1a</p> <ol> <li>\u5355\u5143\u4e4b\u95f4\u4e0d\u5141\u8bb8\u6709\u591a\u4f59\u7684\u7a7a\u683c</li> <li>\u4ec5\u652f\u6301\u901a\u8fc7<code>;</code>\u5206\u9694\uff0c\u4e0esystemd\u7684\u7a7a\u683c\u5206\u9694\u5b58\u5728\u5dee\u5f02</li> <li>\u4e0d\u652f\u6301systemd\u540c\u4e00\u914d\u7f6e\u9879\u914d\u7f6e\u591a\u6b21\u7684\u573a\u666f\uff0c\u5982:     After=\"foo.service\"     After=\"bar.service\"</li> </ol>"},{"location":"man/unit/#afterbefore","title":"After/Before","text":"<ul> <li>\u7c7b\u578b\uff1a\u5b57\u7b26\u4e32</li> </ul> <p><code>After</code>\u548c<code>Before</code>\u80fd\u591f\u914d\u7f6e\u540c\u65f6\u542f\u52a8\u7684\u5355\u5143\u7684\u5148\u540e\u987a\u5e8f\u3002\u5982<code>foo.service</code>\u914d\u7f6e\u4e86<code>After=\"bar.service\" Wants=\"bar.service\"</code>\uff0c<code>foo.service</code>\u5c06\u5728<code>bar.service</code>\u542f\u52a8\u5b8c\u6210\u540e\u542f\u52a8\u3002\u9700\u8981\u6ce8\u610f\uff1a</p> <ol> <li><code>After</code>\u548c<code>Before</code>\u4ec5\u786e\u5b9a\u542f\u52a8\u7684\u5148\u540e\u987a\u5e8f\uff0c\u4e0d\u81ea\u52a8\u6dfb\u52a0\u4f9d\u8d56\u3002\u5728\u4e0a\u9762\u7684\u4f8b\u5b50\u4e2d\u5982\u679c\u6ca1\u6709\u914d\u7f6e<code>Wants=\"bar.service\"</code>\uff0c<code>foo.service</code>\u4e5f\u80fd\u6b63\u5e38\u542f\u52a8\uff0c\u4e14\u4e0d\u4f1a\u81ea\u52a8\u62c9\u8d77<code>bar.service</code>\u3002</li> <li>\u540e\u5e8f\u5355\u5143\u4e0d\u5173\u6ce8\u524d\u5e8f\u5355\u5143\u7684\u542f\u52a8\u7ed3\u679c\uff0c\u8fd9\u610f\u5473\u7740\u5728\u4e0a\u9762\u7684\u4f8b\u5b50\u4e2d\uff0c\u5373\u4f7f<code>bar.service</code>\u542f\u52a8\u5931\u8d25\uff0c<code>foo.service</code>\u4f9d\u65e7\u80fd\u6b63\u5e38\u62c9\u8d77\u3002</li> </ol> <p><code>After</code>\u548c<code>Before</code>\u7684\u4f9d\u8d56\u76f8\u53cd\u3002\u5728\u5173\u673a\u9636\u6bb5\uff0c\u4f9d\u8d56\u53cd\u8f6c\u3002</p>"},{"location":"man/unit/#wantsrequiresrequisitepartofbindstoconflicts","title":"Wants/Requires/Requisite/PartOf/BindsTo/Conflicts","text":"<p>\u8fd9\u4e9b\u914d\u7f6e\u9879\u5747\u7528\u4e8e\u914d\u7f6e\u5355\u5143\u4e4b\u95f4\u7684\u4f9d\u8d56\uff0c\u4ee5<code>foo.service</code>\u914d\u7f6e<code>Wants/Requisite...=\"bar.service\"</code>\u4e3a\u4f8b\u8be6\u7ec6\u8bf4\u660e\u3002</p> <p><code>Wants</code>\uff1a\u914d\u7f6e\u4e00\u4e2a\u5355\u5143\u5bf9\u53e6\u4e00\u4e2a\u5355\u5143\u7684\u4f9d\u8d56\u3002\u5728\u542f\u52a8<code>foo.service</code>\u65f6\uff0c\u5c06\u81ea\u52a8\u62c9\u8d77<code>bar.service</code>\u3002\u4f46\u662f<code>bar.service</code>\u7684\u542f\u52a8\u7ed3\u679c\u4e0d\u5f71\u54cd<code>foo.service</code>\u3002</p> <p><code>Requires</code>\uff1a\u4e0e<code>Wants</code>\u7c7b\u4f3c\uff0c\u533a\u522b\u5728\u4e8e\u5982\u679c<code>bar.service</code>\u542f\u52a8\u5931\u8d25\uff0c<code>foo.service</code>\u4e5f\u540c\u65f6\u8fdb\u5165\u5931\u8d25\u72b6\u6001\u3002\u91cd\u542f\u6216\u5173\u95ed<code>bar.service</code>\u4f1a\u4f20\u9012\u5230<code>foo.service</code>\uff0c\u4f7f<code>foo.service</code>\u8ddf\u968f\u91cd\u542f\u6216\u5173\u95ed\u3002</p> <p><code>Requisite</code>\uff1a\u4e0e<code>Requires</code>\u7c7b\u4f3c\uff0c\u533a\u522b\u5728\u4e8e\u542f\u52a8<code>foo.service</code>\u65f6\uff0c\u5982\u679c<code>bar.service</code>\u8fd8\u672a\u542f\u52a8\u6210\u529f\uff0c\u90a3\u4e48<code>foo.service</code>\u4f1a\u76f4\u63a5\u5931\u8d25\u3002\u6ce8\u610f\uff1a<code>Requisite</code>\u5fc5\u987b\u4e0e<code>After</code>\u914d\u5408\u4f7f\u7528\uff0c\u5426\u5219\u542f\u52a8<code>bar.service</code>\u4e0d\u68c0\u67e5<code>foo.service</code>\uff0c\u8fd9\u4e0esystemd\u884c\u4e3a\u4e00\u81f4\u3002</p> <p><code>PartOf</code>\uff1a\u4e0e<code>Requires</code>\u7c7b\u4f3c\uff0c\u533a\u522b\u5728\u4e8e\u4f9d\u8d56\u4ec5\u5f71\u54cd\u5355\u5143\u7684\u91cd\u542f\u6216\u5173\u95ed\u3002</p> <p><code>BindsTo</code>\uff1a\u4e0e<code>Requires</code>\u7c7b\u4f3c\uff0c\u4f46\u4f9d\u8d56\u66f4\u5f3a\uff0c\u5f53<code>bar.service</code>\u7684\u72b6\u6001\u7a81\u7136\u53d1\u751f\u53d8\u5316\u65f6\uff0c<code>foo.service</code>\u4f1a\u8ddf\u968f\u7acb\u5373\u53d8\u5316\u3002</p> <p><code>Conflicts</code>\uff1a<code>foo.service</code>\u4e0e<code>bar.service</code>\u7684\u72b6\u6001\u76f8\u53cd\u3002\u542f\u52a8<code>foo.service</code>\u5c06\u5173\u95ed<code>bar.service</code>\uff0c\u542f\u52a8<code>bar.service</code>\u4f1a\u5173\u95ed<code>foo.service</code>\u3002</p> <p><code>Wants</code>\u548c<code>Requires</code>\u9664\u4e86\u652f\u6301\u901a\u8fc7<code>.service/.target/.socket</code>\u7b49\u5355\u5143\u914d\u7f6e\u6587\u4ef6\u914d\u7f6e\uff0c\u4e5f\u5141\u8bb8\u5728<code>/etc/sysmaster/system/</code>\u6216<code>/usr/lib/sysmaster/system/</code>\u76ee\u5f55\u4e0b\u521b\u5efa<code>\u5355\u5143\u540d.wants/\u5355\u5143\u540d.requires</code>\u76ee\u5f55\uff0c\u5e76\u5728\u91cc\u9762\u6dfb\u52a0\u6307\u5411\u4f9d\u8d56\u5355\u5143\u7684\u8f6f\u94fe\u63a5\u3002\u4f8b\u5982\u4e3a\u4e86\u7ed9<code>foo.service</code>\u914d\u7f6e<code>Wants=\"bar.service\"</code>\uff0c\u53ef\u4ee5\u521b\u5efa<code>/etc/sysmaster/system/foo.service.wants</code>\u76ee\u5f55\uff0c\u5e76\u5728\u8be5\u76ee\u5f55\u5185\u521b\u5efa<code>bar.service -&gt; /etc/sysmaster/system/bar.service</code>\u7684\u8f6f\u94fe\u63a5\u3002</p>"},{"location":"man/unit/#onfailureonsuccess","title":"OnFailure/OnSuccess","text":"<ul> <li>\u7c7b\u578b\uff1a\u5b57\u7b26\u4e32</li> </ul> <p><code>OnFailure</code>\uff1a\u914d\u7f6e\u5f53\u4e00\u4e2aunit\u542f\u52a8\u5931\u8d25\u6216\u6210\u529f\u7ed3\u675f\u540e\uff0c\u5bf9\u5176\u4ed6\u670d\u52a1\u7684\u5f71\u54cd\u3002\u4ee5<code>foo.service</code>\u914d\u7f6e<code>OnFailure/OnSuccess=\"bar.service\"</code>\u4e3a\u4f8b\uff0c\u5f53<code>foo.service</code>\u542f\u52a8\u5931\u8d25\u6216\u6210\u529f\u7ed3\u675f\u540e\uff0c\u5c06\u81ea\u52a8\u62c9\u8d77<code>bar.service</code>\u3002\u62c9\u8d77<code>bar.service</code>\u4f1a\u751f\u6210\u4e00\u4e2aStart\u7c7b\u578b\u7684job,\u8be5job\u7684\u6a21\u5f0f\u53ef\u914d\u7f6e\u4e3a<code>fail</code>\uff0c <code>replace</code>\uff0c<code>replace-irreversibly</code>\uff0c<code>isolate</code>\uff0c<code>flush</code>\uff0c<code>ignore-dependencies</code>\u6216<code>ignore-requirements</code>\u3002</p>"},{"location":"man/unit/#defaultdependencies","title":"DefaultDependencies","text":"<ul> <li>\u7c7b\u578b\uff1a\u5e03\u5c14\u503c</li> </ul> <p><code>DefaultDependencies</code>\u914d\u7f6e\u662f\u5426\u4e3a\u5355\u5143\u6dfb\u52a0\u7f3a\u7701\u4f9d\u8d56\uff0c\u9ed8\u8ba4\u503c\u4e3a<code>true</code>\u3002\u7f3a\u7701\u4f9d\u8d56\u5982\u4e0b\uff1a</p> <ol> <li>\u6240\u6709\u7c7b\u578b\u7684\u5355\u5143\u7edf\u4e00\u6dfb\u52a0<code>Conflict=\"shutdown.target\"</code>\uff0c<code>Before=\"shutdown.target\"</code>\u3002</li> <li>\u9488\u5bf9\u4e0d\u540c\u7c7b\u578b\u7684\u5355\u5143\uff0c\u989d\u5916\u6dfb\u52a0\u4ee5\u4e0b\u4f9d\u8d56</li> </ol> <ul> <li>\u5bf9<code>.service</code>\uff0c\u6dfb\u52a0<code>Requires=\"sysinit.target\"</code>\uff0c<code>After=\"sysinit.target\"</code>\uff0c<code>After=\"basic.target\"</code>\u3002</li> <li>\u5bf9<code>.socket</code>\uff0c\u6dfb\u52a0<code>Requires=\"sysinit.target\"</code>\uff0c<code>After=\"sysinit.target\"</code>\uff0c<code>After=\"socket.target\"</code>\u3002</li> <li>\u5bf9<code>.target</code>\uff0c\u5bf9target\u914d\u7f6e\u7684<code>Requires=</code>\u3001<code>Wants=</code>\u8865\u5168<code>After=</code>\u3002</li> </ul>"},{"location":"man/unit/#_3","title":"\u542f\u52a8\u68c0\u67e5","text":"<p>sysmaster\u652f\u6301\u914d\u7f6e<code>Condition...</code>\u548c<code>Assert...</code>\u8fdb\u884c\u542f\u52a8\u68c0\u67e5\uff0c\u5f53\u6761\u4ef6\u4e0d\u6ee1\u8db3\u65f6\uff0c\u505c\u6b62\u542f\u52a8\u6d41\u7a0b\u3002\u6240\u6709\u914d\u7f6e\u5747\u652f\u6301\u901a\u8fc7\u5728\u503c\u524d\u9762\u6dfb\u52a0<code>!</code>\u53cd\u8f6c\u68c0\u67e5\u7ed3\u679c\u3002</p>"},{"location":"man/unit/#conditionacpower","title":"ConditionACPower","text":"<ul> <li>\u7c7b\u578b\uff1a\u53ef\u9009\u7684\u5e03\u5c14\u503c</li> </ul> <p>\u68c0\u67e5\u64cd\u4f5c\u7cfb\u7edf\u662f\u5426\u8fde\u63a5\u4ea4\u6d41\u7535\u6e90\u3002\u53ef\u4ee5\u914d\u7f6e\u4e3a<code>false</code>\uff0c<code>true</code>\u3002\u914d\u7f6e\u4e3a<code>true</code>\u65f6\uff0c\u5f53\u64cd\u4f5c\u7cfb\u7edf\u81f3\u5c11\u4e00\u4e2a\u63a5\u53e3\u8fde\u63a5\u4e86\u4ea4\u6d41\u7535\uff0c\u6216\u8005\u65e0\u6cd5\u786e\u5b9a\u662f\u5426\u6709\u8fde\u63a5\u65f6\uff0c\u68c0\u67e5\u901a\u8fc7\u3002\u914d\u7f6e\u4e3a<code>false</code>\u65f6\uff0c\u5f53\u6210\u529f\u68c0\u67e5\u5230\u6240\u6709\u63a5\u53e3\u90fd\u6ca1\u6709\u8fde\u63a5\u4ea4\u6d41\u7535\u65f6\uff0c\u68c0\u67e5\u901a\u8fc7\u3002\u5982\u679c\u4e0d\u914d\u7f6e\uff0c\u8df3\u8fc7\u8be5\u68c0\u67e5\u3002\u914d\u7f6e\u4e3a\u5176\u4ed6\u7684\u503c\uff0c\u4f1a\u5bfc\u81f4\u89e3\u6790\u5931\u8d25\u3002</p>"},{"location":"man/unit/#conditioncapability","title":"ConditionCapability","text":"<ul> <li>\u7c7b\u578b\uff1a\u5b57\u7b26\u4e32</li> </ul> <p>\u68c0\u6d4bsysmaster\u662f\u5426\u652f\u6301\u7ed9\u5b9a\u7684\u6743\u80fd\uff0c\u5141\u8bb8\u914d\u7f6e\u5f15\u53f7\u62ec\u8d77\u6765\u7684\u6743\u80fd\u540d\u79f0\uff0c\u5982<code>\"CAP_CHOWN\"</code>\u3002\u8be5\u914d\u7f6e\u4ec5\u5141\u8bb8\u914d\u7f6e\u4e00\u4e2a\u6743\u80fd\u3002\u901a\u8fc7\u8bfb\u53d6<code>/proc/self/status/</code>\u7684<code>CapBnd</code>\u68c0\u67e5sysmaster\u7684\u6743\u80fd\u7ec4\uff08Capability Set\uff09\uff0c\u5982\u679c\u5305\u542b\u6307\u5b9a\u7684\u6743\u80fd\uff0c\u90a3\u4e48\u68c0\u67e5\u901a\u8fc7\uff1b\u5426\u5219\uff0c\u68c0\u67e5\u5931\u8d25\u3002</p>"},{"location":"man/unit/#conditiondirectorynotempty","title":"ConditionDirectoryNotEmpty","text":"<ul> <li>\u7c7b\u578b\uff1a\u5b57\u7b26\u4e32</li> </ul> <p>\u68c0\u67e5\u914d\u7f6e\u7684\u7edd\u5bf9\u8def\u5f84\u76ee\u5f55\u662f\u5426\u975e\u7a7a\uff0c\u5982\u679c\u4e3a\u8f6f\u94fe\u63a5\uff0c\u5219\u5224\u65ad\u8f6f\u94fe\u63a5\u6307\u5411\u7684\u76ee\u5f55\u3002\u5982\u679c\u76ee\u5f55\u975e\u7a7a\uff0c\u68c0\u67e5\u901a\u8fc7\uff1b\u5426\u5219\uff0c\u68c0\u67e5\u5931\u8d25\u3002</p>"},{"location":"man/unit/#conditionfileisexecutable","title":"ConditionFileIsExecutable","text":"<ul> <li>\u7c7b\u578b\uff1a\u5b57\u7b26\u4e32</li> </ul> <p>\u68c0\u67e5\u914d\u7f6e\u7684\u7edd\u5bf9\u8def\u5f84\u6587\u4ef6\u662f\u5426\u53ef\u6267\u884c\uff0c\u5982\u679c\u4e3a\u8f6f\u94fe\u63a5\uff0c\u5219\u5224\u65ad\u8f6f\u94fe\u63a5\u6307\u5411\u7684\u6587\u4ef6\u3002\u5982\u679c\u53ef\u6267\u884c\uff0c\u68c0\u67e5\u901a\u8fc7\uff1b\u5426\u5219\uff0c\u68c0\u67e5\u5931\u8d25\u3002</p>"},{"location":"man/unit/#conditionfirstboot","title":"ConditionFirstBoot","text":"<ul> <li>\u7c7b\u578b\uff1a\u53ef\u9009\u7684\u5e03\u5c14\u503c</li> </ul> <p>\u68c0\u6d4b\u7cfb\u7edf\u662f\u5426\u9996\u6b21\u542f\u52a8\uff0c\u53ef\u914d\u7f6e\u4e3a<code>false</code>\u3001<code>true</code>\u3002\u7528\u4e8e\u7cfb\u7edf\u51fa\u5382\u540e(\u6216\u8005\u6062\u590d\u51fa\u5382\u8bbe\u7f6e\u4e4b\u540e)\uff0c\u9996\u6b21\u5f00\u673a\u65f6\u6267\u884c\u5fc5\u8981\u7684\u521d\u59cb\u5316\u64cd\u4f5c\u3002\u8be5\u9009\u9879\u5c06\u4f1a\u68c0\u6d4b<code>/run/sysmaster/first-boot</code>\u6587\u4ef6\u662f\u5426\u5b58\u5728\u3002\u82e5\u6587\u4ef6\u5b58\u5728\uff0c\u5219\u8868\u660e\u7cfb\u7edf\u9996\u6b21\u542f\u52a8\uff0c\u53cd\u4e4b\uff0c\u5219\u8868\u660e\u7cfb\u7edf\u975e\u9996\u6b21\u542f\u52a8\u3002\u5982\u679c\u5728\u5185\u6838\u547d\u4ee4\u884c\u4e0a\u6307\u5b9a\u4e86<code>sysmaster.condition-first-boot=</code>\u9009\u9879\uff08\u91c7\u7528\u5e03\u5c14\u503c\uff09\uff0c\u5b83\u5c06\u4f18\u5148\u4e8e<code>/run/sysmaster/first-boot</code>\u6587\u4ef6\u662f\u5426\u5b58\u5728\u7684\u68c0\u67e5\u7ed3\u679c\u3002</p>"},{"location":"man/unit/#conditionkernelcommandline","title":"ConditionKernelCommandLine","text":"<ul> <li>\u7c7b\u578b\uff1a\u5b57\u7b26\u4e32</li> </ul> <p>\u68c0\u67e5\u5185\u6838\u547d\u4ee4\u884c\u662f\u5426\u914d\u7f6e\u7ed9\u5b9a\u7684\u5185\u5bb9\u3002\u8be5\u9009\u9879\u4ec5\u5141\u8bb8\u914d\u7f6e \u4e00\u4e2a \u5355\u8bcd\u6216\u8005<code>=</code>\u5206\u9694\u7684\u952e\u503c\u5bf9\uff0c\u4f8b\u5982\uff1a<code>\"ro\"</code>\uff0c<code>\"crashkernel=512M\"</code>\u3002\u914d\u7f6e\u4e3a\u5355\u8bcd\u65f6\uff0c\u68c0\u67e5\u5185\u6838\u547d\u4ee4\u884c\u662f\u5426\u5305\u542b \u8be5\u5355\u8bcd\u6216\u4f5c\u4e3a\u952e\u503c\u5bf9\u7684\u952e\u3002\u914d\u7f6e\u4e3a\u952e\u503c\u5bf9\u65f6\uff0c\u5c06\u68c0\u67e5\u662f\u5426\u5b58\u5728\u5b8c\u5168\u4e00\u81f4\u7684\u952e\u503c\u5bf9\u3002\u5185\u6838\u547d\u4ee4\u884c\u4ec5\u652f\u6301\u8bfb\u53d6<code>/proc/cmdline</code>\u3002</p>"},{"location":"man/unit/#conditionpathexists","title":"ConditionPathExists","text":"<ul> <li>\u7c7b\u578b\uff1a\u5b57\u7b26\u4e32</li> </ul> <p>\u68c0\u67e5\u6587\u4ef6\u662f\u5426\u5b58\u5728\u3002\u53ea\u6709<code>ConditionPathExists=</code>\u540e\u914d\u7f6e\u7684\u7edd\u5bf9\u8def\u5f84\u5b58\u5728\u65f6\uff0c\u68c0\u67e5\u901a\u8fc7\uff0c\u542f\u52a8\u6d41\u7a0b\u6b63\u5e38\uff1b\u5982\u679c\u914d\u7f6e\u7684\u7edd\u5bf9\u8def\u5f84\u4e0d\u5b58\u5728\uff0c\u5219\u68c0\u67e5\u5931\u8d25\uff0c\u505c\u6b62\u5355\u5143\u7684\u542f\u52a8\u6d41\u7a0b\u3002</p>"},{"location":"man/unit/#conditionpathexistsglob","title":"ConditionPathExistsGlob","text":"<ul> <li>\u7c7b\u578b\uff1a\u5b57\u7b26\u4e32</li> </ul> <p>\u4e0e<code>ConditionPathExists</code>\u7c7b\u4f3c\uff0c\u533a\u522b\u5728\u4e8e<code>ConditionPathExistsGlob</code>\u652f\u6301\u901a\u914d\u7b26\u3002</p>"},{"location":"man/unit/#conditionpathisdirectory","title":"ConditionPathIsDirectory","text":"<ul> <li>\u7c7b\u578b\uff1a\u5b57\u7b26\u4e32</li> </ul> <p>\u68c0\u67e5<code>ConditionPathIsDirectory=</code>\u540e\u914d\u7f6e\u7684\u7edd\u5bf9\u8def\u5f84\u662f\u5426\u4e3a\u76ee\u5f55\uff0c\u5982\u679c\u662f\uff0c\u68c0\u67e5\u901a\u8fc7\uff1b\u5426\u5219\u68c0\u67e5\u5931\u8d25\u3002</p>"},{"location":"man/unit/#conditionpathismountpoint","title":"ConditionPathIsMountPoint","text":"<ul> <li>\u7c7b\u578b\uff1a\u5b57\u7b26\u4e32</li> </ul> <p>\u68c0\u67e5<code>ConditionPathIsMountPoint=</code>\u540e\u914d\u7f6e\u7684\u7edd\u5bf9\u8def\u5f84\u662f\u5426\u4e3a\u6302\u8f7d\u70b9\u76ee\u5f55\uff0c\u5982\u679c\u662f\u8f6f\u94fe\u63a5\uff0c\u5219\u68c0\u67e5\u8f6f\u94fe\u63a5\u6307\u5411\u7684\u76ee\u5f55\u3002\u8be5\u914d\u7f6e\u4ec5\u652f\u6301<code>kernel &gt; 4.11</code>\u7248\u672c\u3002\u5982\u679c\u662f\u6302\u8f7d\u70b9\u76ee\u5f55\uff0c\u68c0\u67e5\u901a\u8fc7\uff1b\u5426\u5219\uff0c\u68c0\u67e5\u5931\u8d25\u3002</p>"},{"location":"man/unit/#conditionpathisreadwrite","title":"ConditionPathIsReadWrite","text":"<ul> <li>\u7c7b\u578b\uff1a\u5b57\u7b26\u4e32</li> </ul> <p>\u4e0e<code>ConditionPathExists</code>\u7c7b\u4f3c\uff0c\u68c0\u67e5\u914d\u7f6e\u7684\u7edd\u5bf9\u8def\u5f84\u6240\u5c5e\u7684\u6587\u4ef6\u7cfb\u7edf\u662f\u5426\u4e3a\u53ef\u8bfb\u53ef\u5199\u3002</p>"},{"location":"man/unit/#conditionpathissymboliclink","title":"ConditionPathIsSymbolicLink","text":"<ul> <li>\u7c7b\u578b\uff1a\u5b57\u7b26\u4e32</li> </ul> <p>\u68c0\u67e5<code>ConditionPathIsSymbolicLink=</code>\u540e\u914d\u7f6e\u7684\u7edd\u5bf9\u8def\u5f84\u662f\u5426\u4e3a\u8f6f\u94fe\u63a5\uff0c\u5982\u679c\u662f\u8f6f\u94fe\u63a5\uff0c\u68c0\u67e5\u901a\u8fc7\uff1b\u5426\u5219\u68c0\u67e5\u5931\u8d25\u3002</p>"},{"location":"man/unit/#conditionsecurity","title":"ConditionSecurity","text":"<ul> <li>\u7c7b\u578b\uff1a\u5b57\u7b26\u4e32</li> </ul> <p><code>ConditionSecurity</code>\u53ef\u4ee5\u7528\u4e8e\u68c0\u67e5\u7cfb\u7edf\u662f\u5426\u652f\u6301\u7ed9\u5b9a\u7684\u5b89\u5168\u6280\u672f\u3002\u5f53\u524d\u652f\u6301\u7684\u503c\u5305\u62ec\uff1a<code>\"selinux\"</code>\uff0c<code>\"apparmor\"</code>\uff0c<code>\"tomoyo\"</code>\uff0c<code>\"ima\"</code>\uff0c<code>\"smack\"</code>\uff0c<code>\"audit\"</code>\uff0c<code>\"uefi-secureboot\"</code>\u548c<code>\"tpm2\"</code>\u3002 \u6ce8\u610f\uff1a \u68c0\u67e5<code>\"selinux\"</code>\u9700\u8981\u5728\u7f16\u8bd1\u65f6\u901a\u8fc7 <code>--features \"selinux\"</code> \u5f00\u542f <code>\"selinux\"</code> feature\u3002</p>"},{"location":"man/unit/#conditionuser","title":"ConditionUser","text":"<ul> <li>\u7c7b\u578b\uff1a\u5b57\u7b26\u4e32</li> </ul> <p>\u68c0\u6d4bsysmaster\u662f\u5426\u4ee5\u7ed9\u5b9a\u7684\u7528\u6237\u8eab\u4efd\u8fd0\u884c\u3002\u53c2\u6570\u53ef\u4ee5\u662f\u6570\u5b57\u5f62\u5f0f\u7684\"UID\"\u3001\u5b57\u7b26\u4e32\u5f62\u5f0f\u7684UNIX\u7528\u6237\u540d\u6216\u8005\u7279\u6b8a\u503c<code>\"@system\"</code>(\u8868\u793a\u5c5e\u4e8e\u7cfb\u7edf\u7528\u6237\u8303\u56f4\u5185)\u3002\u5982\u679c\u4e0d\u914d\u7f6e\uff0c\u9ed8\u8ba4\u8df3\u8fc7\u8be5\u68c0\u67e5\u3002</p>"},{"location":"man/unit/#_4","title":"\u5176\u4ed6\u914d\u7f6e","text":""},{"location":"man/unit/#refusemanualstartrefusemanualstop","title":"RefuseManualStart/RefuseManualStop","text":"<ul> <li>\u7c7b\u578b\uff1a\u5e03\u5c14\u503c</li> </ul> <p><code>RefuseManualStart</code>/<code>RefuseManualStop</code>\uff1a\u914d\u7f6e\u5355\u5143\u662f\u5426\u62d2\u7edd\u901a\u8fc7<code>sctl start/stop</code>\u7684\u5f62\u5f0f\u624b\u52a8\u542f\u52a8/\u5173\u95ed\u3002\u9ed8\u8ba4\u914d\u7f6e\u4e3a<code>false</code>\uff0c\u5373\u5141\u8bb8\u624b\u52a8\u542f\u52a8/\u5173\u95ed\u3002\u8be5\u914d\u7f6e\u4e0d\u5f71\u54cd\u901a\u8fc7\u4f9d\u8d56\u5173\u7cfb\u89e3\u6790\u542f\u52a8/\u5173\u95ed\u670d\u52a1\u3002</p>"}]}